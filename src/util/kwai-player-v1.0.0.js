"undefined"!=typeof window&&function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.KwaiPlayerKernelExternal=t():e.KwaiPlayerKernelExternal=t()}(this,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t,i){var r,n,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){"use strict";e.__esModule=!0,e.ObjectAssign=void 0;var t=Object.assign||function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=n[s])}return i};e.ObjectAssign=t})?r.apply(t,n):r)||(e.exports=s)},function(e,t,i){var r,n,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){"use strict";var t;e.__esModule=!0,e.MediaType=void 0,e.MediaType=t,function(e){e.video="video",e.audio="audio",e.unknown="unknown"}(t||(e.MediaType=t={}))})?r.apply(t,n):r)||(e.exports=s)},function(e,t,i){var r;
/*!
 * UAParser.js v0.7.21
 * Lightweight JavaScript-based User-Agent string parser
 * https://github.com/faisalman/ua-parser-js
 *
 * Copyright Â© 2012-2019 Faisal Salman <f@faisalman.com>
 * Licensed under MIT License
 */!function(n,s){"use strict";var o="model",a="name",u="type",l="vendor",d="version",c="mobile",f="tablet",h="smarttv",_={extend:function(e,t){var i={};for(var r in e)t[r]&&t[r].length%2==0?i[r]=t[r].concat(e[r]):i[r]=e[r];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},p={rgx:function(e,t){for(var i,r,n,s,o,a,u=0;u<t.length&&!o;){var l=t[u],d=t[u+1];for(i=r=0;i<l.length&&!o;)if(o=l[i++].exec(e))for(n=0;n<d.length;n++)a=o[++r],"object"==typeof(s=d[n])&&s.length>0?2==s.length?"function"==typeof s[1]?this[s[0]]=s[1].call(this,a):this[s[0]]=s[1]:3==s.length?"function"!=typeof s[1]||s[1].exec&&s[1].test?this[s[0]]=a?a.replace(s[1],s[2]):void 0:this[s[0]]=a?s[1].call(this,a,s[2]):void 0:4==s.length&&(this[s[0]]=a?s[3].call(this,a.replace(s[1],s[2])):void 0):this[s]=a||void 0;u+=2}},str:function(e,t){for(var i in t)if("object"==typeof t[i]&&t[i].length>0){for(var r=0;r<t[i].length;r++)if(_.has(t[i][r],e))return"?"===i?void 0:i}else if(_.has(t[i],e))return"?"===i?void 0:i;return e}},v={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},m={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[a,d],[/(opios)[\/\s]+([\w\.]+)/i],[[a,"Opera Mini"],d],[/\s(opr)\/([\w\.]+)/i],[[a,"Opera"],d],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[a,d],[/(konqueror)\/([\w\.]+)/i],[[a,"Konqueror"],d],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[a,"IE"],d],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[a,"Edge"],d],[/(yabrowser)\/([\w\.]+)/i],[[a,"Yandex"],d],[/(Avast)\/([\w\.]+)/i],[[a,"Avast Secure Browser"],d],[/(AVG)\/([\w\.]+)/i],[[a,"AVG Secure Browser"],d],[/(puffin)\/([\w\.]+)/i],[[a,"Puffin"],d],[/(focus)\/([\w\.]+)/i],[[a,"Firefox Focus"],d],[/(opt)\/([\w\.]+)/i],[[a,"Opera Touch"],d],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[a,"UCBrowser"],d],[/(comodo_dragon)\/([\w\.]+)/i],[[a,/_/g," "],d],[/(windowswechat qbcore)\/([\w\.]+)/i],[[a,"WeChat(Win) Desktop"],d],[/(micromessenger)\/([\w\.]+)/i],[[a,"WeChat"],d],[/(brave)\/([\w\.]+)/i],[[a,"Brave"],d],[/(qqbrowserlite)\/([\w\.]+)/i],[a,d],[/(QQ)\/([\d\.]+)/i],[a,d],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[a,d],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[a,d],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[a,d],[/(MetaSr)[\/\s]?([\w\.]+)/i],[a],[/(LBBROWSER)/i],[a],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[d,[a,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[d,[a,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[a,d],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[d,[a,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[a,/(.+)/,"$1 WebView"],d],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[a,/(.+(?:g|us))(.+)/,"$1 $2"],d],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[d,[a,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[a,"Sailfish Browser"],d],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[a,d],[/(dolfin)\/([\w\.]+)/i],[[a,"Dolphin"],d],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[a,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[a,"Chrome"],d],[/(coast)\/([\w\.]+)/i],[[a,"Opera Coast"],d],[/fxios\/([\w\.-]+)/i],[d,[a,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[d,[a,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[d,a],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[a,"GSA"],d],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[a,[d,p.str,v.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[a,d],[/(navigator|netscape)\/([\w\.-]+)/i],[[a,"Netscape"],d],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[a,d]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",_.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",_.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",_.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[o,l,[u,f]],[/applecoremedia\/[\w\.]+ \((ipad)/],[o,[l,"Apple"],[u,f]],[/(apple\s{0,1}tv)/i],[[o,"Apple TV"],[l,"Apple"],[u,h]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[l,o,[u,f]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[o,[l,"Amazon"],[u,f]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[o,p.str,v.device.amazon.model],[l,"Amazon"],[u,c]],[/android.+aft([bms])\sbuild/i],[o,[l,"Amazon"],[u,h]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[o,l,[u,c]],[/\((ip[honed|\s\w*]+);/i],[o,[l,"Apple"],[u,c]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[l,o,[u,c]],[/\(bb10;\s(\w+)/i],[o,[l,"BlackBerry"],[u,c]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[o,[l,"Asus"],[u,f]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[l,"Sony"],[o,"Xperia Tablet"],[u,f]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[o,[l,"Sony"],[u,c]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[l,o,[u,"console"]],[/android.+;\s(shield)\sbuild/i],[o,[l,"Nvidia"],[u,"console"]],[/(playstation\s[34portablevi]+)/i],[o,[l,"Sony"],[u,"console"]],[/(sprint\s(\w+))/i],[[l,p.str,v.device.sprint.vendor],[o,p.str,v.device.sprint.model],[u,c]],[/(htc)[;_\s-]+([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[l,[o,/_/g," "],[u,c]],[/(nexus\s9)/i],[o,[l,"HTC"],[u,f]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p|vog-l29|ane-lx1|eml-l29)/i],[o,[l,"Huawei"],[u,c]],[/android.+(bah2?-a?[lw]\d{2})/i],[o,[l,"Huawei"],[u,f]],[/(microsoft);\s(lumia[\s\w]+)/i],[l,o,[u,c]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[o,[l,"Microsoft"],[u,"console"]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[l,"Microsoft"],[u,c]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[o,[l,"Motorola"],[u,c]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[o,[l,"Motorola"],[u,f]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[l,_.trim],[o,_.trim],[u,h]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[l,"Samsung"],[u,h]],[/\(dtv[\);].+(aquos)/i],[o,[l,"Sharp"],[u,h]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[l,"Samsung"],o,[u,f]],[/smart-tv.+(samsung)/i],[l,[u,h],o],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[l,"Samsung"],o,[u,c]],[/sie-(\w*)/i],[o,[l,"Siemens"],[u,c]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[l,"Nokia"],o,[u,c]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[o,[l,"Acer"],[u,f]],[/android.+([vl]k\-?\d{3})\s+build/i],[o,[l,"LG"],[u,f]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[l,"LG"],o,[u,f]],[/(lg) netcast\.tv/i],[l,o,[u,h]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[o,[l,"LG"],[u,c]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[l,o,[u,f]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[o,[l,"Lenovo"],[u,f]],[/(lenovo)[_\s-]?([\w-]+)/i],[l,o,[u,c]],[/linux;.+((jolla));/i],[l,o,[u,c]],[/((pebble))app\/[\d\.]+\s/i],[l,o,[u,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[l,o,[u,c]],[/crkey/i],[[o,"Chromecast"],[l,"Google"],[u,h]],[/android.+;\s(glass)\s\d/i],[o,[l,"Google"],[u,"wearable"]],[/android.+;\s(pixel c)[\s)]/i],[o,[l,"Google"],[u,f]],[/android.+;\s(pixel( [23])?( xl)?)[\s)]/i],[o,[l,"Google"],[u,c]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:a\d|one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[o,/_/g," "],[l,"Xiaomi"],[u,c]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[o,/_/g," "],[l,"Xiaomi"],[u,f]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[o,[l,"Meizu"],[u,c]],[/(mz)-([\w-]{2,})/i],[[l,"Meizu"],o,[u,c]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[o,[l,"OnePlus"],[u,c]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[o,[l,"RCA"],[u,f]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[o,[l,"Dell"],[u,f]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[o,[l,"Verizon"],[u,f]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[l,"Barnes & Noble"],o,[u,f]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[o,[l,"NuVision"],[u,f]],[/android.+;\s(k88)\sbuild/i],[o,[l,"ZTE"],[u,f]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[o,[l,"Swiss"],[u,c]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[o,[l,"Swiss"],[u,f]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[o,[l,"Zeki"],[u,f]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[l,"Dragon Touch"],o,[u,f]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[o,[l,"Insignia"],[u,f]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[o,[l,"NextBook"],[u,f]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[l,"Voice"],o,[u,c]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[l,"LvTel"],o,[u,c]],[/android.+;\s(PH-1)\s/i],[o,[l,"Essential"],[u,c]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[o,[l,"Envizen"],[u,f]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[l,o,[u,f]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[o,[l,"MachSpeed"],[u,f]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[l,o,[u,f]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[o,[l,"Rotor"],[u,f]],[/android.+(KS(.+))\s+build/i],[o,[l,"Amazon"],[u,f]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[l,o,[u,f]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[u,_.lowerize],l,o],[/[\s\/\(](smart-?tv)[;\)]/i],[[u,h]],[/(android[\w\.\s\-]{0,9});.+build/i],[o,[l,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[d,[a,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d,[a,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[a,d],[/rv\:([\w\.]{1,9}).+(gecko)/i],[d,a]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[a,d],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[a,[d,p.str,v.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[a,"Windows"],[d,p.str,v.os.windows.version]],[/\((bb)(10);/i],[[a,"BlackBerry"],d],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[a,d],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[a,"Symbian"],d],[/\((series40);/i],[a],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[a,"Firefox OS"],d],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[a,d],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[a,"Chromium OS"],d],[/(sunos)\s?([\w\.\d]*)/i],[[a,"Solaris"],d],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[a,d],[/(haiku)\s(\w+)/i],[a,d],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[d,/_/g,"."],[a,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[a,"Mac OS"],[d,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[a,d]]},g=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof g))return new g(e,t).getResult();var i=e||(n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),r=t?_.extend(m,t):m;return this.getBrowser=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,i,r.browser),e.major=_.major(e.version),e},this.getCPU=function(){var e={architecture:void 0};return p.rgx.call(e,i,r.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return p.rgx.call(e,i,r.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,i,r.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,i,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};g.VERSION="0.7.21",g.BROWSER={NAME:a,MAJOR:"major",VERSION:d},g.CPU={ARCHITECTURE:"architecture"},g.DEVICE={MODEL:o,VENDOR:l,TYPE:u,CONSOLE:"console",MOBILE:c,SMARTTV:h,TABLET:f,WEARABLE:"wearable",EMBEDDED:"embedded"},g.ENGINE={NAME:a,VERSION:d},g.OS={NAME:a,VERSION:d},void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=g),t.UAParser=g):void 0===(r=function(){return g}.call(t,i,t,e))||(e.exports=r);var y=n&&(n.jQuery||n.Zepto);if(y&&!y.ua){var b=new g;y.ua=b.getResult(),y.ua.get=function(){return b.getUA()},y.ua.set=function(e){b.setUA(e);var t=b.getResult();for(var i in t)y.ua[i]=t[i]}}}("object"==typeof window?window:this)},function(e,t,i){var r,n,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[t,i(4),i(5),i(6),i(7),i(1)],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,t=o(t),n=o(n);var u=function(e){var i,o,u,l,d;function c(t){var i;return(i=e.call(this)||this)._kernel=void 0,i._reportingChannel=void 0,i._media=void 0,i._config=void 0,i._onReport=function(e){if(i._reportingChannel)switch(e.type){case"realtimeBeacon":i._reportingChannel.sendRealtime(e.value);break;case"download":i._reportingChannel.sendDownload(e.value)}},i._onError=function(e){i.emit("error",e)},i.off||(i.off=i.removeListener),i._config=(0,r.processConfig)(t),i._config.logBaseConfig&&(i._reportingChannel=new n.default({env:i._config.logEnv,autoPV:!1,timing:!1,crash:!1,fps:!1},i._config.logBaseConfig,c.version)),i}o=e,(i=c).prototype=Object.create(o.prototype),i.prototype.constructor=i,i.__proto__=o,u=c,d=[{key:"version",get:function(){return"1.0.0"}}],(l=null)&&a(u.prototype,l),d&&a(u,d);var f=c.prototype;return f.setBiz=function(e){this._reportingChannel&&this._reportingChannel.setBiz(e)},f.attachMedia=function(e){this._media=e,this._reportingChannel&&this._reportingChannel.setMediaType(e instanceof HTMLVideoElement?s.MediaType.video:s.MediaType.audio),this._kernel||this._initKernel()},f.load=function(e){this._kernel||this._initKernel(),this._kernel&&this._kernel.load(e)},f.sendSummary=function(){this._reportingChannel&&this._kernel&&this._reportingChannel.sendSummary(this._kernel.getAudienceStat())},f.refresh=function(){this._kernel&&this._kernel.refresh()},f.destroy=function(){this._destroyKernel()},f._initKernel=function(){if(this._media){var e={box:this._config.box,isLive:this._config.isLive,kwaiKernelLog:"e"};this._config.debug&&(e.kwaiKernelLog="v"),this._kernel=new t.default(this._media,e),this._kernel.on("error",this._onError),this._kernel.on("report",this._onReport)}},f._destroyKernel=function(){this._kernel&&(this._kernel.destroy(),this._kernel.removeAllListeners())},c}(i.EventEmitter);e.default=u})?r.apply(t,n):r)||(e.exports=s)},function(e,t,i){var r,n,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],r=function(){"use strict";"undefined"!=typeof window&&function(t,i){e.exports=i()}(0,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="./src/index.ts")}({"./node_modules/@ks/adaptive-multi-rate/lib/adaptive-flv.js":
/*!******************************************************************!*\
  !*** ./node_modules/@ks/adaptive-multi-rate/lib/adaptive-flv.js ***!
  \******************************************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){(function(e){var r,n;!function(s,o,a,u,l,d,c,f,h,_,p,v,m,g,y,b,E,T,S,w,R,x,L,k,A,O,P,D,I,M,C,N,F,U,B,j,V,H,G,K,W,z,q,Y,X,Q,J,Z,$,ee,te,ie,re,ne,se,oe,ae,ue,le,de,ce,fe,he,_e,pe,ve,me,ge,ye,be,Ee,Te,Se,we,Re,xe,Le,ke,Ae,Oe,Pe,De,Ie,Me,Ce,Ne,Fe,Ue,Be,je,Ve,He,Ge,Ke,We,ze,qe,Ye,Xe,Qe,Je,Ze,$e,et,tt,it,rt,nt,st,ot,at,ut,lt,dt,ct,ft,ht,_t,pt,vt,mt,gt,yt,bt,Et,Tt,St,wt,Rt,xt,Lt,kt,At,Ot,Pt,Dt,It,Mt,Ct,Nt,Ft,Ut,Bt,jt,Vt,Ht,Gt,Kt,Wt,zt,qt,Yt,Xt,Qt,Jt,Zt,$t,ei,ti,ii,ri,ni,si,oi,ai,ui,li,di,ci,fi,hi,_i,pi,vi,mi,gi,yi,bi,Ei,Ti,Si,wi,Ri,xi,Li,ki,Ai,Oi,Pi,Di,Ii,Mi,Ci,Ni,Fi,Ui,Bi,ji,Vi,Hi,Gi,Ki,Wi,zi,qi,Yi,Xi,Qi,Ji,Zi,$i,er,tr,ir,rr,nr,sr,or,ar,ur,lr,dr,cr,fr,hr,_r,pr,vr,mr,gr,yr,br,Er,Tr,Sr,wr,Rr,xr,Lr,kr,Ar,Or,Pr,Dr,Ir){!function(s,o){"object"==typeof t&&void 0!==e?e.exports=o():i(/*! !webpack amd define */"./node_modules/webpack/buildin/amd-define.js").amd?void 0===(n="function"==typeof(r=o)?r.call(t,i,t,e):r)||(e.exports=n):(s=s||self).adaptiveMultiRate=o()}(this,(function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t[_](i)&&(e[i]=t[i])})(t,i)},t=function(){return(t=Object.assign||function(e){for(var t,i=1,r=arguments[g];i<r;i++)for(var n in t=arguments[i])Object[b][_].call(t,n)&&(e[n]=t[n]);return e})[p](this,arguments)};function i(){}function r(){r.init.call(this)}function n(e){return void 0===e[S]?r.defaultMaxListeners:e[S]}function s(e,t,r,s){var o,a,u;if(l!=typeof r)throw new TypeError(R);if((a=e[x])?(a.newListener&&(e.emit("newListener",t,r[A]?r[A]:r),a=e[x]),u=a[t]):(a=e[x]=new i,e[O]=0),u){if(l==typeof u?u=a[t]=s?[r,u]:[u,r]:s?u.unshift(r):u.push(r),!u.warned&&(o=n(e))&&0<o&&u[g]>o){u.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+u[g]+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=u[g],function(e){l==typeof console.warn?console.warn(e):console.log(e)}(d)}}else u=a[t]=r,++e[O];return e}function o(e,t,i){var r=!1;function n(){e[K](t,n),r||(r=!0,i[p](e,arguments))}return n[A]=i,n}function a(e){var t=this[x];if(t){var i=t[e];if(l==typeof i)return 1;if(i)return i[g]}return 0}function u(e,t){for(var i=new Array(t);t--;)i[t]=e[t];return i}i[b]=Object.create(null),(r.EventEmitter=r).usingDomains=!1,r[b].domain=void 0,r[b][x]=void 0,r[b][S]=void 0,r.defaultMaxListeners=10,r.init=function(){this.domain=null,r.usingDomains&&(void 0).active,this[x]&&this[x]!==Object.getPrototypeOf(this)[x]||(this[x]=new i,this[O]=0),this[S]=this[S]||void 0},r[b].setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this[S]=e,this},r[b].getMaxListeners=function(){return n(this)},r[b].emit=function(e,t,i,r){var n,s,o,a,d,c,f,h="error"===e;if(c=this[x])h=h&&null==c.error;else if(!h)return!1;if(f=this.domain,h){if(n=t,f)return(n=n||new Error(se)).domainEmitter=this,n.domain=f,n.domainThrown=!1,f.emit("error",n),!1;if(n instanceof Error)throw n;var _=new Error(ae+n+")");throw _.context=n,_}if(!(s=c[e]))return!1;var v=l==typeof s;switch(o=arguments[g]){case 1:!function(e,t,i){if(t)e.call(i);else for(var r=e[g],n=u(e,r),s=0;s<r;++s)n[s].call(i)}(s,v,this);break;case 2:!function(e,t,i,r){if(t)e.call(i,r);else for(var n=e[g],s=u(e,n),o=0;o<n;++o)s[o].call(i,r)}(s,v,this,t);break;case 3:!function(e,t,i,r,n){if(t)e.call(i,r,n);else for(var s=e[g],o=u(e,s),a=0;a<s;++a)o[a].call(i,r,n)}(s,v,this,t,i);break;case 4:!function(e,t,i,r,n,s){if(t)e.call(i,r,n,s);else for(var o=e[g],a=u(e,o),l=0;l<o;++l)a[l].call(i,r,n,s)}(s,v,this,t,i,r);break;default:for(a=new Array(o-1),d=1;d<o;d++)a[d-1]=arguments[d];!function(e,t,i,r){if(t)e[p](i,r);else for(var n=e[g],s=u(e,n),o=0;o<n;++o)s[o][p](i,r)}(s,v,this,a)}return!0},r[b].on=r[b].addListener=function(e,t){return s(this,e,t,!1)},r[b].prependListener=function(e,t){return s(this,e,t,!0)},r[b].once=function(e,t){if(l!=typeof t)throw new TypeError(R);return this.on(e,o(this,e,t)),this},r[b].prependOnceListener=function(e,t){if(l!=typeof t)throw new TypeError(R);return this.prependListener(e,o(this,e,t)),this},r[b][K]=function(e,t){var r,n,s,o,a;if(l!=typeof t)throw new TypeError(R);if(!(n=this[x]))return this;if(!(r=n[e]))return this;if(r===t||r[A]&&r[A]===t)0==--this[O]?this[x]=new i:(delete n[e],n[K]&&this.emit(K,e,r[A]||t));else if(l!=typeof r){for(s=-1,o=r[g];0<o--;)if(r[o]===t||r[o][A]&&r[o][A]===t){a=r[o][A],s=o;break}if(s<0)return this;if(1===r[g]){if(r[0]=void 0,0==--this[O])return this[x]=new i,this;delete n[e]}else!function(e,t){for(var i=t,r=i+1,n=e[g];r<n;i+=1,r+=1)e[i]=e[r];e.pop()}(r,s);n[K]&&this.emit(K,e,a||t)}return this},r[b][ye]=function(e){var t,r;if(!(r=this[x]))return this;if(!r[K])return 0===arguments[g]?(this[x]=new i,this[O]=0):r[e]&&(0==--this[O]?this[x]=new i:delete r[e]),this;if(0===arguments[g]){for(var n,s=Object.keys(r),o=0;o<s[g];++o)K!==(n=s[o])&&this[ye](n);return this[ye](K),this[x]=new i,this[O]=0,this}if(l==typeof(t=r[e]))this[K](e,t);else if(t)for(;this[K](e,t[t[g]-1]),t[0];);return this},r[b].listeners=function(e){var t,i=this[x];return i&&(t=i[e])?l==typeof t?[t[A]||t]:function(e){for(var t=new Array(e[g]),i=0;i<t[g];++i)t[i]=e[i][A]||e[i];return t}(t):[]},r[Te]=function(e,t){return l==typeof e[Te]?e[Te](t):a.call(e,t)},r[b][Te]=a,r[b].eventNames=function(){return 0<this[O]?Reflect.ownKeys(this[x]):[]};var d={version:"1.0",adaptationSet:{representation:[{bitrate:900,id:0,url:""},{bitrate:1e3,id:1,url:""},{bitrate:1500,id:2,url:""}]}},c={consistent_bitrate_threshold:3,lower_buffered_time:3e3,upper_buffered_time:6e3,timeout_minutes:129600,buffer_up_ahead:3,buffer_down_ahead:5,start_up_duration:3,speed_heartbeat_limit:9},f={buffered:0,download:{size:0,duration:0},currentTime:0},h={consistent_bitrate_threshold:{min:0,max:10},lower_buffered_time:{min:0,max:1e5},upper_buffered_time:{min:0,max:1e5},timeout_minutes:{min:0,max:Number.MAX_SAFE_INTEGER},buffer_up_ahead:{min:0,max:100},buffer_down_ahead:{min:0,max:100},start_up_duration:{min:0,max:100},speed_heartbeat_limit:{min:0,max:100},buffered:{min:0,max:3e5},videoTime:{min:0,max:Number.MAX_SAFE_INTEGER},bufferDiff:{min:-1300,max:3e5},videoTimeDiff:{min:0,max:1300},downloadSize:{min:0,max:1e9},downloadDuration:{min:0,max:1100},bitrate:{min:100,max:1e5}};function v(e){return(v=l==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&l==typeof Symbol&&e.constructor===Symbol&&e!==Symbol[b]?"symbol":typeof e})(e)}var m,y,E=[];function T(e,t){t&&0!==t[g]||(t=[e],e="");var i=t.map((function(e){return"object"===v(e)?JSON.stringify(e):e}));return i.unshift("[kwai-ae"+(e?"::"+e:"")+"] > "),i}(y=m=m||{}).LEVEL_ERROR="e",y.LEVEL_WARN="w",y.LEVEL_INFO="i",y.LEVEL_DEBUG="d",y.LEVEL_VERBOSE="v";var w=(L.level=function(e){switch(L[at]=L[ut]=L[lt]=L[dt]=L[ct]=!1,e){case m.LEVEL_ERROR:L[at]=!0;break;case m.LEVEL_WARN:L[at]=L[ut]=!0;break;case m.LEVEL_INFO:L[at]=L[ut]=L[lt]=!0;break;case m.LEVEL_DEBUG:L[at]=L[ut]=L[lt]=L[dt]=!0;break;case m.LEVEL_VERBOSE:L[at]=L[ut]=L[lt]=L[dt]=L[ct]=!0}},L.e=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];if(L[at]){var r=T(e,t);(console.error||console.warn||console.log)[p](console,r)}},L.w=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];var r=T(e,t),n=(new Date).toLocaleTimeString("CN",{hour12:!1});E.push(n+" "+r.join(" ")),L[ut]&&(console.warn||console.log)[p](console,r)},L.i=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];if(L[lt]){var r=T(e,t);(console.info||console.log)[p](console,r)}},L.d=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];if(L[dt]){var r=T(e,t);(console.debug||console.log)[p](console,r)}},L.v=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];if(L[ct]){var r=T(e,t);console.log[p](console,r)}},L.qos=function(){if(0===E[g])return{};var e=E.join(";    ");return E=[],{warning:e}},L[at]=!0,L[ut]=!1,L[lt]=!1,L[dt]=!1,L[ct]=!1,L);function L(){}var k="check";function P(e,t,i){void 0===i&&(i=h[e].min);var r=h[e];return isNaN(t)||null===t?(w.w(k,"invalid number:",e,t,"default",i),i):((t<r.min||t>r.max||"number"!=typeof t)&&w.w(k,"unexpected number value or type:",e,t,"min",r.min,"max",r.max),Number(t))}function D(e){if(!e)return w.w(k,"invalid config:",e),c;var t=Object.assign[p](Object,function(){for(var e=0,t=0,i=arguments[g];t<i;t++)e+=arguments[t][g];var r=Array(e),n=0;for(t=0;t<i;t++)for(var s=arguments[t],o=0,a=s[g];o<a;o++,n++)r[n]=s[o];return r}([{}],Object.entries(c).map((function(t){var i,r=t[0],n=t[1];return(i={})[r]=P(r,e[r],n),i}))));return w.d(k,"config:",t),t}function I(e){if(!e)return w.w(k,"invalid info:",e),f;var t={buffered:P("buffered",e.buffered),download:function(e){return e?{size:P("downloadSize",e.size),duration:P("downloadDuration",e.duration)}:(w.w(k,"invalid download:",e),f.download)}(e.download),currentTime:P("videoTime",e.currentTime)};return w.d(k,"info:",t),t}var M=(C[b].checkBufferAndVideoTime=function(e,t){return P("bufferDiff",e-this[Vt]),P("videoTimeDiff",t-this[Gt]),this[Vt]=e,this[Gt]=t,this},C);function C(e,t){this[Vt]=e,this[Gt]=t}var N=(F[b].write=function(e,t){if(F.available)try{localStorage.setItem(e,JSON.stringify({value:t,time:Date.now()}))}catch(e){}},F[b].read=function(e){if(F.available)try{var t=localStorage.getItem(e);if(t){var i=JSON.parse(t),r=i.value,n=i.time,s=void 0===n?0:n;if(Date.now()-s<this.timeout)return r}}catch(e){}},Object.defineProperty(F,"available",{get:function(){if(void 0===F._available)try{localStorage.setItem("alg","test"),F._available=!0}catch(e){F._available=!1}return F._available},enumerable:!0,configurable:!0}),F);function F(){this.timeout=2592e6}var U="bitrate",B=(j[b].reset=function(){this[ai]=0},j[b]._highestIndexBelowThan=function(e){return Math.max(0,this[di].filter((function(t){return t.bitrate<=e}))[g]-1)},j[b].nextIndexAndBitrate=function(e){var t=this,i=this[fi];return this._needToDecrease(e[i])?(i=Math.max(0,e.filter((function(e){return!t._needToDecrease(e)}))[g]-1),w.d(U,"index:",i)):this._needToIncrease(e[i])&&(i=Math.min(this[di][g]-1,i+1)),this._generateResult(i)},j[b].availableBitrates=function(){return this[di].map((function(e){return e.bitrate}))},j[b].nextStartUp=function(){return this._generateResult(this[fi])},j[b]._generateResult=function(e){this._recordIndex(e);var t=this[bi](e);this._recordBitrate(t);var i=this[Ti](e);return w.d(U,"next index:",i,"bitrate:",t),{index:i,bitrate:t}},j[b]._needToDecrease=function(e){return e<this._config.lower_buffered_time},j[b]._needToIncrease=function(e){return e>=this._config.upper_buffered_time&&this[ai]>=this._config.consistent_bitrate_threshold},j[b]._recordIndex=function(e){e!==this[fi]?(this[fi]=e,this[ai]=1):this[ai]+=1},j[b][bi]=function(e){return this[di][e].bitrate},j[b]._recordBitrate=function(e){this._storage.write("bitrate",e)},j[b][Ti]=function(e){return this[di][e].index},j[b].getQos=function(){return{}},j[b].setLastIndex=function(e){var t=this[di].findIndex((function(t){return t.index===e}));return-1===t?w.w(U,"fail to find index:",e):this[fi]=t,this},j[b].getLastBitrate=function(){return this[bi](this[fi])},j);function j(e,t,i){this[di]=e.map((function(e,t){return{bitrate:e.bitrate,index:t}})).filter((function(e){var t=e.bitrate;return t===P("bitrate",t)})).sort((function(e,t){return e.bitrate-t.bitrate})),w.d(U,"available bitrates:",this[di].map((function(e){return e.bitrate}))),this._storage=i,this._config=t;var r=this._storage.read("bitrate")||0;this[fi]=this._highestIndexBelowThan(r),this[ai]=0}var V=(H[b].reset=function(){this._buffer=0,this._speed=0},H[b].setBufferAndSpeed=function(e,t){this._buffer=e,this._speed=t},H[b].predictBuffers=function(){var e=this,t=this._bitrates.map((function(t){return e.predictBuffer(t)}));return w.d("buffer","predicted buffer:",t),t},H[b].predictBuffer=function(e){var t=this._speed/e*1e3-1e3,i=0<t?this._config.buffer_up_ahead:this._config.buffer_down_ahead;return this._buffer+i*t},H[b].getQos=function(){return{}},H);function H(e,t){this._buffer=0,this._speed=0,this._config=e,this._bitrates=t}var G,W,z,q="speed",Y=(X[b].recordDownload=function(e){return this[Qi]+=e.duration,this[Ji].unshift(e),this._speed=this._calculateSpeed(),w.d(q,"predictedSpeed:",this._speed),this._speed},X[b].reset=function(){this[Ji]=[],this._speed=0,this[er]=0,this[Vt]=0,this[Qi]=0,this[Gt]=0},X[b]._calculateSpeed=function(){var e=this,t=0,i=0;return this[Ji].forEach((function(r,n){var s=r.size,o=r.duration,a=1e3*e._config.speed_heartbeat_limit-i;a<o&&(s=s*a/o,o=a,e[Ji][n]={size:s,duration:o},e[Ji].splice(n+1)),i+=o,t+=s})),t/i*8||0},X[b].getSpeed=function(){return Math.round(this._speed)},X[b].getQos=function(){return{speedUpperLimit:Math.round(this[er])}},X[b][ar]=function(e,t,i){var r=i-this[Gt];this[Gt]=i,w.d(q,"playedVideo",r);var n=e-this[Vt]+r;return this[Vt]=e,w.d(q,"downloadBuffer",n),this[er]=n*t/Math.max(1,this[Qi],n),this[Qi]=0,w.d(q,"speedUpperLimit:",this[er]),this[er]},X);function X(e){this[Ji]=[],this._speed=0,this[er]=0,this[Vt]=0,this[Qi]=0,this[Gt]=0,this._config=e}function Q(){this.constructor=G}function J(e,t,i){var r=z.call(this)||this;r._next=0,r._index=0,w.d("main","version:","3.0.1"),r._config=D(t);var n=function(e){return!e||!e[vr]||!e[vr][mr]||e[vr][mr][g]<1?(w.w(k,"invalid representation:",e),d[vr][mr]):e[vr][mr]}(e),s=new N;s.timeout=60*r._config.timeout_minutes*1e3,r[Er]=new B(n,r._config,s);var o=r[Er].availableBitrates();return r[Tr]=new V(r._config,o),r[Sr]=new Y(r._config),i&&r[Er].setLastIndex(i.index),r._next=r._startUpIndex().index,r}return e(G=J,W=z=r),G[b]=null===W?Object.create(W):(Q[b]=W[b],new Q),J.setLogLevel=function(e){w.level(e)},J[b].reset=function(){this[Er].reset(),this[Tr].reset(),this[Sr].reset()},J[b].onHeartbeat=function(e){var t=I(e),i=t.buffered,r=t.download,n=t.currentTime;this[Lr]?this[Lr].checkBufferAndVideoTime(i,n):this[Lr]=new M(i,n);var s=this[Sr].recordDownload(r);this.emit(kr,{type:"heartbeat",data:{time:Date.now(),speed:s,buffered:i}})},J[b].onGOP=function(e){var t=I(e),i=t.buffered,r=t.download,n=t.currentTime,s=this[Sr].recordDownload(r),o=this[Er].getLastBitrate(),a=this[Sr][ar](i,o,n);this[Tr].setBufferAndSpeed(i,a);var u=this._nextIndex(),l=u.index,d=u.bitrate,c=Date.now();this._next=l,this.emit(kr,{type:"heartbeat",data:{time:c,speed:s,buffered:i}}),this.emit(kr,{type:"bitrate",data:{time:c,bitrate:d,speedUpperLimit:a}})},J[b].onLevelLoad=function(e){this._index=e,this[Er].setLastIndex(e)},Object.defineProperty(J[b],"nextIndex",{get:function(){return this._next},enumerable:!0,configurable:!0}),J[b]._startUpIndex=function(){return this[Er].nextStartUp()},J[b]._nextIndex=function(){var e=this[Tr].predictBuffers();return this[Er].nextIndexAndBitrate(e)},Object.defineProperty(J[b],"qos",{get:function(){return{speed:this[Sr].getSpeed(),extra:t(t(t(t({},w.qos()),this[Er].getQos()),this[Tr].getQos()),this[Sr].getQos())}},enumerable:!0,configurable:!0}),J}))}(0,0,0,0,"function",0,0,0,0,"hasOwnProperty","apply",0,0,"length",0,"prototype",0,0,"_maxListeners",0,'"listener" argument must be a function',"_events",0,0,"listener","_eventsCount",0,0,0,0,0,0,0,0,0,0,0,0,0,"removeListener",0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Uncaught, unspecified "error" event',0,'Uncaught, unspecified "error" event. (',0,0,0,0,0,0,0,0,0,0,0,"removeAllListeners",0,0,"listenerCount",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"ENABLE_ERROR","ENABLE_WARN","ENABLE_INFO","ENABLE_DEBUG","ENABLE_VERBOSE",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_lastBuffer",0,"_lastVideoTime",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_consistentCount",0,0,"_availableBitrates",0,"_lastRequestedIndex",0,0,0,0,0,0,0,"_sortedIndex2Rate",0,"_sortedIndex2Representation",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_downloadDuration","_downloads",0,0,"_speedUpperLimit",0,0,0,0,0,0,"getSpeedUpperLimitAndUpdate",0,0,0,0,0,0,0,0,"adaptationSet","representation",0,0,0,"_bitrateCalculator","_bufferPredictor","_speedPredictor",0,0,0,"_heartbeatChecker","adaptiveAlgorithm")}).call(this,i(/*! ./../../../webpack/buildin/module.js */"./node_modules/webpack/buildin/module.js")(e))},"./node_modules/@ks/adaptive-multi-rate/lib/adaptive-hls.js":
/*!******************************************************************!*\
  !*** ./node_modules/@ks/adaptive-multi-rate/lib/adaptive-hls.js ***!
  \******************************************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){(function(e){var r,n;!function(s,o,a,u,l,d,c,f,h,_,p,v,m,g,y,b,E,T,S,w,R,x,L,k,A,O,P,D,I,M,C,N,F,U,B,j,V,H,G,K,W,z,q,Y,X,Q,J,Z,$,ee,te,ie,re,ne,se,oe,ae,ue,le,de,ce,fe,he,_e,pe,ve,me,ge,ye,be,Ee,Te,Se,we,Re,xe,Le,ke,Ae,Oe,Pe,De,Ie,Me,Ce,Ne,Fe,Ue,Be,je,Ve,He,Ge,Ke,We,ze,qe,Ye,Xe,Qe,Je,Ze,$e,et,tt,it,rt,nt,st,ot,at,ut,lt,dt,ct,ft,ht,_t,pt,vt,mt,gt,yt,bt,Et,Tt,St,wt,Rt,xt,Lt,kt,At,Ot,Pt,Dt,It,Mt,Ct,Nt,Ft,Ut,Bt,jt,Vt,Ht,Gt,Kt,Wt,zt,qt,Yt,Xt,Qt,Jt,Zt,$t,ei,ti,ii,ri,ni,si,oi,ai,ui,li,di,ci,fi,hi,_i,pi,vi,mi,gi,yi,bi,Ei,Ti,Si,wi,Ri,xi,Li,ki,Ai,Oi,Pi,Di,Ii,Mi,Ci,Ni,Fi,Ui,Bi,ji,Vi,Hi,Gi,Ki,Wi,zi,qi,Yi,Xi,Qi,Ji,Zi,$i,er,tr,ir,rr,nr,sr,or,ar,ur,lr,dr,cr,fr,hr,_r,pr,vr,mr,gr,yr,br,Er,Tr,Sr,wr,Rr,xr,Lr,kr,Ar,Or,Pr,Dr,Ir,Mr,Cr,Nr,Fr,Ur,Br,jr,Vr,Hr,Gr,Kr,Wr,zr,qr,Yr,Xr,Qr,Jr,Zr,$r,en,tn,rn,nn,sn,on,an,un,ln,dn,cn,fn,hn,_n,pn,vn,mn,gn,yn,bn,En,Tn,Sn,wn,Rn,xn,Ln){!function(s,o){"object"==typeof t&&void 0!==e?e.exports=o():i(/*! !webpack amd define */"./node_modules/webpack/buildin/amd-define.js").amd?void 0===(n="function"==typeof(r=o)?r.call(t,i,t,e):r)||(e.exports=n):(s=s||self).adaptiveMultiRate=o()}(this,(function(){function e(t){return(e=l==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&l==typeof Symbol&&e[_]===Symbol&&e!==Symbol[p]?"symbol":typeof e})(t)}function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments[y];t++){var i=arguments[t];for(var r in i)Object[p][E].call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t[E](i)&&(e[i]=t[i])})(e,t)};function r(){}function n(){n.init.call(this)}function s(e){return void 0===e[x]?n.defaultMaxListeners:e[x]}function o(e,t,i,n){var o,a,u;if(l!=typeof i)throw new TypeError(k);if((a=e[A])?(a.newListener&&(e.emit("newListener",t,i[D]?i[D]:i),a=e[A]),u=a[t]):(a=e[A]=new r,e[I]=0),u){if(l==typeof u?u=a[t]=n?[i,u]:[u,i]:n?u.unshift(i):u.push(i),!u.warned&&(o=s(e))&&0<o&&u[y]>o){u.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+u[y]+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=u[y],function(e){l==typeof console.warn?console.warn(e):console.log(e)}(d)}}else u=a[t]=i,++e[I];return e}function a(e,t,i){var r=!1;function n(){e[q](t,n),r||(r=!0,i.apply(e,arguments))}return n[D]=i,n}function u(e){var t=this[A];if(t){var i=t[e];if(l==typeof i)return 1;if(i)return i[y]}return 0}function d(e,t){for(var i=new Array(t);t--;)i[t]=e[t];return i}r[p]=Object.create(null),(n.EventEmitter=n).usingDomains=!1,n[p].domain=void 0,n[p][A]=void 0,n[p][x]=void 0,n.defaultMaxListeners=10,n.init=function(){this.domain=null,n.usingDomains&&(void 0).active,this[A]&&this[A]!==Object.getPrototypeOf(this)[A]||(this[A]=new r,this[I]=0),this[x]=this[x]||void 0},n[p].setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this[x]=e,this},n[p].getMaxListeners=function(){return s(this)},n[p].emit=function(e,t,i,r){var n,s,o,a,u,c,f,h="error"===e;if(c=this[A])h=h&&null==c.error;else if(!h)return!1;if(f=this.domain,h){if(n=t,f)return(n=n||new Error(ue)).domainEmitter=this,n.domain=f,n.domainThrown=!1,f.emit("error",n),!1;if(n instanceof Error)throw n;var _=new Error(de+n+")");throw _.context=n,_}if(!(s=c[e]))return!1;var p=l==typeof s;switch(o=arguments[y]){case 1:!function(e,t,i){if(t)e.call(i);else for(var r=e[y],n=d(e,r),s=0;s<r;++s)n[s].call(i)}(s,p,this);break;case 2:!function(e,t,i,r){if(t)e.call(i,r);else for(var n=e[y],s=d(e,n),o=0;o<n;++o)s[o].call(i,r)}(s,p,this,t);break;case 3:!function(e,t,i,r,n){if(t)e.call(i,r,n);else for(var s=e[y],o=d(e,s),a=0;a<s;++a)o[a].call(i,r,n)}(s,p,this,t,i);break;case 4:!function(e,t,i,r,n,s){if(t)e.call(i,r,n,s);else for(var o=e[y],a=d(e,o),u=0;u<o;++u)a[u].call(i,r,n,s)}(s,p,this,t,i,r);break;default:for(a=new Array(o-1),u=1;u<o;u++)a[u-1]=arguments[u];!function(e,t,i,r){if(t)e.apply(i,r);else for(var n=e[y],s=d(e,n),o=0;o<n;++o)s[o].apply(i,r)}(s,p,this,a)}return!0},n[p].on=n[p].addListener=function(e,t){return o(this,e,t,!1)},n[p].prependListener=function(e,t){return o(this,e,t,!0)},n[p].once=function(e,t){if(l!=typeof t)throw new TypeError(k);return this.on(e,a(this,e,t)),this},n[p].prependOnceListener=function(e,t){if(l!=typeof t)throw new TypeError(k);return this.prependListener(e,a(this,e,t)),this},n[p][q]=function(e,t){var i,n,s,o,a;if(l!=typeof t)throw new TypeError(k);if(!(n=this[A]))return this;if(!(i=n[e]))return this;if(i===t||i[D]&&i[D]===t)0==--this[I]?this[A]=new r:(delete n[e],n[q]&&this.emit(q,e,i[D]||t));else if(l!=typeof i){for(s=-1,o=i[y];0<o--;)if(i[o]===t||i[o][D]&&i[o][D]===t){a=i[o][D],s=o;break}if(s<0)return this;if(1===i[y]){if(i[0]=void 0,0==--this[I])return this[A]=new r,this;delete n[e]}else!function(e,t){for(var i=t,r=i+1,n=e[y];r<n;i+=1,r+=1)e[i]=e[r];e.pop()}(i,s);n[q]&&this.emit(q,e,a||t)}return this},n[p][Te]=function(e){var t,i;if(!(i=this[A]))return this;if(!i[q])return 0===arguments[y]?(this[A]=new r,this[I]=0):i[e]&&(0==--this[I]?this[A]=new r:delete i[e]),this;if(0===arguments[y]){for(var n,s=Object.keys(i),o=0;o<s[y];++o)q!==(n=s[o])&&this[Te](n);return this[Te](q),this[A]=new r,this[I]=0,this}if(l==typeof(t=i[e]))this[q](e,t);else if(t)for(;this[q](e,t[t[y]-1]),t[0];);return this},n[p].listeners=function(e){var t,i=this[A];return i&&(t=i[e])?l==typeof t?[t[D]||t]:function(e){for(var t=new Array(e[y]),i=0;i<t[y];++i)t[i]=e[i][D]||e[i];return t}(t):[]},n[Re]=function(e,t){return l==typeof e[Re]?e[Re](t):u.call(e,t)},n[p][Re]=u,n[p].eventNames=function(){return 0<this[I]?Reflect.ownKeys(this[A]):[]};var c,f,h=[];function v(t,i){i&&0!==i[y]||(i=[t],t="");var r=i.map((function(t){return"object"===e(t)?JSON.stringify(t):t}));return r.unshift("[kwai-ae"+(t?"::"+t:"")+"] > "),r}(f=c=c||{}).LEVEL_ERROR="e",f.LEVEL_WARN="w",f.LEVEL_INFO="i",f.LEVEL_DEBUG="d",f.LEVEL_VERBOSE="v";var m=(g.level=function(e){switch(g[We]=g[ze]=g[qe]=g[Ye]=g[Xe]=!1,e){case c.LEVEL_ERROR:g[We]=!0;break;case c.LEVEL_WARN:g[We]=g[ze]=!0;break;case c.LEVEL_INFO:g[We]=g[ze]=g[qe]=!0;break;case c.LEVEL_DEBUG:g[We]=g[ze]=g[qe]=g[Ye]=!0;break;case c.LEVEL_VERBOSE:g[We]=g[ze]=g[qe]=g[Ye]=g[Xe]=!0}},g.e=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];if(g[We]){var r=v(e,t);(console.error||console.warn||console.log).apply(console,r)}},g.w=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];var r=v(e,t),n=(new Date).toLocaleTimeString("CN",{hour12:!1});h.push(n+" "+r.join(" ")),g[ze]&&(console.warn||console.log).apply(console,r)},g.i=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];if(g[qe]){var r=v(e,t);(console.info||console.log).apply(console,r)}},g.d=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];if(g[Ye]){var r=v(e,t);(console.debug||console.log).apply(console,r)}},g.v=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];if(g[Xe]){var r=v(e,t);console.log.apply(console,r)}},g.qos=function(){if(0===h[y])return{};var e=h.join(";    ");return h=[],{warning:e}},g[We]=!0,g[ze]=!1,g[qe]=!1,g[Ye]=!1,g[Xe]=!1,g);function g(){}var b=(T.add=function(e,t){return e.copy().add(t)},T.subtract=function(e,t){return e.copy().subtract(t)},T.augment=function(e,t){return e.copy().augment(t)},T.multiply=function(e,t){return e.multiply(t)},T.zeros=function(e,t,i){return void 0===i&&(i=Float32Array),T.fill(e,t,0,i)},T.fill=function(e,t,i,r){if(void 0===i&&(i=0),void 0===r&&(r=Float32Array),e<=0||t<=0)throw new Error("invalid size");return new T(new r(e*t),{shape:[e,t]}).fill(i)},T.identity=function(e,t){return void 0===t&&(t=Float32Array),T.fill(e,e,(function(t){return t%e===Math.floor(t/e)?1:0}),t)},T[p]._init=function(t,i){if(function(e){return!!(e&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT)}(t))this.data=t,this.shape="object"===e(i)?i.shape:[this.data[y]],this[y]=this.data[y],this.type=function(e){switch(e[_].name){case"Int8Array":return Int8Array;case"Uint8Array":return Uint8Array;case"Int16Array":return Int16Array;case"Uint16Array":return Uint16Array;case"Int32Array":return Int32Array;case"Uint32Array":return Uint32Array;case"Uint8ClampedArray":return Uint8ClampedArray;case"Float64Array":return Float64Array;default:return Float32Array}}(t);else if(t instanceof Array)this.data=new Float32Array(function e(t){return t.reduce((function(t,i){return t.concat(Array.isArray(i)?e(i):i)}),[])}(t)),this.shape=function e(t){return Array.isArray(t)?[t[y]].concat(e(t[0])):[]}(t),this[y]=this.data[y];else if(t instanceof T)return t.copy()},T[p].multiply=function(e){var t=this.shape,i=t[0],r=t[1],n=e.shape,s=n[0],o=n[1];if(r!==s)throw new Error("sizes do not match");var a,u,l,d,c=this.data,f=e.data,h=new this.type(i*o);for(a=0;a<i;a+=1)for(u=0;u<o;u+=1){for(l=d=0;l<r;l+=1)d+=c[a*r+l]*f[u+l*o];h[a*o+u]=d}return new T(h,{shape:[i,o]})},T[p].add=function(e,t){void 0===t&&(t=1),this.equilateral(e),this.equidimensional(e);var i,r=this.data,n=this[y],s=e.data;for(i=0;i<n;i+=1)r[i]+=t*s[i];return this},T[p].subtract=function(e){return this.add(e,-1)},T[p].augment=function(e){var t=this.shape,i=t[0],r=t[1],n=e.shape,s=n[0],o=n[1];if(0===s||0===o)return this;if(i!==s)throw new Error("rows do not match");var a,u,l=this.data,d=e.data,c=r+o,f=new this.type(c*i);for(a=0;a<i;a+=1)for(u=0;u<r;u+=1)f[a*c+u]=l[a*r+u];for(a=0;a<s;a+=1)for(u=0;u<o;u+=1)f[a*c+u+r]=d[a*o+u];return this.shape=[i,c],this[y]=f[y],this.data=f,this},T[p].fill=function(e){void 0===e&&(e=0);var t,i=this.data,r=this[y];for(t=0;t<r;t+=1)i[t]=e instanceof Function?e(t):e;return this},T[p].transpose=function(){var e,t,i=this.shape,r=i[0],n=i[1],s=new this.type(n*r);for(e=0;e<r;e+=1)for(t=0;t<n;t+=1)s[t*r+e]=this.data[e*n+t];return new T(s,{shape:[n,r]})},T[p].inverse=function(){var e=this.shape,t=e[0],i=e[1];if(t!==i)throw new Error("invalid dimensions");var r,n,s=T.identity(t),o=T.augment(this,s).gauss(),a=T.zeros(t,i),u=T.zeros(t,i),l=o.shape[1];for(r=0;r<t;r+=1)for(n=0;n<l;n+=1)n<i?a.set(r,n,o.get(r,n)):u.set(r,n-t,o.get(r,n));if(!a.equals(T.identity(t)))throw new Error("matrix is not invertible");return u},T[p].gauss=function(){var e,t,i,r,n,s=this.shape,o=s[0],a=s[1],u=this.copy(),l=0;for(i=0;i<o;i+=1){if(a<=l)throw new Error("matrix is singular");for(r=i;0===u.data[r*a+l];)if(o===(r+=1)&&(r=i,a===(l+=1)))throw new Error("matrix is singular");if(u.swap(i,r),0!==(e=u.data[i*a+l]))for(n=0;n<a;n+=1)u.data[i*a+n]=u.data[i*a+n]/e;for(r=0;r<o;r+=1)if(t=u.data[r*a+l],r!==i)for(n=0;n<a;n+=1)u.data[r*a+n]=u.data[r*a+n]-u.data[i*a+n]*t;l+=1}for(i=0;i<o;i+=1){for(r=e=0;r<a;r+=1)0===e&&(e=u.data[i*a+r]);if(0===e)for(n=0;n<a;n+=1)u.data[i*a+n]=u.data[i*a+n]/e}return u},T[p].equals=function(e){this.equilateral(e),this.equidimensional(e);var t,i=this.data,r=this[y],n=e.data;for(t=0;t<r;t+=1)if(i[t]!==n[t])return!1;return!0},T[p].check=function(e,t){var i=this.shape,r=i[0],n=i[1];if(isNaN(e)||isNaN(t))throw new Error("one of the indices is not a number");if(e<0||t<0||r-1<e||n-1<t)throw new Error("index out of bounds")},T[p].set=function(e,t,i){return this.check(e,t),this.data[e*this.shape[1]+t]=i,this},T[p].get=function(e,t){return this.check(e,t),this.data[e*this.shape[1]+t]},T[p].swap=function(e,t){var i=this.shape,r=i[0],n=i[1];if(e<0||t<0||r-1<e||r-1<t)throw new Error("index out of bounds");if(this.data.slice){var s=this.data.slice(e*n,(e+1)*n);this.data.copyWithin(e*n,t*n,(t+1)*n),this.data.set(s,t*n)}else s=new this.data[_](this.data.buffer.slice(0)),this.data.set(s.subarray(e*n,(e+1)*n),t*n),this.data.set(s.subarray(t*n,(t+1)*n),e*n);return this},T[p].copy=function(){var e=t(Object.create(Object.getPrototypeOf(this)),this);return e.data=new this.type(this.data),e.shape=this.shape,e[y]=this[y],e.type=this.type,e},T[p].equidimensional=function(e){var t=this.shape,i=e.shape;if(!t.every((function(e,t){return e===i[t]})))throw new Error("shapes "+t+" and "+i+" do not match")},T[p].equilateral=function(e){var t=this[y],i=e[y];if(t!==i)throw new Error("lengths "+t+" and "+i+" do not match")},T);function T(e,t){this.data=new Float32Array(0),this[y]=0,this.shape=[0],this.type=Float32Array,"number"==typeof e&&"number"==typeof t?this._init(new Float32Array(e*t),{shape:[e,t]}):this._init(e,t)}var S,w,R=(L[p].write=function(e,t){if(L.available)try{localStorage.setItem(e,JSON.stringify({value:t,time:Date.now()}))}catch(e){}},L[p].read=function(e){if(L.available)try{var t=localStorage.getItem(e);if(t){var i=JSON.parse(t),r=i.value,n=i.time,s=void 0===n?0:n;if(Date.now()-s<this.timeout)return r}}catch(e){}},Object[di](L,"available",{get:function(){if(void 0===L._available)try{localStorage.setItem("alg","test"),L._available=!0}catch(e){L._available=!1}return L._available},enumerable:!0,configurable:!0}),L);function L(){this.timeout=2592e6}(w=S=S||{})[w.Default=0]="Default",w[w.Seek=1]="Seek";var O,P,M,C="adaptive-hls",N={beacon:!1,predictStep:5,targetBuffer:10,duration:5,smoothRatioToTarget:0,switchpanelty:2.5*1e-6,slidingWindowSize:3,kalmanR:Math.pow(.2,2),kalmanQ:4e-4,initBitrate:2e6,startBitrateLimit:!0,speedPredictRatio:1.5,speedPredictNum:3,algorithm:1,speedPredictRatioOnStart:3,lowProfileThreshold:4,lowProfileBitrate:25e5,lowProfileStartThreshold:5},F="kwai_hls_adaptive";function U(){this[_]=O}function B(e,t){var i=M.call(this)||this;i._xPrev=0,i._PPrev=0,i[Oi]=0,i[Pi]=0,i[Di]=[],i._index=0,i._nextIndex=0,i._status=S.Default,i[Ni]=0,i[Fi]=1,i[Ui]=!1,i[Bi]=0,i[ji]=0,i[Vi]=0,i._storage=new R,i._processConfig(t),m.i(C,"init",e,t,i._conf),i[Di]=[],e.levels.forEach((function(e){i[Di].push(e.bitrate)})),i._index=e.index,i._initParams(),i[Bi]=function(e,t){return e.reduce((function(e,i,r){return t<i?e:r}),0)}(i[Di],i._conf.lowProfileBitrate),i.MATRIX_E=b.zeros(i._conf[Zi],i._conf[Zi]),i.MATRIX_G=b.zeros(i._conf[Zi],2);for(var r=0;r<i._conf[Zi];r++)for(var n=0;n<r+1;n++)i.MATRIX_E.set(r,n,r-n+1);for(r=0;r<i._conf[Zi];r++)i.MATRIX_G.set(r,0,r+2),i.MATRIX_G.set(r,1,-r-1);return i._qos={},i}return i(O=B,P=M=n),O[p]=null===P?Object.create(P):(U[p]=P[p],new U),B.setLogLevel=function(e){m.level(e)},B[p].setAvailableBitrates=function(e){e[y]?this[rr]=e:this[rr]=this[Di]},B[p].bitrateInit=function(){var e=this,t=function(e,t){return e.reduce((function(i,r,n){return(e[i]+r)/2>=t?i:n}),0)}(this[Di],this._conf.initBitrate),i=this._storage.read(F);if(m.i(C,"storage read:"+i),void 0!==i&&0<=i.bitrate&&0<i.speed&&2===i.version){i.time&&i.lowProfile&&Date.now()-i.time<2592e5&&(this[ji]=Math.min(parseInt(i.lowProfile),this._conf.lowProfileStartThreshold+1),this[ji]>this._conf.lowProfileStartThreshold&&(this[Ui]=!0,t=Math.min(t,this[Bi])));var r=Math.min(i.bitrate,1024*i.speed/this._conf.speedPredictRatioOnStart),n=this[Di].reduce((function(t,i,n){return Math.abs(i-r)<Math.abs(e[Di][t]-r)?n:t}),0);t=this._conf.startBitrateLimit?Math.min(t,n):n}return t},B[p].onDownload=function(e){if(e.byteLength){var i=e.duration||e.spendTime,r=e.byteLength/i*7.8125;this._qos=t({cache:!1},e),m.v(C,"report download time:"+i+" bytes:"+e.byteLength+" buffered:"+e.buffered+" speed:"+r+" cache:"+this._qos.cache),this._nextIndex=this._nextRateIndex(r,e.buffered/1e3),this._qos.speed=r,this._qos.buffered=e.buffered,this._qos.nextBitrate=this[Di][this._nextIndex],this._qos.currentBitrate=this[Di][this._index]}},B[p].onLevelLoad=function(e){e<this[Di][y]&&0<=e&&(this._index=e)},B[p].onSeek=function(e){m.v(C,"report seek buffered:"+e.buffered+" inBuffer:"+e.isInBuffer),e.isInBuffer?this._resetAlgorithm():this._qos.seek=1,(!e.isInBuffer||e.buffered/1e3<this._conf.targetBuffer)&&(m.i(C,"status change to seek."),this._status=S.Seek,this[Ni]=this._conf.speedPredictNum)},B[p].onRatechange=function(e){e&&(this[Fi]=e)},B[p].onWaiting=function(e){1e3<e.buffered&&this._index>this[Bi]&&(this[Vi]++,this[Vi]>this._conf.lowProfileThreshold&&(this[Ui]=!0))},B[p].onDownloadEnabled=function(e){e||this._resetAlgorithm()},Object[di](B[p],"qos",{get:function(){var e=this._qos;return{download_spend_time:e.duration||e.spendTime,hls_slice_bytes:e.byteLength,hls_slice_play_start_time:e.slicePlayStartTime,hls_slice_play_duration:e.slicePlayDuration,hls_slice_index:e.sliceIndex,is_browser_cache:e.cache,speed:Math.round(e.speed),estimated_throughput:e.estimatedThroughput,next_bitrate:e.nextBitrate,current_bitrate:e.currentBitrate,buffered:e.buffered,seek:e.seek,algorithm:this._conf.algorithm}},enumerable:!0,configurable:!0}),Object[di](B[p],"nextIndex",{get:function(){var e=this._nextIndex;return this._storage.write(F,{version:2,index:e,bitrate:this[Di][e],speed:this._qos&&this._qos.speed?this._qos.speed:0,lowProfile:Math.max(0,this[Ui]?this[ji]+1:this[ji]-1),time:Date.now()}),e},enumerable:!0,configurable:!0}),Object[di](B[p],"algorithm",{get:function(){return this._conf?this._conf.algorithm:N.algorithm},enumerable:!0,configurable:!0}),Object[di](B[p],"lowProfile",{get:function(){return this[Ui]},enumerable:!0,configurable:!0}),Object[di](B[p],"beacon",{get:function(){return!!this._conf&&this._conf.beacon},enumerable:!0,configurable:!0}),B[p]._initParams=function(){m.v(C,"initParams"),this._nextIndex=0,this[Oi]=this._conf.duration,this[Pi]=0,this[nn]=new Array(this._conf[sn]),this[nn][this._conf[sn]-1]=0,this._xPrev=0,this._PPrev=0,this._status=S.Default},B[p]._processConfig=function(e){var i=t({},N);this._conf=t(i,e)},B[p]._quantization=function(e){for(var t=this._index,i=this[Di][y]-1;0<=i;i--)e>=this[Di][i]&&(t=i);return t},B[p]._nextRateIndex=function(e,t){this[Oi]=t,this[nn].shift(),this[nn].push(e),this._status===S.Seek&&(t>=this._conf.targetBuffer||this[Ni]<=0)&&(this[Ni]=0,this._status=S.Default,m.i(C,"status change to default. buffered:"+t+" step:"+this[Ni]));var i=-1;if(i=this._status===S.Seek?(this[Ni]--,this[Pi]=this[Oi],this._nextRateBySpeed(e)):1===this._conf.algorithm?this[cn](e,t):this[fn](e,t),this[Ui]&&(i=Math.min(i,this[Bi])),this[rr]&&this[rr][y]&&-1===this[rr].indexOf(i)){for(var r=this[rr][y]-1;0<=r;r--)if(this[rr][r]<=i){i=this[rr][r];break}i=Math.max(i,this[rr][0])}return i},B[p]._resetAlgorithm=function(){this[Oi]=0,this[Pi]=0,this[nn]=new Array(this._conf[sn])},B[p]._nextRateBySpeed=function(e){var t=1024*e,i=this[Di][this._index];if(t<i||t>i*this._conf.speedPredictRatio)for(var r=this[Di][y]-1;0<=r;r--)if(t>this[Di][r]*this._conf.speedPredictRatio)return r;return this._index},B[p][cn]=function(e,t){var i,r=1024*e,n=this[Di],s=n[this._index];for(i=n[y]-1;0<i&&!(r>n[i]*this[Fi]);i--);var o=n[i],a=this._index,u=t/this[Fi];return s<o?u>o*this._conf.duration/r&&(a=i):o<s&&u<s*this._conf.duration/r+this._conf.duration&&(a=i),m.v(C,"_nextRateBySpeedAndBufferedB bitrateBySpeed:"+o+", nextBitrate:"+a+", bitrate:"+s+", remainingTime:"+u+", speed:"+r+", playbackRate:"+this[Fi]),a},B[p][fn]=function(e,t){for(var i=this,r=b.zeros(this._conf[Zi],this._conf[Zi]),n=0;n<this._conf[Zi];n++)r.set(n,n,this._conf.switchpanelty*(this._conf[Zi]-n));var s=this.MATRIX_E,o=this.MATRIX_G,a=this._multistepPred(this[nn],this._conf[Zi]);m.v(C,"algorithm kalman:"+a);var u=-1;if(this[Oi]>=this._conf.targetBuffer)u=this._quantization(1024*a[0]);else{var l=a.map((function(e){return-i._conf.duration/e})),d=new b([[this[Oi]],[this[Pi]]]),c=[];for(c[0]=[this[Oi]],n=0;n<this._conf[Zi];n++)c[n+1]=[this._conf.smoothRatioToTarget*c[n]+(1-this._conf.smoothRatioToTarget)*this._conf.targetBuffer];var f=c.slice(1),h=new b(f),_=s.multiply(this._diag(l)),p=b.multiply(b.multiply(b.add(b.multiply(_.transpose(),_),r).inverse(),_.transpose()),b.subtract(h,b.multiply(o,d)));this[Pi]=this[Oi],m.v(C,"algorithm input speed:"+e+" buffered:"+t,"output result:"+p.get(0,0)),u=this._quantization(this[Di][this._index]+1024*p.get(0,0))}return u},B[p]._multistepPred=function(e,t){for(var i=new Array(t),r=e.slice(0),n=0;n<t;n++){for(var s=0,o=0,a=0;a<e[y];a++)r[a]&&(s+=1/r[a],o+=1);0!==o&&(i[n]=1/(s/o),r.shift(),r.push(i[n]))}return i},B[p]._diag=function(e){for(var t=[],i=e[y],r=0;r<i;r++){t[r]=new Array(i);for(var n=0;n<i;n++)t[r][n]=0;t[r][r]=e[r]}return new b(t,{shape:[i,i]})},B}))}(0,0,0,0,"function",0,0,0,0,"constructor","prototype",0,0,0,"length",0,"hasOwnProperty",0,0,0,0,"_maxListeners",0,'"listener" argument must be a function',"_events",0,0,"listener","_eventsCount",0,0,0,0,0,0,0,0,0,0,0,0,0,"removeListener",0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Uncaught, unspecified "error" event',0,'Uncaught, unspecified "error" event. (',0,0,0,0,0,0,0,0,0,0,0,"removeAllListeners",0,0,"listenerCount",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"ENABLE_ERROR","ENABLE_WARN","ENABLE_INFO","ENABLE_DEBUG","ENABLE_VERBOSE",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"defineProperty",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_bufferSize","_lastBufferSize","_bitrates",0,0,0,"_speedPredictCnt","_playbackRate","_lowProfile","_lowProfileIndex","_lowProfileHistory","_renderBlockCount",0,0,0,0,0,0,0,0,0,0,"predictStep",0,0,0,0,"_availableList",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_pastThroughput","slidingWindowSize",0,0,0,0,0,"_nextRateBySpeedAndBufferedB","_nextRateBySpeedAndBuffered")}).call(this,i(/*! ./../../../webpack/buildin/module.js */"./node_modules/webpack/buildin/module.js")(e))},"./node_modules/events/events.js":
/*!***************************************!*\
  !*** ./node_modules/events/events.js ***!
  \***************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,i,r){var n,s,o,a;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),o=s[t]),void 0===o)o=s[t]=i,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),(n=l(e))>0&&o.length>n&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,a=u,console&&console.warn&&console.warn(a)}return e}function c(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,s(this.listener,this.target,e))}function f(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=c.bind(r);return n.listener=i,r.wrapFn=n,n}function h(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):p(n,n.length)}function _(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)s(u,this,t);else{var l=u.length,d=p(u,l);for(i=0;i<l;++i)s(d[i],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var i,r,n,s,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){o=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},a.prototype.listenerCount=_,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},"./node_modules/querystringify/index.js":
/*!**********************************************!*\
  !*** ./node_modules/querystringify/index.js ***!
  \**********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=Object.prototype.hasOwnProperty;function n(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}t.stringify=function(e,t){t=t||"";var i,n,s=[];for(n in"string"!=typeof t&&(t="?"),e)if(r.call(e,n)){if((i=e[n])||null!=i&&!isNaN(i)||(i=""),n=encodeURIComponent(n),i=encodeURIComponent(i),null===n||null===i)continue;s.push(n+"="+i)}return s.length?t+s.join("&"):""},t.parse=function(e){for(var t,i=/([^=?&]+)=?([^&]*)/g,r={};t=i.exec(e);){var s=n(t[1]),o=n(t[2]);null===s||null===o||s in r||(r[s]=o)}return r}},"./node_modules/requires-port/index.js":
/*!*********************************************!*\
  !*** ./node_modules/requires-port/index.js ***!
  \*********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},"./node_modules/url-parse/index.js":
/*!*****************************************!*\
  !*** ./node_modules/url-parse/index.js ***!
  \*****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){(function(t){var r=i(/*! requires-port */"./node_modules/requires-port/index.js"),n=i(/*! querystringify */"./node_modules/querystringify/index.js"),s=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,o=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,a=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function u(e){return(e||"").toString().replace(a,"")}var l=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],d={hash:1,query:1};function c(e){var i,r=("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}).location||{},n={},o=typeof(e=e||r);if("blob:"===e.protocol)n=new h(unescape(e.pathname),{});else if("string"===o)for(i in n=new h(e,{}),d)delete n[i];else if("object"===o){for(i in e)i in d||(n[i]=e[i]);void 0===n.slashes&&(n.slashes=s.test(e.href))}return n}function f(e){e=u(e);var t=o.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function h(e,t,i){if(e=u(e),!(this instanceof h))return new h(e,t,i);var s,o,a,d,_,p,v=l.slice(),m=typeof t,g=this,y=0;for("object"!==m&&"string"!==m&&(i=t,t=null),i&&"function"!=typeof i&&(i=n.parse),t=c(t),s=!(o=f(e||"")).protocol&&!o.slashes,g.slashes=o.slashes||s&&t.slashes,g.protocol=o.protocol||t.protocol||"",e=o.rest,o.slashes||(v[3]=[/(.*)/,"pathname"]);y<v.length;y++)"function"!=typeof(d=v[y])?(a=d[0],p=d[1],a!=a?g[p]=e:"string"==typeof a?~(_=e.indexOf(a))&&("number"==typeof d[2]?(g[p]=e.slice(0,_),e=e.slice(_+d[2])):(g[p]=e.slice(_),e=e.slice(0,_))):(_=a.exec(e))&&(g[p]=_[1],e=e.slice(0,_.index)),g[p]=g[p]||s&&d[3]&&t[p]||"",d[4]&&(g[p]=g[p].toLowerCase())):e=d(e);i&&(g.query=i(g.query)),s&&t.slashes&&"/"!==g.pathname.charAt(0)&&(""!==g.pathname||""!==t.pathname)&&(g.pathname=function(e,t){if(""===e)return t;for(var i=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=i.length,n=i[r-1],s=!1,o=0;r--;)"."===i[r]?i.splice(r,1):".."===i[r]?(i.splice(r,1),o++):o&&(0===r&&(s=!0),i.splice(r,1),o--);return s&&i.unshift(""),"."!==n&&".."!==n||i.push(""),i.join("/")}(g.pathname,t.pathname)),r(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(d=g.auth.split(":"),g.username=d[0]||"",g.password=d[1]||""),g.origin=g.protocol&&g.host&&"file:"!==g.protocol?g.protocol+"//"+g.host:"null",g.href=g.toString()}h.prototype={set:function(e,t,i){var s=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(i||n.parse)(t)),s[e]=t;break;case"port":s[e]=t,r(t,s.protocol)?t&&(s.host=s.hostname+":"+t):(s.host=s.hostname,s[e]="");break;case"hostname":s[e]=t,s.port&&(t+=":"+s.port),s.host=t;break;case"host":s[e]=t,/:\d+$/.test(t)?(t=t.split(":"),s.port=t.pop(),s.hostname=t.join(":")):(s.hostname=t,s.port="");break;case"protocol":s.protocol=t.toLowerCase(),s.slashes=!i;break;case"pathname":case"hash":if(t){var o="pathname"===e?"/":"#";s[e]=t.charAt(0)!==o?o+t:t}else s[e]=t;break;default:s[e]=t}for(var a=0;a<l.length;a++){var u=l[a];u[4]&&(s[u[1]]=s[u[1]].toLowerCase())}return s.origin=s.protocol&&s.host&&"file:"!==s.protocol?s.protocol+"//"+s.host:"null",s.href=s.toString(),s},toString:function(e){e&&"function"==typeof e||(e=n.stringify);var t,i=this,r=i.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var s=r+(i.slashes?"//":"");return i.username&&(s+=i.username,i.password&&(s+=":"+i.password),s+="@"),s+=i.host+i.pathname,(t="object"==typeof i.query?e(i.query):i.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),i.hash&&(s+=i.hash),s}},h.extractProtocol=f,h.location=c,h.trimLeft=u,h.qs=n,e.exports=h}).call(this,i(/*! ./../webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s,o,a;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,a={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=a.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var s=a.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):t;var o=a.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=n.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(l.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var d=o.path,c=d.substring(0,d.lastIndexOf("/")+1)+s.path;l.path=a.normalizePath(c)}else l.path=o.path,s.params||(l.params=o.params,s.query||(l.query=o.query));return null===l.path&&(l.path=i.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(l)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(s,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=a},"./node_modules/uuid/index.js":
/*!************************************!*\
  !*** ./node_modules/uuid/index.js ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./v1 */"./node_modules/uuid/v1.js"),n=i(/*! ./v4 */"./node_modules/uuid/v4.js"),s=n;s.v1=r,s.v4=n,e.exports=s},"./node_modules/uuid/lib/bytesToUuid.js":
/*!**********************************************!*\
  !*** ./node_modules/uuid/lib/bytesToUuid.js ***!
  \**********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){for(var i=[],r=0;r<256;++r)i[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,n=i;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},"./node_modules/uuid/lib/rng-browser.js":
/*!**********************************************!*\
  !*** ./node_modules/uuid/lib/rng-browser.js ***!
  \**********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var r=new Uint8Array(16);e.exports=function(){return i(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},"./node_modules/uuid/v1.js":
/*!*********************************!*\
  !*** ./node_modules/uuid/v1.js ***!
  \*********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s=i(/*! ./lib/rng */"./node_modules/uuid/lib/rng-browser.js"),o=i(/*! ./lib/bytesToUuid */"./node_modules/uuid/lib/bytesToUuid.js"),a=0,u=0;e.exports=function(e,t,i){var l=t&&i||0,d=t||[],c=(e=e||{}).node||r,f=void 0!==e.clockseq?e.clockseq:n;if(null==c||null==f){var h=s();null==c&&(c=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==f&&(f=n=16383&(h[6]<<8|h[7]))}var _=void 0!==e.msecs?e.msecs:(new Date).getTime(),p=void 0!==e.nsecs?e.nsecs:u+1,v=_-a+(p-u)/1e4;if(v<0&&void 0===e.clockseq&&(f=f+1&16383),(v<0||_>a)&&void 0===e.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=_,u=p,n=f;var m=(1e4*(268435455&(_+=122192928e5))+p)%4294967296;d[l++]=m>>>24&255,d[l++]=m>>>16&255,d[l++]=m>>>8&255,d[l++]=255&m;var g=_/4294967296*1e4&268435455;d[l++]=g>>>8&255,d[l++]=255&g,d[l++]=g>>>24&15|16,d[l++]=g>>>16&255,d[l++]=f>>>8|128,d[l++]=255&f;for(var y=0;y<6;++y)d[l+y]=c[y];return t||o(d)}},"./node_modules/uuid/v4.js":
/*!*********************************!*\
  !*** ./node_modules/uuid/v4.js ***!
  \*********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./lib/rng */"./node_modules/uuid/lib/rng-browser.js"),n=i(/*! ./lib/bytesToUuid */"./node_modules/uuid/lib/bytesToUuid.js");e.exports=function(e,t,i){var s=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[s+a]=o[a];return t||n(o)}},"./node_modules/webpack/buildin/amd-define.js":
/*!***************************************!*\
  !*** (webpack)/buildin/amd-define.js ***!
  \***************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},"./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){function r(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var r=i(i.s=ENTRY_MODULE);return r.default||r}function n(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,r){var s={};s[r]=[];var o=t.toString(),a=o.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return s;for(var u,l=a[1],d=new RegExp("(\\\\n|\\W)"+n(l)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");u=d.exec(o);)"dll-reference"!==u[3]&&s[r].push(u[3]);for(d=new RegExp("\\("+n(l)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");u=d.exec(o);)e[u[2]]||(s[r].push(u[1]),e[u[2]]=i(u[1]).m),s[u[2]]=s[u[2]]||[],s[u[2]].push(u[4]);for(var c,f=Object.keys(s),h=0;h<f.length;h++)for(var _=0;_<s[f[h]].length;_++)c=s[f[h]][_],isNaN(1*c)||(s[f[h]][_]=1*s[f[h]][_]);return s}function o(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:i.m},a=t.all?{main:Object.keys(n.main)}:function(e,t){for(var i={main:[t]},r={main:[]},n={main:{}};o(i);)for(var a=Object.keys(i),u=0;u<a.length;u++){var l=a[u],d=i[l].pop();if(n[l]=n[l]||{},!n[l][d]&&e[l][d]){n[l][d]=!0,r[l]=r[l]||[],r[l].push(d);for(var c=s(e,e[l][d],l),f=Object.keys(c),h=0;h<f.length;h++)i[f[h]]=i[f[h]]||[],i[f[h]]=i[f[h]].concat(c[f[h]])}}return r}(n,e),u="";Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),u=u+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var l=new window.Blob([u],{type:"text/javascript"});if(t.bare)return l;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),c=new window.Worker(d);return c.objectURL=d,c}},"./src/abr/flv-abr-get-url.ts":
/*!************************************!*\
  !*** ./src/abr/flv-abr-get-url.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! url-parse */"./node_modules/url-parse/index.js")],void 0===(s="function"==typeof(r=function(e,t){var i;e.__esModule=!0,e.flvAbrGetUrl=function(e,i){if(void 0===i)return e;var r=new t.default(e,!0);return r.query.kabr_spts=""+i,r.toString()},t=(i=t)&&i.__esModule?i:{default:i}})?r.apply(t,n):r)||(e.exports=s)},"./src/abr/flv-abr-level.ts":
/*!**********************************!*\
  !*** ./src/abr/flv-abr-level.ts ***!
  \**********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0,e.default=function(e){this.url=void 0,this.bitrate=0,this.qualityType="",this.id=0,this.codec="",this.averageBitrate=0,this.hidden=!1,this.enableAdaptive=!0,this.defaultSelect=!1,this.url=e}})?r.apply(t,n):r)||(e.exports=s)},"./src/abr/flv-abr-manifest.ts":
/*!*************************************!*\
  !*** ./src/abr/flv-abr-manifest.ts ***!
  \*************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./flv-abr-level */"./src/abr/flv-abr-level.ts")],void 0===(s="function"==typeof(r=function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r;e.__esModule=!0,e.FlvAbrManifest=void 0,t=(r=t)&&r.__esModule?r:{default:r};var n=function(){function e(i){var r=this;this._levels=[],this._abrLevels=[],this._default=void 0,e.verify(i)&&(i.adaptationSet.representation.sort((function(e,t){return e.bitrate-t.bitrate})),i.adaptationSet.representation.forEach((function(e,i){var n=new t.default(e.url);n.id=e.id||i,n.bitrate=e.bitrate||0,n.qualityType=e.qualityType||"",n.codec=e.codec||"",n.averageBitrate=e.averageBitrate||0,n.hidden=e.hidden||!1,n.enableAdaptive=void 0===e.enableAdaptive||!!e.enableAdaptive,n.defaultSelect=e.defaultSelect||!1,r._levels.push(n),n.enableAdaptive&&r._abrLevels.push(i),n.defaultSelect&&void 0===r._default&&(r._default=i)})))}var r,n,s;return e.verify=function(e){return!!(e&&e.hasOwnProperty("version")&&e.hasOwnProperty("adaptationSet")&&e.adaptationSet.hasOwnProperty("representation")&&Array.isArray(e.adaptationSet.representation)&&e.adaptationSet.representation.length>0)&&(e.adaptationSet.representation.forEach((function(e){if(!e.url||!e.bitrate||!e.qualityType)return!1})),!0)},r=e,(n=[{key:"levels",get:function(){return this._levels}},{key:"abrLevels",get:function(){return this._abrLevels}},{key:"default",get:function(){return this._default||0}}])&&i(r.prototype,n),s&&i(r,s),e}();e.FlvAbrManifest=n})?r.apply(t,n):r)||(e.exports=s)},"./src/abr/flv-multirate.ts":
/*!**********************************!*\
  !*** ./src/abr/flv-multirate.ts ***!
  \**********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! @ks/adaptive-multi-rate/lib/adaptive-flv */"./node_modules/@ks/adaptive-multi-rate/lib/adaptive-flv.js"),i(/*! ../abr/flv-abr-get-url */"./src/abr/flv-abr-get-url.ts"),i(/*! ../abr/flv-abr-manifest */"./src/abr/flv-abr-manifest.ts"),i(/*! ../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../core/observer */"./src/core/observer.ts"),i(/*! ../core/report-types */"./src/core/report-types.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o){function a(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function d(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,t=a(t),n=a(n);var c=function(e){var s,a;function c(i,s){var o;return(o=e.call(this)||this)._config=void 0,o._media=void 0,o._smooth=void 0,o._downloadSize=0,o._downloadStartTime=0,o._qosStatInterval=0,o._qosStatIntervalCount=0,o._keyCount=0,o._index=0,o._algorithm=void 0,o._adaptiveQosStat=void 0,o._autoLevelEnabled=!1,o._manifest=void 0,o._getBufferedLengthMillis=function(){return 1e3*o._media.bufferedSec()},o._config=i,o._media=s,o._adaptiveQosStat={playStartTime:0,tickStart:0},o._manifest=new r.FlvAbrManifest(i.manifest),o._algorithm=new t.default(i.manifest,o._config.liveAdaptiveConfig,{index:o._index}),o._algorithm.on(n.default.ADAPTIVE_ALGORITHM,(function(e){return o.trigger(n.default.ADAPTIVE_ALGORITHM,e)})),o._autoLevelEnabled=!!i.adaptive,t.default.setLogLevel(o._config.kwaiKernelLog),o}a=e,(s=c).prototype=Object.create(a.prototype),s.prototype.constructor=s,s.__proto__=a;var f,h,_,p=c.prototype;return p.init=function(){this._downloadSize=0,this._downloadStartTime=performance.now(),this._qosStatInterval=2,this._qosStatIntervalCount=0,this._keyCount=0,this._manifest.levels&&(this._autoLevelEnabled&&(this._index=this._algorithm.nextIndex),this.trigger(n.default.MANIFEST_PARSED,{}))},p.destory=function(){this._algorithm&&this._algorithm.removeAllListeners()},p.onLoaderChunk=function(e){this._downloadSize+=e},p.onLevelLoad=function(e){this._manifest.levels.length&&e>=0&&e<this._manifest.levels.length&&(this._keyCount=0,this._adaptiveQosStat.playStartTime=Date.now(),this._index=e,this._algorithm&&this._algorithm.onLevelLoad(e))},p.onKeyFrame=function(e){var t=this._manifest.levels;if(this._keyCount++,(this._algorithm||"number"==typeof this._smooth)&&this._keyCount>1&&t){var i=this._index,r=!1;if("number"==typeof this._smooth)i=this._smooth,this._smooth=void 0;else{if(!this._autoLevelEnabled||!this._algorithm)return;this._algorithm.onGOP(this._getAdaptionInfo()),i=this._algorithm.nextIndex,r=!0}if(i!==this._index)return{url:this.getRequestUrl(i,e),level:i,auto:r}}},p.heartbeat=function(){if(this._algorithm&&this._autoLevelEnabled){var e=this._getAdaptionInfo();e.type=o.REPORT_TYPES.HEARTBEAT,this._algorithm.onHeartbeat(e),this._qosStatIntervalCount%this._qosStatInterval==0&&this._sendAdaptiveQosStat(),this._qosStatIntervalCount=(this._qosStatIntervalCount+1)%this._qosStatInterval}},p.getRequestUrl=function(e,t){var r=this._config.src,n=this._manifest.levels[e];return n&&(r=n.url),(0,i.flvAbrGetUrl)(r,t||this._config.defaultSpts)},p._sendAdaptiveQosStat=function(){if(this._algorithm){var e=this._algorithm.qos,t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(i,!0).forEach((function(t){l(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({type:o.REPORT_TYPES.LIVE_ADAPTIVE_QOS_STAT,play_start_time:this._adaptiveQosStat.playStartTime,tick_start:this._adaptiveQosStat.tickStart,current_gop_duration:0,buffer_time:Math.floor(this._getBufferedLengthMillis())},e);this._adaptiveQosStat.tickStart=Date.now(),this.trigger(n.default.REPORT,t)}},p._getAdaptionInfo=function(){var e={currentTime:Math.round(1e3*(this._media.currentTime||0)),buffered:this._getBufferedLengthMillis(),pendingBuffers:Math.round(1e3*this._media.pendingSecByType("video")),download:{size:this._downloadSize,duration:Math.round(performance.now()-this._downloadStartTime)}};return this._downloadStartTime=performance.now(),this._downloadSize=0,e},f=c,(h=[{key:"autoLevelEnabled",get:function(){return this._autoLevelEnabled}},{key:"levels",get:function(){return this._manifest.levels}},{key:"nextLevel",get:function(){return"number"==typeof this._smooth?this._smooth:this._index},set:function(e){e>=0?(e=Math.min(this._manifest.levels.length-1,e),this._autoLevelEnabled=!1,this._smooth=e):-1===e&&(this._autoLevelEnabled=this._config.adaptive)}},{key:"currentLevel",get:function(){return this._index},set:function(e){e>=0?(e=Math.min(this._manifest.levels.length-1,e),this._autoLevelEnabled=!1,this._index=e):-1===e&&(this._autoLevelEnabled=this._config.adaptive)}}])&&d(f.prototype,h),_&&d(f,_),c}((s=a(s)).default);e.default=c})?r.apply(t,n):r)||(e.exports=s)},"./src/abr/hls-abr.ts":
/*!****************************!*\
  !*** ./src/abr/hls-abr.ts ***!
  \****************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! @ks/adaptive-multi-rate/lib/adaptive-hls */"./node_modules/@ks/adaptive-multi-rate/lib/adaptive-hls.js"),i(/*! ../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../core/observer */"./src/core/observer.ts"),i(/*! ../core/report-types */"./src/core/report-types.ts"),i(/*! ../utils/download-info */"./src/utils/download-info.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o){function a(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function d(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,i=a(i),r=a(r),n=a(n);var c={speedPredictRatioOnStart:6},f=function(e){var n,a;function f(t,r){var n;return(n=e.call(this)||this)._config=void 0,n._media=void 0,n._algorithm=void 0,n._info=void 0,n._activity=!1,n._downloadEnd=void 0,n._downloadStartTime=0,n._index=0,n._config=t,n._media=r,i.default.setLogLevel(t.kwaiKernelLog),n._downloadEnd=0,n}a=e,(n=f).prototype=Object.create(a.prototype),n.prototype.constructor=n,n.__proto__=a;var h,_,p,v=f.prototype;return v.init=function(e){return this._info=e,this._index=e.index,this._activity=!!(this._config.adaptive&&e.levels.length>1),this._activity?(this._algorithm=new i.default(e,this._config.hlsAdaptiveConfig||c),this._index=this._algorithm.bitrateInit()||0,this.trigger(r.default.REPORT,{type:s.REPORT_TYPES.ABR_INIT,algorithm:this._algorithm.algorithm,lowProfile:this._algorithm.lowProfile?1:0})):this.active(!1),this._index||0},v.setAvailableAbrLevels=function(e){this._algorithm&&this._algorithm.setAvailableBitrates(e)},v.destory=function(){this._algorithm&&(this._algorithm.removeAllListeners(),this._algorithm=void 0)},v.onRatechange=function(e){this._algorithm&&this._algorithm.onRatechange(e)},v.onWaiting=function(){this._algorithm&&(this._algorithm.onWaiting({buffered:1e3*this._media.bufferedSec()}),this._algorithm.lowProfile&&this.trigger(r.default.REPORT,{type:s.REPORT_TYPES.ABR_LOW_PROFILE}))},v.onMessage=function(e,i){if(this._algorithm&&this._info)switch(e){case r.default.REPORT:if(i.type===s.REPORT_TYPES.DOWNLOAD){if((0,t.isFiniteNumber)(i.slicePlayStartTime)&&i.status===o.DownloadStatus.SUCCESS){this._downloadEnd=i.slicePlayStartTime+i.slicePlayDuration;var n={buffered:this._downloadEnd-1e3*this._media.currentTime,duration:i.duration||0,spendTime:i.spendTime,byteLength:i.byteLength};this._algorithm.onDownload(n)}}else if(i.type===s.REPORT_TYPES.NEW_SOURCE)this._downloadStartTime=this._downloadStartTime||performance.now(),this._info&&i.index>=0&&i.index<this._info.levels.length&&(this._index=i.index),this._algorithm.onLevelLoad(i.index);else if(i.type===s.REPORT_TYPES.SEEK){var a={isInBuffer:i.isInBuffer,buffered:this._downloadEnd-1e3*this._media.currentTime};this._algorithm.onSeek(a)}}},v.active=function(e){this._activity=e},v.nextBitrateIndex=function(){if(this._sendAdaptiveQosStat(),this._activity&&this._info&&this._info.levels.length>1&&this._algorithm){var e=this._algorithm.nextIndex;if(e!==this._index&&e>=0&&e<this._info.levels.length)return e}return this._index},v.setDownloadEnabled=function(e){this._algorithm&&this._algorithm.onDownloadEnabled(e)},v._sendAdaptiveQosStat=function(){if(this._algorithm&&this._algorithm.beacon){var e=this._algorithm.qos,t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(i,!0).forEach((function(t){l(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({type:s.REPORT_TYPES.HLS_VOD_ADAPTIVE_QOS_STAT},e);this.trigger(r.default.REPORT,t)}},h=f,(_=[{key:"autoLevelEnabled",get:function(){return!!this._activity}}])&&d(h.prototype,_),p&&d(h,p),f}(n.default);e.default=f})?r.apply(t,n):r)||(e.exports=s)},"./src/config.ts":
/*!***********************!*\
  !*** ./src/config.ts ***!
  \***********************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! ./io/fetch */"./src/io/fetch.ts"),i(/*! ./io/xhr */"./src/io/xhr.ts"),i(/*! ./types/core */"./src/types/core.ts"),i(/*! ./utils/browser */"./src/utils/browser.ts"),i(/*! ./utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o){function a(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.ConfigHelper=e.DEFAULT_CONFIG=void 0,i=a(i),s=a(s);var u=new RegExp("^(http|https)://"),l={isLive:!1,box:n.MediaBox.flv,alwaysSeekKeyframe:!1,lazyLoadMaxDuration:90,lazyLoadRecoverDuration:60,webWorker:!0,fragBeforeWorker:2,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:15,appendErrorMaxRetry:3,credentials:!1,streamingMux:!0,autoPlaybackRate:!0,autoPlaybackRateConf:void 0,enableSoftwareAES:!0,startPlayBufferSec:0,startFromSec:0,startFromKeyframe:!0,defaultSpts:-7e3,lazyLoad:!1,kwaiKernelLog:o.LOG_LEVEL.LEVEL_ERROR,retryWithBackup:!0,resourceBuffer:!0,resourceBufferSize:500,ntp:!0,ensureAudio:!0,dbCache:!0,adaptive:!0,stretchShortVideoTrack:!1,maxBufferHole:.5,maxAudioFramesDrift:5,forceKeyFrameOnDiscontinuity:!1,maxRetry:3,connectionTimeout:1e4,transmissionTimeout:3e4,retryDelay:2e3,maxFragFailSec:11,manifestLoadingMaxRetry:3,manifestConnectionTimeout:1e4,manifestTransmissionTimeout:1e4,manifestLoadingRetryDelay:1,levelLoadingMaxRetry:3,levelConnectionTimeout:1e4,levelTransmissionTimeout:1e4,levelLoadingRetryDelay:100,keyLoadingMaxRetry:3,keyConnectionTimeout:5e3,keyTransmissionTimeout:5e3,keyLoadingRetryDelay:300};e.DEFAULT_CONFIG=l;var d={maxRetry:1,retryDelay:100,connectionTimeout:1e4,levelConnectionTimeout:1e4,manifestConnectionTimeout:1e4},c={startDelay:10,interval:.6,rule:[{rate:1.2,lower:20,upper:Number.MAX_SAFE_INTEGER},{rate:1.1,lower:14,upper:17},{rate:1,lower:5,upper:11},{rate:.9,lower:0,upper:3}]},f={startDelay:10,interval:.6,rule:[{rate:1.1,lower:11,upper:Number.MAX_SAFE_INTEGER},{rate:1,lower:0,upper:10}]},h=function(){function e(){}return e.isStreamingSupport=function(e){return e&&"flv"===e.box&&e.isLive?i.default.isSupport()||r.XHR.isSupportChunk()===r.XHR_TYPE.MOZ_CHUNK:i.default.isSupport()||r.XHR.isSupportChunk()},e.processConfig=function(i){var r=i.box===n.MediaBox.hls?(0,t.ObjectAssign)({},l,d):(0,t.ObjectAssign)({},l);return(0,t.ObjectAssign)(r,i),r.startPlayBufferSec=Math.min(5,Math.max(0,r.startPlayBufferSec)),s.default.msedge&&(r.startPlayBufferSec=Math.max(r.startPlayBufferSec,1),r.adaptive=r.box===n.MediaBox.hls),e.setSrc(r),this._initPlayBackRateRule(r),window.Worker||(r.webWorker=!1),r.isLive&&(r.startFromSec=0),r.lazyLoad=!(r.isLive&&r.box===n.MediaBox.flv),e.detectStreamingMux(r),r.autoCleanupMaxBackwardDuration=Math.max(r.autoCleanupMaxBackwardDuration,r.autoCleanupMinBackwardDuration+10),r},e.detectStreamingMux=function(t){t.streamingMux=!(!t.streamingMux||!e.isStreamingSupport(t));var i=s.default.safari&&!t.isLive||s.default.opera&&s.default.version.major<37;t.gopRemux=t.streamingMux&&i},e.setSrc=function(e,t){if(void 0===t&&(t=null),t&&(e.src=t,e.manifest=""),"string"==typeof e.src&&!u.test(e.src))try{e.src=JSON.parse(e.src)}catch(t){e.manifest=""}"object"==typeof e.src&&(e.manifest=e.src,e.src="")},e._initPlayBackRateRule=function(e){e.autoPlaybackRate=e.isLive&&e.autoPlaybackRate;var t=e.autoPlaybackRateConf;if(t){var i=t.rule;if(i&&Array.isArray(i)&&((i=i.filter((function(e){return e.upper>e.lower&&e.rate>0}))).sort((function(e,t){return t.rate-e.rate})),i.length>1))return t.rule=i,void(e.autoPlaybackRateConf=t)}else e.autoPlaybackRateConf=e.adaptive?f:c},e}();e.ConfigHelper=h})?r.apply(t,n):r)||(e.exports=s)},"./src/const.ts":
/*!**********************!*\
  !*** ./src/const.ts ***!
  \**********************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.ERRORNO=void 0,e.ERRORNO={UNKNOW_ERROR:10,NET_ERROR:100,CODEC_ERROR:101,CANNOT_SEEK:102,ENDOFSTREAM_ERROR:103,MEDIASOURCE_ERROR:104,SOURCEBUFFER_ERROR:105,SBABORT_ERROR:106,APPENDBUFFER_ERROR:107,FORMAT_ERROR:108,CODEC_UNSUPPORTED:109,CONFIG_DATA_ERROR:111}})?r.apply(t,n):r)||(e.exports=s)},"./src/core/kernel-errors.ts":
/*!***********************************!*\
  !*** ./src/core/kernel-errors.ts ***!
  \***********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){var t,i;e.__esModule=!0,e.ErrorDetails=e.ErrorTypes=void 0,e.ErrorTypes=t,function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e.MSE_ERROR="mseError"}(t||(e.ErrorTypes=t={})),e.ErrorDetails=i,function(e){e[e.LOAD_ERROR=10]="LOAD_ERROR",e[e.HLS_MANIFEST_LOAD_ERROR=11]="HLS_MANIFEST_LOAD_ERROR",e[e.HLS_LEVEL_LOAD_ERROR=12]="HLS_LEVEL_LOAD_ERROR",e[e.HLS_AUDIO_TRACK_LOAD_ERROR=13]="HLS_AUDIO_TRACK_LOAD_ERROR",e[e.HLS_KEY_LOAD_ERROR=14]="HLS_KEY_LOAD_ERROR",e[e.CANNOT_SEEK=100]="CANNOT_SEEK",e[e.VIDEO_ERROR=101]="VIDEO_ERROR",e[e.UNSUPPORTED=102]="UNSUPPORTED",e[e.CONFIG_ERROR=103]="CONFIG_ERROR",e[e.MEDIASOURCE_ERROR=200]="MEDIASOURCE_ERROR",e[e.ADDSOURCEBUFFER_ERROR=201]="ADDSOURCEBUFFER_ERROR",e[e.SOURCEBUFFER_ERROR=202]="SOURCEBUFFER_ERROR",e[e.ENDOFSTREAM_ERROR=203]="ENDOFSTREAM_ERROR",e[e.APPENDBUFFER_ERROR=204]="APPENDBUFFER_ERROR",e[e.PARSING_ERROR=301]="PARSING_ERROR",e[e.REMUX_ERROR=302]="REMUX_ERROR",e[e.REMUX_ALLOC_ERROR=303]="REMUX_ALLOC_ERROR",e[e.HLS_MANIFEST_PARSING_ERROR=400]="HLS_MANIFEST_PARSING_ERROR",e[e.HLS_LEVEL_SWITCH_ERROR=401]="HLS_LEVEL_SWITCH_ERROR",e[e.KEY_SYSTEM_NO_ACCESS=500]="KEY_SYSTEM_NO_ACCESS",e[e.KEY_SYSTEM_NO_SESSION=501]="KEY_SYSTEM_NO_SESSION",e[e.KEY_SYSTEM_URL_ERROR=502]="KEY_SYSTEM_URL_ERROR",e[e.KEY_SYSTEM_LICENSE_REQUEST_FAILED=503]="KEY_SYSTEM_LICENSE_REQUEST_FAILED",e[e.KEY_SYSTEM_LICENSE_REQUEST_TIMEOUT=504]="KEY_SYSTEM_LICENSE_REQUEST_TIMEOUT",e[e.KEY_SYSTEM_NO_KEYS=505]="KEY_SYSTEM_NO_KEYS",e[e.FRAG_DECRYPT_ERROR=506]="FRAG_DECRYPT_ERROR"}(i||(e.ErrorDetails=i={}))})?r.apply(t,n):r)||(e.exports=s)},"./src/core/kernel-events.ts":
/*!***********************************!*\
  !*** ./src/core/kernel-events.ts ***!
  \***********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){var t;e.__esModule=!0,e.default=void 0,function(e){e.METADATA="metadata",e.PARSING_INIT_SEGMENT="parsingInitSegment",e.PARSING_DATA="parsingData",e.PARSED_DATA="parsedData",e.SCRIPT_PARSED="scriptParsed",e.REPORT="report",e.LOAD_END="loadEnd",e.DISCONTINUITY="discontinuity",e.ERROR="kernelError",e.LEVEL_SWITCH_FAILED="levelSwitchFailed",e.LEVEL_SWITCHING="levelSwitching",e.LEVEL_SWITCHED="levelSwitched",e.LEVEL_LOADED="levelLoaded",e.LEVEL_UPDATED="levelUpdated",e.INPUT_DATA_CONTAINS_I="inputDataContainsI",e.HLS_MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="manifestParsed",e.HLS_INIT_PTS_FOUND="hlsInitPtsFound",e.HLS_FRAG_PARSED="hlsFragParsed",e.HLS_KEY_LOADED="hlsKeyLoaded",e.AUDIO_TRACK_LOADED="audioLoaded",e.ADAPTIVE_ALGORITHM="adaptiveAlgorithm",e.BUFFER_FLUSHING="bufferFlushing",e.INIT_PTS_FOUND="initPTSFound",e.SEEK_KEYFRAME="seekKeyframe",e.PRELOAD_COMPLETE="preloadComplete",e.PRELOAD_HIT="preloadHit",e.ABR_NEXT="abrNext",e.FLV_HEAD="flvHead",e.PRIV_NAL="privNal"}(t||(t={}));var i=t;e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/core/media.ts":
/*!***************************!*\
  !*** ./src/core/media.ts ***!
  \***************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0;var i=function(){function e(){this._video=void 0,this._mse=void 0}var i,r,n,s=e.prototype;return s.attachVideo=function(e){this._video=e},s.attachMSE=function(e){this._mse=e},s.isTimeinBuffered=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++)if(e>=t.start(i)&&e<t.end(i))return!0;return!1},s.bufferedSec=function(){return this._video&&this._video.buffered.length>0?Math.max(0,this._video.buffered.end(this._video.buffered.length-1)-this._video.currentTime):0},s.bufferedSecByType=function(e){return this._mse&&this._video&&this._mse.bufferedEndByType(e)>0?this._mse.bufferedEndByType(e)-this._video.currentTime:0},s.mseBufferedSecByType=function(e){return this._mse?this._mse.bufferedByType(e):{start:0,end:0}},s.bufferSliceNumByType=function(e){return this._mse?this._mse.bufferSliceNumByType(e):0},s.pendingNum=function(){return this._mse?this._mse.pendingNum():0},s.pendingSecByType=function(e){return this._mse?this._mse.pendingSecByType(e):0},s.currentBuffer=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r<=e&&e<n)return{start:r,end:n}}},s.nextBuffer=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r>e)return{start:r,end:n}}},i=e,(r=[{key:"video",get:function(){return this._video}},{key:"mse",get:function(){return this._mse}},{key:"mseReadyState",get:function(){return this._mse?this._mse.readyState:"closed"}},{key:"videoReadyState",get:function(){return this._video?this._video.readyState:0}},{key:"currentTime",get:function(){return this._video?this._video.currentTime:0}}])&&t(i.prototype,r),n&&t(i,n),e}();e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/core/mse-controller.ts":
/*!************************************!*\
  !*** ./src/core/mse-controller.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! events */"./node_modules/events/events.js"),i(/*! ../utils/log */"./src/utils/log.ts"),i(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),i(/*! ./kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ./kernel-events */"./src/core/kernel-events.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o){function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u;e.__esModule=!0,e.default=void 0,o=(u=o)&&u.__esModule?u:{default:u};var l=function(e){var i,u;function l(t){var i;return(i=e.call(this)||this).tag="mse-controller",i._config=void 0,i.video=void 0,i._sourceBuffer=void 0,i._mediaSource=null,i._mimeCodec=void 0,i._cleanUpTask=void 0,i._appendQueue=void 0,i._hasVideo=void 0,i._hasAudio=void 0,i._endOfData=!1,i._appendEnabled=void 0,i._duration=null,i._appendError=0,i._appendBufferError=!1,i._mseDuration=null,i._sbHandler={},i._souceBufferLocked=!1,i._onSourceOpen=function(){r.Log.i(i.tag,"MediaSource onSourceOpen"),i._mediaSource&&(i._mediaSource.removeEventListener("sourceopen",i._onSourceOpen),i._checkSourceBuffer(),i.refresh(),i.emit("source_open"))},i._onSourceEnded=function(){r.Log.i(i.tag,"MediaSource onSourceEnded")},i._onSourceClose=function(){r.Log.i(i.tag,"MediaSource onSourceClose"),i._mediaSource&&(i._mediaSource.removeEventListener("sourceopen",i._onSourceOpen),i._mediaSource.removeEventListener("sourceended",i._onSourceEnded),i._mediaSource.removeEventListener("sourceclose",i._onSourceClose))},i._onSourceBufferUpdateEnd=function(e){i._update(e),i._endOfData&&i._endOfStream(),i._updateDuration(),i.emit("updateend")},i._onSourceBufferError=function(e){r.Log.e(i.tag,"SourceBuffer Error: "+e),i.emit(o.default.ERROR,{type:s.ErrorTypes.MSE_ERROR,details:s.ErrorDetails.SOURCEBUFFER_ERROR,fatal:!0,reason:"source buffer error"})},i._config=t,i._hasVideo=!1,i._hasAudio=!1,i._appendQueue={video:[],audio:[]},i._sourceBuffer={},i._cleanUpTask={video:[],audio:[]},i._mimeCodec={},i._appendEnabled=!0,i}u=e,(i=l).prototype=Object.create(u.prototype),i.prototype.constructor=i,i.__proto__=u;var d,c,f,h=l.prototype;return h.attach=function(e){var t=this;this.video=e;var i=(0,n.getMediaSource)();if(i){var r=this._mediaSource=new i;this.video.src=URL.createObjectURL(r),this.video.load(),r.addEventListener("sourceopen",this._onSourceOpen),r.addEventListener("sourceended",this._onSourceEnded),r.addEventListener("sourceclose",this._onSourceClose),this._souceBufferLocked=!1}else setTimeout((function(){t.emit(o.default.ERROR,{type:s.ErrorTypes.MSE_ERROR,details:s.ErrorDetails.MEDIASOURCE_ERROR,fatal:!0,reason:"MediaSource is not support"})}),0)},h.trackInfo=function(e){if((this._hasAudio!==e.hasAudio||this._hasVideo!==e.hasVideo)&&this.video&&this.hasSourceBuffer()){for(var t in r.Log.i(this.tag,"trackInfo rebuild mse"),this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend));this._sourceBuffer={},this._mediaSource&&(this._mediaSource.removeEventListener("sourceopen",this._onSourceOpen),this._mediaSource.removeEventListener("sourceended",this._onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this._onSourceClose)),this._mimeCodec={},this._hasAudio=e.hasAudio,this._hasVideo=e.hasVideo,this.attach(this.video)}e.hasAudio&&e.audioCodec&&(this._mimeCodec.audio='audio/mp4; codecs="'+e.audioCodec+'"'),e.hasVideo&&e.videoCodec&&(this._mimeCodec.video='video/mp4; codecs="'+e.videoCodec+'"'),this._hasAudio=this._hasAudio||e.hasAudio,this._hasVideo=this._hasVideo||e.hasVideo,this._checkSourceBuffer()},h.updateDuration=function(e){this._duration=e,this._updateDuration()},h._updateDuration=function(){if(null!==this._duration&&this.video&&this._mediaSource&&this._sourceBuffer&&0!==this.video.readyState&&"open"===this._mediaSource.readyState){for(var e in this._sourceBuffer)if(this._sourceBuffer[e]&&this._sourceBuffer[e].updating)return;var i=this.video.duration;if(null===this._mseDuration&&(this._mseDuration=this._mediaSource.duration),this._config.isLive)this._mseDuration=this._mediaSource.duration=1/0;else if(this._duration!==this._mseDuration&&this._duration!==i||!(0,t.isFiniteNumber)(i)){var r=!0;for(var n in this._sourceBuffer)r=r&&this.bufferedEndByType(n)<this._duration;r&&(this._mseDuration=this._mediaSource.duration=this._duration),this._duration=null}}},h._checkSourceBuffer=function(){var e=(this._hasAudio?1:0)+(this._hasVideo?1:0),t=(this._mimeCodec.audio?1:0)+(this._mimeCodec.video?1:0);if(r.Log.v(this.tag,"checkSourceBuffer",e,t,this._mimeCodec),this._mediaSource&&"open"===this._mediaSource.readyState&&e>0&&t>=e)for(var i in this._mimeCodec)this._mimeCodec[i]&&this._addSourceBuffer(i)},h._addSourceBuffer=function(e){var t=this;if(!this._sourceBuffer[e]&&!this._souceBufferLocked){try{this._mediaSource&&(this._sourceBuffer[e]=this._mediaSource.addSourceBuffer(this._mimeCodec[e]))}catch(e){return r.Log.e(this.tag,e),void this.emit(o.default.ERROR,{type:s.ErrorTypes.MSE_ERROR,details:s.ErrorDetails.ADDSOURCEBUFFER_ERROR,fatal:!0,reason:e.message})}var i=this._sourceBuffer[e];this._sbHandler[e]={updateend:function(){t._onSourceBufferUpdateEnd(e)},error:function(e){t._onSourceBufferError(e)}},i.addEventListener("error",this._sbHandler[e].error),i.addEventListener("updateend",this._sbHandler[e].updateend),this._duration&&this._mediaSource&&(this._mediaSource.duration=this._duration)}},h._hasPendingData=function(){return!(!this._appendQueue||!(this._appendQueue.video&&this._appendQueue.video.length||this._appendQueue.audio&&this._appendQueue.audio.length))},h.refresh=function(){for(var e in this._sourceBuffer)this._update(e)},h._doAppend=function(e){if(this._appendQueue[e]&&this._appendQueue[e].length>0){if(!this._appendEnabled)return void(this._getBufferQueueSize()>209715200&&!this._appendBufferError&&(this._appendBufferError=!0,this.emit(o.default.ERROR,{type:s.ErrorTypes.MSE_ERROR,details:s.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull"})));if(this._sourceBuffer[e]&&!this._sourceBuffer[e].updating&&!this._appendBufferError){var t=this._appendQueue[e].shift();this._appendBuffer(t,e)}}},h.mediaSegment=function(e){var t=e.type,i=this._appendQueue[t];this._souceBufferLocked&&!this._sourceBuffer[t]||i.push(e),this._sourceBuffer[t]&&(this._souceBufferLocked=!0,this._update(t))},h.bufferedByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?{start:t.buffered.start(0),end:t.buffered.end(t.buffered.length-1)}:{start:0,end:0}},h.bufferedEndByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?t.buffered.end(t.buffered.length-1):0},h.bufferSliceNumByType=function(e){var t=this._sourceBuffer[e];return t?t.buffered.length:0},h.pendingSecByType=function(e){var t=this._appendQueue[e];return t?t.reduce((function(e,t){return e+t.duration}),0):0},h.pendingNum=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].length;return e},h._calculateRemoveRange=function(e){var t=this.video;if(t&&!t.seeking){var i=t.currentTime;if(this._sourceBuffer[e]){var r=this._cleanUpTask[e],n=this._sourceBuffer[e].buffered;if(n.length>=1&&i-n.start(0)>=this._config.autoCleanupMaxBackwardDuration){var s=i-this._config.autoCleanupMinBackwardDuration;if(r.length&&0===r[r.length-1].start&&r[r.length-1].end===s)return;r.push({start:0,end:s})}}}},h._cleanUpRange=function(e,t){try{for(var i=0;i<e.buffered.length;i++){var r=e.buffered.start(i),n=e.buffered.end(i),s=Math.max(r,t.start),o=Math.min(n,t.end);if(o>s)return e.remove(s,o),this.emit("remove"),!(t.end>n&&i<e.buffered.length-1&&(t.start=Math.max(t.start,o),1));if(!(t.end>o))break;t.start=Math.max(t.start,o)}return!0}catch(t){return!(e&&e.updating)}},h._appendBuffer=function(e,t){if(this._sourceBuffer[t]&&this.video&&!this.video.error)try{this._sourceBuffer[t].appendBuffer(e.data.buffer)}catch(l){if(r.Log.w(this.tag,l.code,l),22!==l.code)this._appendError?this._appendError++:this._appendError=1,this._appendError>this._config.appendErrorMaxRetry?(this._appendBufferError=!0,this.emit(o.default.ERROR,{type:s.ErrorTypes.MSE_ERROR,details:s.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:l.message})):this._appendQueue[t].unshift(e);else{var i=this.video,n=this._config;this._appendEnabled=!1,this._appendQueue[t].unshift(e);var a=i.buffered.end(i.buffered.length-1)-i.currentTime;if(n.lazyLoadMaxDuration>30&&n.lazyLoad)n.lazyLoadMaxDuration=Math.max(n.lazyLoadMaxDuration/2,30),n.lazyLoadRecoverDuration=20;else{var u=i.currentTime-i.buffered.start(0);a<30?(u<n.autoCleanupMaxBackwardDuration&&(n.autoCleanupMaxBackwardDuration=Math.max(n.autoCleanupMaxBackwardDuration/2,20),n.autoCleanupMinBackwardDuration=10),this._calculateRemoveRange(t),this.hasCleanUpTask(t)&&this._cleanUp(t)):u<n.autoCleanupMinBackwardDuration&&this.emit(o.default.ERROR,{type:s.ErrorTypes.MSE_ERROR,details:s.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull-appendError"})}r.Log.i(this.tag,"mse bufferfull"),this.emit("bufferFull")}}},h.flush=function(e,t,i){var r=0,n=Number.POSITIVE_INFINITY;for(var s in this._endOfData=!1,this._sourceBuffer)if((!i||i===s)&&this._sourceBuffer[s]){if(e){r=Math.max(r,e);for(var o=this._appendQueue[s].length-1;o>=0&&(!this._appendQueue[s][o].startPTS||this._appendQueue[s][o].startPTS>=e);o--)this._appendQueue[s].pop()}else this._appendQueue[s]=[];t&&(n=Math.min(n,t)),this._cleanUpTask[s].push({start:r,end:n}),this._cleanUp(s)}this._appendEnabled=!0},h.setAppendEnabled=function(e){!this._appendEnabled&&e?(this._appendEnabled=e,this.refresh()):this._appendEnabled=e},h.getAppendEnabled=function(){return this._appendEnabled},h.endOfData=function(){this._endOfData=!0,this._hasPendingData()||this._endOfStream()},h.ended=function(){return this._endOfData},h._endOfStream=function(){var e=this._mediaSource;if(e&&"open"===e.readyState){for(var t in this._sourceBuffer){var i=this._sourceBuffer[t];if(i&&i.updating)return}try{e.endOfStream()}catch(e){r.Log.e(this.tag,e),this.emit(o.default.ERROR,{type:s.ErrorTypes.MSE_ERROR,details:s.ErrorDetails.ENDOFSTREAM_ERROR,fatal:!0,reason:e.message})}}},h.destroy=function(){if(this._mediaSource){var e=this._mediaSource;if(this._endOfStream(),"closed"!==e.readyState)for(var t in this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend),e.removeSourceBuffer(this._sourceBuffer[t]));e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceended",this._onSourceEnded),e.removeEventListener("sourceclose",this._onSourceClose),this._mediaSource=null}this.removeAllListeners(),this._appendQueue={},this._mimeCodec={},this._cleanUpTask={},this._sourceBuffer={},this._sbHandler={}},h.hasCleanUpTask=function(e){var t=0;if(void 0===e)for(var i in this._cleanUpTask)t+=this._cleanUpTask[i].length;else this._cleanUpTask[e]&&(t=this._cleanUpTask[e].length);return t>0},h.hasSourceBuffer=function(){return!!Object.keys(this._sourceBuffer).length},h._getBufferQueueSize=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].reduce((function(e,t){return t.data&&t.data.byteLength?e+t.data.byteLength:e}),0);return e},h.getBufferQueueSec=function(e){var t=this;return this._appendQueue?(e?[e]:Object.keys(this._appendQueue)).reduce((function(e,i){return t._appendQueue[i]&&t._appendQueue[i].length>0&&(0===Object.keys(t._sourceBuffer).length||t._sourceBuffer[i])?Math.max(e,t._appendQueue[i].reduce((function(e,t){return t.duration?e+t.duration:e}),0)):e}),0):0},h._update=function(e){this.hasCleanUpTask(e)&&this._cleanUp(e),this._doAppend(e)},h._cleanUp=function(e){for(var t=this._cleanUpTask[e];t&&t.length;){var i=t[0],r=this._sourceBuffer[e];if(r){if(r.updating||!this._cleanUpRange(r,i))return;t.shift()}else t.shift()}this.refresh()},d=l,(c=[{key:"readyState",get:function(){return this._mediaSource?this._mediaSource.readyState:"closed"}}])&&a(d.prototype,c),f&&a(d,f),l}(i.EventEmitter);e.default=l})?r.apply(t,n):r)||(e.exports=s)},"./src/core/observer.ts":
/*!******************************!*\
  !*** ./src/core/observer.ts ***!
  \******************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! events */"./node_modules/events/events.js")],void 0===(s="function"==typeof(r=function(e,t){e.__esModule=!0,e.default=void 0;var i=function(e){var t,i;function r(){return e.apply(this,arguments)||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r.prototype.trigger=function(t){for(var i,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return(i=e.prototype.emit).call.apply(i,[this,t,t].concat(n))},r}(t.EventEmitter);e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/core/report-types.ts":
/*!**********************************!*\
  !*** ./src/core/report-types.ts ***!
  \**********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.REPORT_TYPES=void 0,e.REPORT_TYPES={LOADER_CHUNK_ARRIVAL:"loader-chunk-arrival",MEDIA_DEMUX:"media-demux",NEW_SOURCE:"newSource",TIMEUPDATE:"timeupdate",LIVE_ADAPTIVE_QOS_STAT:"liveAdaptiveQosStat",KEY_FRAME:"keyFrame",DISCONTINUITY:"discontinuity",DOWNLOAD:"download",SEEK:"seek",SEEK_WITH_LOAD:"seekWithLoad",HEARTBEAT:"heartbeat",MUX_INFO:"muxInfo",LOST_FRAMES:"lostFrames",HLS_VOD_ADAPTIVE_QOS_STAT:"hlsVodAdaptiveQosStat",USE_BACKUP:"useBackup",ABR_INIT:"abrInit",ABR_LOW_PROFILE:"abrLowProfile"}})?r.apply(t,n):r)||(e.exports=s)},"./src/core/trans-flv.ts":
/*!*******************************!*\
  !*** ./src/core/trans-flv.ts ***!
  \*******************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),i(/*! ../abr/flv-abr-get-url */"./src/abr/flv-abr-get-url.ts"),i(/*! ../abr/flv-abr-manifest */"./src/abr/flv-abr-manifest.ts"),i(/*! ../abr/flv-multirate */"./src/abr/flv-multirate.ts"),i(/*! ../demux/flv/flv-demuxer-inline */"./src/demux/flv/flv-demuxer-inline.ts"),i(/*! ../demux/flv/flv-tag-dump */"./src/demux/flv/flv-tag-dump.ts"),i(/*! ../io/loader */"./src/io/loader.ts"),i(/*! ../io/multipart-loader */"./src/io/multipart-loader.ts"),i(/*! ../monitor/live-delay */"./src/monitor/live-delay.ts"),i(/*! ../types/core */"./src/types/core.ts"),i(/*! ../utils/log */"./src/utils/log.ts"),i(/*! ./kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ./kernel-events */"./src/core/kernel-events.ts"),i(/*! ./observer */"./src/core/observer.ts"),i(/*! ./report-types */"./src/core/report-types.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u,l,d,c,f,h,_,p,v){function m(e){return e&&e.__esModule?e:{default:e}}function g(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}e.__esModule=!0,e.default=void 0,i=m(i),s=m(s),o=m(o),a=m(a),u=m(u),l=m(l),d=m(d),_=m(_);var b=function(e){var m,b;function E(r,s){var u;(u=e.call(this)||this)._config=void 0,u._media=void 0,u._w=void 0,u._flv=void 0,u._observer=void 0,u._protocol=c.Protocol.FLV,u._loader=null,u._loaderConf=void 0,u._loaderCallbacks=void 0,u._multirate=void 0,u._contiguous=void 0,u._remuxId=void 0,u._lastDTS=0,u._discontinuity=!1,u._accurateTimeOffset=!1,u._baseTimeSec=0,u._progressTime=0,u._tagDump=void 0,u._currentUrl=void 0,u._ready=!1,u._onKeyframe=function(e){if(u._multirate){var i=u._multirate.onKeyFrame(e);if(i){u._tagDump&&u._tagDump.reset();var r=(0,t.ObjectAssign)({},i);return u._baseTimeSec=u._lastDTS,r.startSec=u._baseTimeSec,r.smooth=!0,u.emit(_.default.LEVEL_SWITCHING,r),r}}u.emit(_.default.REPORT,{type:v.REPORT_TYPES.KEY_FRAME})},u._onMessage=function(e,t){switch(e){case _.default.FLV_HEAD:u._protocol===c.Protocol.KWAI_FLV&&(t.hasAudio=u._config.manifest.hasAudio,t.hasVideo=u._config.manifest.hasVideo),u._w?u._w.postMessage({cmd:"flvHead",hasAudio:t.hasAudio,hasVideo:t.hasVideo}):u._flv&&u._flv.flvHead(t.hasAudio,t.hasVideo);break;case _.default.PARSING_INIT_SEGMENT:u.emit(_.default.PARSING_INIT_SEGMENT,t);break;case _.default.PARSING_DATA:if(t.extra&&t.extra.remuxId!==u._remuxId)break;u._lastDTS=t.endDTS,u.emit(_.default.PARSING_DATA,{data:t.payload,type:t.type,startDTS:t.startDTS||0,endDTS:t.endDTS||0,startPTS:t.startPTS||0,endPTS:t.endPTS||0,streamDTS:t.streamDTS||0,duration:t.endDTS-t.startDTS,framesInfo:t.framesInfo});break;case _.default.REPORT:t.type===v.REPORT_TYPES.HLS_VOD_ADAPTIVE_QOS_STAT&&(t.play_url=u._currentUrl),u.emit(e,t);break;case _.default.DISCONTINUITY:u._w?u._w.postMessage({cmd:"flush"}):u._flv&&u._flv.flush(),u._tagDump.reset(),u._discontinuity=!0,u._accurateTimeOffset=!1,u._contiguous=!1,u._baseTimeSec=t,u._observer&&u._observer.trigger(_.default.REPORT,{type:v.REPORT_TYPES.DISCONTINUITY,time:t});break;default:u.emit(e,t)}},u._config=r,u._media=s,r.manifest&&(n.FlvAbrManifest.verify(r.manifest)?u._protocol=c.Protocol.ABR_FLV:u._protocol=c.Protocol.KWAI_FLV),u._loaderConf={connectionTimeout:u._config.connectionTimeout,transmissionTimeout:u._config.transmissionTimeout,maxRetry:u._config.isLive?0:u._config.maxRetry,retryDelay:u._config.isLive?0:u._config.retryDelay,useFetch:u._config.isLive},u._loaderCallbacks={onProgress:u._onProgress.bind(y(u)),onError:u._onLoaderError.bind(y(u)),onEnd:u._onLoaderEnd.bind(y(u)),onAbort:u._onAbort.bind(y(u))},u._contiguous=!1,u._remuxId=1;var l=u._observer=new p.default,h=u._onMessage;return l.on(_.default.METADATA,h),l.on(_.default.PARSING_INIT_SEGMENT,h),l.on(_.default.PARSING_DATA,h),l.on(_.default.ERROR,h),l.on(_.default.SCRIPT_PARSED,h),l.on(_.default.REPORT,h),l.on(_.default.PRIV_NAL,h),l.on(_.default.INPUT_DATA_CONTAINS_I,h),l.on(_.default.LOAD_END,h),l.on(_.default.DISCONTINUITY,h),l.on(_.default.LEVEL_UPDATED,h),l.on(_.default.SEEK_KEYFRAME,h),l.on(_.default.FLV_HEAD,h),u._tagDump=new a.default(l,u._onKeyframe),u._config.webWorker&&(f.Log.i("TransFLV","webWorker"),u._onWorkMessage=u._onWorkMessage.bind(y(u)),u._w=(0,i.default)(/*! ../demux/flv/flv-demuxer-worker */"./src/demux/flv/flv-demuxer-worker.ts"),u._w)?(d.default.workerTimeOffset=performance.now(),u._w.addEventListener("message",u._onWorkMessage),u._w.postMessage({cmd:"init",config:u._config,data:{remuxId:u._remuxId},vendor:navigator.vendor}),y(u)):(u._flv=new o.default(l,u._config,{remuxId:u._remuxId},navigator.vendor),u._flv.init(),u)}b=e,(m=E).prototype=Object.create(b.prototype),m.prototype.constructor=m,m.__proto__=b;var T,S,w,R=E.prototype;return R.init=function(){this._protocol!==c.Protocol.ABR_FLV||this._multirate||(this._multirate=new s.default(this._config,this._media),this._multirate.on(_.default.REPORT,this._onMessage),this._multirate.on(_.default.MANIFEST_PARSED,this._onMessage),this._multirate.on(_.default.ADAPTIVE_ALGORITHM,this._onMessage),this._multirate.init()),this._ready=!0},R._onWorkMessage=function(e){var t=e.data;e.data.event===_.default.PARSING_DATA&&(t.data.payload=t.payload),this._onMessage(e.data.event,t.data)},R.loadSource=function(){var e=this._multirate;if(e){var t=e.levels[e.currentLevel];t?this._load((0,r.flvAbrGetUrl)(t.url,this._config.defaultSpts),e.currentLevel):this.emit(_.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"manifest parse error"})}else this._load(this._config.src)},R.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._loader instanceof l.default&&this._loader.setDownloadEnabled(e)},R.isSeekable=function(){return this._protocol===c.Protocol.KWAI_FLV},R.seek=function(e,t){this.isSeekable()?(this._loader instanceof l.default&&(this._refreshRemuxId(),this._baseTimeSec=this._loader.seek(e,t),this._accurateTimeOffset=!1,this._discontinuity=!0,this._contiguous=!1),this._tagDump&&this._tagDump.reset()):this.emit(_.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.CANNOT_SEEK,fatal:!0,reason:"can not seek"})},R.heartbeat=function(){this._multirate&&this._multirate.heartbeat()},R.destroy=function(){this._loader&&(this._loader.destroy(),this._loader=null),this._w&&(this._w.postMessage({cmd:"destroy"}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate()),this._flv&&(this._flv.destroy(),this._flv=void 0),this._multirate&&(this._multirate.removeAllListeners(),this._multirate.destory());var e=this._observer;e&&e.removeAllListeners()},R.getCurrentUrl=function(){var e=this._config.src;return this._protocol===c.Protocol.ABR_FLV?e=this._currentUrl:this._protocol===c.Protocol.KWAI_FLV&&(e=this._loader.getCurrentUrl(0)),e},R.setAvailableAbrLevels=function(e){},R.streamingMux=function(e){},R._load=function(e,t){void 0===t&&(t=0),this._loader&&(this._loader.destroy(),this._loader=null),this._multirate&&this._multirate.onLevelLoad(t),this._currentUrl=e;var i=this.levels[t];if(this._observer.trigger(_.default.REPORT,{type:v.REPORT_TYPES.NEW_SOURCE,url:e,sync:this._baseTimeSec,index:t,bitrate:i?i.bitrate:0,qualityType:i?i.qualityType:void 0}),this._protocol===c.Protocol.KWAI_FLV)this._loader||(this._loader=new l.default(this._observer,this._config)),this._baseTimeSec=this._loader.load(this._config.manifest,this._loaderCallbacks,this._loaderConf)||0;else{this._loader||(this._loader=new u.default);var r={url:e,progress:!0,responseType:"arraybuffer",credentials:this._config.credentials};this._loader instanceof u.default&&this._loader.load(r,this._loaderCallbacks,this._loaderConf)}},R._append=function(e,t,i,r,n){this._w?this._w.postMessage({cmd:"append",tags:e,timeOffset:t||0,discontinuity:i,contiguous:r,accurateTimeOffset:n}):this._flv&&this._flv.append(e,t||0,i,r,n)},R._onProgress=function(e,t,i){if(t instanceof ArrayBuffer){this._multirate&&this._multirate.onLoaderChunk(t.byteLength),this._observer&&this._observer.trigger(_.default.REPORT,{type:v.REPORT_TYPES.LOADER_CHUNK_ARRIVAL,byteLength:t.byteLength,timeCost:performance.now()-this._progressTime||i.trequest,header:e.responseHeader}),this._progressTime=performance.now();var r=this._tagDump.append(t);r.list.length&&(this._append(r.list,this._baseTimeSec,this._discontinuity,this._contiguous,this._accurateTimeOffset),this._accurateTimeOffset=!0,this._contiguous=!0,this._discontinuity=!1,r.abr&&this._load(r.abr.url,r.abr.level))}},R._onAbort=function(){},R._onLoaderError=function(e,t){if(t.fatal){var i={type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url};this.emit(_.default.ERROR,i)}},R._onLoaderEnd=function(){this._w?this._w.postMessage({cmd:"end"}):this._flv&&this._flv.end()},R._refreshRemuxId=function(){this._remuxId++;var e={remuxId:this._remuxId};this._w?this._w.postMessage({cmd:"setExtra",data:e}):this._flv&&this._flv.setExtra(e)},T=E,(S=[{key:"protocol",get:function(){return this._protocol}},{key:"isNetworkInUse",get:function(){return!0}},{key:"autoLevelEnabled",get:function(){return!!this._multirate&&this._multirate.autoLevelEnabled}},{key:"levels",get:function(){var e=[];return this._multirate&&this._multirate.levels.forEach((function(t){e.push({bitrate:t.bitrate,qualityType:t.qualityType})})),e}},{key:"nextLevel",get:function(){return this._multirate?this._multirate.nextLevel:0},set:function(e){this._ready||(this.currentLevel=e);var t=this._multirate;t&&(-1===e&&this.emit(_.default.LEVEL_SWITCHING,{level:-1,startSec:this._media.currentTime,smooth:!0,auto:!0}),t.nextLevel=e)}},{key:"currentLevel",get:function(){return this._multirate?this._multirate.currentLevel:0},set:function(e){var t=this._multirate;if(t){var i=e>=0||e!==t.currentLevel;t.currentLevel=e;var n=t.levels[t.currentLevel];i&&n&&this._ready&&(this._currentUrl=(0,r.flvAbrGetUrl)(n.url,this._config.defaultSpts),this._refreshRemuxId(),this._contiguous=!1,this._discontinuity=!0,this._accurateTimeOffset=!1,this._tagDump&&this._tagDump.reset(),this._baseTimeSec=this._media.currentTime,this.emit(_.default.LEVEL_SWITCHING,{level:t.currentLevel,startSec:this._baseTimeSec,smooth:!1,auto:!1}),this._load(this._currentUrl,t.currentLevel))}}}])&&g(T.prototype,S),w&&g(T,w),E}((p=m(p)).default);e.default=b})?r.apply(t,n):r)||(e.exports=s)},"./src/core/trans-hls.ts":
/*!*******************************!*\
  !*** ./src/core/trans-hls.ts ***!
  \*******************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../demux/hls/hls */"./src/demux/hls/hls.ts"),i(/*! ./kernel-events */"./src/core/kernel-events.ts"),i(/*! ./observer */"./src/core/observer.ts"),i(/*! ./report-types */"./src/core/report-types.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n){function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,t=s(t),i=s(i);var a=function(e){var s,a;function u(s,o,a){var u;return void 0===a&&(a=!1),(u=e.call(this)||this)._config=void 0,u._observer=void 0,u._hls=void 0,u._onMessage=function(e,t){switch(e){case i.default.REPORT:u.emit(i.default.REPORT,t);break;case i.default.PARSING_INIT_SEGMENT:u._hls.current&&(t.manifestAudioCodec=u._hls.current.audioCodec,t.manifestVideoCodec=u._hls.current.videoCodec),u.emit(i.default.PARSING_INIT_SEGMENT,t);break;case i.default.PARSING_DATA:u.emit(i.default.PARSING_DATA,{data:t.payload,type:t.type,startDTS:t.startDTS||0,endDTS:t.endDTS||0,startPTS:t.startPTS||0,endPTS:t.endPTS||0,duration:t.endDTS-t.startDTS});break;case i.default.ERROR:u._config.retryWithBackup&&u._hls.nextBackup()?u.emit(i.default.REPORT,{type:n.REPORT_TYPES.USE_BACKUP}):u.emit(e,t);break;default:u.emit(e,t)}},u._config=s,u._observer=new r.default,u._hls=new t.default(u._observer,u._config,o,a),u}a=e,(s=u).prototype=Object.create(a.prototype),s.prototype.constructor=s,s.__proto__=a;var l,d,c,f=u.prototype;return f.init=function(){var e=this;this._bindObserver(this._observer),this._hls.init(),this.on("mainNotify",(function(t){e._observer.emit("mainNotify",t)}))},f.destroy=function(){var e=this._hls;e&&e.destroy();var t=this._observer;t&&t.removeAllListeners()},f.loadSource=function(){this._hls.loadSource()},f.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._hls.setDownloadEnabled(e)},f.seek=function(e,t,i){void 0===i&&(i=!1),this._hls.seek(e,t,i)},f.heartbeat=function(){},f.getCurrentUrl=function(){var e=this._hls.current;return e?e.url[e.urlId]:""},f.isSeekable=function(){return!this._config.isLive},f.setAvailableAbrLevels=function(e){this._hls.setAvailableAbrLevels(e)},f.streamingMux=function(e){this._hls.streamingMux(e)},f.usePreload=function(){this._hls.usePreload()},f._bindObserver=function(e){var t=this._onMessage;e.on(i.default.PARSING_INIT_SEGMENT,t),e.on(i.default.PARSING_DATA,t),e.on(i.default.ERROR,t),e.on(i.default.LEVEL_UPDATED,t),e.on(i.default.LEVEL_SWITCH_FAILED,t),e.on(i.default.LEVEL_SWITCHING,t),e.on(i.default.MANIFEST_PARSED,t),e.on(i.default.REPORT,t),e.on(i.default.LOAD_END,t),e.on(i.default.BUFFER_FLUSHING,t),e.on(i.default.SEEK_KEYFRAME,t),e.on(i.default.PRELOAD_COMPLETE,t)},l=u,(d=[{key:"levels",get:function(){return this._hls.levels}},{key:"autoLevelEnabled",get:function(){return this._hls.autoLevelEnabled}},{key:"nextLevel",get:function(){return this._hls.nextLevel},set:function(e){this._hls.manualNextLevel=e}},{key:"currentLevel",get:function(){return this._hls.currentLevel},set:function(e){this._hls.currentLevel=e}},{key:"protocol",get:function(){return this._hls.protocol}},{key:"isNetworkInUse",get:function(){return this._hls.isNetworkInUse}}])&&o(l.prototype,d),c&&o(l,c),u}((r=s(r)).default);e.default=a})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/adts.ts":
/*!***************************!*\
  !*** ./src/demux/adts.ts ***!
  \***************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../utils/log */"./src/utils/log.ts"),i(/*! ./get-audio-config */"./src/demux/get-audio-config.ts")],void 0===(s="function"==typeof(r=function(e,t,i){function r(e,t){return{objectType:1+((192&e[t+2])>>>6),sampleingIndex:(60&e[t+2])>>>2,chanelConfig:(1&e[t+2])<<2|(192&e[t+3])>>>6}}function n(e,t){return 255===e[t]&&240==(246&e[t+1])}function s(e,t){return 1&e[t+1]?7:9}function o(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function a(e){return 9216e4/e}function u(e,t,i,r,n){var a,u=e.length,l=s(e,t);return a=o(e,t),(a-=l)>0&&t+l+a<=u?{headerLength:l,frameLength:a,stamp:i+r*n}:null}e.__esModule=!0,e.parseData=r,e.isHeaderPattern=n,e.getHeaderLength=s,e.getFullFrameLength=o,e.isHeader=function(e,t){return!!(t+1<e.length&&n(e,t))},e.probe=function(e,t){if(t+1<e.length&&n(e,t)){var i=s(e,t);t+5<e.length&&(i=o(e,t));var r=t+i;if(r===e.length||r+1<e.length&&n(e,r))return!0}return!1},e.initTrackConfig=function(e,n,s,o,a){if(!e.samplerate){var u=(0,i.getAudioConfig)(n,r(s,o),a);u&&(e.config=u.config,e.samplerate=u.samplerate,e.channelCount=u.channelCount,e.codec=u.codec,e.manifestCodec=u.manifestCodec,t.Log.v("parsed codec:"+e.codec+",rate:"+u.samplerate+",nb channel:"+u.channelCount))}},e.getFrameDuration=a,e.parseFrameHeader=u,e.appendFrame=function(e,t,i,r,n){var s=u(t,i,r,n,a(e.samplerate));if(s){var o=s.stamp,l=s.headerLength,d=s.frameLength,c={unit:t.subarray(i+l,i+l+d),pts:o,dts:o};return e.samples.push(c),{sample:c,length:d+l}}return null}})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/asc.ts":
/*!**************************!*\
  !*** ./src/demux/asc.ts ***!
  \**************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./get-audio-config */"./src/demux/get-audio-config.ts")],void 0===(s="function"==typeof(r=function(e,t){function i(e,t){return{objectType:e[t+2]>>>3,sampleingIndex:(7&e[t+2])<<1|e[t+3]>>>7,chanelConfig:(120&e[t+3])>>>3}}e.__esModule=!0,e.parseData=i,e.initTrackConfig=function(e,r,n,s,o){if(void 0===o&&(o=""),!e.samplerate){var a=(0,t.getAudioConfig)(r,i(n,s),o);a&&(e.config=a.config,e.timescale=e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,e.isAAC=!0)}},e.getFrameDuration=function(e){return 1024e3/e}})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/exp-golomb.ts":
/*!*********************************!*\
  !*** ./src/demux/exp-golomb.ts ***!
  \*********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0;var i=function(){function e(e){this._buffer=void 0,this._buffer_index=void 0,this._total_bytes=void 0,this._total_bits=void 0,this._current_word=void 0,this._current_word_bits_left=void 0,this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}var i,r,n,s=e.prototype;return s.destroy=function(){this._buffer=null},s._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0||!this._buffer)throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},s.readBits=function(e){if(e>32)throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(r,this._current_word_bits_left),s=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,i=i<<n|s},s.readBool=function(){return 1===this.readBits(1)},s.readUByte=function(){return this.readBits(8)},s.readUShort=function(){return this.readBits(16)},s.readUInt=function(){return this.readBits(32)},s.readByte=function(){return this.readBits(8)},s._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},s.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},s.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},s.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},s.getBitsLeft=function(){return 8*(this._total_bytes-this._buffer_index)+this._current_word_bits_left},i=e,(r=[{key:"bytesAvailable",get:function(){return this._total_bytes-this._buffer_index}}])&&t(i.prototype,r),n&&t(i,n),e}();e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/flv/amf.ts":
/*!******************************!*\
  !*** ./src/demux/flv/amf.ts ***!
  \******************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../utils/decodeUTF8 */"./src/utils/decodeUTF8.ts"),i(/*! ../../utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i){var r;e.__esModule=!0,e.default=void 0,t=(r=t)&&r.__esModule?r:{default:r};var n=function(){function e(){}return e.parseMetadata=function(t){var r={};try{var n=e.parseScript(t,0),s=e.parseScript(t,n.size);r[n.data]=s.data}catch(e){i.Log.e("AMF",e.toString())}return r},e.parseObject=function(t,i){var r=e.parseString(t,i),n=e.parseScript(t,i+r.size),s=n.objectEnd;return{data:{name:r.data,value:n.data},size:n.size,objectEnd:s}},e.parseVariable=function(t,i){return e.parseObject(t,i)},e.parseLongString=function(e,i){var r=new DataView(e,i).getUint32(0);return{data:r>0?(0,t.default)(new Uint8Array(e,i+4,r)):"",size:4+r}},e.parseDate=function(e,t){var i=new DataView(e,t),r=i.getFloat64(0),n=i.getInt16(8);return{data:new Date(r+=60*n*1e3),size:10}},e.parseString=function(e,i){var r=new DataView(e,i).getUint16(0);return{data:r>0?(0,t.default)(new Uint8Array(e,i+2,r)):"",size:2+r}},e.parseScript=function(t,r){var n=t.byteLength,s=r,o=t,a=new DataView(o,0),u=null,l=a.getUint8(s);s+=1;var d=!1;switch(l){case 0:u=a.getFloat64(s),s+=8;break;case 1:u=!!a.getUint8(s),s+=1;break;case 2:var c=e.parseString(o,s);u=c.data,s+=c.size;break;case 3:for(u={},a.getUint32(n-4);s<n-4;){var f=e.parseObject(o,s);if(f.objectEnd)break;u[f.data.name]=f.data.value,s=f.size}s<=n-3&&9==(16777215&a.getUint32(s-1))&&(s+=3);break;case 8:for(u={},s+=4,a.getUint32(n-4);s<n-8;){var h=e.parseVariable(o,s);if(h.objectEnd)break;u[h.data.name]=h.data.value,s=h.size}s<=n-3&&9==(16777215&a.getUint32(s-1))&&(s+=3);break;case 9:u=void 0,s=1,d=!0;break;case 10:u=[];var _=a.getUint32(s);s+=4;for(var p=0;p<_;p++){var v=e.parseScript(o,s);u.push(v.data),s=v.size}break;case 11:var m=e.parseDate(o,s+1);u=m.data,s+=m.size;break;case 12:var g=e.parseString(o,s+1);u=g.data,s+=g.size;break;default:s=n,i.Log.v("AMF","AMF","Unsupported AMF value type "+l)}return{data:u,size:s,objectEnd:d}},e}();e.default=n})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/flv/avc-helper.ts":
/*!*************************************!*\
  !*** ./src/demux/flv/avc-helper.ts ***!
  \*************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./flv */"./src/demux/flv/flv.ts")],void 0===(s="function"==typeof(r=function(e,t){e.__esModule=!0,e.default=void 0;var i=new Uint8Array([23,0,0,0,0,1,100,0,10,255,225,0,24,103,100,0,10,172,114,4,68,122,16,0,0,3,0,16,0,0,3,3,32,241,34,88,70,1,0,6,104,232,67,143,44,139]),r=new Uint8Array([23,1,0,0,0,0,0,2,176,6,5,255,255,172,220,69,233,189,230,217,72,183,150,44,216,32,217,35,238,239,120,50,54,52,32,45,32,99,111,114,101,32,49,53,50,32,114,50,56,53,52,32,101,57,97,53,57,48,51,32,45,32,72,46,50,54,52,47,77,80,69,71,45,52,32,65,86,67,32,99,111,100,101,99,32,45,32,67,111,112,121,108,101,102,116,32,50,48,48,51,45,50,48,49,55,32,45,32,104,116,116,112,58,47,47,119,119,119,46,118,105,100,101,111,108,97,110,46,111,114,103,47,120,50,54,52,46,104,116,109,108,32,45,32,111,112,116,105,111,110,115,58,32,99,97,98,97,99,61,49,32,114,101,102,61,49,54,32,100,101,98,108,111,99,107,61,49,58,48,58,48,32,97,110,97,108,121,115,101,61,48,120,51,58,48,120,49,51,51,32,109,101,61,117,109,104,32,115,117,98,109,101,61,49,48,32,112,115,121,61,49,32,112,115,121,95,114,100,61,49,46,48,48,58,48,46,48,48,32,109,105,120,101,100,95,114,101,102,61,49,32,109,101,95,114,97,110,103,101,61,50,52,32,99,104,114,111,109,97,95,109,101,61,49,32,116,114,101,108,108,105,115,61,50,32,56,120,56,100,99,116,61,49,32,99,113,109,61,48,32,100,101,97,100,122,111,110,101,61,50,49,44,49,49,32,102,97,115,116,95,112,115,107,105,112,61,49,32,99,104,114,111,109,97,95,113,112,95,111,102,102,115,101,116,61,45,50,32,116,104,114,101,97,100,115,61,49,32,108,111,111,107,97,104,101,97,100,95,116,104,114,101,97,100,115,61,49,32,115,108,105,99,101,100,95,116,104,114,101,97,100,115,61,48,32,110,114,61,48,32,100,101,99,105,109,97,116,101,61,49,32,105,110,116,101,114,108,97,99,101,100,61,48,32,98,108,117,114,97,121,95,99,111,109,112,97,116,61,48,32,99,111,110,115,116,114,97,105,110,101,100,95,105,110,116,114,97,61,48,32,98,102,114,97,109,101,115,61,56,32,98,95,112,121,114,97,109,105,100,61,50,32,98,95,97,100,97,112,116,61,50,32,98,95,98,105,97,115,61,48,32,100,105,114,101,99,116,61,51,32,119,101,105,103,104,116,98,61,49,32,111,112,101,110,95,103,111,112,61,48,32,119,101,105,103,104,116,112,61,50,32,107,101,121,105,110,116,61,50,53,48,32,107,101,121,105,110,116,95,109,105,110,61,50,53,32,115,99,101,110,101,99,117,116,61,52,48,32,105,110,116,114,97,95,114,101,102,114,101,115,104,61,48,32,114,99,95,108,111,111,107,97,104,101,97,100,61,54,48,32,114,99,61,99,114,102,32,109,98,116,114,101,101,61,49,32,99,114,102,61,50,51,46,48,32,113,99,111,109,112,61,48,46,54,48,32,113,112,109,105,110,61,48,32,113,112,109,97,120,61,54,57,32,113,112,115,116,101,112,61,52,32,105,112,95,114,97,116,105,111,61,49,46,52,48,32,97,113,61,49,58,49,46,48,48,0,128,0,0,0,29,101,136,129,0,5,127,254,246,115,124,10,107,109,176,149,46,5,118,246,150,55,45,60,239,89,160,124,49,129]),n=function(){function e(){}return e.getFlvVideoTag=function(e,n){void 0===n&&(n=!1);var s=new t.FlvTag;return s.tagType=t.FlvTagType.VIDEO,s.body=n?i:r,s.dataSize=s.body.byteLength,s.timestamp=Math.round(e),s.frameType=1,s.codecId=7,s.fill=!0,s},e}();e.default=n})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/flv/flv-demuxer-inline.ts":
/*!*********************************************!*\
  !*** ./src/demux/flv/flv-demuxer-inline.ts ***!
  \*********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),i(/*! ./flv-demuxer */"./src/demux/flv/flv-demuxer.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r){function n(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,t=n(t),i=n(i),r=n(r);var s=function(){function e(e,t,i,r){this.tag="FlvDemuxerInline",this._observer=void 0,this._config=void 0,this._extraData=void 0,this._demuxer=void 0,this._remuxer=void 0,this._bitrate=void 0,this._vendor=void 0,this._observer=e,this._config=t,this._bitrate=this._config.bitrate,this._extraData=i,this._vendor=r}var n=e.prototype;return n.init=function(){var e=this._config,t=this._observer,n=this._remuxer=new i.default(t,e,{mp4:!0,mpeg:!1,mp3:!1});this._demuxer=new r.default(t,n,e),n.setExtra(this._extraData)},n.flvHead=function(e,t){this._demuxer.flvHead(e,t)},n.append=function(e,t,i,r,n){i&&(this._demuxer.resetInitSegment(),this._remuxer.resetInitSegment(),this._demuxer.resetTimeStamp(),this._remuxer.resetTimeStamp()),this._demuxer.append(e,t,r,n)},n.end=function(){this._demuxer.flush(),this._remuxer.flush(),this._observer.trigger(t.default.LOAD_END)},n.flush=function(){this._demuxer&&this._demuxer.flush()},n.setExtra=function(e){this._extraData=e,this._extraData.bitrate=this._bitrate,this._remuxer&&this._remuxer.setExtra(this._extraData)},n.destroy=function(){},e}();e.default=s})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/flv/flv-demuxer-worker.ts":
/*!*********************************************!*\
  !*** ./src/demux/flv/flv-demuxer-worker.ts ***!
  \*********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../core/observer */"./src/core/observer.ts"),i(/*! ../../utils/log */"./src/utils/log.ts"),i(/*! ./flv-demuxer-inline */"./src/demux/flv/flv-demuxer-inline.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n){function s(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=function(e){var s,o=new i.default,a=function(t,i){e.postMessage({event:t,data:i})};o.on(t.default.METADATA,a),o.on(t.default.PARSING_INIT_SEGMENT,a),o.on(t.default.ERROR,a),o.on(t.default.SCRIPT_PARSED,a),o.on(t.default.REPORT,a),o.on(t.default.PRIV_NAL,a),o.on(t.default.INPUT_DATA_CONTAINS_I,a),o.on(t.default.LOAD_END,a),o.on(t.default.PARSING_DATA,(function(t,i){var r={event:t,data:i};r.payload=i.payload,delete i.payload,e.postMessage(r,[r.payload.buffer])})),e.addEventListener("message",(function(e){var t=e.data;switch(t.cmd){case"init":r.Log.level(t.config.kwaiKernelLog),function(e,t,i,r){(s=new n.default(e,t,i,r)).init()}(o,t.config,t.data,t.vendor);break;case"destroy":s&&s.destroy(),o&&o.removeAllListeners();break;case"append":s.append(t.tags,t.timeOffset,t.discontinuity,t.contiguous,t.accurateTimeOffset);break;case"flvHead":s.flvHead(t.hasAudio,t.hasVideo);break;case"flush":s.flush();break;case"setExtra":s.setExtra(t.data);break;case"end":s.end()}}))},t=s(t),i=s(i),n=s(n)})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/flv/flv-demuxer.ts":
/*!**************************************!*\
  !*** ./src/demux/flv/flv-demuxer.ts ***!
  \**************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../core/report-types */"./src/core/report-types.ts"),i(/*! ../../types/remux */"./src/types/remux.ts"),i(/*! ../../utils/kwai-priv-nal */"./src/utils/kwai-priv-nal.ts"),i(/*! ../../utils/log */"./src/utils/log.ts"),i(/*! ../asc */"./src/demux/asc.ts"),i(/*! ../sps-parser */"./src/demux/sps-parser.ts"),i(/*! ./amf */"./src/demux/flv/amf.ts"),i(/*! ./avc-helper */"./src/demux/flv/avc-helper.ts"),i(/*! ./flv */"./src/demux/flv/flv.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u,l,d,c){function f(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return f=function(){return e},e}function h(e){return e&&e.__esModule?e:{default:e}}function _(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,i=h(i),s=h(s),a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=f();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(a),u=h(u),l=h(l),d=h(d);var p=function(){function e(e,t,i){this.tag="FlvDemux",this._observer=void 0,this._remuxer=void 0,this._config=void 0,this._duration=void 0,this._naluLengthSize=void 0,this._hasVideo=void 0,this._hasAudio=void 0,this._videoTrack=void 0,this._audioTrack=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._currentTimestamp=0,this._aLastDTS=0,this._vLastDTS=0,this._nonMonotonousCache=void 0,this._fillAtStart={enabled:!0,start:0,avcConfig:!0},this._observer=e,this._remuxer=t,this._config=i,this._duration=1/0,this._naluLengthSize=4,this._hasVideo=!0,this._hasAudio=!0,this._videoTrack={id:1,type:n.TrackType.video,container:"",codec:"",timescale:9e4,duration:1/0,samples:[],inputTimeScale:9e4,sequenceNumber:0,pid:-1,width:0,height:0,codecWidth:0,codecHeight:0,sps:[],pps:[],pixelRatio:[],profile:"",level:"",chromaFormat:"",fps:0,dropped:0,refSampleDuration:0,hvcc:null},this._audioTrack={id:2,type:n.TrackType.audio,container:"",codec:"",timescale:9e4,duration:1/0,samples:[],inputTimeScale:9e4,sequenceNumber:0,pid:-1,isAAC:!0,samplerate:0,channelCount:0,config:[]}}var f,h,p,v=e.prototype;return v.append=function(e,t,i,r){var n=this;if(this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:r}),e.length){if(e.forEach((function(e){e.tagType===c.FlvTagType.VIDEO&&n._hasVideo&&(n._fillAtStart.enabled&&(n._fillAtStart.enabled=!1,n._audioTrack.samples.length&&n._fillFrame(n._audioTrack.samples[n._audioTrack.samples.length-1].dts/90)),n._parseVideoData(e)),e.tagType===c.FlvTagType.AUDIO&&n._hasAudio&&n._parseAudioData(e),e.tagType===c.FlvTagType.SCRIPT&&n._parseScriptTag(e)})),this._fillAtStart.enabled&&this._audioTrack.samples.length){var s=this._audioTrack.samples[0].dts/90,o=this._audioTrack.samples[this._audioTrack.samples.length-1].dts/90;this._fillAtStart.start<=0&&(this._fillAtStart.start=s),o>this._fillAtStart.start&&this._fillFrame(o)}this._remux()}},v.flvHead=function(e,t){this._hasAudio=e,this._hasVideo=t,this._fillAtStart.enabled=this._hasVideo},v.destroy=function(){},v.flush=function(){this._remux(!0),this._remuxStat=void 0},v.resetInitSegment=function(){this._firstRemux=!0,this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=0,this._remuxStat=void 0},v.resetTimeStamp=function(){},v._parseScriptTag=function(e){if(e.body){var t=l.default.parseMetadata(e.body.buffer);if(t.timestamp=this._currentTimestamp||0,t.hasOwnProperty("onMetaData")){var r=t.onMetaData;"number"==typeof r.duration&&(this._duration=this._duration||r.duration),"number"==typeof r.framerate&&(this._videoTrack.fps=this._videoTrack.fps||r.framerate),o.Log.i(this.tag,"Parsed onMetaData")}this._observer.trigger(i.default.SCRIPT_PARSED,t)}},v._parseVideoData=function(e){if(e.body){var r=e.body[0];e.frameType=(240&r)>>>4;var n=15&r;if(7===n||12===n){e.codecId=n;var s=e.body[1];if(e.cts=((255&e.body[2])<<16)+((255&e.body[3])<<8)+(255&e.body[4]),0===s)7===n?this._parseAVCDecoderConfigurationRecord(e,5):12===n&&(this._config.gopRemux=!0,this._parseHEVCDecoderConfigurationRecord(e,5));else if(1===s){var o=this._parseAVCVideoData(e,5)||{};1===e.frameType&&(o.timestamp=e.timestamp,o.ptsOrignMs=e.timestamp+e.cts,this._observer.trigger(i.default.PRIV_NAL,o))}else if(2!==s)return void this._observer.trigger(i.default.ERROR,{type:t.ErrorTypes.MUX_ERROR,details:t.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid video packet type "+s})}else this._observer.trigger(i.default.ERROR,{type:t.ErrorTypes.MUX_ERROR,details:t.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Unsupported codec in video frame: "+n})}},v._parseHEVCDecoderConfigurationRecord=function(e,t){if(e.body){for(var i,r=this._videoTrack,n=e.body.buffer,s=e.body.byteLength-t,a=new DataView(n,t,s),l=a.getUint8(1)>>6,d=a.getUint8(1),c=31&a.getUint8(1),f=a.getUint32(2),h="",_=[],p=11;p>=6;p--){var v=a.getUint8(p);(v>0||h.length)&&(h.length&&(h+="."),h+=v.toString(16)),_.push()}0===h.length&&(h="0");for(var m=a.getUint8(12),g=a.getUint8(22),y=23,b=0;b<g;b++){var E=63&a.getUint8(y);y+=1;var T=a.getUint16(y);y+=2;for(var S=0;S<T;S++){var w=a.getUint16(y);if(y+=2,0!==w){if(32===E)o.Log.v(this.tag,"VPS lengh "+w);else if(33===E){o.Log.v(this.tag,"SPS lengh "+w);var R=new Uint8Array(n,t+y,w);i=u.default.parseHEVCSPS(R)}else 34===E&&o.Log.v(this.tag,"PPS lengh "+w);y+=w}}}for(var x=f.toString(16);x.length>1;){var L=x.length-1;if("0"!==x.charAt(L))break;x=x.slice(0,L)}i||(i={});var k="hev1."+["","A","B","C"][l]+c+"."+x+"."+(0===d?"L":"H")+m+"."+h;r.width=r.codecWidth=i.width,r.height=r.codecHeight=i.height,r.codec=k,r.profile=i.profile_string,r.level=i.level_string,r.chromaFormat=i.chroma_format_string,r.hvcc=new Uint8Array(s),r.hvcc=e.body.slice(t,e.body.byteLength)}},v._parseAVCDecoderConfigurationRecord=function(e,r){if(e.body){var n=this._videoTrack,s=e.body.buffer,a=e.body.byteLength-r,l=new DataView(s,r,a),d=l.getUint8(0),c=l.getUint8(1);if(1===d&&0!==c)if(this._naluLengthSize=1+(3&l.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var f=31&l.getUint8(5);if(0===f||f>1)this._observer.trigger(i.default.ERROR,{type:t.ErrorTypes.MUX_ERROR,details:t.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid H264 SPS count: "+f});else{for(var h=6,_=[],p=0;p<f;p++){var v=l.getUint16(h);if(h+=2,0!==v){var m=new Uint8Array(s,r+h,v);h+=v,_.push(m);for(var g=u.default.parseSPS(m),y=m.subarray(1,4),b="avc1.",E=0;E<3;E++){var T=y[E].toString(16);T.length<2&&(T="0"+T),b+=T}!n.codec||n.width===g.codec_size.width&&n.height===g.codec_size.height&&b===n.codec||(e.fill||this._remux(!0),this._remuxer.ISGenerated&&this._remuxer.resetInitSegment()),n.sps=_,n.width=g.codec_size.width,n.height=g.codec_size.height,n.pixelRatio=[g.sar_ratio.width,g.sar_ratio.height],g.frame_rate.fixed&&0!==g.frame_rate.fps&&(n.fps=g.frame_rate.fps),n.codec=b,n.profile=g.profile_string,n.level=g.level_string,n.chromaFormat=g.chroma_format_string}}var S=l.getUint8(h);if(0===S||S>1)this._observer.trigger(i.default.ERROR,{type:t.ErrorTypes.MUX_ERROR,details:t.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid H264 PPS count: "+S});else{h++,n.pps=[];for(var w=0;w<S;w++){var R=l.getUint16(h);h+=2;var x=new Uint8Array(s,r+h,R);n.pps.push(x),0!==R&&(h+=R)}o.Log.v(this.tag,"Parsed AVCDecoderConfigurationRecord"),n.duration=this._duration,n.container="video/mp4",n.fps?n.refSampleDuration=Math.floor(n.timescale/n.fps):n.refSampleDuration=Math.floor(n.timescale/30)}}}else this._observer.trigger(i.default.ERROR,{type:t.ErrorTypes.MUX_ERROR,details:t.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1)});else this._observer.trigger(i.default.ERROR,{type:t.ErrorTypes.MUX_ERROR,details:t.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid AVCDecoderConfigurationRecord"})}},v._parseAVCVideoData=function(e,t,i){if(void 0===i&&(i=!1),e.body){var r,a=e.body.buffer,u=e.body.byteLength-t,l=new DataView(a,t,u),d=[],c=0,f=0,h=this._naluLengthSize,_=e.timestamp,p=1===e.frameType;if(!i&&_<=this._vLastDTS&&this._vLastDTS>0)return o.Log.w(this.tag,"debug Non-monotonous DTS dts:"+_+" last:"+this._vLastDTS),void this._onNonMonotonous({tag:e,dataOffset:t},n.TrackType.video);!i&&this._nonMonotonousCache&&this._flushNonMonotonousCache();for(var v=_+e.cts;f<u;){if(f+4>=u){o.Log.v(this.tag,"Malformed Nalu near timestamp "+_+", offset = "+f+", dataSize = "+u);break}var m=l.getUint32(f);if(3===h&&(m>>>=8),m>u-h)return void o.Log.v(this.tag,"Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var g=new Uint8Array(a,t+f+4,h+m-4),y=void 0;if(7===e.codecId){if(5==(y=31&l.getUint8(f+h)))p=!0;else if(31===y)try{r=s.default.parse(g)}catch(e){o.Log.w(this.tag,"PrivNal parse error "+e)}}else if(12===e.codecId)if(19==(y=(126&l.getUint8(f+h))>>1)||20===y||21===y)p=!0;else if(63===y)try{r=s.default.parse(g)}catch(e){o.Log.w(this.tag,"PrivNal parse error "+e)}var b={type:y,data:g};d.push(b),c+=g.byteLength,f+=h+m}if(d.length){var E=this._videoTrack,T={units:d,length:c,dts:90*_,cts:90*e.cts,pts:90*v,streamDts:_,key:p,extraInfo:{dtsOrignMs:_,ptsOrignMs:_+e.cts,parseMs:0}};self.performance&&(T.extraInfo.parseMs=performance.now()),E.samples.push(T)}return this._vLastDTS=_,r}},v._parseAudioData=function(e,t){var s;if(void 0===t&&(t=!1),e.body)if(e.body.byteLength<=1)o.Log.v(this.tag,"Flv: Invalid audio packet, missing SoundData payload!");else{var u=this._audioTrack,l=e.body[1];if(0===l){if(e.body.byteLength<4)return;return a.initTrackConfig(u,this._observer,e.body,0,this._config.audioCodec),void(u.duration=this._duration)}if(1===l){var d=e.body.subarray(2),c=e.timestamp,f=(s=a.getFrameDuration(u.samplerate))*this._config.maxAudioFramesDrift;if(this._aLastDTS>0){c=this._aLastDTS+s;var h=e.timestamp-c;if(h>f)c=e.timestamp,this._observer.trigger(i.default.REPORT,{type:r.REPORT_TYPES.LOST_FRAMES,drop:h});else if(!t&&h<-f)return void this._onNonMonotonous({tag:e},n.TrackType.audio)}!t&&this._nonMonotonousCache&&this._flushNonMonotonousCache();var _=c*u.inputTimeScale/1e3,p={unit:d,dts:_,pts:_,streamDts:c,length:d.byteLength,extraInfo:{dtsOrignMs:c,ptsOrignMs:c,parseMs:0}};self.performance&&(p.extraInfo.parseMs=performance.now()),this._aLastDTS=c,u.samples.push(p)}else o.Log.v(this.tag,"Flv: Unsupported AAC data type "+l)}},v._onNonMonotonous=function(e,t){this._nonMonotonousCache||(this._nonMonotonousCache={video:[],audio:[]});var i=this._nonMonotonousCache[t];if(i.length>10){this.flush();var r=this._remuxer.getLastPTS(),n=r.audio;(0===n||r.video>0&&r.video<n)&&(n=r.video),this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=0,this._remuxStat={accurateTimeOffset:!1,contiguous:!1,timeOffset:n},this._remuxer.resetInitSegment(),this._remuxer.resetTimeStamp(),o.Log.i(this.tag,"NON_MONOTONOUS reset time"),this._flushNonMonotonousCache()}else i.push(e)},v._flushNonMonotonousCache=function(){if(this._nonMonotonousCache){var e=this._nonMonotonousCache;for(var t in e)for(var i=e[t];i.length;){var r=i.shift();r&&("video"===t?this._parseAVCVideoData(r.tag,r.dataOffset,!0):"audio"===t&&this._parseAudioData(r.tag,!0))}this._nonMonotonousCache=void 0}},v._remux=function(e){void 0===e&&(e=!1);var n=this._audioTrack,s=this._videoTrack,a=!0,u=0,l=!1;if(this._remuxStat&&(a=this._remuxStat.contiguous,u=this._remuxStat.timeOffset,l=this._remuxStat.accurateTimeOffset),0!==n.samples.length||0!==s.samples.length){if(e||!(this._hasAudio&&0===n.samples.length||this._hasVideo&&s.samples.length<2)){this._firstRemux&&(this._firstRemux=!1,this._observer.trigger(i.default.REPORT,{type:r.REPORT_TYPES.MEDIA_DEMUX}));try{this._remuxer.remux(n,s,u,a,l,e),this._remuxStat=void 0}catch(e){o.Log.e(this.tag,e),this._observer.trigger(i.default.ERROR,{type:t.ErrorTypes.MUX_ERROR,details:t.ErrorDetails.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},v._fillFrame=function(e){var t=this;if(0!==this._audioTrack.samples.length){var i=this._fillAtStart.start||90*this._audioTrack.samples[0].dts;if(e>i){o.Log.i(this.tag,"fill video frame: "+i+" "+e),this._fillAtStart.start=e;var r=[d.default.getFlvVideoTag(i),d.default.getFlvVideoTag(e-1)];this._fillAtStart.avcConfig&&(r.unshift(d.default.getFlvVideoTag(i,!0)),this._fillAtStart.avcConfig=!1),r.forEach((function(e){t._parseVideoData(e)}))}}},f=e,(h=[{key:"duration",set:function(e){this._duration=e}}])&&_(f.prototype,h),p&&_(f,p),e}();e.default=p})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/flv/flv-tag-dump.ts":
/*!***************************************!*\
  !*** ./src/demux/flv/flv-tag-dump.ts ***!
  \***************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../io/cache */"./src/io/cache.ts"),i(/*! ./flv */"./src/demux/flv/flv.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n){function s(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,i=s(i),r=s(r);var o=function(){function e(e,t){this._observer=void 0,this._cache=void 0,this._tag=void 0,this._result=void 0,this._parseLen=0,this._parseFunc=void 0,this._onAbr=void 0,this._observer=e,this._onAbr=t,this._cache=new r.default,this._parseLen=n.FlvSize.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._result={list:[]}}var s=e.prototype;return s.reset=function(){this._parseLen=n.FlvSize.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0,this._result.list=[],this._result.abr=void 0},s.append=function(e){for(this._cache.put(new Uint8Array(e));this._cache.unreadLen>this._parseLen;)this._parseFunc();var t={list:this._result.list.splice(0),abr:this._result.abr};return this._result.abr=void 0,t},s._parseFlvHead=function(){var e=this._cache.read(n.FlvSize.FLV_HEAD_LEN);e&&(70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||this._observer.trigger(i.default.ERROR,{type:t.ErrorTypes.MUX_ERROR,details:t.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: wrong head"}),this._observer.trigger(i.default.FLV_HEAD,{hasAudio:(4&e[4])>>>2,hasVideo:1&e[4]}),this._cache.skip(n.FlvSize.FLV_HEAD_LEN),this._parseLen=n.FlvSize.FLV_TAG_HEAD_LEN,this._parseFunc=this._parseFlvTagHead)},s._parseFlvTagHead=function(){this._tag=new n.FlvTag;var e=this._cache.read(n.FlvSize.FLV_TAG_HEAD_LEN);e&&(this._tag.tagType=e[0],this._tag.dataSize=((255&e[1])<<16)+((255&e[2])<<8)+(255&e[3]),this._tag.timestamp=((255&e[7])<<24)+((255&e[4])<<16)+((255&e[5])<<8)+(255&e[6]),this._cache.skip(n.FlvSize.FLV_TAG_HEAD_LEN),this._tag.tagType===n.FlvTagType.VIDEO?(this._parseFunc=this._detectKeyFrame,this._parseLen=n.FlvSize.AVC_KEY_FRAME_CHECK_LEN):(this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+n.FlvSize.FLV_TAG_SIZE_LEN))},s._detectKeyFrame=function(){var e=this._cache.read(2);if(e&&this._tag){var t=(240&e[0])>>>4,i=e[1];this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+n.FlvSize.FLV_TAG_SIZE_LEN,1===t&&1===i&&this._onAbr&&(this._result.abr=this._onAbr(this._tag.timestamp),this._result.abr&&(this._parseLen=n.FlvSize.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0))}},s._parseFlvTag=function(){var e=this._tag;e&&(e.tagType!==n.FlvTagType.SCRIPT&&e.tagType!==n.FlvTagType.AUDIO&&e.tagType!==n.FlvTagType.VIDEO||(e.body=this._cache.get(e.dataSize),this._cache.skip(4),e&&this._result.list.push(e),this._tag=void 0),this._parseFunc=this._parseFlvTagHead,this._parseLen=n.FlvSize.FLV_TAG_HEAD_LEN)},e}();e.default=o})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/flv/flv.ts":
/*!******************************!*\
  !*** ./src/demux/flv/flv.ts ***!
  \******************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){var t;e.__esModule=!0,e.FlvTag=e.FlvSize=e.FlvTagType=void 0,e.FlvTagType=t,function(e){e[e.AUDIO=8]="AUDIO",e[e.VIDEO=9]="VIDEO",e[e.SCRIPT=18]="SCRIPT"}(t||(e.FlvTagType=t={})),e.FlvSize={FLV_HEAD_LEN:13,FLV_TAG_HEAD_LEN:11,FLV_TAG_SIZE_LEN:4,AVC_KEY_FRAME_CHECK_LEN:2},e.FlvTag=function(){this.tagType=t.VIDEO,this.dataSize=0,this.timestamp=0,this.size=0,this.cts=0,this.frameType=0,this.codecId=0,this.body=null,this.fill=void 0}})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/get-audio-config.ts":
/*!***************************************!*\
  !*** ./src/demux/get-audio-config.ts ***!
  \***************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r){var n;e.__esModule=!0,e.getAudioConfig=function(e,n,s){void 0===s&&(s="");var o,a,u=n.objectType,l=n.sampleingIndex,d=n.chanelConfig,c=navigator.userAgent.toLowerCase(),f=s,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return l<0||l>=h.length?(e.trigger(t.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid sampling index:"+l}),null):d<0||d>=8?(e.trigger(t.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid chanelConfig:"+d}),null):(r.Log.v("manifest codec:"+s+",data:type:"+u+",sampleingIndex:"+l+"["+h[l]+"Hz],channelConfig:"+d),/firefox/i.test(c)?l>=6?(u=5,a=new Array(4),o=l-3):(u=2,a=new Array(2),o=l):-1!==c.indexOf("android")?(u=2,a=new Array(2),o=l):(u=5,a=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&l>=6?o=l-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(l>=6&&1===d||/vivaldi/i.test(c))||!s&&1===d)&&(u=2,a=new Array(2)),o=l)),a[0]=u<<3,a[0]|=(14&l)>>1,a[1]|=(1&l)<<7,a[1]|=d<<3,5===u&&(a[1]|=(14&o)>>1,a[2]=(1&o)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:h[l],channelCount:d,codec:"mp4a.40."+u,manifestCodec:f})},t=(n=t)&&n.__esModule?n:{default:n}})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/base-stream.ts":
/*!**************************************!*\
  !*** ./src/demux/hls/base-stream.ts ***!
  \**************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! ../../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../core/report-types */"./src/core/report-types.ts"),i(/*! ../../io/loader */"./src/io/loader.ts"),i(/*! ../../io/loader-with-cache */"./src/io/loader-with-cache.ts"),i(/*! ../../utils/download-info */"./src/utils/download-info.ts"),i(/*! ./demuxer */"./src/demux/hls/demuxer.ts"),i(/*! ./fragment-finder */"./src/demux/hls/fragment-finder.ts"),i(/*! ./level-helper */"./src/demux/hls/level-helper.ts"),i(/*! ./loader/key-loader */"./src/demux/hls/loader/key-loader.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u,l,d,c){function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,r=f(r),s=f(s),o=f(o),u=f(u),c=f(c);var _=function(){function e(e,t,i,n,s,o,a){void 0===a&&(a=!1),this._observer=void 0,this._type=void 0,this._config=void 0,this._levels=void 0,this._index=void 0,this._next=void 0,this._pos=void 0,this._failPos=-1,this._demuxer=void 0,this._loadEnabled=void 0,this._newSource=void 0,this._startSN=0,this._inited=!1,this._fragLoadFailSec=0,this._demuxing=!1,this._loader=void 0,this._keyLoader=void 0,this._remuxContiguous=!1,this._media=void 0,this._fragAlign=void 0,this._callback=void 0,this._loadConfig=void 0,this._keyLoadConfig=void 0,this._streamingMux=!0,this._fragCnt=0,this._preload=!1,this._preloadData=void 0,this._type=e,this._observer=t,this._media=i,this._config=n,this._levels=s,this._next=this._index=o,this._pos=0,this._callback={onProgress:this._onProgress.bind(this),onEnd:this._onEnd.bind(this),onError:this._onError.bind(this),onAbort:this._onAbort.bind(this)},this._loadConfig={connectionTimeout:n.connectionTimeout,transmissionTimeout:n.transmissionTimeout,maxRetry:n.maxRetry,retryDelay:n.retryDelay},this._keyLoadConfig={connectionTimeout:n.keyConnectionTimeout,transmissionTimeout:n.keyTransmissionTimeout,maxRetry:n.keyLoadingMaxRetry,retryDelay:n.keyLoadingRetryDelay},this._observer.on(r.default.PARSED_DATA,this._fragParsed.bind(this)),this._demuxer=new u.default(t,n,e),this._loadEnabled=!0,this._newSource=!0,this._preload=a,this._preload&&this.streamingMux(!1)}var f,_,p,v=e.prototype;return v.levelUpdated=function(){if(this.level&&this.level.details){var e=this.level.details.startSN;(0,t.isFiniteNumber)(this._startSN)&&this._startSN!==e&&(this._pos=Math.max(0,this._pos-(e-this._startSN))),this._startSN=e,this._tryLoadNext()}},v.seek=function(e,t){void 0===t&&(t=!1),this._remuxContiguous=!1;var i=this.level;this._loadEnabled=!0;var n=0;if(this._destroyLoader(),i&&i.details){var s=0===e?0:(0,l.findFragmentPosByPTS)(e,i.details.fragments);this._pos=s>=0?s:i.details.fragments.length-1;var o=this._config.startPlayBufferSec,a=i.details.fragments[this._pos].start;n=t?o:Math.max(e+o-a,0),this._reset(!0,n),t&&this._observer.trigger(r.default.SEEK_KEYFRAME,{keyFrameSec:a}),this._tryLoadNext()}},v.setDownloadEnabled=function(e){void 0===e&&(e=!0),!this._loadEnabled&&e?(this._loadEnabled=e,this._tryLoadNext()):this._loadEnabled=e},v.destroy=function(){this._destroyLoader(),this._demuxer&&this._demuxer.destroy(),this._keyLoader&&(this._keyLoader.destroy(),this._keyLoader=void 0),this._fragAlign=void 0},v.nextBackup=function(e){if(this._levels)for(var t=0;t<this._levels.length;t++){var i=this._levels[t];if(i.urlId>=i.url.length-1)return!1;i.urlId++,delete i.m3u8,delete i.m3u8Slice,i.details=null}this._destroyLoader(),this._newSource=!0,this._failPos>=0&&(this._pos=this._failPos);var r=0;if(this.level&&this.level.details){var n=this._config.startPlayBufferSec;r=Math.max(e+n-this.level.details.fragments[this._pos].start,0)}return this._reset(!0,r),!0},v.streamingMux=function(e){this._streamingMux=e},v.usePreload=function(){this._preloadData&&(this._demuxer.onFragLoaded(this._preloadData),this._preloadData=void 0,this._preload=!1)},v._getFragStartByPos=function(e){if(this.level.details){var t=this.level.details.fragments[e];if(t)return t.maxStartPTS||t.startPTS||t.start}return 0},v._reset=function(e,t){this._inited=!1,this._demuxing=!1,this._demuxer.reset(e,t)},v._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},v._loadKey=function(e){var t=this;this._keyLoader||(this._keyLoader=new c.default({credentials:this._config.credentials},this._keyLoadConfig),this._keyLoader.on(r.default.HLS_KEY_LOADED,this._tryLoadNext.bind(this)),this._keyLoader.on(r.default.ERROR,(function(e){t._observer.trigger(r.default.ERROR,e)}))),this._keyLoader.load(e)},v._tryLoadNext=function(){this._next!==this._index&&(this._index=this._next);var e=this.level;if(e){if(this._fragAlign&&e.details){var t=this._fragAlign.frag,i=e.details.fragments[this._pos];i&&(this._pos===this._fragAlign.pos&&this._index===this._fragAlign.level&&(0,d.updateFragPTSDTS)(e.details,i,t.startPTS,t.endPTS,t.startDTS,t.endDTS),this._fragAlign=void 0)}if(this._loadEnabled&&!this._loader&&!this._demuxing){if(this._isLevelEnd())return void this._demuxer.end();var r=this._nextFragment();if(r){if("encrypted"===r)return;this._loadFrag(r)}}}},v._isLevelEnd=function(){var e=this.level;return!!(e&&e.details&&!e.details.live&&this._pos>=e.details.fragments.length)},v._nextFragment=function(){var e=this.level,t=null;if(e&&e.details&&(this._inited&&e.details.initSegment?t=e.details.initSegment:this._pos<e.details.fragments.length&&(t=e.details.fragments[this._pos])),t){if(t.encrypted&&t.decryptdata)return this._loadKey(t),"encrypted";this._inited?this._inited=!1:this._pos++}return t},v._fragParsed=function(e,t){for(var i in this._demuxing=!1,this._remuxContiguous=!1,t.type=n.REPORT_TYPES.MUX_INFO,this._observer.trigger(r.default.REPORT,t),t.info){var s=t.info[i];if(s&&s.endPTS&&s.endDTS){var o=t.frag,a=this._levels[o.level].details;a&&(0,d.updateFragPTSDTS)(a,o,s.startPTS,s.endPTS,s.startDTS,s.endDTS)}}this._isLevelEnd()?this._demuxer.end():(this._observer.trigger(r.default.ABR_NEXT,{startSec:this._getFragStartByPos(this._pos)}),this._tryLoadNext())},v._loadFrag=function(e){if(e){var i={url:e.url,responseType:"arraybuffer",progress:this._streamingMux&&this._config.streamingMux,frag:e,type:"frag",credentials:this._config.credentials},a=e.byteRangeStartOffset,u=e.byteRangeEndOffset;(0,t.isFiniteNumber)(a)&&(0,t.isFiniteNumber)(u)&&(i.rangeStart=a,i.rangeEnd=u),this._destroyLoader(),this._loadConfig.cache=this._preload;var l=0===this._fragCnt&&this._config.dbCache?o.default:s.default;if(this._loader=new l,this._loader.load(i,this._callback,this._loadConfig),this._demuxing=!0,this._newSource){var d={type:n.REPORT_TYPES.NEW_SOURCE,index:this._index,sync:e.start,url:this._config.src,bitrate:0,urlId:0,qualityType:this.level.qualityType};this.level&&this.level.bitrate&&(d.bitrate=Math.round(this.level.bitrate),d.urlId=this.level.urlId),this._observer.trigger(r.default.REPORT,d),this._newSource=!1}this._config.fragBeforeWorker>0&&this._fragCnt===this._config.fragBeforeWorker&&this._demuxer.mixedModeWorkerStart(),this._fragCnt++}},v._onProgress=function(e,t,i){var r=this._levels[e.frag.level]||{};t instanceof ArrayBuffer&&this._demuxer.onFragProgress({context:e,data:t,stats:i,audioCodec:r.audioCodec,videoCodec:r.videoCodec,remuxContiguous:this._remuxContiguous,progress:!0})},v._onEnd=function(e,t,i){this._failPos=-1,this._fragLoadFailSec=0,this._destroyLoader();var n=this._levels[e.frag.level]||{},s=(0,a.downloadInfo)(a.DownloadStatus.SUCCESS,e,i,this._levels,this._preload);if(this._observer.trigger(r.default.REPORT,s),"string"!=typeof t){var o={context:e,data:t,stats:i,audioCodec:n.audioCodec,videoCodec:n.videoCodec,remuxContiguous:this._remuxContiguous,progress:!!e.progress};this._preload?(this._preloadData=o,this._observer.trigger(r.default.PRELOAD_COMPLETE)):this._demuxer.onFragLoaded(o)}},v._onError=function(e,t){this._demuxing=!1,this._observer.trigger(r.default.REPORT,(0,a.downloadInfo)(a.DownloadStatus.FAIL,e,t,this._levels,this._preload)),t.fatal&&(this._remuxContiguous=!1,this._failPos<0&&(this._failPos=Math.max(0,this._pos-1)),this._destroyLoader(),this._fragLoadFailSec+=e.frag.duration||0,"initSegment"===e.frag.sn||404!==t.code||this._config.maxFragFailSec&&this._fragLoadFailSec>=this._config.maxFragFailSec||this._isLevelEnd()?this._observer.trigger(r.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url}):this._tryLoadNext())},v._onAbort=function(e,t){this._observer.trigger(r.default.REPORT,(0,a.downloadInfo)(a.DownloadStatus.ABORT,e,t,this._levels,this._preload))},f=e,(_=[{key:"isNetworkInUse",get:function(){return!(!this._loadEnabled&&!this._loader)}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._levels[this._index]}},{key:"index",get:function(){return this._index},set:function(e){this._destroyLoader(),this._newSource=!0,this._index=this._next=e,this._fragAlign=void 0}},{key:"next",get:function(){return this._next},set:function(e){this._newSource=!0,this._next=e,this._remuxContiguous=!0}},{key:"manualNext",set:function(e){var t=this.level.details;if(t){var i=this._media.currentTime+(t.targetduration||5)/2,n=(0,l.findFragmentPosByPTS)(i,t.fragments)+1;if(n>0&&n<t.fragments.length){n<this._pos-1&&(this._loader&&this._destroyLoader(),this._reset(!1,0),this._pos=n,this._remuxContiguous=!1),this._newSource=!0,this._next=e;var s=t.fragments[this._pos],o=this._getFragStartByPos(this._pos);return this._observer.trigger(r.default.LEVEL_SWITCHING,{startSec:o,level:e,smooth:!0}),this._fragAlign={level:this._next,pos:this._pos,frag:s},this._observer.trigger(r.default.BUFFER_FLUSHING,{startSec:o}),void this._tryLoadNext()}}this._observer.trigger(r.default.LEVEL_SWITCH_FAILED)}},{key:"nextLoadStart",get:function(){return this._getFragStartByPos(this._pos)}}])&&h(f.prototype,_),p&&h(f,p),e}();e.default=_})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/crypt/aes-crypto.ts":
/*!*******************************************!*\
  !*** ./src/demux/hls/crypt/aes-crypto.ts ***!
  \*******************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}();e.default=t})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/crypt/aes-decryptor.js":
/*!**********************************************!*\
  !*** ./src/demux/hls/crypt/aes-decryptor.js ***!
  \**********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){function t(e){var t=e.byteLength,i=t&&new DataView(e).getUint8(t-1);return i?e.slice(0,t-i):e}e.__esModule=!0,e.removePadding=t,e.default=void 0;var i=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var i=e.prototype;return i.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),r=0;r<4;r++)i[r]=t.getUint32(4*r);return i},i.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],n=i[1],s=i[2],o=i[3],a=this.invSubMix,u=a[0],l=a[1],d=a[2],c=a[3],f=new Uint32Array(256),h=0,_=0,p=0;for(p=0;p<256;p++)f[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=_^_<<1^_<<2^_<<3^_<<4;v=v>>>8^255&v^99,e[h]=v,t[v]=h;var m=f[h],g=f[m],y=f[g],b=257*f[v]^16843008*v;r[h]=b<<24|b>>>8,n[h]=b<<16|b>>>16,s[h]=b<<8|b>>>24,o[h]=b,b=16843009*y^65537*g^257*m^16843008*h,u[v]=b<<24|b>>>8,l[v]=b<<16|b>>>16,d[v]=b<<8|b>>>24,c[v]=b,h?(h=m^f[f[f[y^m]]],_^=f[f[_]]):h=_=1}},i.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,r=0;r<t.length&&i;)i=t[r]===this.key[r],r++;if(!i){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var s,o,a,u,l=this.ksRows=4*(n+6+1),d=this.keySchedule=new Uint32Array(l),c=this.invKeySchedule=new Uint32Array(l),f=this.sBox,h=this.rcon,_=this.invSubMix,p=_[0],v=_[1],m=_[2],g=_[3];for(s=0;s<l;s++)s<n?a=d[s]=t[s]:(u=a,s%n==0?(u=f[(u=u<<8|u>>>24)>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u],u^=h[s/n|0]<<24):n>6&&s%n==4&&(u=f[u>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u]),d[s]=a=(d[s-n]^u)>>>0);for(o=0;o<l;o++)s=l-o,u=3&o?d[s]:d[s-4],c[o]=o<4||s<=4?u:p[f[u>>>24]]^v[f[u>>>16&255]]^m[f[u>>>8&255]]^g[f[255&u]],c[o]=c[o]>>>0}},i.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},i.decrypt=function(e,i,r,n){for(var s,o,a,u,l,d,c,f,h,_,p,v,m,g,y=this.keySize+6,b=this.invKeySchedule,E=this.invSBox,T=this.invSubMix,S=T[0],w=T[1],R=T[2],x=T[3],L=this.uint8ArrayToUint32Array_(r),k=L[0],A=L[1],O=L[2],P=L[3],D=new Int32Array(e),I=new Int32Array(D.length),M=this.networkToHostOrderSwap;i<D.length;){for(h=M(D[i]),_=M(D[i+1]),p=M(D[i+2]),v=M(D[i+3]),l=h^b[0],d=v^b[1],c=p^b[2],f=_^b[3],m=4,g=1;g<y;g++)s=S[l>>>24]^w[d>>16&255]^R[c>>8&255]^x[255&f]^b[m],o=S[d>>>24]^w[c>>16&255]^R[f>>8&255]^x[255&l]^b[m+1],a=S[c>>>24]^w[f>>16&255]^R[l>>8&255]^x[255&d]^b[m+2],u=S[f>>>24]^w[l>>16&255]^R[d>>8&255]^x[255&c]^b[m+3],l=s,d=o,c=a,f=u,m+=4;s=E[l>>>24]<<24^E[d>>16&255]<<16^E[c>>8&255]<<8^E[255&f]^b[m],o=E[d>>>24]<<24^E[c>>16&255]<<16^E[f>>8&255]<<8^E[255&l]^b[m+1],a=E[c>>>24]<<24^E[f>>16&255]<<16^E[l>>8&255]<<8^E[255&d]^b[m+2],u=E[f>>>24]<<24^E[l>>16&255]<<16^E[d>>8&255]<<8^E[255&c]^b[m+3],m+=3,I[i]=M(s^k),I[i+1]=M(u^A),I[i+2]=M(a^O),I[i+3]=M(o^P),k=h,A=_,O=p,P=v,i+=4}return n?t(I.buffer):I.buffer},i.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}();e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/crypt/decrypter.ts":
/*!******************************************!*\
  !*** ./src/demux/hls/crypt/decrypter.ts ***!
  \******************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./aes-crypto */"./src/demux/hls/crypt/aes-crypto.ts"),i(/*! ./fast-aes-key */"./src/demux/hls/crypt/fast-aes-key.ts"),i(/*! ./aes-decryptor */"./src/demux/hls/crypt/aes-decryptor.js"),i(/*! ../../../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../../../utils/log */"./src/utils/log.ts"),i(/*! ../../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../../utils/get-self-scope */"./src/utils/get-self-scope.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a){function u(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,t=u(t),i=u(i),r=u(r),o=u(o);var l=(0,a.getSelfScope)(),d=function(){function e(e,t,i){var r=(void 0===i?{}:i).removePKCS7Padding,n=void 0===r||r;if(this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.logEnabled=!0,this.key=null,this.fastAesKey=void 0,this.decryptor=void 0,this.disableWebCrypto=void 0,this.subtle=void 0,this.observer=e,this.config=t,this.removePKCS7Padding=n,n)try{var s=l.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(e){console.error(e)}this.disableWebCrypto=!this.subtle}var a=e.prototype;return a.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},a.decrypt=function(e,n,o,a){var u=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(s.Log.v("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new r.default),l.expandKey(n),a(l.decrypt(e,0,o,this.removePKCS7Padding))}else if(this.subtle){this.logEnabled&&(s.Log.v("WebCrypto AES decrypt"),this.logEnabled=!1);var d=this.subtle;this.key!==n&&(this.key=n,this.fastAesKey=new i.default(d,n)),this.fastAesKey&&this.fastAesKey.expandKey().then((function(i){new t.default(d,o).decrypt(e,i).catch((function(t){u.onWebCryptoError(t,e,n,o,a)})).then((function(e){a(e)}))})).catch((function(t){u.onWebCryptoError(t,e,n,o,a)}))}},a.onWebCryptoError=function(e,t,i,r,a){this.config.enableSoftwareAES?(s.Log.v("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,r,a)):(s.Log.e("decrypting error : "+e.message),this.observer.trigger(o.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},a.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=null)},e}();e.default=d})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/crypt/fast-aes-key.ts":
/*!*********************************************!*\
  !*** ./src/demux/hls/crypt/fast-aes-key.ts ***!
  \*********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC",length:128},!1,["encrypt","decrypt"])},e}();e.default=t})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/demuxer-inline.ts":
/*!*****************************************!*\
  !*** ./src/demux/hls/demuxer-inline.ts ***!
  \*****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./crypt/decrypter */"./src/demux/hls/crypt/decrypter.ts"),i(/*! ./tsdemuxer */"./src/demux/hls/tsdemuxer.ts"),i(/*! ../../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../core/kernel-errors */"./src/core/kernel-errors.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s){function o(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,t=o(t),i=o(i),r=o(r),n=o(n);var a=function(){function e(e,t,i,r,n,s){this._observer=void 0,this._config=void 0,this._vendor=void 0,this._typeSupported=void 0,this._decrypter=void 0,this._nextIV=null,this._data=void 0,this.probe=void 0,this._demuxer=void 0,this._remuxer=void 0,this._demuxerStat=void 0,this._remuxerStat=void 0,this._observer=e,this._typeSupported=t,this._config=i,this._data=r,this._vendor=n,s&&(this._demuxerStat=s.demuxer,this._remuxerStat=s.remuxer)}var o=e.prototype;return o.push=function(e,i,r,n,s,o,a,u,l,d,c,f,h){var _=this;if(e.byteLength>0&&i&&i.key&&"AES-128"===i.method){var p=this._decrypter;p||(p=this._decrypter=new t.default(this._observer,this._config,{removePKCS7Padding:f}));var v=this._nextIV?this._nextIV:i.iv;p.decrypt(e,i.key.buffer,v.buffer,(function(e){_._pushDecrypted(new Uint8Array(e),i,r?new Uint8Array(r):null,n,s,o,a,u,l,d,c,f,h)})),f?this._nextIV=null:(this._nextIV=new Uint8Array(16),this._nextIV.set(new Uint8Array(e,e.byteLength-16)))}else this._pushDecrypted(new Uint8Array(e),i,r?new Uint8Array(r):null,n,s,o,a,u,l,d,c,f,h)},o.reset=function(e){this._nextIV=null,this._demuxer&&(this._demuxer.setExtra(e),this._demuxer.reset(e.stashSec)),this._remuxer&&(this._remuxer.setExtra(e),this._remuxer.resetStash()),this._data=e},o.flush=function(){this._demuxer&&this._demuxer.flush()},o.end=function(){this._observer.trigger(n.default.LOAD_END)},o.getStat=function(){return this._demuxer&&this._remuxer?{demuxer:this._demuxer.getStat(),remuxer:this._remuxer.getStat()}:null},o._pushDecrypted=function(e,t,o,a,u,l,d,c,f,h,_,p,v){var m=this._demuxer,g=!1;if(!m||f&&!this.probe(e)){for(var y=this._observer,b=this._typeSupported,E=this._config,T=[{Demux:i.default,Remux:r.default}],S=0,w=T.length;S<w;S++){var R=T[S],x=R.Demux.probe;if(x(e)){var L=this._remuxer=new R.Remux(y,E,b,this._vendor);L.setExtra(this._data),(m=new R.Demux(y,L,E,b)).setExtra(this._data),this.probe=x,g=!0;break}}if(!m)return void this._observer.trigger(n.default.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this._demuxer=m}var k=this._remuxer,A=g&&this._demuxerStat;(c||f||A)&&(m.resetInitSegment(o,a,u,_),k.resetInitSegment()),(f||A)&&(m.resetTimeStamp(),k.resetTimeStamp()),"function"==typeof m.setDecryptData&&m.setDecryptData(t),A&&(m.setStat(this._demuxerStat),k.setStat(this._remuxerStat)),v&&this.reset(v),m.append(e,l,d,h,p)},e}();e.default=a})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/demuxer-worker.ts":
/*!*****************************************!*\
  !*** ./src/demux/hls/demuxer-worker.ts ***!
  \*****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../core/observer */"./src/core/observer.ts"),i(/*! ./demuxer-inline */"./src/demux/hls/demuxer-inline.ts"),i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n){function s(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=function(e){var s,o=new t.default,a=function(t,i){e.postMessage({event:t,data:i})};o.on(r.default.PARSING_INIT_SEGMENT,a),o.on(r.default.PARSED_DATA,a),o.on(r.default.LOAD_END,a),o.on(r.default.ERROR,a),o.on(r.default.REPORT,a),o.on(r.default.PARSING_DATA,(function(t,i){var r={event:t,data:i,payload:i.payload};delete i.payload,e.postMessage(r,[r.payload.buffer])})),e.addEventListener("message",(function(e){var t=e.data;switch(t.cmd){case"init":n.Log.level(t.config.kwaiKernelLog),function(e,t,r,n,o,a){s=new i.default(e,t,r,n,o,a)}(o,t.typeSupported,t.config,t.data,t.vendor,t.stat);break;case"push":s.push(t.data,t.decryptdata,t.initSegment,t.audioCodec,t.videoCodec,t.timeOffset,t.contiguous,t.trackSwitch,t.discontinuity,t.accurateTimeOffset,t.duration,t.fragEnd,t.resetData);break;case"flush":s.flush();break;case"end":s.end()}}))},t=s(t),i=s(i),r=s(r)})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/demuxer.ts":
/*!**********************************!*\
  !*** ./src/demux/hls/demuxer.ts ***!
  \**********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),i(/*! ../../core/observer */"./src/core/observer.ts"),i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../core/report-types */"./src/core/report-types.ts"),i(/*! ../../io/cache */"./src/io/cache.ts"),i(/*! ./demuxer-inline */"./src/demux/hls/demuxer-inline.ts"),i(/*! ../../utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u,l){function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,r=d(r),n=d(n),s=d(s),a=d(a),u=d(u);var f=function(){function e(e,t,i){var r=this;this.MUX_MIN_LEN=752,this._id=void 0,this._observer=void 0,this._config=void 0,this._inlineObserver=null,this._w=null,this._typeSupported=void 0,this._cache=void 0,this._chunkIndex=void 0,this._remuxId=void 0,this._seek=!1,this._frag=null,this._demuxer=null,this._duration=0,this._progressTime=0,this._initSegment=void 0,this._resetData=null,this._fragInfo=void 0,this._onWorkMessage=function(e){var t=e.data;e.data.event===s.default.PARSING_DATA&&(t.data.payload=t.payload),r._onMessage(e.data.event,t.data)},this._id=i,this._observer=e,this._config=t,this._typeSupported={mp4:!0,mpeg:!1,mp3:!1},this._frag=null,this._fragInfo={},t.webWorker&&t.fragBeforeWorker>0?this._cache=new a.default(524288):this._cache=new a.default,this._chunkIndex=0,this._remuxId=1,this.init()}var d,f,h,_=e.prototype;return _.init=function(){var e=this._inlineObserver=new n.default,t=this._onMessage.bind(this);e.on(s.default.PARSING_INIT_SEGMENT,t),e.on(s.default.PARSED_DATA,t),e.on(s.default.LOAD_END,t),e.on(s.default.ERROR,t),e.on(s.default.REPORT,t),e.on(s.default.PARSING_DATA,t),this._config.webWorker&&this._config.fragBeforeWorker<=0?this._initWorker():this._demuxer=new u.default(e,this._typeSupported,this._config,{remuxId:this._remuxId,stashSec:0},navigator.vendor,null)},_.mixedModeWorkerStart=function(){this._cache.expandCache(a.default.DEFAULT_CACHE_SIZE),this._initWorker()},_._initWorker=function(){if(this._config.webWorker&&!this._w&&(this._w=(0,r.default)(/*! ./demuxer-worker */"./src/demux/hls/demuxer-worker.ts"),this._w)){var e=null;this._demuxer&&(e=this._demuxer.getStat()),this._w.addEventListener("message",this._onWorkMessage),this._w.postMessage({cmd:"init",typeSupported:this._typeSupported,config:this._config,data:{remuxId:this._remuxId,stashSec:0},vendor:navigator.vendor,stat:e})}},_.destroy=function(){this._config.webWorker&&this._w&&(this._w.postMessage({cmd:"destroy"}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate()),this._inlineObserver&&(this._inlineObserver.removeAllListeners(),this._inlineObserver=null)},_.resetData=function(e){this._remuxId++,this._cache.clear(),this._resetData={remuxId:this._remuxId,stashSec:e},this._chunkIndex=0},_.reset=function(e,t){this.resetData(t),this._seek=e,this._frag=null},_.end=function(){this._config.webWorker&&this._w?this._w.postMessage({cmd:"end"}):this._demuxer&&this._demuxer.end()},_.onFragProgress=function(e){this._demux(e,!1)},_.onFragLoaded=function(e){this._demux(e,!0)},_._demux=function(e,t){if("initSegment"===e.context.frag.sn&&e.data)this._initSegment=e.data;else{var r=this._cache,n=e.context.frag,a=this._frag,u=(0,i.isFiniteNumber)(n.startDTS)?n.startDTS:n.start,l=e.progress,d=!1,c=!1,f=!0,h=null;if(e.data&&e.data.byteLength){var _={type:o.REPORT_TYPES.LOADER_CHUNK_ARRIVAL,byteLength:e.data.byteLength,timeCost:performance.now()-(this._progressTime||e.stats.trequest)};this._progressTime=performance.now(),this._observer.trigger(s.default.REPORT,_),l&&r.put(new Uint8Array(e.data))}if(0===this._chunkIndex){this._fragInfo={},d=!(a&&n.level===a.level),c=!(a&&n.cc===a.cc);var p=a&&n.sn===a.sn+1;f=(f=!(d||!p))||e.remuxContiguous}if(t)this._progressTime=0,this._chunkIndex=0,this._frag=e.context.frag,l&&r.unreadLen&&(h=r.get(r.unreadLen)),r.clear(),this._frag=n;else if(l){var v=Math.floor(r.unreadLen/this.MUX_MIN_LEN)*this.MUX_MIN_LEN-this.MUX_MIN_LEN;v>=this.MUX_MIN_LEN&&(h=r.get(v),this._chunkIndex++)}var m=null;l?h&&(m=h.buffer):m=e.data,m&&(this._push(m,n.decryptdata,this._initSegment,e.audioCodec,e.videoCodec,u,f,d,c,!this._seek||0===e.context.frag.start,this._duration,t),this._seek=!1)}},_._onParsing=function(e){if(e.expired=!(!e.extra||e.extra.remuxId===this._remuxId),e.id=this.id,e.expired)l.Log.i("Demuxer","parsing data expired");else{var t=this._fragInfo;t.hasOwnProperty(e.type)?(t[e.type].endPTS=e.endPTS,t[e.type].endDTS=e.endDTS):t[e.type]={startDTS:e.startDTS,startPTS:e.startPTS,endPTS:e.endPTS,endDTS:e.endDTS}}},_._onParsed=function(e){e.expired=!(!e.extra||e.extra.remuxId===this._remuxId),e.expired?l.Log.i("Demuxer","parsed expired"):(e.info=(0,t.ObjectAssign)({},this._fragInfo),e.frag=this._frag,this._fragInfo={})},_._push=function(e,t,i,r,n,s,o,a,u,l,d,c){this._config.webWorker&&this._w?this._w.postMessage({cmd:"push",data:e,decryptdata:t,initSegment:i,audioCodec:r,videoCodec:n,timeOffset:s||0,contiguous:o,trackSwitch:a,discontinuity:u,accurateTimeOffset:l,duration:d,fragEnd:c,resetData:this._resetData},[e]):this._demuxer&&this._demuxer.push(e,t,i,r,n,s,o,a,u,l,d,c,this._resetData),this._resetData=null},_._onMessage=function(e,t){switch(e){case s.default.PARSING_DATA:if(this._onParsing(t),t.expired)return;break;case s.default.PARSED_DATA:if(this._onParsed(t),t.expired)return}this._observer.trigger(e,t)},d=e,(f=[{key:"totalDuration",set:function(e){this._duration=e}},{key:"seek",set:function(e){this._seek=e}},{key:"id",get:function(){return this._id}},{key:"hasWorker",get:function(){return!!this._w}}])&&c(d.prototype,f),h&&c(d,h),e}();e.default=f})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/fragment-finder.ts":
/*!******************************************!*\
  !*** ./src/demux/hls/fragment-finder.ts ***!
  \******************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../utils/binary-search */"./src/utils/binary-search.ts")],void 0===(s="function"==typeof(r=function(e,t){var i;e.__esModule=!0,e.findFragmentByPTS=function(e,i){return i?t.default.search(i,(function(t){return e<t.start?-1:e>t.start+t.duration?1:0})):null},e.findFragmentPosByPTS=function(e,i){return i?t.default.searchIndex(i,(function(t){return e<t.start?-1:e>t.start+t.duration?1:0})):-1},t=(i=t)&&i.__esModule?i:{default:i}})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/hls.ts":
/*!******************************!*\
  !*** ./src/demux/hls/hls.ts ***!
  \******************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../abr/hls-abr */"./src/abr/hls-abr.ts"),i(/*! ../../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../core/report-types */"./src/core/report-types.ts"),i(/*! ../../types/core */"./src/types/core.ts"),i(/*! ../../utils/browser */"./src/utils/browser.ts"),i(/*! ../../utils/codecs */"./src/utils/codecs.ts"),i(/*! ../../utils/log */"./src/utils/log.ts"),i(/*! ./level-helper */"./src/demux/hls/level-helper.ts"),i(/*! ./loader/kwai-hls */"./src/demux/hls/loader/kwai-hls.ts"),i(/*! ./loader/playlist-loader */"./src/demux/hls/loader/playlist-loader.ts"),i(/*! ./main-stream */"./src/demux/hls/main-stream.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u,l,d,c,f){function h(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return h=function(){return e},e}function _(e){return e&&e.__esModule?e:{default:e}}function p(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,t=_(t),r=_(r),o=_(o),d=_(d),c=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=h();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(c),f=_(f);var v=function(){function e(e,t,i,n){var o=this;void 0===n&&(n=!1),this.tag="HLS",this._observer=void 0,this._config=void 0,this._abr=void 0,this._media=void 0,this._playlistLoader=void 0,this._main=void 0,this._timer=void 0,this._startTimeSec=void 0,this._seekKeyframe=void 0,this._levels=null,this._totalduration=0,this._protocol=s.Protocol.HLS,this._preload=!1,this._manifestReady=!1,this._levelLoadDelayTimer=void 0,this._sortLevels=function(e){return e.sort((function(e,t){return e.bitrate-t.bitrate==0&&e.height&&t.height?e.height-t.height:e.bitrate-t.bitrate}))},this._abrNext=function(e,t){if(o._abr&&o._abr.autoLevelEnabled&&o._main){var i=o._abr.nextBitrateIndex();i>=0&&i!==o._main.index&&(o._observer.trigger(r.default.LEVEL_SWITCHING,{startSec:t.startSec,level:i,smooth:!0}),o.nextLevel=i)}},this.tag="HLS",this._observer=e,this._config=t,this._media=i,this._preload=n,this._startTimeSec=t.startFromSec||-1,this._seekKeyframe=t.startFromKeyframe,"object"==typeof t.manifest&&(this._protocol=s.Protocol.KWAI_HLS)}var h,_,v,m=e.prototype;return m.init=function(){var e=this;this._initMultirate(),this._playlistLoader=new c.default(this._config),this._playlistLoader.on(r.default.HLS_MANIFEST_LOADED,this._onManifestLoaded.bind(this)),this._playlistLoader.on(r.default.LEVEL_LOADED,this._onLevelLoaded.bind(this)),this._playlistLoader.on(r.default.REPORT,(function(t){e._observer.trigger(r.default.REPORT,t)})),this._playlistLoader.on(r.default.ERROR,(function(t){!e.current||e.current.details&&e.current.details.live&&e.current.alwaysRetryLiveLevel||(t.fatal=!0),e._observer.trigger(r.default.ERROR,t)}))},m.destroy=function(){this._playlistLoader&&(this._playlistLoader.removeAllListeners(),this._playlistLoader.destroy(),this._playlistLoader=void 0),this._clearLevelTimer(),this._main&&(this._main.destroy(),this._main=void 0),this._abr&&(this._abr.removeAllListeners(),this._abr.destory(),this._abr=void 0),clearTimeout(this._levelLoadDelayTimer)},m.loadSource=function(){if(this._protocol!==s.Protocol.KWAI_HLS)this._playlistLoader&&this._playlistLoader.load({url:this._config.src,type:c.PlaylistContextType.MANIFEST,level:0,id:null,credentials:this._config.credentials});else{var e=d.default.parse(this._config.manifest);this._onManifestLoaded({levels:e,audioTracks:null})}},m.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._main&&this._main.setDownloadEnabled(e),this._abr&&this._abr.setDownloadEnabled(e)},m.seek=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),this._abr&&this._abr.onMessage(r.default.REPORT,{type:n.REPORT_TYPES.SEEK,isInBuffer:i}),this._main&&!i){var s=this._main.level;s&&s.details&&this._main&&!s.details.live?(this._main.seek(e,t),this._startTimeSec=-1):(this._startTimeSec=e,this._seekKeyframe=t)}},m.nextBackup=function(){return!(!this._main||!this._main.nextBackup(this._media.currentTime)||(this._main.setDownloadEnabled(!1),this._seekKeyframe=!1,this._loadLevel(this._main.index),0))},m.streamingMux=function(e){this._main&&this._main.streamingMux(e)},m.setAvailableAbrLevels=function(e){this._abr&&this._abr.setAvailableAbrLevels(e)},m.usePreload=function(){this._main&&this._main.usePreload(),this._preload=!1},m._onManifestLoaded=function(e){var t=this;u.Log.i(this.tag,"_onManifestLoaded",e);var n=[],l={},d=!1,c=!1,h=o.default.chrome||o.default.firefox;if(e.levels.forEach((function(e){d=d||!!e.videoCodec,c=c||!!e.audioCodec||!(!e.attrs||!e.attrs.AUDIO),h&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=""),t._config.audioCodec&&t._config.audioCodecSwap&&(e.audioCodec&&e.audioCodec!==t._config.audioCodec?-1!==e.audioCodec.indexOf("mp4a.40.5")?e.audioCodec="mp4a.40.2":e.audioCodec="mp4a.40.5":e.audioCodec=t._config.audioCodec),l[e.bitrate],e.url="string"==typeof e.url?[e.url]:e.url,e.urlId=0,l[e.bitrate]=e,n.push(e)})),d&&c&&(n=n.filter((function(e){return!!e.videoCodec}))),(n=n.filter((function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||(0,a.isCodecSupportedInMp4)(t))&&(!i||(0,a.isCodecSupportedInMp4)(i))}))).length>0){var _=0;n=this._sortLevels(n);for(var p=0;p<n.length;p++)for(var v=0;v<p;v++)if(n[v].bitrate===n[p].bitrate){n[p].bitrate=n[p].bitrate+p-v;break}this._levels=n,this._abr&&n.length>1&&!n[_].details&&(_=this._abr.init({levels:n,index:_})||0),this._main=new f.default(this._observer,this._media,this._config,n,_,this._preload),n[0].m3u8Slice&&(this._protocol=s.Protocol.KWAI_HLS_SLICE),this._observer.trigger(r.default.MANIFEST_PARSED,{}),this._manifestReady=!0,this._levels[this._main.index].details?this._levelUpdated():this._loadLevel(this._main.index)}else d||c?this._observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"no supported codec"}):this._observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.HLS_MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parsing error"})},m._onLevelLoaded=function(e){var t=this,i=e.level;if(this._main&&this._main.level&&i===this._main.index){var n=this._main.level,s=e.details;if(s.live){var o=n.details,a=(0,l.computeReloadInterval)(n.details,e.details,e.stats.trequest);o&&s.endSN!==o.endSN&&((0,l.mergeDetails)(o,s),n.details=s,this._levelUpdated()),u.Log.v("live playlist, reload in "+Math.round(a)+" ms"),this._timer=setTimeout((function(e){return t._loadLevel(e)}),a,this._main.index)}else this._clearLevelTimer(),n.details&&(0,l.mergeDetails)(n.details,s),n.details=s,n.live=n.details.live,this._levelUpdated();this._observer.trigger(r.default.LEVEL_LOADED,{bitrate:this._main.level.bitrate,duration:this._totalduration})}},m._levelUpdated=function(){if(this._startTimeSec>=0&&this.seek(this._startTimeSec,this._seekKeyframe),this._main&&this._main.level&&this._main.level.details){this._main.setDownloadEnabled(!0),this._totalduration=this._main.level.details.totalduration;var e=[];this._main.level.details.live||this._main.level.details.fragments.forEach((function(t){e.push(t.start)})),this._observer.trigger(r.default.LEVEL_UPDATED,{duration:this._totalduration,times:e,targetduration:this._main.level.details.targetduration}),this._main.levelUpdated()}},m._loadLevel=function(e){var t=this;if(this._levels){var i=this._levels[e];if(i.m3u8)return d.default.parseLevel(i,e),void this._levelUpdated();if(i.m3u8Slice&&this._startTimeSec<=0)return d.default.parseLevelSlice(i,e),this._levelUpdated(),void(this._levelLoadDelayTimer=setTimeout((function(){t._requestLevel(e),t._levelLoadDelayTimer=void 0}),200));this._requestLevel(e)}},m._requestLevel=function(e){if(this._levels){var t=this._levels[e];if(t&&"object"==typeof t&&t.url.length>0&&this._playlistLoader){var i=t.urlId,r=t.url[i];this._playlistLoader.load({url:r,type:c.PlaylistContextType.LEVEL,level:e,id:i,credentials:this._config.credentials})}}},m._clearLevelTimer=function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null)},m._initMultirate=function(){var e=this;this._config.adaptive&&!this._abr&&(this._abr=new t.default(this._config,this._media),this._abr.active(!0),this._abr.on(r.default.REPORT,(function(t,i){t===r.default.REPORT&&e._observer.trigger(r.default.REPORT,i)})),this._observer.on(r.default.ABR_NEXT,this._abrNext),this._observer.on(r.default.REPORT,(function(t,i){e._abr&&e._abr.onMessage(t,i)})),this._observer.on("mainNotify",(function(t){e._abr&&("ratechange"===t.type?e._abr.onRatechange(t.playbackRate):"waiting"===t.type&&e._abr.onWaiting())})))},m._checkNextLevel=function(e){this._main&&this._main.levels&&(!this._main.levels[e].details||this._main.levels[e].live)&&(this._main.setDownloadEnabled(!1),this._loadLevel(e))},m._abrActive=function(e){this._abr&&this._config.adaptive&&(e&&!this._abr.autoLevelEnabled&&this._observer.trigger(r.default.LEVEL_SWITCHING,{startSec:this._media.currentTime,level:-1,smooth:!0}),this._abr.active(e))},h=e,(_=[{key:"levels",get:function(){var e=[];return this._main&&this._main.levels.forEach((function(t){e.push({bandwidth:t.bitrate,bitrate:t.bitrate,width:t.width,height:t.height,qualityType:t.qualityType,qualityLabel:t.qualityLabel})})),e}},{key:"protocol",get:function(){return this._protocol}},{key:"isNetworkInUse",get:function(){return!!this._main&&this._main.isNetworkInUse}},{key:"autoLevelEnabled",get:function(){return!!this._abr&&!!this._abr.autoLevelEnabled}},{key:"current",get:function(){return!!this._main&&this._main.level}},{key:"currentLevel",get:function(){return this._main?this._main.index:0},set:function(e){e>=0?(this._abrActive(!1),this._main&&(e=Math.min(e,this._main.levels.length-1),this._main.index=e,this._manifestReady&&(this.seek(this._media.currentTime),this._checkNextLevel(e),this._observer.trigger(r.default.LEVEL_SWITCHING,{startSec:this._media.currentTime,level:e,smooth:!1})))):this._abrActive(!0)}},{key:"manualNextLevel",set:function(e){this._abrActive(e<0),this._manifestReady?this._main&&this._main.level.details&&e>=0&&(e=Math.min(e,this._main.levels.length-1),this._main.manualNext=e,this._checkNextLevel(e)):this.currentLevel=e}},{key:"nextLevel",get:function(){return this._main?this._main.next:0},set:function(e){this._main&&this._main.next!==e&&(this._main.next=e,this._checkNextLevel(e))}}])&&p(h.prototype,_),v&&p(h,v),e}();e.default=v})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/level-helper.ts":
/*!***************************************!*\
  !*** ./src/demux/hls/level-helper.ts ***!
  \***************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! ../../utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i){e.__esModule=!0,e.addGroupId=function(e,t,i){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(i);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(i)}},e.updatePTS=n,e.updateFragPTSDTS=s,e.mergeDetails=function(e,n){n.initSegment&&e.initSegment&&(n.initSegment=e.initSegment);var u,l=0;if(o(e,n,(function(e,i){l=e.cc-i.cc,(0,t.isFiniteNumber)(e.startPTS)&&(i.start=i.startPTS=e.startPTS,i.endPTS=e.endPTS,i.duration=e.duration,i.backtracked=e.backtracked,i.dropped=e.dropped,u=i),n.PTSKnown=!0})),n.PTSKnown){if(l){i.Log.v(r,"discontinuity sliding from playlist, take drift into account");for(var d=n.fragments,c=0;c<d.length;c++)d[c].cc+=l}u?s(n,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS):a(e,n),n.PTSKnown=e.PTSKnown}},e.mergeSubtitlePlaylists=function(e,t,i){void 0===i&&(i=0);var r=-1;o(e,t,(function(e,t,i){t.start=e.start,r=i}));var n=t.fragments;if(r<0)n.forEach((function(e){e.start+=i}));else for(var s=r+1;s<n.length;s++)n[s].start=n[s-1].start+n[s-1].duration},e.mapFragmentIntersection=o,e.adjustSliding=a,e.computeReloadInterval=function(e,t,i){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),n=r/2;return e&&t.endSN===e.endSN&&(r=n),i&&(r=Math.max(n,r-(window.performance.now()-i))),Math.round(r)};var r="LevelHelper";function n(e,n,s){var o=e[n],a=e[s],u=a.startPTS;(0,t.isFiniteNumber)(u)?s>n?(o.duration=u-o.start,o.duration<0&&i.Log.w(r,"negative duration computed for frag "+o.sn+",level "+o.level+", there should be some duration drift between playlist and fragment!")):(a.duration=o.start-u,a.duration<0&&i.Log.w(r,"negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):a.start=s>n?o.start+o.duration:Math.max(o.start-a.duration,0)}function s(e,i,r,s,o,a){var u=r;if((0,t.isFiniteNumber)(i.startPTS)){var l=Math.abs(i.startPTS-r);(0,t.isFiniteNumber)(i.deltaPTS)?i.deltaPTS=Math.max(l,i.deltaPTS):i.deltaPTS=l,u=Math.max(r,i.startPTS),r=Math.min(r,i.startPTS),s=Math.max(s,i.endPTS),o=Math.min(o,i.startDTS),a=Math.max(a,i.endDTS)}var d=r-i.start;i.start=i.startPTS=r,i.maxStartPTS=u,i.endPTS=s,i.startDTS=o,i.endDTS=a,i.duration=s-r;var c,f=i.sn;if(!e||f<e.startSN||f>e.endSN||"number"!=typeof f)return 0;var h=f-e.startSN,_=e.fragments;for(_[h]=i,c=h;c>0;c--)n(_,c,c-1);for(c=h;c<_.length-1;c++)n(_,c,c+1);return e.PTSKnown=!0,d}function o(e,t,i){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,s=t.startSN-e.startSN,o=r;o<=n;o++){var a=e.fragments[s+o],u=t.fragments[o];if(!a||!u)break;i(a,u,o)}}function a(e,t){var i=t.startSN-e.startSN,r=e.fragments,n=t.fragments;if(!(i<0||i>r.length))for(var s=0;s<n.length;s++)n[s].start+=r[i].start}})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/loader/fragment.ts":
/*!******************************************!*\
  !*** ./src/demux/hls/loader/fragment.ts ***!
  \******************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),i(/*! ./level-key */"./src/demux/hls/loader/level-key.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r){function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s,o;e.__esModule=!0,e.default=e.ElementaryStreamTypes=void 0,r=(o=r)&&o.__esModule?o:{default:o},e.ElementaryStreamTypes=s,function(e){e.AUDIO="audio",e.VIDEO="video"}(s||(e.ElementaryStreamTypes=s={}));var a=function(){function e(){var e;this._url="",this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[s.AUDIO]=!1,e[s.VIDEO]=!1,e),this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.sn=0,this.levelkey=void 0,this.level=0,this.start=0,this.cc=0,this.maxStartPTS=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.deltaPTS=void 0,this.dropped=void 0,this.backtracked=void 0,this.type=void 0,this.loader=void 0,this.title=null,this.urlId=void 0}var o,a,u,l=e.prototype;return l.setByteRange=function(e,t){var i=e.split("@",2),r=[];1===i.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(i[1],10),r[1]=parseInt(i[0],10)+r[0],this._byteRange=r},l.addElementaryStream=function(e){this._elementaryStreams[e]=!0},l.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},l.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},l.setDecryptDataFromLevelKey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new r.default(e.baseuri,e.reluri)).method=e.method,i.iv=this.createInitializationVector(t)),i},o=e,(a=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=(0,i.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!(0,t.isFiniteNumber)(this.programDateTime))return null;var e=(0,t.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&n(o.prototype,a),u&&n(o,u),e}();e.default=a})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/loader/key-loader.ts":
/*!********************************************!*\
  !*** ./src/demux/hls/loader/key-loader.ts ***!
  \********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../../../core/observer */"./src/core/observer.ts"),i(/*! ../../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../../../utils/log */"./src/utils/log.ts"),i(/*! ../../../io/loader */"./src/io/loader.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s){function o(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,t=o(t),i=o(i),s=o(s);var a=function(e){var t,o;function a(t,i){var r;return(r=e.call(this)||this)._loaders=void 0,r._config=void 0,r._loaderConfig=void 0,r._decryptkey=void 0,r._decrypturl=void 0,r._config=t,r._loaderConfig=i,r._loaders={},r._decryptkey=null,r._decrypturl=null,r}o=e,(t=a).prototype=Object.create(o.prototype),t.prototype.constructor=t,t.__proto__=o;var u=a.prototype;return u.destroy=function(){for(var e in this._loaders){var t=this._loaders[e];t&&t.destroy()}this._loaders={}},u.load=function(e){var t=e.type,r=this._loaders[t],o=e.decryptdata,a=null;if(o&&(a=o.uri),!a||a===this._decrypturl&&null!==this._decryptkey)this._decryptkey&&(o&&(o.key=this._decryptkey),this.emit(i.default.HLS_KEY_LOADED,{frag:e}));else{var u=this._loaderConfig;r&&(n.Log.w("KeyLoader","abort previous key loader for type:"+t),r.abort()),e.loader=this._loaders[t]=new s.default,this._decrypturl=a,this._decryptkey=null;var l={url:a,frag:e,responseType:"arraybuffer",credentials:this._config.credentials},d=u,c={onEnd:this.loadEnd.bind(this),onError:this.loadError.bind(this),onAbort:function(){}};e.loader.load(l,c,d)}},u.loadEnd=function(e,t,n){if(t&&t instanceof ArrayBuffer){var s=e.frag;this._decryptkey=s.decryptdata.key=new Uint8Array(t),this._loaders[s.type]=null,this.emit(i.default.HLS_KEY_LOADED,{frag:s})}else this.emit(i.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.HLS_KEY_LOAD_ERROR,fatal:!0,reason:"key empty",statusCode:n.code})},u.loadError=function(e,t){var n=e.frag.loader;t.fatal&&(n&&n.abort(),this._loaders[e.frag.type]=null,this.emit(i.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.HLS_KEY_LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code}))},a}(t.default);e.default=a})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/loader/kwai-hls.ts":
/*!******************************************!*\
  !*** ./src/demux/hls/loader/kwai-hls.ts ***!
  \******************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./level */"./src/demux/hls/loader/level.ts"),i(/*! ./m3u8-parser */"./src/demux/hls/loader/m3u8-parser.ts"),i(/*! ./playlist-loader */"./src/demux/hls/loader/playlist-loader.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r){function n(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,t=n(t),i=n(i);var s=function(){function e(){}return e.parse=function(r){var n=[];return e.verify(r)&&r.adaptationSet.representation.forEach((function(e){if(e&&(e.url||e.m3u8)){var r=new t.default(e.url||e.baseUrl);r.url=e.baseUrl?i.default.resolve(e.url,e.baseUrl):e.url,r.bitrate=e.bandwidth,r.bandwidth=e.bandwidth,r.averageBandwidth=e.averageBandwidth,r.bitrate=r.averageBandwidth||r.bandwidth,r.qualityType=e.qualityType,r.qualityLabel=e.qualityLabel,e.width&&e.height&&(r.width=e.width,r.height=e.height),i.default.setCodecs([].concat((e.codecs||"").split(/[ ,]+/)),r),r.audioCodec="",r.m3u8=e.m3u8,r.m3u8Slice=e.m3u8Slice,r.totalduration=e.duration,e.backupUrl&&e.backupUrl.length&&(r.url=[r.url].concat(e.backupUrl)),r.urlId=0,n.push(r)}})),n},e.parseLevel=function(e,t){if(e.m3u8){var n=i.default.parseLevelPlaylist(e.m3u8,e.url[0],t,r.PlaylistLevelType.MAIN,0);return delete e.m3u8,e.details=n,!0}return!1},e.parseLevelSlice=function(e,t){if(e.m3u8Slice){var n=i.default.parseLevelPlaylist(e.m3u8Slice,e.url[0],t,r.PlaylistLevelType.MAIN,0);return delete e.m3u8Slice,e.details=n,e.alwaysRetryLiveLevel=!1,e.live=!0,n.totalduration=e.totalduration,!0}return!1},e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.representation&&e.adaptationSet.representation.length)},e}();e.default=s})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/loader/level-key.ts":
/*!*******************************************!*\
  !*** ./src/demux/hls/loader/level-key.ts ***!
  \*******************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js")],void 0===(s="function"==typeof(r=function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0;var r=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=void 0,this.baseuri=e,this.reluri=t}var r,n,s;return r=e,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=(0,t.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&i(r.prototype,n),s&&i(r,s),e}();e.default=r})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/loader/level.ts":
/*!***************************************!*\
  !*** ./src/demux/hls/loader/level.ts ***!
  \***************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js")],void 0===(s="function"==typeof(r=function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0;var r=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url="",this.urlId=0,this.version=null,this.details=null,this.PTSKnown=!1,this.m3u8=void 0,this.m3u8Slice=void 0,this.width=void 0,this.height=void 0,this.bitrate=0,this.bandwidth=0,this.averageBandwidth=0,this.alwaysRetryLiveLevel=!0,this.audioGroupIds=void 0,this.textGroupIds=void 0,this.audioCodec="",this.videoCodec="",this.attrs=void 0,this.averagetargetduration=void 0,this.unknownCodecs=void 0,this.name=void 0,this.qualityType=void 0,this.qualityLabel=void 0,this.url=e}var r,n,s;return r=e,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||"number"!=typeof this.fragments[0].programDateTime||!(0,t.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&i(r.prototype,n),s&&i(r,s),e}();e.default=r})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/loader/m3u8-parser.ts":
/*!*********************************************!*\
  !*** ./src/demux/hls/loader/m3u8-parser.ts ***!
  \*********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),i(/*! ./fragment */"./src/demux/hls/loader/fragment.ts"),i(/*! ./level */"./src/demux/hls/loader/level.ts"),i(/*! ./level-key */"./src/demux/hls/loader/level-key.ts"),i(/*! ../../../utils/attr-list */"./src/utils/attr-list.js"),i(/*! ../../../utils/log */"./src/utils/log.ts"),i(/*! ../../../utils/codecs */"./src/utils/codecs.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u){function l(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,r=l(r),n=l(n),s=l(s),o=l(o);var d=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,c=/#EXT-X-MEDIA:(.*)/g,f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),h=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,_=/\.(mp4|m4s|m4v|m4a)$/i;function p(e,i){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):i&&i.programDateTime&&(e.programDateTime=i.endProgramDateTime),"number"==typeof e.programDateTime&&(0,t.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var v=function(){function e(){}return e.findGroup=function(e,t){if(!e)return null;for(var i=null,r=0;r<e.length;r++){var n=e[r];n.id===t&&(i=n)}return i},e.convertAVC1ToAVCOTI=function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift(),10).toString(16),t+=("000"+parseInt(i.shift(),10).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return(0,i.buildAbsoluteURL)(t,e,{alwaysNormalize:!0})},e.setCodecs=function(e,t){["video","audio"].forEach((function(i){var r=e.filter((function(e){return(0,u.isCodecType)(e,i)}));if(r.length){var n=r.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[i+"Codec"]=n.length>0?n[0]:r[0],e=e.filter((function(e){return-1===r.indexOf(e)}))}})),t.unknownCodecs=e},e.parseMasterPlaylist=function(t,i){var r,s=[];for(d.lastIndex=0;null!==(r=d.exec(t));){var a=new n.default(i),u=a.attrs=new o.default(r[1]);a.url=e.resolve(r[2],i);var l=u.decimalResolution("RESOLUTION");l&&(a.width=l.width,a.height=l.height),a.bandwidth=u.decimalInteger("BANDWIDTH"),a.averageBandwidth=u.decimalInteger("AVERAGE-BANDWIDTH"),a.bitrate=a.averageBandwidth||a.bandwidth,a.name=u.NAME,e.setCodecs([].concat((u.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),s.push(a)}return s},e.parseMasterPlaylistMedia=function(t,i,r,n){var s;void 0===n&&(n=[]);var a=[],u=0;for(c.lastIndex=0;null!==(s=c.exec(t));){var l={},d=new o.default(s[1]);if(d.TYPE===r){if(l.groupId=d["GROUP-ID"],l.name=d.NAME,l.type=r,l.default="YES"===d.DEFAULT,l.autoselect="YES"===d.AUTOSELECT,l.forced="YES"===d.FORCED,d.URI&&(l.url=e.resolve(d.URI,i)),l.lang=d.LANGUAGE,l.name||(l.name=l.lang),n.length){var f=e.findGroup(n,l.groupId);l.audioCodec=f?f.codec:n[0].codec}l.id=u++,a.push(l)}}return a},e.parseLevelPlaylist=function(e,i,u,l,d){var c,v,m,g=0,y=0,b=0,E=null,T=new r.default,S=null,w=new n.default(i);for(f.lastIndex=0;null!==(v=f.exec(e));){var R=v[1];if(R){T.duration=parseFloat(R);var x=(" "+v[2]).slice(1);T.title=x||null,T.tagList.push(x?["INF",R,x]:["INF",R])}else if(v[3]){if((0,t.isFiniteNumber)(T.duration)){var L=g++;T.type=l,T.start=y,T.levelkey=c,T.sn=L,T.level=u,T.cc=b,T.urlId=d,T.baseurl=i,T.relurl=(" "+v[3]).slice(1),p(T,E),w.fragments.push(T),E=T,y+=T.duration,T=new r.default}}else if(v[4]){var k=(" "+v[4]).slice(1);E?T.setByteRange(k,E):T.setByteRange(k)}else if(v[5])T.rawProgramDateTime=(" "+v[5]).slice(1),T.tagList.push(["PROGRAM-DATE-TIME",T.rawProgramDateTime]),null===S&&(S=w.fragments.length);else{if(!(v=v[0].match(h))||v.length<=0)break;for(m=1;m<v.length&&void 0===v[m];m++);var A=(" "+v[m+1]).slice(1),O=(" "+v[m+2]).slice(1);switch(v[m]){case"#":T.tagList.push(O?[A,O]:[A]);break;case"PLAYLIST-TYPE":w.type=A.toUpperCase();break;case"MEDIA-SEQUENCE":g=w.startSN=parseInt(A,10);break;case"TARGETDURATION":w.targetduration=parseFloat(A);break;case"VERSION":w.version=parseInt(A,10);break;case"EXTM3U":break;case"ENDLIST":w.live=!1;break;case"DIS":b++,T.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":b=parseInt(A,10);break;case"KEY":var P=A,D=new o.default(P),I=D.enumeratedString("METHOD"),M=D.URI,C=D.hexadecimalInteger("IV");I&&(c=new s.default(i,M),M&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(I)>=0&&(c.method=I,c.key=null,c.iv=C));break;case"START":var N=new o.default(A).decimalFloatingPoint("TIME-OFFSET");(0,t.isFiniteNumber)(N)&&(w.startTimeOffset=N);break;case"MAP":var F=new o.default(A);T.relurl=F.URI,F.BYTERANGE&&T.setByteRange(F.BYTERANGE),T.baseurl=i,T.level=u,T.type=l,T.sn="initSegment",w.initSegment=T,(T=new r.default).rawProgramDateTime=w.initSegment.rawProgramDateTime;break;default:a.Log.w("line parsed but not handled: "+v)}}}return(T=E)&&!T.relurl&&(w.fragments.pop(),y-=T.duration),w.totalduration=y,w.averagetargetduration=y/w.fragments.length,w.endSN=g-1,w.startCC=w.fragments[0]?w.fragments[0].cc:0,w.endCC=b,!w.initSegment&&w.fragments.length&&w.fragments.every((function(e){return _.test(e.relurl)}))&&(a.Log.w("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(T=new r.default).relurl=w.fragments[0].relurl,T.baseurl=i,T.level=u,T.type=l,T.sn="initSegment",w.initSegment=T,w.needSidxRanges=!0),S&&function(e,t){for(var i=e[t],r=t-1;r>=0;r--){var n=e[r];i.programDateTime&&(n.programDateTime=i.programDateTime-1e3*n.duration),i=n}}(w.fragments,S),w},e}();e.default=v})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/loader/playlist-loader.ts":
/*!*************************************************!*\
  !*** ./src/demux/hls/loader/playlist-loader.ts ***!
  \*************************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! ../../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../../../utils/log */"./src/utils/log.ts"),i(/*! ./m3u8-parser */"./src/demux/hls/loader/m3u8-parser.ts"),i(/*! ../../../utils/download-info */"./src/utils/download-info.ts"),i(/*! ../../../io/loader */"./src/io/loader.ts"),i(/*! ../../../core/observer */"./src/core/observer.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u){function l(e){return e&&e.__esModule?e:{default:e}}var d,c;e.__esModule=!0,e.default=e.PlaylistLevelType=e.PlaylistContextType=void 0,i=l(i),s=l(s),a=l(a),u=l(u),e.PlaylistContextType=d,function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack"}(d||(e.PlaylistContextType=d={})),e.PlaylistLevelType=c,function(e){e.MAIN="main",e.AUDIO="audio"}(c||(e.PlaylistLevelType=c={}));var f=function(e){var u,l;function f(t){var i;return(i=e.call(this)||this).loaders={},i.tag="PlaylistLoader",i._config=void 0,i._config=t,i.loaders={},i}l=e,(u=f).prototype=Object.create(l.prototype),u.prototype.constructor=u,u.__proto__=l,f.canHaveQualityLevels=function(e){return e!==d.AUDIO_TRACK},f.mapContextToLevelType=function(e){switch(e.type){case d.AUDIO_TRACK:return c.AUDIO;default:return c.MAIN}},f.getResponseUrl=function(e){var t=e.responseUrl;return t&&0!==t.indexOf("data:")||(t=e.url),t};var h=f.prototype;return h.createInternalLoader=function(e){var t=new a.default;return e.loader=t,this.loaders[e.type]=t,t},h.getInternalLoader=function(e){return this.loaders[e.type]},h.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},h.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},h.destroy=function(){this.destroyInternalLoaders()},h.load=function(e){n.Log.d(this.tag,"Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var t,i,r,s,o=this.getInternalLoader(e);if(o){var a=o.context;if(a&&a.url===e.url)return n.Log.i(this.tag,"playlist request ongoing"),!1;n.Log.w(this.tag,"aborting previous loader for type: "+e.type),o.abort()}switch(e.type){case d.MANIFEST:t=this._config.manifestLoadingMaxRetry,i=this._config.manifestConnectionTimeout,r=this._config.manifestTransmissionTimeout,s=this._config.manifestLoadingRetryDelay;break;default:t=this._config.levelLoadingMaxRetry,i=this._config.levelConnectionTimeout,r=this._config.levelTransmissionTimeout,s=this._config.levelLoadingRetryDelay}o=this.createInternalLoader(e),e.responseType=e.responseType||"text";var u={connectionTimeout:i,transmissionTimeout:r,maxRetry:t,retryDelay:s},l={onEnd:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onAbort:this.loadAbort.bind(this)};return n.Log.d(this.tag,"Calling internal loader delegate for URL: "+e.url),o.load(e,l,u),!0},h.loadsuccess=function(e,t,n){if(this.emit(i.default.REPORT,(0,o.downloadInfo)(o.DownloadStatus.SUCCESS,e,n)),e.isSidxRequest)this.emit(i.default.ERROR,{type:r.ErrorTypes.OTHER_ERROR,details:r.ErrorDetails.UNSUPPORTED,fatal:!0,url:e.url,reason:"unsupport sidx",statusCode:n.code});else if(this.resetInternalLoader(e.type),"string"==typeof t){var s=t;if(0!==s.indexOf("#EXTM3U")){var a=s;return a.length>4096&&(a=a.slice(0,4096)),void this._handleManifestParsingError(e,a,n)}s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n):this._handleMasterPlaylist(e,t,n)}else this.emit(i.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.HLS_MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:'expected responseType of "text" for PlaylistLoader',statusCode:n.code})},h.loaderror=function(e,t){this._handleNetworkError(e,t)},h.loadAbort=function(e,t){this.emit(i.default.REPORT,(0,o.downloadInfo)(o.DownloadStatus.ABORT,e,t))},h._handleMasterPlaylist=function(e,t,r){var o=t,a=f.getResponseUrl(e),u=s.default.parseMasterPlaylist(o,a);if(u.length){var l=u.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),d=s.default.parseMasterPlaylistMedia(o,a,"AUDIO",l);if(d.length){var c=!1;d.forEach((function(e){e.url||(c=!0)})),!1===c&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(n.Log.v(this.tag,"audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main"}))}this.emit(i.default.HLS_MANIFEST_LOADED,{levels:u,audioTracks:d,url:a,stats:r})}else this._handleManifestParsingError(e,"no level found in manifest",r)},h._handleTrackOrLevelPlaylist=function(e,r,n){var o=e.id,a=e.level,u=e.type,l=f.getResponseUrl(e),c=(0,t.isFiniteNumber)(o)?o:0,h=(0,t.isFiniteNumber)(a)?a:c,_=f.mapContextToLevelType(e),p=s.default.parseLevelPlaylist(r,l,h,_,c);if(u===d.MANIFEST){var v={url:l,details:p};this.emit(i.default.HLS_MANIFEST_LOADED,{levels:[v],singleLevel:!0,url:l,stats:n})}if(p.needSidxRanges&&p.initSegment){var m=p.initSegment.url;this.load({url:m,isSidxRequest:!0,type:u,level:a,levelDetails:p,id:o,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else e.levelDetails=p,this._handlePlaylistLoaded(e,n)},h._handleManifestParsingError=function(e,t,n){this.emit(i.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.HLS_MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:t,statusCode:n.code})},h._handleNetworkError=function(e,t){var s,a;n.Log.i(this.tag,"A network error occured while loading a "+e.type+"-type playlist");var u=this.getInternalLoader(e);switch(e.type){case d.MANIFEST:s=r.ErrorDetails.HLS_MANIFEST_LOAD_ERROR,a=!0;break;case d.LEVEL:s=r.ErrorDetails.HLS_LEVEL_LOAD_ERROR,a=!1;break;case d.AUDIO_TRACK:s=r.ErrorDetails.HLS_AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}this.emit(i.default.REPORT,(0,o.downloadInfo)(o.DownloadStatus.FAIL,e,t)),t.fatal&&(u&&(u.abort(),this.resetInternalLoader(e.type)),this.emit(i.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:s,fatal:a,url:e.url,reason:t.text,statusCode:t.code}))},h._handlePlaylistLoaded=function(e,t){var r=e.type,n=e.level,s=e.id,o=e.levelDetails;if(o&&o.targetduration)if(f.canHaveQualityLevels(e.type))this.emit(i.default.LEVEL_LOADED,{details:o,level:n||0,id:s||0,stats:t});else switch(r){case d.AUDIO_TRACK:this.emit(i.default.AUDIO_TRACK_LOADED,{details:o,id:s,stats:t})}else this._handleManifestParsingError(e,"invalid target duration",t)},f}(u.default);e.default=f})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/main-stream.ts":
/*!**************************************!*\
  !*** ./src/demux/hls/main-stream.ts ***!
  \**************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./base-stream */"./src/demux/hls/base-stream.ts"),i(/*! ./loader/playlist-loader */"./src/demux/hls/loader/playlist-loader.ts")],void 0===(s="function"==typeof(r=function(e,t,i){e.__esModule=!0,e.default=void 0;var r,n=function(e){var t,r;function n(t,r,n,s,o,a){return void 0===a&&(a=!1),e.call(this,i.PlaylistLevelType.MAIN,t,r,n,s,o,a)||this}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}((r=t,t=r&&r.__esModule?r:{default:r}).default);e.default=n})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/sample-aes.ts":
/*!*************************************!*\
  !*** ./src/demux/hls/sample-aes.ts ***!
  \*************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./crypt/decrypter */"./src/demux/hls/crypt/decrypter.ts")],void 0===(s="function"==typeof(r=function(e,t){var i;e.__esModule=!0,e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};var r=function(){function e(e,i,r,n){this._decrypter=void 0,this._decryptdata=void 0,this._discardEPB=void 0,this._decryptdata=r,this._discardEPB=n,this._decrypter=new t.default(e,i,{removePKCS7Padding:!1})}var i=e.prototype;return i.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var r=this._decrypter.isSync();if(this._decryptAacSample(e,t,i,r),!r)return}}},i.decryptAvcSamples=function(e,t,i,r){for(;;t++,i=0){if(t>=e.length)return void r();for(var n=e[t].units;!(i>=n.length);i++){var s=n[i];if(!(s.length<=48||1!==s.type&&5!==s.type)){var o=this._decrypter.isSync();if(this._decryptAvcSample(e,t,i,r,s,o),!o)return}}}},i._decryptBuffer=function(e,t){this._decryptdata.key&&this._decrypter.decrypt(e,this._decryptdata.key.buffer,this._decryptdata.iv.buffer,t)},i._decryptAacSample=function(e,t,i,r){var n=e[t].unit,s=n.subarray(16,n.length-n.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),a=this;this._decryptBuffer(o,(function(s){s=new Uint8Array(s),n.set(s,16),r||a.decryptAacSamples(e,t+1,i)}))},i._getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Uint8Array(t),r=0,n=32;n<=e.length-16;n+=160,r+=16)i.set(e.subarray(n,n+16),r);return i},i._getAvcDecryptedUnit=function(e,t){for(var i=new Uint8Array(t),r=0,n=32;n<=e.length-16;n+=160,r+=16)e.set(i.subarray(r,r+16),n);return e},i._decryptAvcSample=function(e,t,i,r,n,s){var o=this._discardEPB(n.data),a=this._getAvcEncryptedData(o),u=this;this._decryptBuffer(a.buffer,(function(a){n.data=u._getAvcDecryptedUnit(o,a),s||u.decryptAvcSamples(e,t,i+1,r)}))},e}();e.default=r})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/hls/tsdemuxer.ts":
/*!************************************!*\
  !*** ./src/demux/hls/tsdemuxer.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! ../adts */"./src/demux/adts.ts"),i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../../core/report-types */"./src/core/report-types.ts"),i(/*! ../exp-golomb */"./src/demux/exp-golomb.ts"),i(/*! ../sps-parser */"./src/demux/sps-parser.ts"),i(/*! ../../utils/log */"./src/utils/log.ts"),i(/*! ../../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ./sample-aes */"./src/demux/hls/sample-aes.ts"),i(/*! ../../types/remux */"./src/types/remux.ts"),i(/*! ../../remux/aac-helper */"./src/remux/aac-helper.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u,l,d,c){function f(e){return e&&e.__esModule?e:{default:e}}function h(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return h=function(){return e},e}e.__esModule=!0,e.default=void 0,i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=h();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(i),r=f(r),s=f(s),o=f(o),l=f(l),c=f(c);var _=function(){function e(e,t,i,r){this._observer=void 0,this._config=void 0,this._typeSupported=void 0,this._remuxer=void 0,this._sampleAes=void 0,this._remuxStat=void 0,this._pmtParsed=!1,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._audioCodec="",this._videoCodec="",this._duration=0,this._vLastDts=0,this._lastDts=0,this._aLastDts=0,this._aacOverFlow=null,this._aacLastPTS=null,this._avcSample=null,this._stashSec=0,this._contiguous=!1,this._timeOffset=0,this._accurateTimeOffset=!1,this._spsUpdated=!1,this._firstNalTypes=0,this._extra=void 0,this._audioNonMonotonous=0,this._qos={vMaxDtsDiff:0,aMaxDtsDiff:0,aacOverhead:0,unknownTSPacketCount:0},this._observer=e,this._config=i,this._typeSupported=r,this._remuxer=t,this._sampleAes=null,this._remuxStat=null}var f=e.prototype;return f.setStat=function(e){e&&(this._pmtParsed=e.pmtParsed,this._pmtId=e.pmtId,this._audioCodec=e.audioCodec,this._videoCodec=e.videoCodec,this._duration=e.duration,this._vLastDts=e.vLastDts,this._lastDts=e.lastDts,this._aLastDts=e.aLastDts,this._aacLastPTS=e.aacLastPTS,this._firstNalTypes=e.firstNalTypes,this._audioNonMonotonous=e.audioNonMonotonous,this._qos=e.qos,this._avcTrack.pid=e.avc.pid,this._avcTrack.sequenceNumber=e.avc.sequenceNumber,this._avcTrack.timescale=e.avc.timescale,this._avcTrack.width=e.avc.width,this._avcTrack.height=e.avc.height,this._avcTrack.codec=e.avc.codec,this._audioTrack.pid=e.audio.pid,this._audioTrack.sequenceNumber=e.audio.sequenceNumber,this._audioTrack.config=e.audio.config,this._audioTrack.samplerate=e.audio.samplerate,this._audioTrack.timescale=e.audio.timescale,this._audioTrack.channelCount=e.audio.channelCount,this._audioTrack.codec=e.audio.codec,this._audioTrack.manifestCodec=e.audio.manifestCodec)},f.getStat=function(){return{pmtParsed:this._pmtParsed,pmtId:this._pmtId,audioCodec:this._audioCodec,videoCodec:this._videoCodec,duration:this._duration,vLastDts:this._vLastDts,lastDts:this._lastDts,aLastDts:this._aLastDts,aacLastPTS:this._aacLastPTS,firstNalTypes:this._firstNalTypes,audioNonMonotonous:this._audioNonMonotonous,qos:(0,t.ObjectAssign)({},this._qos),avc:{pid:this._avcTrack.pid,sequenceNumber:this._avcTrack.sequenceNumber,timescale:this._avcTrack.timescale,width:this._avcTrack.width,height:this._avcTrack.height,codec:this._avcTrack.codec},audio:{pid:this._audioTrack.pid,sequenceNumber:this._audioTrack.sequenceNumber,config:this._audioTrack.config,samplerate:this._audioTrack.samplerate,timescale:this._audioTrack.timescale,channelCount:this._audioTrack.channelCount,codec:this._audioTrack.codec,manifestCodec:this._audioTrack.manifestCodec}}},f.setDecryptData=function(e){e&&e.key&&"SAMPLE-AES"===e.method?this._sampleAes=new l.default(this._observer,this._config,e,this.discardEPB):this._sampleAes=null},e.probe=function(t){var i=e._syncOffset(t);return!(i<0||(i&&a.Log.w("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){var i={type:e,id:d.RemuxerTrackIdConfig[e],pid:-1,inputTimeScale:9e4,timescale:0,codec:"",sequenceNumber:0,samples:[],container:"video/mp2t",duration:t};if(e===d.TrackType.audio){var r=i;return r.isAAC=!0,r}return i},f.resetInitSegment=function(t,i,r,n){this._pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack(d.TrackType.video,n),this._audioTrack=e.createTrack(d.TrackType.audio,n),this._aacOverFlow=null,this._aacLastPTS=null,this._avcSample=null,this._audioCodec=i,this._videoCodec=r,this._duration=n,this._vLastDts=0,this._aLastDts=0,this._audioNonMonotonous=0,this._qos.vMaxDtsDiff=0,this._qos.aMaxDtsDiff=0,this._qos.aacOverhead=0},f.resetTimeStamp=function(){},f.append=function(t,i,n,s,o){void 0===o&&(o=!1),this._contiguous=n,this._timeOffset=i,this._accurateTimeOffset=s,null===this._remuxStat&&(this._remuxStat={timeOffset:i,contiguous:n,accurateTimeOffset:s});var a,l,d,c,f,h=this._remuxStat,_=this._avcTrack,p=this._audioTrack,v=this._parsePAT,m=this._parsePMT,g=this._parsePES,y=this._parseAVCPES.bind(this),b=this._parseAACPES.bind(this),E=this._parseMPEGPES.bind(this),T=t.length,S=!1,w=this._pmtParsed,R=_.pid,x=p.pid,L=this._pmtId,k=_.pesData,A=p.pesData,O=e._syncOffset(t);for(T-=(T+O)%188,a=O;a<T;a+=188)if(71===t[a]){if(l=!!(64&t[a+1]),d=((31&t[a+1])<<8)+t[a+2],(48&t[a+3])>>4>1){if((c=a+5+t[a+4])===a+188)continue}else c=a+4;switch(d){case R:l&&(k&&(f=g(k,!0))&&void 0!==f.pts&&y(f,!1),k={data:[],size:0}),k&&(k.data.push(t.subarray(c,a+188)),k.size+=a+188-c);break;case x:l&&(A&&(f=g(A))&&void 0!==f.pts&&(p.isAAC?b(f):E()),A={data:[],size:0}),A&&(A.data.push(t.subarray(c,a+188)),A.size+=a+188-c);break;case 0:l&&(c+=t[c]+1),L=this._pmtId=v(t,c);break;case L:l&&(c+=t[c]+1);var P=m(t,c,!0===this._typeSupported.mpeg||!0===this._typeSupported.mp3,null!==this._sampleAes);(R=P.avc)>0&&(_.pid=R),(x=P.audio)>0&&(p.pid=x,p.isAAC=P.isAAC),S&&!w&&(S=!1),w=this._pmtParsed=!0;break;case 17:case 8191:break;default:this._qos.unknownTSPacketCount++,S=!0}}else this._observer.trigger(r.default.ERROR,{type:u.ErrorTypes.MUX_ERROR,details:u.ErrorDetails.PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});k&&(f=g(k,o))&&void 0!==f.pts?(y(f,o),_.pesData=null):_.pesData=k,A&&(f=g(A))&&void 0!==f.pts?(p.isAAC?b(f):E(),p.pesData=null):(A&&A.size,p.pesData=A),(x>0&&0===p.samples.length||R>0&&0===_.samples.length||R<=0&&x<=0)&&!o||((o||!this._config.gopRemux&&this._isStashEnd())&&(this._remux(h.timeOffset,h.contiguous,h.accurateTimeOffset,o),this._remuxStat=null),o&&this._onParsed())},f._isStashEnd=function(){if(this._stashSec){var e=this._avcTrack.samples;return e.length>1&&this._stashSec<=(e[e.length-1].dts-e[0].dts)/this._avcTrack.inputTimeScale||e.length>=600}return!0},f._onParsed=function(){var e=(0,t.ObjectAssign)({extra:this._extra,audioNonMonotonous:this._audioNonMonotonous,fragStartWithNonIdr:5!==this._firstNalTypes},this._qos);this._observer.trigger(r.default.PARSED_DATA,e),this._qos.vMaxDtsDiff=0,this._qos.aMaxDtsDiff=0,this._firstNalTypes=0},f.flush=function(){var e,t=this._avcTrack,i=this._audioTrack,r=t.pesData,n=i.pesData,s=this._parsePES,o=this._parseAVCPES.bind(this),a=this._parseAACPES.bind(this);if(r&&(e=s(r,!0))&&void 0!==e.pts&&o(e,!0),t.pesData=null,n&&(e=s(n))&&void 0!==e.pts&&i.isAAC&&a(e),i.pesData=null,i.pid&&0===i.samples.length&&t.pid&&0===t.samples.length)this._remuxer.flush();else{var u=this._remuxStat;u?this._remux(u.timeOffset,u.contiguous,u.accurateTimeOffset,!0):this._remux(this._timeOffset,!0,this._accurateTimeOffset,!0),this._avcSample=null,this._remuxStat=null,this._firstNalTypes=0}},f._remux=function(e,t,s,o){void 0===o&&(o=!1);var a=this._audioTrack,u=this._avcTrack;0==u.samples.length&&0===a.samples.length||(this._config.ensureAudio&&(a.codec||i.initTrackConfig(a,this._observer,new Uint8Array([255,241,92,128,93]),0,this._audioCodec||(/firefox/.test(navigator.userAgent.toLowerCase())?"mp4a.40.2":"mp4a.40.5")),0===a.samples.length&&u.samples.length&&(a.samples=[{unit:c.default.getSilentFrame(a.codec,a.channelCount),pts:u.samples[0].dts,dts:u.samples[0].dts}])),this._stashSec=0,this._observer.trigger(r.default.REPORT,{type:n.REPORT_TYPES.MEDIA_DEMUX}),this._sampleAes?this.decryptAndRemux(a,u,e,t,s,o):this._remuxer.remux(a,u,e,t,s,o))},f.reset=function(e){void 0===e&&(e=0);var t=this._avcTrack,i=this._audioTrack;t.pesData=null,t.samples=[],t.audFound=!1,i.pesData=null,i.samples=[],this._aacOverFlow=null,this._avcSample=null,this._remuxStat=null,this._vLastDts=0,this._aLastDts=0,this._firstNalTypes=0,this._stashSec=e,this._aacLastPTS=null,this._audioNonMonotonous=0},f.setExtra=function(e){this._extra=e},f.decryptAndRemux=function(e,t,i,r,n,s){if(void 0===s&&(s=!1),e.samples&&e.isAAC&&this._sampleAes){var o=this;this._sampleAes.decryptAacSamples(e.samples,0,(function(){o.decryptAndRemuxAvc(e,t,i,r,n,s)}))}else this.decryptAndRemuxAvc(e,t,i,r,n,s)},f.decryptAndRemuxAvc=function(e,t,i,r,n,s){if(void 0===s&&(s=!1),t.samples&&this._sampleAes){var o=this;this._sampleAes.decryptAvcSamples(t.samples,0,0,(function(){o._remuxer.remux(e,t,i,r,n,s)}))}else this._remuxer.remux(e,t,i,r,n,s)},f.destroy=function(){this._duration=0},f._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},f._parsePMT=function(e,t,i,r){var n,s,o={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){switch(s=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){a.Log.v("unkown stream type:"+e[t]);break}case 15:-1===o.audio&&(o.audio=s);break;case 21:-1===o.id3&&(o.id3=s);break;case 219:if(!r){a.Log.v("unkown stream type:"+e[t]);break}case 27:-1===o.avc&&(o.avc=s);break;case 3:case 4:i?-1===o.audio&&(o.audio=s,o.isAAC=!1):a.Log.v("MPEG audio found, not supported in this browser for now");break;case 36:a.Log.w("HEVC stream type found, not supported for now");break;default:a.Log.v("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return o},f._parsePES=function(e,t){void 0===t&&(t=!1);var i,r,n,s,o,u,l=e.data,d=0,c=0,f=0;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;){var h=new Uint8Array(l[0].length+l[1].length);h.set(l[0]),h.set(l[1],l[0].length),l[0]=h,l.splice(1,1)}if(1===((i=l[0])[0]<<16)+(i[1]<<8)+i[2]){if((n=(i[4]<<8)+i[5])&&n>e.size-6)return null;if(0===n&&!t)return null;192&(r=i[7])&&((c=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)>4294967295&&(c-=8589934592),64&r?((f=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>4294967295&&(f-=8589934592),c-f>54e5&&(a.Log.w(Math.round((c-f)/9e4)+"s delta between PTS and DTS, align them"),c=f)):f=c),u=(s=i[8])+9,e.size-=u,o=new Uint8Array(e.size);for(var _=0,p=l.length;_<p;_++){var v=(i=l[_]).byteLength;if(u){if(u>v){u-=v;continue}i=i.subarray(u),v-=u,u=0}o.set(i,d),d+=v}return n&&(n-=s+3),{data:o,pts:c,dts:f,len:n}}return null},f.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,r=i.length;if(!this._config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this._contiguous)){if(this._isStashEnd()&&this._config.gopRemux&&e.key&&i&&i.length>1&&this._remuxStat){var n=this._remuxStat;this._remux(n.timeOffset,n.contiguous,n.accurateTimeOffset)}e.id=this._avcTrack.samples.length,this._avcTrack.samples.push(e)}else t.dropped++}e.debug.length&&a.Log.v(e.pts+"/"+e.dts+":"+e.debug)},f._parseAVCPES=function(e,t){var i=this;if(e.data){var r,n,a,u=this._avcTrack,l=this._parseAVCNALu(e.data),d=this.pushAccesUnit.bind(this),c=this,f=function(e,t,i,r){return i===c._lastDts&&(i+=1),c._lastDts=i,{key:e,pts:t,dts:i,units:[],debug:r}},h=this._avcSample,_=!1;if(this._vLastDts>0){var p=e.dts-this._vLastDts;Math.abs(p)>Math.abs(this._qos.vMaxDtsDiff)&&(this._qos.vMaxDtsDiff=p)}this._vLastDts=e.dts,e.data=null,h&&l.length&&!u.audFound&&(d(h,u),h=this._avcSample=f(!1,e.pts,e.dts,"")),l.forEach((function(t){switch(t.type){case 1:i._firstNalTypes||(i._firstNalTypes=t.type),n=!0,h||(h=i._avcSample=f(!0,e.pts,e.dts,"")),h.frame=!0;var l=t.data;if(_&&l.length>4){var c=new s.default(l).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(h.key=!0)}break;case 5:i._firstNalTypes||(i._firstNalTypes=t.type),n=!0,h||(h=i._avcSample=f(!0,e.pts,e.dts,"")),h.key=!0,h.frame=!0;break;case 6:n=!0,(r=new s.default(i.discardEPB(t.data))).readUByte();for(var p=0,v=0,m=!1,g=0;!m&&r.bytesAvailable>1;){p=0;do{p+=g=r.readUByte()}while(255===g);v=0;do{v+=g=r.readUByte()}while(255===g);if(4===p&&0!==r.bytesAvailable){if(m=!0,181===r.readUByte()&&49===r.readUShort()&&1195456820===r.readUInt()&&3===r.readUByte()){var y=r.readUByte(),b=31&y,E=[y,r.readUByte()];for(a=0;a<b;a++)E.push(r.readUByte()),E.push(r.readUByte()),E.push(r.readUByte())}}else if(v<r.bytesAvailable)for(a=0;a<v;a++)r.readUByte()}break;case 7:n=!0,_=!0;var T=t.data.subarray(1,4),S="avc1.";for(a=0;a<3;a++){var w=T[a].toString(16);w.length<2&&(w="0"+w),S+=w}var R=o.default.parseSPS(t.data);!u.width||u.width===R.codec_size.width&&u.height===R.codec_size.height&&S===u.codec||(i._spsUpdated=!0),u.width=R.codec_size.width,u.height=R.codec_size.height,u.pixelRatio=[R.sar_ratio.width,R.sar_ratio.height],u.sps=[t.data],u.duration=i._duration,u.fps=R.frame_rate.fps,u.profile=R.profile_string,u.level=R.level_string,u.chromaFormat=R.chroma_format_string,u.codec=S;break;case 8:n=!0,u.pps||(u.pps=[t.data]);break;case 9:n=!1,u.audFound=!0,h&&d(h,u),h=i._avcSample=f(!1,e.pts,e.dts,"");break;case 12:n=!1;break;default:n=!1,h&&(h.debug+="unknown NAL "+t.type+" ")}i._spsUpdated&&u.sps&&u.pps&&(i._remuxer.ISGenerated&&i._remuxer.resetInitSegment(),i._spsUpdated=!1),h&&n&&h.units.push(t)})),t&&h&&(d(h,u),this._avcSample=null)}},f._getLastNalUnit=function(){var e,t=this._avcSample;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e},f._parseAVCNALu=function(e){var t,i,r,n,s=this._avcTrack,o=e.byteLength,a=[],u=0,l=s.naluState||0,d=-1,c=l;for(-1===l&&(d=0,n=31&e[0],l=0,u=1);u<o;)if(t=e[u++],l)if(1!==l)if(t)if(1===t){if(d>=0)r={data:e.subarray(d,u-l-1),type:n},a.push(r);else{var f=this._getLastNalUnit();if(f&&(c&&u<=4-c&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-c)),(i=u-l-1)>0)){var h=new Uint8Array(f.data.byteLength+i);h.set(f.data,0),h.set(e.subarray(0,i),f.data.byteLength),f.data=h}}u<o?(d=u,n=31&e[u],l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;if(d>=0&&l>=0&&(r={data:e.subarray(d,o),type:n,state:l},a.push(r)),0===a.length){var _=this._getLastNalUnit();if(_){var p=new Uint8Array(_.data.byteLength+e.byteLength);p.set(_.data,0),p.set(e,_.data.byteLength),_.data=p}}return s.naluState=l,a},f.discardEPB=function(e){for(var t,i=e.byteLength,r=[],n=1,s=null;n<i-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;t=i-r.length,s=new Uint8Array(t);var o=0;for(n=0;n<t;o++,n++)o===r[0]&&(o++,r.shift()),s[n]=e[o];return s},f._parseMPEGPES=function(){this._observer.trigger(r.default.ERROR,{type:u.ErrorTypes.MUX_ERROR,details:u.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"unsupport mpeg"})},f._parseAACPES=function(e){if(e.data){var t,n,s,o,l,d,c=this._audioTrack,f=this._aacLastPTS,h=e.data,_=e.pts,p=this._aacOverFlow,v=null;if(this._aLastDts>0){var m=e.dts-this._aLastDts;Math.abs(m)>Math.abs(this._qos.aMaxDtsDiff)&&(this._qos.aMaxDtsDiff=m)}if(this._aLastDts=e.dts,p){var g=new Uint8Array(p.byteLength+h.byteLength);g.set(p,0),g.set(h,p.byteLength),h=g}for(s=0,o=h.length;s<o-1&&!i.isHeader(h,s);s++);if(s&&(s<o-1?(l="AAC PES did not start with ADTS header,offset:"+s,d=!1):(l="no ADTS header found in AAC PES",d=!0),a.Log.w("parsing error:"+l),this._observer.trigger(r.default.ERROR,{type:u.ErrorTypes.MUX_ERROR,details:u.ErrorDetails.PARSING_ERROR,fatal:d,reason:l}),d))return;if(i.initTrackConfig(c,this._observer,h,s,this._audioCodec),n=0,t=i.getFrameDuration(c.samplerate),f&&(this._audioNonMonotonous||(this._audioNonMonotonous=_<f?1:0),this._audioNonMonotonous||p)){var y=f+t;Math.abs(y-_)>1&&(a.Log.v("AAC: align PTS for overlapping frames by "+Math.round((y-_)/90)),_=y)}for(;s<o;)if(i.isHeader(h,s)&&s+5<o){var b=i.appendFrame(c,h,s,_,n);if(!b)break;s+=b.length,v=b.sample.pts,n++}else s++;n>1&&(this._qos.aacOverhead=1),p=s<o?h.subarray(s,o):null,this._aacOverFlow=p,this._aacLastPTS=v}},e}();e.default=_})?r.apply(t,n):r)||(e.exports=s)},"./src/demux/sps-parser.ts":
/*!*********************************!*\
  !*** ./src/demux/sps-parser.ts ***!
  \*********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./exp-golomb */"./src/demux/exp-golomb.ts")],void 0===(s="function"==typeof(r=function(e,t){var i;e.__esModule=!0,e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};var r={1:"Main",2:"Main 10",3:"Main Still Picture",4:"Rext"},n={30:1,60:2,63:2.1,90:3,93:3.1,120:4,123:4.1,150:5,153:5.1,156:5.2,180:6,183:6.1,186:6.2,255:8.5},s=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,s=0;s<i;s++)s>=2&&3===t[s]&&0===t[s-1]&&0===t[s-2]||(r[n]=t[s],n++);return new Uint8Array(r.buffer,0,n)},e.parseHEVCSPS=function(i){var r=e._ebsp2rbsp(i),n=new t.default(r),s={general_ptl:{},sub_layer_ptl:{}};n.readBits(16),n.readBits(4);var o=n.readBits(3)+1;if(n.readBits(1),!e._parsePTL(n,s,o))return null;if(n.readUEG()>=16)return null;var a=n.readUEG();3==a&&n.readBits(1)&&(a=0);var u=n.readUEG(),l=n.readUEG();return n.destroy(),n=null,{chroma_format_string:3===a?"4:4:4":"4:2:0",profile_string:s.general_ptl.profile_string,level_string:s.general_ptl.level_string,width:u,height:l}},e._parsePTL=function(e,t,i){if(!this._decodeProfileTierLevel(e,t.general_ptl)||e.getBitsLeft()<8+16*(i-1>0?1:0))return!1;t.general_ptl.level_idc=e.readBits(8),t.general_ptl.level_string=this.getHEVCLevelString(t.general_ptl.level_idc),t.sub_layer_profile_present_flag=[],t.sub_layer_level_present_flag=[];for(var r=0;r<i-1;r++)t.sub_layer_profile_present_flag[r]=e.readBits(1),t.sub_layer_level_present_flag[r]=e.readBits(1);if(i-1>0)for(var n=i-1;n<8;n++)e.readBits(2);for(var s=0;s<i-1;s++){if(t.sub_layer_profile_present_flag[s]&&this._decodeProfileTierLevel(e,t.sub_layer_ptl))return!1;if(t.sub_layer_level_present_flag[s]){if(e.getBitsLeft()<8)return!1;t.sub_layer_ptl[s].level_idc=e.readBits(8)}}return!0},e._decodeProfileTierLevel=function(e,t){if(e.getBitsLeft()<88)return!1;t.profile_space=e.readBits(2),t.tier_flag=e.readBits(1),t.profile_idc=e.readBits(5),t.profile_compatibility_flag=[];for(var i=0;i<32;i++)t.profile_compatibility_flag[i]=e.readBits(1),0==t.profile_idc&&i>0&&t.profile_compatibility_flag[i]&&(t.profile_idc=i);return t.progressive_source_flag=e.readBits(1),t.interlaced_source_flag=e.readBits(1),t.non_packed_constraint_flag=e.readBits(1),t.frame_only_constraint_flag=e.readBits(1),e.readBits(16),e.readBits(16),e.readBits(12),t.profile_string=this.getHEVCProfileString(t.profile_idc),!0},e.parseSPS=function(i){var r=e._ebsp2rbsp(i),n=new t.default(r);n.readByte();var s=n.readByte();n.readByte();var o=n.readByte();n.readUEG();var a=e.getProfileString(s),u=e.getLevelString(o),l=1,d=420,c=8;if((100===s||110===s||122===s||244===s||44===s||83===s||86===s||118===s||128===s||138===s||144===s)&&(3===(l=n.readUEG())&&n.readBits(1),l<=3&&(d=[0,420,422,444][l]),c=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var f=3!==l?8:12,h=0;h<f;h++)n.readBool()&&(h<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var _=n.readUEG();if(0===_)n.readUEG();else if(1===_){n.readBits(1),n.readSEG(),n.readSEG();for(var p=n.readUEG(),v=0;v<p;v++)n.readSEG()}n.readUEG(),n.readBits(1);var m=n.readUEG(),g=n.readUEG(),y=n.readBits(1);0===y&&n.readBits(1),n.readBits(1);var b=0,E=0,T=0,S=0;n.readBool()&&(b=n.readUEG(),E=n.readUEG(),T=n.readUEG(),S=n.readUEG());var w=1,R=1,x=0,L=!0,k=0,A=0;if(n.readBool()){if(n.readBool()){var O=n.readByte();O>0&&O<16?(w=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][O-1],R=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][O-1]):255===O&&(w=n.readByte()<<8|n.readByte(),R=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var P=n.readBits(32),D=n.readBits(32);L=n.readBool(),x=(k=D)/(A=2*P)}}var I=1;1===w&&1===R||(I=w/R);var M=0,C=0;0===l?(M=1,C=2-y):(M=3===l?1:2,C=(1===l?2:1)*(2-y));var N=16*(m+1),F=16*(g+1)*(2-y);N-=(b+E)*M,F-=(T+S)*C;var U=Math.ceil(N*I);return n.destroy(),n=null,{profile_string:a,level_string:u,bit_depth:c,chroma_format:d,chroma_format_string:e.getChromaFormatString(d),frame_rate:{fixed:L,fps:x,fps_den:A,fps_num:k},sar_ratio:{width:w,height:R},codec_size:{width:N,height:F},present_size:{width:U,height:F}}},e._skipScalingList=function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e.getHEVCProfileString=function(e){return r[e]},e.getHEVCLevelString=function(e){return n[e]},e}();e.default=s})?r.apply(t,n):r)||(e.exports=s)},"./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! events */"./node_modules/events/events.js"),i(/*! ./config */"./src/config.ts"),i(/*! ./const */"./src/const.ts"),i(/*! ./core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ./core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ./core/media */"./src/core/media.ts"),i(/*! ./core/mse-controller */"./src/core/mse-controller.ts"),i(/*! ./monitor/monitor */"./src/monitor/monitor.ts"),i(/*! ./preload/preload-cache */"./src/preload/preload-cache.ts"),i(/*! ./preload/preload-manager */"./src/preload/preload-manager.ts"),i(/*! ./trans-conf */"./src/trans-conf.ts"),i(/*! ./types/core */"./src/types/core.ts"),i(/*! ./utils/bitrate-to-index */"./src/utils/bitrate-to-index.ts"),i(/*! ./utils/browser */"./src/utils/browser.ts"),i(/*! ./utils/get-error-code */"./src/utils/get-error-code.ts"),i(/*! ./utils/get-resource-timing */"./src/utils/get-resource-timing.ts"),i(/*! ./utils/is-supported */"./src/utils/is-supported.ts"),i(/*! ./utils/kwai-live-abs-time */"./src/utils/kwai-live-abs-time.ts"),i(/*! ./utils/log */"./src/utils/log.ts"),i(/*! ./utils/playback-rate-manager */"./src/utils/playback-rate-manager.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u,l,d,c,f,h,_,p,v,m,g,y,b,E){function T(e){return e&&e.__esModule?e:{default:e}}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,i){return t&&w(e.prototype,t),i&&w(e,i),e}var x;e.__esModule=!0,e.default=void 0,o=T(o),a=T(a),u=T(u),l=T(l),c=T(c),f=T(f),p=T(p),y=T(y),E=T(E),function(e){e[e.NONE=0]="NONE",e[e.WAITING=1]="WAITING",e[e.SEEK=2]="SEEK",e[e.SELECT_BITRATE=3]="SELECT_BITRATE",e[e.INIT=4]="INIT"}(x||(x={}));var L=function(e){var i,T;function w(t,i){var n;return(n=e.call(this)||this).tag="kernel",n._config=void 0,n._video=void 0,n._mse=void 0,n._monitor=void 0,n._transmuxer=void 0,n._playbackRateManager=null,n._stat=x.INIT,n._seekOnCanplay=!1,n._skipSeekEvent=!1,n._internalSeekFlag=!1,n._isFlushVideoBufferOnEnd=!1,n._audioCodecSwap=!1,n._error=void 0,n._audioCodec="",n._recoverMediaErrorTime=0,n._mainTimer=void 0,n._hbTimer=void 0,n._media=void 0,n._nextLevel=[],n._mediaInfo=void 0,n._streamingMuxThreshold=11,n._loadStopped=!1,n._preloader=void 0,n._streamTimeOffset=0,n._playingLevel=void 0,n._preloadProcessing=!1,n._startLevel=void 0,n._flvLiveRetry=0,n._flvLiveRetryTimer=void 0,n._onVideoPlay=function(){n._error||(n._transmuxer||n.load(),n._monitor.onPlay())},n._onVideoEnded=function(){n._monitor.onEnd(),n._stopHeartbeat(),n._isFlushVideoBufferOnEnd&&n._mse&&(n._mse.flush(),n._checkStreamingMux())},n._resetMSE=function(){b.Log.i(n.tag,"rebuild mse"),URL.revokeObjectURL(n._video.src),n._video.src="",n._video.removeAttribute("src"),n._destroyMSE(),n._initMSE()},n._seeked=function(){n._monitor.onSeeked()},n._seek=function(){if(b.Log.i(n.tag,"seek to "+n._video.currentTime+" internal:"+n._internalSeekFlag),n._video&&n._video.currentTime>=n._video.duration&&n._mse&&n._mse.ended())return n._video.currentTime;n._checkStreamingMux();var e=n._internalSeekFlag;if(n._internalSeekFlag=!1,n._skipSeekEvent)return n._skipSeekEvent=!1,n._video.currentTime;n._monitor.onSeek(e);var t=n._video.currentTime;return n._media.isTimeinBuffered(t)?e||(p.default.msedge||p.default.msie?(n._seekOnCanplay=!0,n._seekWithLoad()):n._transmuxer&&"hls"===n._config.box&&n._transmuxer.seek(t,!1,!0)):0===t&&n._video.buffered.length>0&&n._video.buffered.start(0)<1?e||n._internalSeek(n._video.buffered.start(0)):n._seekWithLoad(),t},n._seekWithLoad=function(){if(!n._config.isLive&&n._transmuxer&&n._mse){n._preloader&&n._preloader.active(!1);var e=n._video.currentTime;n._monitor.onSeekWithLoad(e),n._stat=x.SEEK,n._nextLevel.length&&(n._nextLevel=n._nextLevel.slice(n._nextLevel.length-1),n._nextLevel[0].startSec=e),n._mse.flush(),n._transmuxer.seek(e,n._config.alwaysSeekKeyframe,!1)}},n._mainLoop=function(){var e=n._video;if((n._stat===x.WAITING&&!e.seeking||n._stat===x.INIT||n._stat===x.SEEK||n._stat===x.SELECT_BITRATE)&&n._mse&&!n._mse.hasCleanUpTask()&&!e.ended){var t=e.currentTime,i=n._media.currentBuffer(t),r=void 0;if(!i||i.end-t<1){var s=n._media.nextBuffer(t);s&&(b.Log.i(n.tag,"try fix block-A"),r=s.start)}else n._video.buffered.length>1&&i.end-t>1&&(b.Log.i(n.tag,"try fix block-B"),r=i.start);r&&(r+=p.default.safari?.3:.001,n._internalSeek(r),b.Log.i(n.tag,"jump to "+r))}n._nextLevel.length&&n._checkLevelChange()},n._onVideoLoadeddata=function(){b.Log.i(n.tag,"loadeddata"),n._monitor.onLoadeddata()},n._onVideoCanplay=function(){b.Log.i(n.tag,"canplay "+!!n._stat),n._monitor.onCanplay(),n._stat!==x.NONE&&(n._stat=x.NONE,n._transmuxer&&n._transmuxer.emit("mainNotify",{type:"canplay"}),n._detectSeekOnCanplay(),n._checkLevelChange(),n._video.paused||n._onVideoPlaying()),(0,d.initPreloadCache)()},n._onVideoWaiting=function(){n._stat=n._stat||x.WAITING;var e=n._media.bufferedSec(),t=!n._video.seeking&&n._stat===x.WAITING;t&&n._transmuxer&&n._transmuxer.emit("mainNotify",{type:"waiting"}),n._monitor.onWaiting(t,e)},n._onVideoPlaying=function(){b.Log.i(n.tag,"playing"),n._error||(n._stat=x.NONE,n._startHeartbeat(),n._monitor.onPlaying())},n._onVideoPause=function(){n._monitor.onPause()},n._onVideoError=function(e){if(b.Log.e(n.tag,"video error",e),!n._error){var t=performance.now();if(!n._recoverMediaErrorTime||t-n._recoverMediaErrorTime>3e3)return n._recoverMediaErrorTime=t,n._config.box===h.MediaBox.flv&&n._config.isLive?n._config.gopRemux=!0:n._config.streamingMux=!1,void n._recoverMedia();if(!n._audioCodecSwap&&n._audioCodec)return n._audioCodecSwap=!0,n._recoverSwapAudioCodec(),void n._recoverMedia();var i="video error";n._video&&n._video.error&&(i+=" code:"+n._video.error.code+" message:"+n._video.error.message),n._onError({type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.VIDEO_ERROR,fatal:!0,reason:i})}},n._onVideoRatechange=function(){n._transmuxer&&n._transmuxer.emit("mainNotify",{type:"ratechange",playbackRate:n._video.playbackRate}),n._monitor.onRateChange(n._video.playbackRate),b.Log.v(n.tag,"ratechange "+n._video.playbackRate)},n._onVideoDurationchange=function(){n._monitor.onDurationChange(n._video.duration)},n._heartbeat=function(){n._monitor.heartbeat(),n._updateBufferControl(),n._transmuxer&&(n._transmuxer.heartbeat(),n._preloader&&n._preloader.active(!n._transmuxer.isNetworkInUse&&"closed"!==n._media.mseReadyState))},n._video=t,n.off||(n.off=n.removeListener),n._config=r.ConfigHelper.processConfig(i),n._media=new a.default,n._media.attachVideo(n._video),n._config?w.isSupport(n._config)?(n._mainTimer=null,n._isFlushVideoBufferOnEnd=!1,n._parseUrlConfig(),n._bindEvents(),n._initMSE(),n._initLogger(),n._startMainTimer(),c.default&&(n._preloader=new c.default(n._monitor)),n._config.autoPlaybackRateConf&&(n._playbackRateManager=new E.default(n._media,n._config.autoPlaybackRateConf)),!n._config.isLive&&(n._config.startFromSec>0||n._config.startFrom&&n._config.startFrom>0)&&(n._config.startFromSec=n._config.startFromSec||(n._config.startFrom||0)/1e3,n._internalSeek(n._config.startFromSec),n._skipSeekEvent=!0),n._config.box===h.MediaBox.hls&&n._config.resourceBuffer&&((0,m.setResourceTimingBufferSize)(n._config.resourceBufferSize),performance.onresourcetimingbufferfull=m.clearResourceTimings),b.Log.i("kernel",w.version,n._config),n):(setTimeout((function(){n._onError({type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"unsupported"})}),0),S(n)):(setTimeout((function(){n._onError({type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.CONFIG_ERROR,fatal:!0,reason:"config data error"})}),0),S(n))}T=e,(i=w).prototype=Object.create(T.prototype),i.prototype.constructor=i,i.__proto__=T,w.isSupport=function(e){var t=(0,g.isSupported)(),i=!0;e&&(i=e.isLive&&e.box===h.MediaBox.flv);var n=r.ConfigHelper.isStreamingSupport(e);return t&&!(i&&!n)},R(w,null,[{key:"version",get:function(){return"2.0.8"}}]);var L=w.prototype;return L._initLogger=function(){var e=this;this._monitor=new l.default(w.version,this._media,this._config),this._monitor.on("report",(function(t){e.emit(o.default.REPORT,t)}))},L._bindEvents=function(){this._video&&(this._video.addEventListener("loadeddata",this._onVideoLoadeddata),this._video.addEventListener("canplay",this._onVideoCanplay),this._video.addEventListener("waiting",this._onVideoWaiting),this._video.addEventListener("playing",this._onVideoPlaying),this._video.addEventListener("pause",this._onVideoPause),this._video.addEventListener("play",this._onVideoPlay),this._video.addEventListener("error",this._onVideoError),this._video.addEventListener("ended",this._onVideoEnded),this._video.addEventListener("ratechange",this._onVideoRatechange),this._video.addEventListener("durationchange",this._onVideoDurationchange))},L._unbindMediaSourceEvent=function(e){e.removeAllListeners()},L._initMSE=function(){var e=this;this._mse=new u.default(this._config),this._mse.attach(this._video),this._media.attachMSE(this._mse),this._mse.on(o.default.ERROR,(function(t){e._onError(t)})),this._mse.on("bufferFull",(function(){e._config.lazyLoad&&e._transmuxer&&e._transmuxer.setDownloadEnabled(!1),e._monitor.onMSEBufferFull()})),this._mse.on("updateend",(function(){e._monitor.mseUpdate(),e._stat!==x.NONE&&e._media.isTimeinBuffered(e._video.currentTime)&&4===e._video.readyState?(e._onVideoCanplay(),b.Log.v(e.tag,"canplay polyfill")):e._seekOnCanplay&&e._detectSeekOnCanplay()})),this._mse.on("remove",(function(){e._monitor.mseRemove()}))},L.load=function(e,t){void 0===e&&(e=void 0),b.Log.i(this.tag,"load");var i=!!this._transmuxer,n=this._monitor.data;this._monitor.reset(i),this._playingLevel=void 0,this._flvLiveRetry=0,e&&r.ConfigHelper.setSrc(this._config,e),this._config.src||this._config.manifest?(this._preloader&&this._preloader.active(!1),t?("number"==typeof t.bitrateStart&&(this._config.bitrateStart=t.bitrateStart),"number"==typeof t.startFromSec&&(this._config.startFromSec=t.startFromSec)):i&&(this._config.startFromSec=0),this._checkPreload(n)||(b.Log.i(this.tag,"preload miss"),this._load()),this._preloader&&this._preloader.clean()):this._onError({type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.CONFIG_ERROR,fatal:!0,reason:"url empty"})},L._load=function(e){void 0===e&&(e=!1),b.Log.i(this.tag,"_load"),this._loadStopped=!1,this._error=!1,this._internalSeekFlag=!1,this._stat=x.INIT,this._nextLevel=[],this._monitor.onLoad(this._config.src,e),this._transmuxer&&this._destroyTrans(),(this._mse.hasSourceBuffer()||this._video.error)&&this._resetMSE(),this._startHeartbeat(),this._initTrans(),this._transmuxer&&(this._transmuxer.loadSource(),this._config.autoPlaybackRate&&this._playbackRateManager&&this._playbackRateManager.start())},L.getTimeNow=function(){return y.default.serverNowMs},L._verifyLevel=function(e){return!(!(this._transmuxer&&this._transmuxer.levels.length>0&&e<this._transmuxer.levels.length&&this._mse&&this._video)||this._video.ended)},L.selectBitrate=function(e,t){if(void 0===t&&(t=!1),this._transmuxer){var i=-1;if(e>=0&&(i=(0,_.bitrateToIndex)(this._transmuxer.levels,e)),!this._verifyLevel(i))return;t?this.nextLevel=i:this.currentLevel=i}},L.getBitrates=function(){var e=[];return this._transmuxer&&this._transmuxer.levels.forEach((function(t){e.push(t.bitrate)})),e},L.getLevels=function(){return this._transmuxer?this._transmuxer.levels:[]},L.getCurrentLevelIndex=function(){return this._transmuxer?this._transmuxer.currentLevel:0},L.getCurrentLevel=function(){if(this._transmuxer){var e=this._transmuxer.levels;if(e.length>0)return e[this._transmuxer.currentLevel]}return null},L.setAvailableAbrBitrates=function(e){var t=this;if(this._transmuxer&&e&&e.length){var i=[];e.forEach((function(e){t._transmuxer&&i.push((0,_.bitrateToIndex)(t._transmuxer.levels,e))})),this.setAvailableAbrLevels(i)}},L.setAvailableAbrLevels=function(e){this._transmuxer&&e&&e.length&&this._transmuxer.setAvailableAbrLevels(e)},L.preload=function(e){this._config.box===h.MediaBox.hls&&!this._config.isLive&&this._preloader&&this._preloader.add(this._config,e)},L._checkPreload=function(e){if(!this._preloader||!this._preloader.hasCache()||!this._transmuxer||this._config.startFromSec)return!1;var t=this._preloader.check(this._config.manifest,e);return!!(t&&t.app&&t.app.trans)&&(this._config=t.data.config,this._stat=x.INIT,this._audioCodecSwap=!1,this._destroyTrans(),this._mse.hasSourceBuffer()&&this._resetMSE(),this._transmuxer=t.app.trans,this._monitor.onPreloadHit(this._transmuxer.getCurrentUrl()),this._transmuxerEvent(this._transmuxer),this._preloadProcessing=!0,t.app.use(),this._preloadProcessing=!1,this._transmuxer.usePreload(),this._startHeartbeat(),b.Log.i(this.tag,"preload hit"),this.emit(o.default.PRELOAD_HIT),!0)},L._transmuxerEvent=function(e){var i=this,r=this._mse;e.on(o.default.PARSING_DATA,(function(e){r&&(r.mediaSegment(e),i._updateBufferControl()),"audio"===e.type&&e.streamDTS>0&&e.startDTS>0&&(i._streamTimeOffset=e.streamDTS-e.startDTS),i._monitor&&i._monitor.onSegment({type:e.type,byteLength:e.data.byteLength,dts:Math.floor(1e3*e.startDTS),duration:Math.floor(1e3*e.duration),framesInfo:e.framesInfo})})),e.on(o.default.PARSING_INIT_SEGMENT,(function(e){var n=e.tracks.video,s=e.tracks.audio,a={segments:[],hasVideo:!!n,hasAudio:!!s};for(var u in e.tracks){var l=e.tracks[u];(0,t.ObjectAssign)(a,l.metadata),l.initSegment&&a.segments.push({type:u,data:new Uint8Array(l.initSegment)})}a.videoCodec=n?n.codec:null,a.audioCodec=s?s.codec:null,i._audioCodec=e.manifestAudioCodec||a.audioCodec;var d=(0,t.ObjectAssign)({},a);delete d.segments,i._monitor.onSegmentInit(d),i.emit(o.default.REPORT,{type:"mediaInfo",value:d}),i._mediaInfo||(i._video.addEventListener("seeking",i._seek),i._video.addEventListener("seeked",i._seeked)),i._mediaInfo=d,r&&r.trackInfo(a),i._startMainTimer()})),e.on(o.default.ERROR,(function(e){i._onError(e)})),e.on(o.default.LOAD_END,(function(){r&&r.endOfData(),i.emit(o.default.LOAD_END)})),e.on(o.default.REPORT,(function(e){i._monitor&&i._monitor.onReport(e)})),e.on(o.default.ADAPTIVE_ALGORITHM,(function(e){return i.emit("adaptiveAlgorithm",e)})),e.on(o.default.LEVEL_SWITCH_FAILED,(function(e){i.emit(o.default.LEVEL_SWITCH_FAILED)})),e.on(o.default.LEVEL_SWITCHING,(function(t){t.auto=e.autoLevelEnabled,i._monitor.levelSwitching(e.getCurrentUrl(),t.auto),!t.smooth&&i._mse&&(i._mse.flush(),i._checkStreamingMux()),t.bitrate=t.level<0?-1:e.levels[t.level].bitrate,i.emit(o.default.LEVEL_SWITCHING,{bitrate:t.bitrate,level:t.level,smooth:t.smooth,auto:t.auto}),-1===t.level?i.emit(o.default.LEVEL_SWITCHED,{bitrate:t.bitrate,level:t.level,smooth:t.smooth,auto:t.auto}):(i._nextLevel=i._nextLevel.sort((function(e,t){return e.startSec-t.startSec})).filter((function(e){return e.startSec<t.startSec})),i._nextLevel.push(t))})),e.on(o.default.BUFFER_FLUSHING,(function(e){i._mse&&i._mse.flush(e.startSec,i._video.duration)})),e.on(o.default.SCRIPT_PARSED,(function(e){e.hasOwnProperty("onMetaData")&&i.emit(o.default.REPORT,{type:"metadata",value:e.onMetaData})})),e.on(o.default.MANIFEST_PARSED,(function(r){if(b.Log.i(i.tag,"manifest parsed"),"number"!=typeof i._playingLevel){var n,s=void 0,a=i._config.bitrateStart;"number"==typeof a&&a>=0&&(n=(0,_.bitrateToIndex)(e.levels,a),s=a>=0?n:-1),"number"==typeof i._startLevel&&(s=i._startLevel),"number"==typeof s&&(-1===s&&e.autoLevelEnabled||(e.currentLevel=s));var u=i.getBitrates(),l=u[e.currentLevel];(r=(0,t.ObjectAssign)({bitrates:u,bitrate:l,levels:i.getLevels().slice(0),currentLevel:i.currentLevel},r)).levels=i.getLevels(),i._playingLevel=e.currentLevel,b.Log.i(i.tag,o.default.MANIFEST_PARSED,r),i.emit(o.default.MANIFEST_PARSED,r),i._monitor.onManifest(e.getCurrentUrl(),e.protocol,l,e.autoLevelEnabled)}else e.currentLevel=i._playingLevel})),e.on(o.default.LEVEL_UPDATED,(function(e){e.targetduration&&(i._streamingMuxThreshold=Math.max(e.targetduration+1,11)),!i._config.isLive&&e.duration&&i._mse&&i._mse.updateDuration(e.duration),i._monitor.onLevel(),b.Log.i(i.tag,o.default.LEVEL_UPDATED,e),i.emit(o.default.LEVEL_UPDATED,e)})),e.on(o.default.SEEK_KEYFRAME,(function(e){i._skipSeekEvent=!0;try{i._internalSeek(e.keyFrameSec)}catch(e){}})),e.on(o.default.PRIV_NAL,(function(e){i._monitor.onPrivNal(e)}))},L.isTimeinBuffered=function(e){return this._media.isTimeinBuffered(e)},L._internalSeek=function(e){this._internalSeekFlag=!0;try{this._video.currentTime=e}catch(e){}},L._updateBufferControl=function(){if(this._transmuxer&&this._mse){var e=this._media.bufferedSec(),t=this._mse.getBufferQueueSec(),i=!0;if(this._checkStreamingMux(e),(e<this._config.lazyLoadRecoverDuration||!this._config.lazyLoad&&!this._mse.getAppendEnabled())&&this._mse.setAppendEnabled(!0),e+t>=("closed"===this._media.mseReadyState?1:this._config.lazyLoadMaxDuration))i=!1;else{if(!(e+t<this._config.lazyLoadRecoverDuration))return;i=!0}this._config.lazyLoad&&this._transmuxer&&(b.Log.v(this.tag,"download: "+i+" buffered:"+e+" mse:"+t),this._transmuxer.setDownloadEnabled(i)),this._media.pendingNum()&&this._mse.refresh()}},L._detectSeekOnCanplay=function(){this._seekOnCanplay&&this._mse&&!this._mse.hasCleanUpTask()&&this._media.isTimeinBuffered(this._video.currentTime+.001)&&(b.Log.i(this.tag,"seek on canplay "+this._video.currentTime+" + 0.001"),this._seekOnCanplay=!1,this._internalSeek(this._video.currentTime+.001))},L.resume=function(){b.Log.i(this.tag,"call resume"),this._loadStopped&&(this._loadStopped=!1,this._load(!0)),this._video.paused&&this._video.play()},L.destroy=function(){this._stopFlvLiveRetryTimer(),this._stopMainTimer(),this._stopHeartbeat(),this._monitor&&(this._monitor.destroy(),this._monitor.removeAllListeners()),this._video.removeEventListener("loadeddata",this._onVideoLoadeddata),this._video.removeEventListener("canplay",this._onVideoCanplay),this._video.removeEventListener("seeking",this._seek),this._video.removeEventListener("seeked",this._seeked),this._video.removeEventListener("waiting",this._onVideoWaiting),this._video.removeEventListener("playing",this._onVideoPlaying),this._video.removeEventListener("pause",this._onVideoPause),this._video.removeEventListener("play",this._onVideoPlay),this._video.removeEventListener("error",this._onVideoError),this._video.removeEventListener("ended",this._onVideoEnded),this._video.removeEventListener("ratechange",this._onVideoRatechange),this._video.removeEventListener("durationchange",this._onVideoDurationchange),this._stopVideo(),this._playbackRateManager&&this._playbackRateManager.dispose(),performance.onresourcetimingbufferfull=null,this._preloader&&this._preloader.destroy()},L.seek=function(e){b.Log.i(this.tag,"call kernel seek"),this._config.isLive||(this._internalSeekFlag=!1,this._video.currentTime=e)},L.play=function(){return b.Log.i(this.tag,"call kernel play"),this._video.play()},L.pause=function(){return b.Log.i(this.tag,"call kernel pause"),this._video.pause()},L.refresh=function(){b.Log.i(this.tag,"call kernel refresh"),this._reload(),this._flvLiveRetry=0},L.stopLoad=function(){b.Log.i(this.tag,"call kernel stopLoad"),this._transmuxer&&(this._destroyTrans(),this._stopHeartbeat(),this._mse.endOfData(),this._loadStopped=!0,this._playbackRateManager&&this._playbackRateManager.stop(),this._monitor.onStopLoad())},L.getStreamTime=function(e){return this._streamTimeOffset?e+1e3*this._streamTimeOffset:NaN},L.getCurrentBitrate=function(){if(this._transmuxer){var e=this._transmuxer.levels[this._transmuxer.currentLevel];if(e)return e.bitrate}return 0},L.getAudienceStat=function(){return this._monitor.audienceStat},L.getMediaInfo=function(){return(0,t.ObjectAssign)({},this._mediaInfo)},L.experiment=function(e){e&&null!=typeof e.startBitrateLimit&&(this._config.hlsAdaptiveConfig?this._config.hlsAdaptiveConfig.startBitrateLimit=e.startBitrateLimit:this._config.hlsAdaptiveConfig={startBitrateLimit:e.startBitrateLimit})},L._reload=function(){this._transmuxer&&this._mse?(this._config.startFromSec=this._video.currentTime,this._startLevel=this._transmuxer.currentLevel,this._internalSeekFlag=!1,this._nextLevel=[],this._stopVideo(),this._initMSE(),this._initTrans(),this._transmuxer&&this._transmuxer.loadSource(),this._startHeartbeat()):b.Log.v(this.tag,"transmuxer & mediaSource not ready")},L._parseUrlConfig=function(){if(location.href){var e=location.href.match(/kwaiKernelLog=([a-z]{1})/);e&&(this._config.kwaiKernelLog=e[1])}b.Log.level(this._config.kwaiKernelLog)},L._onError=function(e){b.Log.i(this.tag,"on error "+JSON.stringify(e));var t={errno:n.ERRORNO.UNKNOW_ERROR,errmsg:e.reason||"unknow"};switch(e.type){case s.ErrorTypes.NETWORK_ERROR:if(this._config.isLive&&this._config.box===h.MediaBox.flv&&this._flvLiveRetry<this._config.maxRetry)return void this._startFlvLiveRetryTimer();t.errno=n.ERRORNO.NET_ERROR,t.statusCode=e.statusCode,t.url=e.url;break;case s.ErrorTypes.MSE_ERROR:switch(e.details){case s.ErrorDetails.APPENDBUFFER_ERROR:t.errno=n.ERRORNO.APPENDBUFFER_ERROR;break;case s.ErrorDetails.ENDOFSTREAM_ERROR:t.errno=n.ERRORNO.ENDOFSTREAM_ERROR;break;case s.ErrorDetails.MEDIASOURCE_ERROR:t.errno=n.ERRORNO.MEDIASOURCE_ERROR;break;default:t.errno=n.ERRORNO.SOURCEBUFFER_ERROR}break;case s.ErrorTypes.MEDIA_ERROR:t.errno=n.ERRORNO.FORMAT_ERROR,e.details===s.ErrorDetails.CANNOT_SEEK?t.errno=n.ERRORNO.CANNOT_SEEK:t.errno=n.ERRORNO.CODEC_ERROR;break;case s.ErrorTypes.MUX_ERROR:t.errno=n.ERRORNO.FORMAT_ERROR;break;case s.ErrorTypes.OTHER_ERROR:e.details===s.ErrorDetails.CONFIG_ERROR?t.errno=n.ERRORNO.CONFIG_DATA_ERROR:t.errno=n.ERRORNO.FORMAT_ERROR}if(e.fatal){var i=(0,v.getErrorCode)(e.details,e.reason,e.statusCode||0);this._monitor.onError(i,e.reason),this.stopLoad(),this._stopMainTimer(),(e.details===s.ErrorDetails.VIDEO_ERROR||this._video.error)&&this._destroyMSE(),t.code=i,t.type=e.type,t.reason=e.reason}e.fatal&&!this._error&&(this._error=t,this.emit("error",t))},L._startMainTimer=function(){null===this._mainTimer&&(this._mainTimer=setInterval(this._mainLoop,200))},L._stopMainTimer=function(){this._mainTimer&&(clearInterval(this._mainTimer),this._mainTimer=null)},L._startHeartbeat=function(){this._hbTimer||(this._hbTimer=setInterval(this._heartbeat,1e3))},L._stopHeartbeat=function(){this._hbTimer&&(clearInterval(this._hbTimer),this._hbTimer=null)},L._checkLevelChange=function(){var e=this._nextLevel[0];e&&this._video.currentTime>=e.startSec&&this._media.isTimeinBuffered(this._video.currentTime)&&(this.emit(o.default.LEVEL_SWITCHED,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto}),this._playingLevel=e.level,this._nextLevel.shift())},L._stopVideo=function(){this._video&&(URL.revokeObjectURL(this._video.src),this._video.src="",this._video.removeAttribute("src"),this._destroyTrans(),this._destroyMSE())},L._destroyTrans=function(){this._transmuxer&&(this._transmuxer.removeAllListeners(),this._transmuxer.destroy(),this._transmuxer=void 0)},L._destroyMSE=function(){this._mse&&(this._unbindMediaSourceEvent(this._mse),this._mse.destroy())},L._initTrans=function(){this._stopFlvLiveRetryTimer();var e=f.default[this._config.box];e?(this._transmuxer=new e(this._config,this._media),this._transmuxer&&(this._transmuxerEvent(this._transmuxer),this._transmuxer.init())):this._onError({type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"unsupported box"})},L._recoverSwapAudioCodec=function(){var e=this._audioCodec;e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5",this._config.audioCodec=e,this._config.audioCodecSwap=!0},L._recoverMedia=function(){this._monitor.recoverMedia(),this.refresh()},L._checkStreamingMux=function(e){void 0===e&&(e=0),this._config.streamingMux&&this._transmuxer&&(e>this._streamingMuxThreshold?this._transmuxer.streamingMux(!1):this._transmuxer.streamingMux(!0))},L._startFlvLiveRetryTimer=function(){var e=this;this._flvLiveRetryTimer=setTimeout((function(){e._flvLiveRetry++,e._monitor.flvLiveRetry(),e._reload()}),this._config.retryDelay)},L._stopFlvLiveRetryTimer=function(){this._flvLiveRetryTimer&&(clearTimeout(this._flvLiveRetryTimer),this._flvLiveRetryTimer=void 0)},R(w,[{key:"currentLevel",get:function(){return this._transmuxer?this._transmuxer.currentLevel:0},set:function(e){var t=this;b.Log.i(this.tag,"set currentLevel",e),this._preloadProcessing?setTimeout((function(){t.currentLevel=e}),0):this._verifyLevel(e)&&(e!==this.currentLevel||this.autoLevelEnabled)?e<0?this.nextLevel=-1:(this._preloader&&this._preloader.active(!1),this._stat!==x.INIT&&(this._monitor.selectBitrate(),this._stat=x.SELECT_BITRATE,this._seekOnCanplay=!0),this._mse&&(this._mse.flush(),this._checkStreamingMux()),this._transmuxer&&(this._transmuxer.currentLevel=e)):this.emit(o.default.LEVEL_SWITCH_FAILED)}},{key:"nextLevel",get:function(){return this._transmuxer?this._transmuxer.nextLevel:0},set:function(e){b.Log.i(this.tag,"set nextLevel",e),this._verifyLevel(e)?this._media.bufferedSec()<3&&e>=0?this.currentLevel=e:this._transmuxer&&(this._transmuxer.nextLevel=e):this.emit(o.default.LEVEL_SWITCH_FAILED)}},{key:"startLevel",get:function(){return void 0===this._startLevel?this._config.adaptive?-1:0:this._startLevel},set:function(e){this._startLevel=e}},{key:"autoLevelEnabled",get:function(){return this._transmuxer?this._transmuxer.autoLevelEnabled:this._config.adaptive}},{key:"monitorData",get:function(){return this._monitor?this._monitor.snapshot:null}}]),w}(i.EventEmitter);e.default=L})?r.apply(t,n):r)||(e.exports=s)},"./src/io/cache.ts":
/*!*************************!*\
  !*** ./src/io/cache.ts ***!
  \*************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0;var i=function(){function e(t){void 0===t&&(t=0),this._size=void 0,this._readOffset=0,this._writeOffset=0,this._storage=void 0,this._cache=void 0,this._size=t>0?t:e.DEFAULT_CACHE_SIZE,this._storage=new ArrayBuffer(this._size),this._cache=new Uint8Array(this._storage)}var i,r,n,s=e.prototype;return s.put=function(e){if(this._readOffset===this._writeOffset&&(this._readOffset=this._writeOffset=0),this._writeOffset+e.byteLength>this._size){var t=this._writeOffset+e.byteLength-this._readOffset;t>this._size?(this._collateCache(),this.expandCache(t)):this._collateCache()}this._cache.set(e,this._writeOffset),this._writeOffset+=e.byteLength},s.get=function(e){if(e+this._readOffset>this._writeOffset)return null;var t=null;if(this._cache.slice)t=this._cache.slice(this._readOffset,this._readOffset+e);else{var i=this._cache.byteOffset+this._readOffset;t=new Uint8Array(this._storage.slice(i,i+e))}return this._readOffset+=e,t},s.read=function(e){return e+this._readOffset>this._writeOffset?null:new Uint8Array(this._storage,this._readOffset,e)},s.skip=function(e){e+this._readOffset>this._writeOffset||(this._readOffset+=e)},s.clear=function(){this._readOffset=this._writeOffset=0},s.expandCache=function(t){if(void 0===t&&(t=0),this._size=Math.max(2*this._size,t),this._size>=e.MAX_CACHE_SIZE)throw new Error("max cache size");0===this._readOffset&&0===this._writeOffset?this._storage=new ArrayBuffer(this._size):this._storage=this._transfer(this._storage,this._size),this._cache=new Uint8Array(this._storage)},s._collateCache=function(){var e=new Uint8Array(this._storage,this._readOffset,this._writeOffset-this._readOffset);this._cache.set(e),this._writeOffset-=this._readOffset,this._readOffset=0},s._transfer=function(e,t){if(!(e instanceof ArrayBuffer))throw new TypeError("Source must be an instance of ArrayBuffer");if(t<=e.byteLength)return e.slice(0,t);var i=new Uint8Array(e),r=new Uint8Array(new ArrayBuffer(t));return r.set(i),r.buffer},i=e,(r=[{key:"unreadLen",get:function(){return this._writeOffset-this._readOffset}}])&&t(i.prototype,r),n&&t(i,n),e}();i.MAX_CACHE_SIZE=104857600,i.DEFAULT_CACHE_SIZE=3145728;var r=i;e.default=r})?r.apply(t,n):r)||(e.exports=s)},"./src/io/fetch.ts":
/*!*************************!*\
  !*** ./src/io/fetch.ts ***!
  \*************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t=function(){function e(){this.tag="fetch",this._context=void 0,this._callbacks=null,this._controller=null,this._reader=null,this._abort=!1}e.isSupport=function(){return!(!self.fetch||!self.ReadableStream)};var t=e.prototype;return t.load=function(e,t){var i=this;this._context=e,this._callbacks=t;var r=new Headers;e.headers&&e.headers.forEach((function(e){r.append(e.header,e.value)})),e.range&&r.append("Range",e.range);var n={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:this._getAbortSignal()};e.credentials&&(n.credentials="include"),fetch(e.url,n).then((function(t){if(e.responseUrl=t.url,e.responseHeader=t.headers,i._callbacks&&i._callbacks.onConnect&&i._callbacks.onConnect(t.status),t.ok)return i._abort?void(t.body&&t.body.getReader().cancel()):"arraybuffer"===e.responseType?e.progress?void(t.body&&(i._reader=t.body.getReader(),i._pump(i._reader))):void t.arrayBuffer().then((function(t){i._onEnd(e,t)})):void t.text().then((function(t){i._onEnd(e,t)}));var r=new Error(t.status+" "+t.statusText);i._onError(r)})).catch((function(e){"AbortError"!==e.name&&i._onError(e)}))},t.abort=function(){this._controller?this._controller.abort():this._reader&&(this._reader.cancel(),this._reader=null),this._abort=!0},t.destroy=function(){this._callbacks=null,this.abort()},t._onProgress=function(e,t){this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t)},t._onEnd=function(e,t){this._callbacks&&this._callbacks.onEnd&&(this._reader=null,this._controller=null,this._callbacks.onEnd(e,t))},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},t._pump=function(e){var t=this;e.read().then((function(i){if(t._abort)return e.cancel(),null;if(i.done)return t._onEnd(t._context,null),null;var r=i.value.buffer;return t._onProgress(t._context,r),t._pump(e)})).catch((function(e){"AbortError"!==e.name&&t._onError(e)}))},t._getAbortSignal=function(){try{if(AbortController)return this._controller=new AbortController,this._controller.signal}catch(e){return null}return null},e}();e.default=t})?r.apply(t,n):r)||(e.exports=s)},"./src/io/loader-with-cache.ts":
/*!*************************************!*\
  !*** ./src/io/loader-with-cache.ts ***!
  \*************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./loader */"./src/io/loader.ts"),i(/*! ../preload/preload-cache */"./src/preload/preload-cache.ts"),i(/*! ../preload/preload-id */"./src/preload/preload-id.ts"),i(/*! ../utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n){e.__esModule=!0,e.default=void 0;var s,o=function(e){var t,s;function o(){var t;return(t=e.call(this)||this)._cache=void 0,t._writeCache=!1,t._cache=i.preloadCache,t}s=e,(t=o).prototype=Object.create(s.prototype),t.prototype.constructor=t,t.__proto__=s;var a=o.prototype;return a.load=function(e,t,i){var s=this;if(this._init(e,t,i),this._writeCache=!!i.cache,this._cache&&this._cache.ready){var o=(0,r.getDBID)(this.context.url,this.context.rangeStart,this.context.rangeEnd);this._cache.hit(o)>=0?this._cache.get(o,(function(e,t){s._callbacks&&(!e&&t?(s._writeCache=!1,s._stats.cacheHit=!0,s._stats.id="cache",s._stats.tsload=Date.now(),s._stats.tstart=performance.now(),s._onEnd(s.context,t.result),n.Log.i(s.tag,"db cache hit!")):(s._stats.cacheFail=!0,s._loadInternal()))})):this._loadInternal()}else this._loadInternal()},a._onEnd=function(t,i){e.prototype._onEnd.call(this,t,i),this._cache&&this._cache.ready&&this._writeCache&&i&&"string"!=typeof i&&this._cache.put((0,r.getDBID)(this.context.url,this.context.rangeStart,this.context.rangeEnd),i)},o}((s=t,t=s&&s.__esModule?s:{default:s}).default);e.default=o})?r.apply(t,n):r)||(e.exports=s)},"./src/io/loader.ts":
/*!**************************!*\
  !*** ./src/io/loader.ts ***!
  \**************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../utils/browser */"./src/utils/browser.ts"),i(/*! ./fetch */"./src/io/fetch.ts"),i(/*! ./xhr */"./src/io/xhr.ts"),i(/*! ../utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n){function s(e){return e&&e.__esModule?e:{default:e}}var o;e.__esModule=!0,e.default=void 0,t=s(t),i=s(i);var a=0,u=function(){var e=s.prototype;function s(){this.tag="loader",this.context=void 0,this._loader=void 0,this._callbacks=null,this._config=void 0,this._loaderCallback=void 0,this._stats=void 0,this._retryDelay=0,this._loading=!1,this._aborted=!1,this._requestTimeout=void 0,this._transTimer=void 0,this._retryTimeout=void 0,this._rangeStart=void 0,this._continuedTransmissionRetry=!1,this._progressTime=0,this.tag="loader",a++,this._loader=null,this._config={useFetch:!1,connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0},this._loaderCallback={onConnect:this._onConnect.bind(this),onProgress:this._onProgress.bind(this),onEnd:this._onEnd.bind(this),onError:this._onError.bind(this)}}return e._getInternalLoader=function(e){if(void 0!==o)return o;if(o=null,t.default.msie||t.default.msedge){if(e)return i.default.isSupport()&&(o=i.default),o;r.XHR.isSupportChunk()?o=r.XHR:i.default.isSupport()&&(o=i.default)}else i.default.isSupport()?o=i.default:r.XHR.isSupportChunk()&&(o=r.XHR);return o},e.load=function(e,t,i){this._init(e,t,i),this._loadInternal()},e.destroy=function(){this._stopTimer(),this._abortInternal(),this._destroyLoader(),this._callbacks=null},e._init=function(e,t,i){this.context=e,this._rangeStart=e.rangeStart,this._callbacks=t,this._config=i||this._config,this._stats={id:"",trequest:performance.now(),retry:0,loaded:0,code:0,output:0,tfirst:0,tload:0,total:0,tsload:0,tstart:0,fatal:!1,text:""},this._config.retryDelay&&(this._retryDelay=this._config.retryDelay)},e._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=null)},e._loadInternal=function(){this._loading=!0,this._aborted=!1;var e=this._stats;e.code=0,e.tfirst=0,e.loaded=0,this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this.context.progress?this._loader=new(this._getInternalLoader(!!this._config.useFetch)):this._loader=new r.XHR,this._loader&&(e.id=this._loader.tag+"-"+a,this._config.connectionTimeout&&(this._requestTimeout=setTimeout(this._onTimeout.bind(this),this._config.connectionTimeout)),this.context.rangeEnd?this.context.range="bytes="+this.context.rangeStart+"-"+(this.context.rangeEnd-1):this.context.rangeStart&&(this.context.range="bytes="+this.context.rangeStart+"-"),e.tsload=Date.now(),e.tstart=performance.now(),this._loader.load(this.context,this._loaderCallback))},e._abortInternal=function(){this._callbacks&&this._callbacks.onAbort&&!this._aborted&&this._loading&&this._callbacks.onAbort(this.context,this._stats),this._aborted=!0,this._loader&&this._loader.abort()},e.abort=function(){this._stopTimer(),this._abortInternal()},e._stopTimer=function(){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this._stopTransmissionTimer()},e._onConnect=function(e){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._startTransmissionTimer(),this._stats.code=e,this._stats.tfirst=Math.max(this._stats.trequest,performance.now())},e._onProgress=function(e,t){var i=this._stats;if(this._progressTime=performance.now(),!this._continuedTransmissionRetry&&i.output>i.loaded){if(i.loaded+t.byteLength-i.output>0){var r=t.slice(i.output-i.loaded);this._callProgress(this.context,r,i)}}else this._callProgress(this.context,t,i);i.loaded+=t.byteLength},e._callProgress=function(e,t,i){this._stats.output+=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t,i)},e._onEnd=function(e,t){this._stopTimer();var i=this._stats;i.total=t?i.loaded="string"==typeof t?t.length||0:t.byteLength||0:i.loaded,i.tload=Math.max(i.tfirst,performance.now()),this._loading=!1,i.output=0,this._callbacks&&this._callbacks.onEnd(e,t,i)},e._onError=function(e){n.Log.i(this.tag,e),this._stopTimer(),this._destroyLoader();var t=this._stats,i=this._config;this._loading=!1,t.fatal=!i.maxRetry||t.retry>=i.maxRetry||!i.maxRetry,t.text=e.message||"load error",this._callbacks&&this._callbacks.onError&&this._callbacks.onError(this.context,t),t.fatal||(this._stats.output&&this._stats.loaded>0?(this._rangeStart?this.context.rangeStart=this._rangeStart+this._stats.output:this.context.rangeStart=this._stats.output,this._continuedTransmissionRetry=!0):(this.context.rangeStart=this._rangeStart,this._continuedTransmissionRetry=!1),t.retry++,this._callbacks&&(this._retryDelay?(this._retryTimeout=setTimeout(this._loadInternal.bind(this),this._retryDelay),this._retryDelay=2*this._retryDelay):this._loadInternal()))},e._onTimeout=function(){this._loading=!1,this._abortInternal();var e=new Error("timeout");this._onError(e)},e._startTransmissionTimer=function(){var e=this;this._stopTransmissionTimer(),this._progressTime=performance.now();var t=this._config.transmissionTimeout||0;t&&(this._transTimer=setInterval((function(){performance.now()-e._progressTime>t&&e._onTimeout()}),1e3))},e._stopTransmissionTimer=function(){this._transTimer&&(clearInterval(this._transTimer),this._transTimer=null)},s}();e.default=u})?r.apply(t,n):r)||(e.exports=s)},"./src/io/multipart-loader.ts":
/*!************************************!*\
  !*** ./src/io/multipart-loader.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),i(/*! ../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../demux/flv/flv */"./src/demux/flv/flv.ts"),i(/*! ../utils/binary-search */"./src/utils/binary-search.ts"),i(/*! ../utils/download-info */"./src/utils/download-info.ts"),i(/*! ../utils/log */"./src/utils/log.ts"),i(/*! ./loader */"./src/io/loader.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a){function u(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,i=u(i),n=u(n),a=u(a);var l=function(){function e(e,t){this.tag="MultiPartLoader",this._observer=void 0,this._config=void 0,this._manifest=void 0,this._segment=void 0,this._callbacks=null,this._loaderCallbacks=null,this._loader=void 0,this._fragLoadConfig=void 0,this._segmentIndex=void 0,this._autoNext=void 0,this._removeFlvHead=void 0,this._periodId=void 0,this._seeking=!1,this._observer=e,this._config=t,this._loader=null,this._segmentIndex=0,this._autoNext=!0,this._removeFlvHead=!1,this._periodId=NaN}var u=e.prototype;return u.load=function(e,t,r){var n=0;this._callbacks=t,this._fragLoadConfig=r,this._manifest=e;var s=0,o=[];if(this._manifest.segments.forEach((function(e){e.time=s,o.push(s/1e3),s+=e.duration})),e.duration=s,this._initLoaderCallback(),this._config.startFromSec>0)n=this.seek(this._config.startFromSec,this._config.startFromKeyframe);else{this._autoNext=!0;var a=this._nextSegment();a&&this._loadSegment(a)}return this._observer.trigger(i.default.LEVEL_UPDATED,{duration:e.duration/1e3,times:o}),n},u.setDownloadEnabled=function(e){!this._autoNext&&e?this.resume():this._autoNext=e},u.pause=function(){o.Log.v(this.tag,"pause"),this._autoNext=!1},u.resume=function(){if(this._autoNext=!0,!this._loader){var e=this._nextSegment();e&&this._loadSegment(e)}},u.destroy=function(){this._callbacks=null,this._disposeLoader(this._loader),this._loader=null},u.seek=function(e,t){void 0===t&&(t=!1),this._loader&&(this._disposeLoader(this._loader),this._loader=null),this._seeking=!0,this._autoNext=!0,this._removeFlvHead=!1;var r=this._seekByTime(1e3*e||0);return t&&this._observer.trigger(i.default.SEEK_KEYFRAME,{keyFrameSec:r.time/1e3}),this._nextSegment(),this._loadSegment(r),r.time/1e3},u.getCurrentUrl=function(e){var t=n.default.search(this._manifest.segments,(function(t){return e<t.time?-1:e>t.time+t.duration?1:0}));return t?t.url:this._manifest.segments[0].url},u._initLoaderCallback=function(){var e=this;this._loaderCallbacks={onProgress:this._onLoaderChunkArrival.bind(this),onEnd:function(t,n,o){if(e._loader=null,!e._config.streamingMux&&n instanceof ArrayBuffer&&e._callbacks&&(e._removeFlvHead&&(n=n.slice(r.FlvSize.FLV_HEAD_LEN,n.byteLength),e._removeFlvHead=!1),e._callbacks&&e._callbacks.onProgress&&e._callbacks.onProgress(t,n,o)),e._observer.trigger(i.default.REPORT,(0,s.downloadInfo)(s.DownloadStatus.SUCCESS,t,o)),e._removeFlvHead=!0,e._hasNextSegment()){if(e._autoNext){var a=e._nextSegment();a&&e._loadSegment(a)}}else e._callbacks&&e._callbacks.onEnd(t,n,o)},onError:function(t,r){e._observer.trigger(i.default.REPORT,(0,s.downloadInfo)(s.DownloadStatus.FAIL,t,r)),e._callbacks&&e._callbacks.onError(t,r)},onAbort:function(){}}},u._onLoaderChunkArrival=function(e,t,i){t instanceof ArrayBuffer&&this._callbacks&&this._callbacks.onProgress&&(this._removeFlvHead&&(t=t.slice(r.FlvSize.FLV_HEAD_LEN,t.byteLength),this._removeFlvHead=!1),this._callbacks.onProgress(e,t,i))},u._loadSegment=function(e){this._disposeLoader(this._loader),this._loader=null,e&&(this._segment=e,this._config.baseURL&&(this._segment.url=(0,t.buildAbsoluteURL)(this._config.baseURL,this._segment.url,{alwaysNormalize:!0})),this._loader=new a.default,isNaN(this._periodId)||this._periodId===e.periodId||this._seeking||(this._removeFlvHead=!1,o.Log.v(this.tag,"DISCONTINUITY"),this._observer.trigger(i.default.DISCONTINUITY,e.time/1e3)),this._periodId=e.periodId,this._seeking&&(this._seeking=!1),this._loaderCallbacks&&this._loader.load({url:e.url,responseType:"arraybuffer",progress:this._config.streamingMux,frag:e,credentials:this._manifest.withCredentials,type:"flv"},this._loaderCallbacks,this._fragLoadConfig))},u._disposeLoader=function(e){e&&e.destroy()},u._seekByTime=function(e){return this._segmentIndex=n.default.searchIndex(this._manifest.segments,(function(t){return e<t.time?-1:e>t.time+t.duration?1:0})),this._segmentIndex<0&&(this._segmentIndex=0),this._manifest.segments[this._segmentIndex]},u._hasNextSegment=function(){return this._manifest.segments&&this._manifest.segments.length>this._segmentIndex},u._nextSegment=function(){var e=null;return this._manifest.segments&&this._manifest.segments.length>this._segmentIndex&&(e=this._manifest.segments[this._segmentIndex],this._segmentIndex++),e},e}();e.default=l})?r.apply(t,n):r)||(e.exports=s)},"./src/io/xhr.ts":
/*!***********************!*\
  !*** ./src/io/xhr.ts ***!
  \***********************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){var t;e.__esModule=!0,e.XHR=e.XHR_TYPE=void 0,e.XHR_TYPE=t,function(e){e.MOZ_CHUNK="moz-chunked-arraybuffer",e.MS_STREAM="ms-stream",e.UNKNOW="unknow",e.UNSUPPORT=""}(t||(e.XHR_TYPE=t={}));var i=function(){function e(){this.tag="xhr",this._xhr=null,this._context=void 0,this._callbacks=null,this._reader=null,this._msBufferOffset=0,this._msBufferUpper=16777216,this._progress=t.UNKNOW,this._xhr=null,this._msBufferOffset=0}e.isSupportChunk=function(){if(e.supportChunk!==t.UNKNOW)return e.supportChunk;try{var i=new XMLHttpRequest;if(i.open("GET","https://example.com",!0),i.responseType=t.MOZ_CHUNK,i.responseType===t.MOZ_CHUNK)return e.supportChunk=t.MOZ_CHUNK,e.supportChunk}catch(i){e.supportChunk=t.UNSUPPORT}try{var r=new XMLHttpRequest;if(r.open("GET","https://example.com",!0),r.responseType=t.MS_STREAM,r.responseType===t.MS_STREAM)return e.supportChunk=t.MS_STREAM,e.supportChunk}catch(i){e.supportChunk=t.UNSUPPORT}return t.UNSUPPORT};var i=e.prototype;return i.load=function(i,r){if(this._callbacks=r,this._context=i,this._progress=t.UNSUPPORT,i.progress&&"arraybuffer"===i.responseType&&(this._progress=e.isSupportChunk(),this._progress===t.MS_STREAM)){var n=this._reader=new self.MSStreamReader;n.onprogress=this._msrOnProgress.bind(this),n.onload=this._onLoadEnd.bind(this),n.onerror=this._onError.bind(this)}var s=this._xhr=new XMLHttpRequest;s.open("GET",this._context.url,!0),this._progress===t.MOZ_CHUNK?(s.responseType=t.MOZ_CHUNK,s.onprogress=this._onProgress.bind(this),s.onload=this._onLoadEnd.bind(this)):this._progress===t.MS_STREAM?s.responseType=t.MS_STREAM:(s.responseType=i.responseType||"arraybuffer",s.onload=this._onLoadEnd.bind(this)),s.onreadystatechange=this._onReadyStateChange.bind(this),s.onerror=this._onError.bind(this),s.withCredentials=!!i.credentials,i.range&&s.setRequestHeader("Range",i.range),s.send()},i.abort=function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},i.destroy=function(){this._callbacks=null,this.abort()},i._onReadyStateChange=function(e){var t=e.target;2===t.readyState?(this._context.responseUrl=t.responseURL,this._context.responseHeader=t.getAllResponseHeaders(),this._callbacks&&this._callbacks.onConnect&&this._callbacks.onConnect(t.status),(t.status<200||t.status>299)&&this._onError(new Error("xhr error"))):3===t.readyState&&this._reader&&0===this._reader.readyState&&t.status>=200&&t.status<=299&&this._reader.readAsArrayBuffer(t.response)},i._onProgress=function(e){var t=e.target.response;this._callbacks&&this._callbacks.onProgress&&t&&this._callbacks.onProgress(this._context,t)},i._msrOnProgress=function(e){var t=e.target.result;if(t){var i=t.slice(this._msBufferOffset);this._msBufferOffset=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(this._context,i),t.byteLength>=this._msBufferUpper&&this._onError(new Error("ms buffer too large"))}else this._onError(new Error("ms buffer null"))},i._onLoadEnd=function(e){var t=null,i=e.target;!this._progress&&i&&(t=i.response),this._callbacks&&this._callbacks.onEnd(this._context,t)},i._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},e}();e.XHR=i,i.supportChunk=t.UNKNOW})?r.apply(t,n):r)||(e.exports=s)},"./src/monitor/download-beacon.ts":
/*!****************************************!*\
  !*** ./src/monitor/download-beacon.ts ***!
  \****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! url-parse */"./node_modules/url-parse/index.js")],void 0===(s="function"==typeof(r=function(e,t){var i;e.__esModule=!0,e.downloadBeacon=function(e){var i;return"flv"===e.resourceType?i={domain:new t.default(e.url).host,downloaded_size:e.byteLength,error_code:e.errorCode,load_status:e.status,network_cost:Math.round(e.spendTime),resource_type:"flv",total_size:e.byteLength,url:e.url}:(i={download_url:e.url,domain:new t.default(e.url).host,download_start_time:e.startTime,download_spend_time:Math.round(e.spendTime),download_status:e.status,http_status_code:e.httpStatusCode,retry_index:e.retry,error_code:e.errorCode,error_message:e.errorMessage,loader_id:e.loaderId,download_size:e.byteLength,resource_type:e.resourceType,preload:e.preload?1:0},e.slice&&(i.hls_slice_bytes=e.byteLength,i.hls_slice_play_start_time=e.slicePlayStartTime,i.hls_slice_play_duration=e.slicePlayDuration,i.hls_slice_index=e.sliceIndex,e.sliceLevelIndex&&(i.hls_slice_level_index=e.sliceLevelIndex,i.hls_slice_bitrate=e.sliceBitrate)),"number"==typeof e.rangeStart&&(i.range_start=e.rangeStart),e.rangeEnd&&(i.range_end=e.rangeEnd)),e.httpResponseTime&&(i.http_response_time=e.httpResponseTime),e.customHeader&&(i.custom_http_header=e.customHeader),void 0!==e.redirect&&(i.time_redirect=Math.round(e.redirect)),void 0!==e.dns&&(i.time_dns=Math.round(e.dns)),void 0!==e.tcp&&(i.time_tcp=Math.round(e.tcp)),void 0!==e.request&&(i.time_request=Math.round(e.request)),void 0!==e.firstResponse&&(i.time_first_response=Math.round(e.firstResponse)),void 0!==e.response&&(i.time_response=Math.round(e.response)),e.duration&&(i.duration=Math.round(e.duration)),i},t=(i=t)&&i.__esModule?i:{default:i}})?r.apply(t,n):r)||(e.exports=s)},"./src/monitor/first-frame.ts":
/*!************************************!*\
  !*** ./src/monitor/first-frame.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i,r;e.__esModule=!0,e.FirstFrameEvents=e.FirstFrameType=e.FirstFrame=void 0,e.FirstFrameType=i,function(e){e.FIRST_FRAME="normal",e.FIRST_FRAME_SEEK="seek",e.FIRST_FRAME_SELECT_BITRATE="select_bitrate"}(i||(e.FirstFrameType=i={})),e.FirstFrameEvents=r,function(e){e.START="start",e.MANIFEST="manifest",e.LEVEL="level",e.DATA="data",e.DEMUX="demux",e.SEGMENT="segment",e.CANPLAY="canplay",e.LOADEDDATA="loadeddata"}(r||(e.FirstFrameEvents=r={}));var n=[{event:r.START,emitEvent:"first_loader_open_timestamp",detailName:"first-loader-open"},{event:r.MANIFEST,detailName:"manifest-duration"},{event:r.LEVEL,detailName:"level-duration"},{event:r.DATA,emitEvent:"receive-first-package-duration",detailName:"first-package-duration"},{event:r.DEMUX,emitEvent:"first-flv-package-duration",detailName:"first-remux-duration"},{event:r.SEGMENT,emitEvent:"first-flv-to-mp4",detailName:"first-segment-duration"},{event:[r.LOADEDDATA,r.CANPLAY],emitEvent:"first_video_frame_duration",detailName:"first-frame-duration"}],s=function(){function e(e,t){this._complete=!1,this._duration=0,this._events=void 0,this._start=0,this._lastEventTime=0,this._details={},this._eventEmitter=void 0,this._media=void 0,this._events=n.slice(0),this._eventEmitter=e,this._media=t}var i,s,o,a=e.prototype;return a.start=function(e){this._complete=!1,this._start=performance.now(),this._duration=0,this._events=n.slice(0),this._lastEventTime=0,this._details={type:e,error_cnt:0},this.process(r.START,this._start)},a.process=function(e,t){if(void 0===t&&(t=0),this._complete)return!1;var i=this._events,n=-1;t=t||performance.now();for(var s=0;s<i.length;s++){var o=i[s];if(Array.isArray(o.event)){if(-1!==o.event.indexOf(e)){n=s;break}}else if(o.event===e){n=s;break}}if(-1===n)return!1;var a=i.splice(0,n+1).pop(),u="closed"===this._media.mseReadyState;if((0===i.length||u&&e===r.SEGMENT)&&(this._duration=t-this._start,this._complete=!0),a){var l=Math.round(t-this._lastEventTime);0===this._lastEventTime&&(l=Date.now()),this._lastEventTime=t,this._details[a.detailName]=l,a.emitEvent&&this._eventEmitter&&this._eventEmitter.emit("report",{type:"performance",value:{type:a.emitEvent,value:l}})}return this._complete},a.onError=function(){this._details.error_cnt++},i=e,(s=[{key:"complete",get:function(){return this._complete}},{key:"duration",get:function(){return this._duration}},{key:"details",get:function(){return this._details}}])&&t(i.prototype,s),o&&t(i,o),e}();e.FirstFrame=s})?r.apply(t,n):r)||(e.exports=s)},"./src/monitor/fps.ts":
/*!****************************!*\
  !*** ./src/monitor/fps.ts ***!
  \****************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t=window.performance,i=function(){function e(){var e=this;this.tag="fps",this._lastDroppedFrames=0,this._lastDecodedFrames=0,this._video=null,this._isVideoPlaybackQualityAvailable=!1,this._lastTime=0,this._decoded=0,this._dropped=0,this._seeked=function(){e.checkFPSInterval()}}var i=e.prototype;return i.attachMedia=function(e){var t=this._video=e instanceof window.HTMLVideoElement?e:null;t&&(this._isVideoPlaybackQualityAvailable="function"==typeof t.getVideoPlaybackQuality,t.addEventListener("seeked",this._seeked))},i.destory=function(){this._video&&this._video.removeEventListener("seeked",this._seeked)},i.reset=function(){this._lastTime=t.now(),this._lastDroppedFrames=this._lastDecodedFrames=this._decoded=this._dropped=0;var e=this._video;if(e)try{if(this._isVideoPlaybackQualityAvailable){var i=e.getVideoPlaybackQuality();this._lastDecodedFrames=i.totalVideoFrames,this._lastDroppedFrames=i.droppedVideoFrames}else this._lastDecodedFrames=e.webkitDecodedFrameCount,this._lastDroppedFrames=e.webkitDroppedFrameCount}catch(e){return}},i.checkFPSInterval=function(){var e=this._video,i=t.now(),r=null,n=0,s=0;if(e)if(this._isVideoPlaybackQualityAvailable){var o=e.getVideoPlaybackQuality();n=o.totalVideoFrames,s=o.droppedVideoFrames}else n=e.webkitDecodedFrameCount||0,s=e.webkitDroppedFrameCount||0;if(n){n<this._lastDecodedFrames&&(this._lastDecodedFrames=0,this._lastDroppedFrames=0);var a=i-this._lastTime,u=s-this._lastDroppedFrames,l=n-this._lastDecodedFrames,d=0,c=0;this._lastTime&&(d=parseFloat((1e3*u/a).toFixed(2)),c=parseFloat((1e3*l/a).toFixed(2))),this._decoded=this._decoded+=l,this._dropped=this._dropped+=u,this._lastTime=i,this._lastDroppedFrames=s,this._lastDecodedFrames=n,r={decoded:this._decoded,dropped:this._dropped,decodedFPS:c,droppedFPS:d}}return this._lastTime=i,r},e}();e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/monitor/live-delay.ts":
/*!***********************************!*\
  !*** ./src/monitor/live-delay.ts ***!
  \***********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../utils/kwai-live-abs-time */"./src/utils/kwai-live-abs-time.ts")],void 0===(s="function"==typeof(r=function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r;e.__esModule=!0,e.default=void 0,t=(r=t)&&r.__esModule?r:{default:r};var n=function(){function e(){this._ntp=void 0,this._media=void 0,this._priv={keyAbstMs:0,keyPtsOrignMs:0,keyDtsOrignMs:0},this._vLastFrameInfo=void 0,this._aLastFrameInfo=void 0}var r,n,s,o=e.prototype;return o.init=function(e){this._ntp=new t.default,this._media=e},o.onPrivNal=function(e){this._priv.keyAbstMs=e.abst,this._priv.keyPtsOrignMs=e.ptsOrignMs,this._priv.keyDtsOrignMs=e.timestamp},o.onParsing=function(e){e.framesInfo&&("video"===e.type?this._vLastFrameInfo=e.framesInfo[e.framesInfo.length-1]:"audio"===e.type&&(this._aLastFrameInfo=e.framesInfo[e.framesInfo.length-1]))},o.destroy=function(){this._ntp&&(this._ntp.destroy(),this._ntp=void 0)},o._renderDelay=function(e){var i=t.default.serverNowMs,r=this._priv;if(i&&e&&this._media&&r.keyAbstMs){var n=1e3*this._media.currentTime;return e.ptsMs-n+i-(e.ptsOrignMs-r.keyPtsOrignMs+r.keyAbstMs)}return 0},r=e,s=[{key:"workerTimeOffset",set:function(t){e._workerStartMs=t}}],(n=[{key:"displayDelay",get:function(){return this._renderDelay(this._vLastFrameInfo)}},{key:"audioRenderDelay",get:function(){return this._renderDelay(this._aLastFrameInfo)}},{key:"recDelay",get:function(){var i=this._vLastFrameInfo;if(t.default.serverNowMs&&i&&this._media){var r=this._priv;return t.default.serverMs(i.parseMs+e._workerStartMs)-(i.dtsOrignMs-r.keyDtsOrignMs+r.keyAbstMs)}return 0}}])&&i(r.prototype,n),s&&i(r,s),e}();n._workerStartMs=0;var s=n;e.default=s})?r.apply(t,n):r)||(e.exports=s)},"./src/monitor/monitor.ts":
/*!********************************!*\
  !*** ./src/monitor/monitor.ts ***!
  \********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! events */"./node_modules/events/events.js"),i(/*! url-parse */"./node_modules/url-parse/index.js"),i(/*! ../core/report-types */"./src/core/report-types.ts"),i(/*! ../preload/preload-cache */"./src/preload/preload-cache.ts"),i(/*! ../types/core */"./src/types/core.ts"),i(/*! ../types/monitor-data */"./src/types/monitor-data.ts"),i(/*! ../utils/get-hidden */"./src/utils/get-hidden.ts"),i(/*! ./download-beacon */"./src/monitor/download-beacon.ts"),i(/*! ./first-frame */"./src/monitor/first-frame.ts"),i(/*! ./fps */"./src/monitor/fps.ts"),i(/*! ./live-delay */"./src/monitor/live-delay.ts"),i(/*! ./realtime-beacon */"./src/monitor/realtime-beacon.ts"),i(/*! ./stream-monitor */"./src/monitor/stream-monitor.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u,l,d,c,f,h,_){function p(e){return e&&e.__esModule?e:{default:e}}function v(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m;e.__esModule=!0,e.default=void 0,r=p(r),c=p(c),f=p(f),h=p(h),function(e){e.NORMEL="normal",e.SEEK="seek",e.END="end",e.LEVEL_SWITCH="levelSwitch"}(m||(m={}));var g=function(e){var i,p;function g(t,i,r){var n;return(n=e.call(this)||this)._version=void 0,n._config=void 0,n._beaconTimer=void 0,n._runningStartTime=void 0,n._media=void 0,n._fps=void 0,n._firstFrame=void 0,n._data=void 0,n._realtimeBeacon=void 0,n._firstLoadTime=0,n._hiddenStart=!1,n._playing=!1,n._sm=void 0,n._seekLoadFlag=!1,n._liveDelay=void 0,n._version=t,n._config=r,n._beaconTimer=null,n._runningStartTime=performance.now(),n._firstFrame=new d.FirstFrame(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),i),n._sm=new _.StreamMonitor,n._media=i,i.video&&(n._fps=new c.default,n._fps.attachMedia(i.video)),r.isLive&&r.box===o.MediaBox.flv&&(n._liveDelay=new f.default,n._liveDelay.init(i)),n.reset(),n}p=e,(i=g).prototype=Object.create(p.prototype),i.prototype.constructor=i,i.__proto__=p;var y,b,E,T=g.prototype;return T.reset=function(e){void 0===e&&(e=!1),this._data=(0,a.getNewMonitorData)(this._version),this._data.reuse=e?1:0,this._sm.reset(),this._fps&&this._fps.reset(),this.refresh()},T.onReport=function(e){var t=this;e.ts=e.ts||performance.now();var i=this._data;switch(e.type){case n.REPORT_TYPES.LOADER_CHUNK_ARRIVAL:i.downloadedBytes+=e.byteLength,this._sm.onDataReceive(e),this._realtimeBeacon&&this._realtimeBeacon.setCustomHeader(e.header),this._processFirstFrame(d.FirstFrameEvents.DATA,e.ts);break;case n.REPORT_TYPES.MEDIA_DEMUX:this._processFirstFrame(d.FirstFrameEvents.DEMUX,e.ts);break;case n.REPORT_TYPES.LIVE_ADAPTIVE_QOS_STAT:e.bitrate_playing=this.playingInfo?this.playingInfo.bitrate:0,e.bitrate_downloading=this.loadingInfo?this.loadingInfo.bitrate:0,e.extra?e.extra.session_id=i.sessionId:e.extra={session_id:i.sessionId},this.emit("report",{type:"liveStreamAdaptiveQosStat",value:e});break;case n.REPORT_TYPES.HLS_VOD_ADAPTIVE_QOS_STAT:delete e.type,delete e.ts,e.session_id=i.sessionId,this.emit("report",{type:"hlsVodAdaptiveQosStat",value:e});break;case n.REPORT_TYPES.MUX_INFO:i.unknownTSPacketCount=i.unknownTSPacketCount||e.unknownTSPacketCount,i.audioNonMonotonous=i.audioNonMonotonous||e.audioNonMonotonous,i.aacOverhead=i.aacOverhead||e.aacOverhead;break;case n.REPORT_TYPES.NEW_SOURCE:e.urlId&&(i.urlId=e.urlId),this._sm.onStreamOpen(e.index||0,e.sync,e.url,e.bitrate),i.level=e.index,i.bandwidth=e.bitrate,i.qualityType=e.qualityType,i.protocol===o.Protocol.UNKNOWN&&(i.protocol="flv"===this._config.box?o.Protocol.FLV:o.Protocol.HLS);break;case n.REPORT_TYPES.KEY_FRAME:this._sm.onKeyFrame();break;case n.REPORT_TYPES.DISCONTINUITY:this.emit("report",{type:"discontinuity",value:e});break;case n.REPORT_TYPES.DOWNLOAD:if(e.cacheHit)return void(e.preload||(i.preloadCacheHit=1));i.preloadCacheFail=e.cacheFail?1:0,e.errorCode&&!this._firstFrame.complete&&this._firstFrame.onError(),i.download++;var r=(0,l.downloadBeacon)(e);r.session_id=i.sessionId,r.kernel_version=this._version,r.play_start_time=i.playStartTime||0,r.protocol=i.protocol,r.use_backup=i.useBackup,r.first_screen=i.firstScreenTotalDuration?1:0,1009===e.errorCode?setTimeout((function(){t.emit("report",{type:"download",value:r})}),0):this.emit("report",{type:"download",value:r});break;case n.REPORT_TYPES.LOST_FRAMES:i.cdnDropFrameCnt++,i.cdnDropFrameDuration+=Math.round(e.drop);break;case n.REPORT_TYPES.USE_BACKUP:i.useBackup=1;break;case n.REPORT_TYPES.ABR_INIT:i.abrAlgorithm=e.algorithm,i.abrLowProfile=e.lowProfile;break;case n.REPORT_TYPES.ABR_LOW_PROFILE:i.abrLowProfile=1}},T.heartbeat=function(){this.refresh();var e=this._data,t=this._sm,i={totalReceive:t.traffic,speed:t.downloadSpeed,videoDataRate:t.videoDataRate,audioDataRate:t.audioDataRate,decodedFPS:e.decodedFPS,droppedFPS:e.droppedFPS,decodedFrames:e.decodedFrames,droppedFrames:e.droppedFrames};this._refreshDelay(),this.emit("report",{type:"heartbeat",value:i})},T.refresh=function(){var e;this._fps&&(e=this._fps.checkFPSInterval());var t=this._data;e?(t.decodedFPS=e.decodedFPS,t.droppedFPS=e.droppedFPS,t.droppedFrames=e.dropped,t.decodedFrames=e.decoded):t.decodedFPS=t.droppedFPS=t.droppedFrames=t.decodedFrames=0},T.destroy=function(){this._sendRealtimeBeacon(m.END),this._stopBeaconTimer(),this._fps&&(this._fps.destory(),this._fps=void 0)},T.onPreloadHit=function(e){this._data.playStartTime=Date.now(),this._data.preloadHit=1,this._firstLoadTime||(this._firstLoadTime=performance.now(),this._hiddenStart=(0,u.getHidden)()),this._data.url=e,this._firstFrame.start(d.FirstFrameType.FIRST_FRAME),this._realtimeBeacon=new h.default(this._data,this._config),this._startBeaconTimer()},T.onPreload=function(){this._data.preloadCount++},T.onLoad=function(e,t){void 0===t&&(t=!1),t||(this._data.playStartTime=Date.now(),this._firstFrame.start(d.FirstFrameType.FIRST_FRAME),this._firstLoadTime||(this._firstLoadTime=performance.now(),this._hiddenStart=(0,u.getHidden)()),this._data.url=e,this._realtimeBeacon=new h.default(this._data,this._config))},T.onStopLoad=function(){this._sendRealtimeBeacon(m.END),this._stopBeaconTimer()},T.onManifest=function(e,t,i,r,n){void 0===n&&(n=0),e&&(this._data.url=e),this._data.protocol=t,this._data.startBitrate||(this._data.startBitrate=i),this._data.abrNow=this._data.abr=this._data.abr||r,this._processFirstFrame(d.FirstFrameEvents.MANIFEST,n)},T.onLevel=function(e){void 0===e&&(e=0),this._processFirstFrame(d.FirstFrameEvents.LEVEL,e)},T.onSegmentInit=function(e){this._sm.onMediaInfo(e)},T.onSegment=function(e){this._liveDelay&&this._liveDelay.onParsing(e),this._sm.onMediaSegment(e),this._processFirstFrame(d.FirstFrameEvents.SEGMENT,e.ts),this._data.segment++},T.onPrivNal=function(e){this._liveDelay&&this._liveDelay.onPrivNal(e)},T.onPlay=function(){this._startBeaconTimer()},T.onLoadeddata=function(){this._processFirstFrame(d.FirstFrameEvents.LOADEDDATA),this._waitingEnd()},T.onCanplay=function(){this._processFirstFrame(d.FirstFrameEvents.CANPLAY),this._waitingEnd()},T.onPlaying=function(){this._playing=!0,this._playStart(),this._pauseEnd(),this._waitingEnd()},T.onPause=function(){this._playEnd(),this._pauseStart()},T.onEnd=function(){this._playEnd(),this._pauseEnd(),this._waitingEnd(),this._sendRealtimeBeacon(m.END),this._stopBeaconTimer()},T.onWaiting=function(e,t){this._playing&&e&&this._waitingStart(t)},T.mseUpdate=function(){this._data.mseUpdate++},T.mseRemove=function(){this._data.mseRemove++},T.onSeek=function(e){void 0===e&&(e=!1),this._config.isLive||e||(this._data.seekStartTime=performance.now())},T.onSeekWithLoad=function(e){this._sendRealtimeBeacon(m.SEEK),this._resetBeaconTimer(),this._firstFrame.start(d.FirstFrameType.FIRST_FRAME_SEEK),this._sm.updateStartPos(e),this._seekLoadFlag=!0},T.onSeeked=function(){if(this._data.seekStartTime){this._data.seekCnt++;var e=Math.round(performance.now()-this._data.seekStartTime);this._data.seekDuration+=e,this._data.seekStartTime=0,this._seekLoadFlag&&(this._data.seekLoadCnt++,this._data.seekLoadDuration+=e)}this._seekLoadFlag=!1},T.onMSEBufferFull=function(){this._data.mseBufferFull++},T.mediaCapabilities=function(e){this._data.smoothBitrate=e},T.recoverMedia=function(){this._data.recoverMedia++},T.flvLiveRetry=function(){this._data.flvLiveRetry++},T.levelSwitching=function(e,t){e&&(this._data.url=e),this._data.abrNow=t,this._data.abr=this._data.abr||t},T.selectBitrate=function(){this._sendRealtimeBeacon(m.LEVEL_SWITCH),this._resetBeaconTimer(),this._firstFrame.start(d.FirstFrameType.FIRST_FRAME_SELECT_BITRATE)},T.onDurationChange=function(e){this._data.streamDuration=Math.round(1e3*e)},T.onRateChange=function(e){},T.onError=function(e,t){this._data.errorCode=e,this._data.errorMessage=t,this._realtimeBeacon&&this._realtimeBeacon.setError(e,t)},T._getRealtimeDuration=function(){var e=this._data;return{play:Math.round(e.playDuration+(e.playStartMS?performance.now()-e.playStartMS:0)),pause:Math.round(e.pauseDuration+(e.pauseStartMS?performance.now()-e.pauseStartMS:0)),buffer:Math.round(e.bufferTime+(e.bufferingStartMS?performance.now()-e.bufferingStartMS:0))}},T._getRealtimeBeacon=function(){if(!this._realtimeBeacon)return null;var e=this._sm,i=this._media,r=i.mseBufferedSecByType("video"),n=i.mseBufferedSecByType("audio"),s=i.currentTime,o=this._getRealtimeDuration(),a={play:0,pause:0,buffer:0,aBufStart:Math.round(1e3*n.start),aBufEnd:Math.round(1e3*n.end),aBufLen:Math.round(1e3*Math.max(0,n.end-s)),aBufCount:i.bufferSliceNumByType("audio"),vBufStart:Math.round(1e3*r.start),vBufEnd:Math.round(1e3*r.end),vBufLen:Math.round(1e3*Math.max(0,r.end-s)),vBufCount:i.bufferSliceNumByType("video"),aDataRate:Math.round(e.audioDataRate),vDataRate:Math.round(e.videoDataRate),currentTime:Math.round(1e3*s),bufferQueueCount:i.pendingNum(),videoReadyState:i.videoReadyState};return this._refreshDelay(),(0,t.ObjectAssign)(a,o),this.refresh(),this._realtimeBeacon.buildAndStartNewInterval(a)},T._processFirstFrame=function(e,t){void 0===t&&(t=0),!this._firstFrame.complete&&this._firstFrame.process(e,t)&&this._onFirstFrame()},T._playStart=function(){this._data.playStartMS=this._data.playStartMS||performance.now()},T._playEnd=function(){this._data.playStartMS&&(this._data.playDuration+=performance.now()-this._data.playStartMS),this._data.playStartMS=null},T._pauseStart=function(){this._data.pauseStartMS=this._data.pauseStartMS||performance.now()},T._pauseEnd=function(){this._data.pauseStartMS&&(this._data.pauseDuration+=performance.now()-this._data.pauseStartMS),this._data.pauseStartMS=null},T._waitingStart=function(e){this._data.blockCount++,this._data.bufferingStartMS=this._data.bufferingStartMS||performance.now(),e>.6&&this._data.renderBlockCount++},T._waitingEnd=function(){this._data.bufferingStartMS&&(this._data.bufferTime+=performance.now()-this._data.bufferingStartMS),this._data.bufferingStartMS=null},T._onFirstFrame=function(){this._data.firstScreenTotalDuration=this._data.firstScreenTotalDuration||Math.round(this._firstFrame.duration),this._data.firstScreenDetails=this._data.firstScreenDetails||this._firstFrame.details,this._realtimeBeacon&&this._realtimeBeacon.setFirstScreenDuration(this._firstFrame.duration,this._firstFrame.details)},T._startBeaconTimer=function(){null===this._beaconTimer&&(this._beaconTimer=setInterval(this._sendRealtimeBeacon.bind(this),1e4))},T._stopBeaconTimer=function(){this._beaconTimer&&(clearTimeout(this._beaconTimer),this._beaconTimer=null)},T._resetBeaconTimer=function(){this._stopBeaconTimer(),this._startBeaconTimer()},T._sendRealtimeBeacon=function(e){void 0===e&&(e=m.NORMEL);var t=this._getRealtimeBeacon();t&&(t.type=e,this.emit("report",{type:"realtimeBeacon",value:t}))},T._refreshDelay=function(){var e=this._liveDelay,t=this._data;e&&(t.displayDelay=Math.round(e.displayDelay),t.recDelay=Math.round(e.recDelay),t.audioRenderDelay=Math.round(e.audioRenderDelay))},y=g,(b=[{key:"sid",get:function(){return this._data.sessionId}},{key:"playingInfo",get:function(){return this._sm.getInfoByTime(this._media.currentTime)}},{key:"loadingInfo",get:function(){return this._sm.loadingInfo}},{key:"snapshot",get:function(){var e=this._sm,i={downloadSpeed:this._sm.downloadSpeed,videoDataRate:e.videoDataRate,audioDataRate:e.audioDataRate};return(0,t.ObjectAssign)(i,this._data,this._sm.data)}},{key:"data",get:function(){return this._data}},{key:"audienceStat",get:function(){var e=this._data,t=this._sm,i="",n=this.loadingInfo;n&&n.mediaInfo&&(i=(n.mediaInfo.videoCodec||"")+","+(n.mediaInfo.audioCodec||""));var a=this._getRealtimeDuration(),u={session_id:e.sessionId,kernel_version:this._version,play_start_time:e.playStartTime,play_duration:a.play,actual_play_duration:a.play-a.buffer,traffic:t.traffic>>10,buffer_time:a.buffer,block_cnt:e.blockCount,render_block_cnt:e.renderBlockCount,stream_duration:e.streamDuration,play_url:e.url,stream_host:new r.default(e.url).host,first_screen_total_duration:Math.round(e.firstScreenTotalDuration)||0,first_screen_details:e.firstScreenDetails||this._firstFrame.details||null,error_code:e.errorCode||0,error_message:e.errorMessage||"",remux_process_type:(this._config.streamingMux?1:0)+(this._config.gopRemux?1:0),hidden_start:this._hiddenStart?1:0,adaptive_multi_rate:this._config.adaptive?1:0,current_running_time:Math.round(performance.now()-e.startTime),running_time:Math.round(performance.now()-this._runningStartTime),codec:i,recover_media:e.recoverMedia,protocol:e.protocol,smooth_bitrate:e.smoothBitrate,start_bitrate:e.startBitrate||0,use_backup:e.useBackup,abr_algorithm:e.abrAlgorithm,abr:e.abr?1:0,abr_low_profile:e.abrLowProfile,mse_buffer_full:e.mseBufferFull,mse_remove:e.mseRemove,bitrate:e.bandwidth,reuse:e.reuse};return this._config.isLive?(u.skip_cnt=e.cdnDropFrameCnt,u.skip_duration=e.cdnDropFrameDuration,u.flv_live_retry=e.flvLiveRetry):(u.pause_duration=a.pause,u.seek_cnt=e.seekCnt,u.seek_duration=e.seekDuration,u.seek_load_cnt=e.seekLoadCnt,u.seek_load_duration=e.seekLoadDuration,u.start_sec=Math.round(this._config.startFromSec)),this._config.box===o.MediaBox.hls&&(u.url_id=e.urlId,u.unknown_ts_packet_count=e.unknownTSPacketCount,u.audio_non_monotonous=e.audioNonMonotonous,u.aac_overhead=e.aacOverhead,u.preload_hit=e.preloadHit,u.preload_cache_hit=e.preloadCacheHit,u.preload_cache_fail=e.preloadCacheFail,u.preload_cnt=e.preloadCount,u.db_quota_exceeded=s.preloadCache?s.preloadCache.quotaExceeded:0),e.qualityType&&(u.quality_type=e.qualityType),u}}])&&v(y.prototype,b),E&&v(y,E),g}(i.EventEmitter);e.default=g})?r.apply(t,n):r)||(e.exports=s)},"./src/monitor/realtime-beacon.ts":
/*!****************************************!*\
  !*** ./src/monitor/realtime-beacon.ts ***!
  \****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! url-parse */"./node_modules/url-parse/index.js"),i(/*! ../utils/get-header */"./src/utils/get-header.ts"),i(/*! ../utils/get-hidden */"./src/utils/get-hidden.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n){var s;e.__esModule=!0,e.default=void 0,i=(s=i)&&s.__esModule?s:{default:s};var o=function(){function e(e,t){this._data=void 0,this._config=void 0,this._snapshot=void 0,this._tickIndex=1,this._statTimestampMillis=0,this._statTimestampMillisUTC=0,this._firstScreen=!0,this._firstScreenDetails=void 0,this._firstScreenDuration=null,this._customeHttpHeader=void 0,this._errorCode=0,this._errorMessage="",this._data=e,this._config=t,this._tickIndex=1,this._snapshot={play:0,pause:0,buffer:0,blockCount:0,renderBlockCount:0,seekCnt:0,seekLoadCnt:0,decodedFrames:0,droppedFrames:0,downloadedBytes:0,cdnDropFrameCnt:0,cdnDropFrameDuration:0,download:0,mseUpdate:0,mseRemove:0,segment:0,preloadCount:0},this._resetForNewInterval()}var s=e.prototype;return s._updateSnapshot=function(e){var t={};for(var i in this._snapshot)"number"==typeof e[i]&&(t[i]=e[i]-this._snapshot[i],this._snapshot[i]=e[i]);return t},s._resetForNewInterval=function(){this._statTimestampMillis=performance.now(),this._statTimestampMillisUTC=Date.now(),this._customeHttpHeader=void 0,this._firstScreenDuration=null,this._firstScreenDetails=void 0,this._errorCode=0,this._errorMessage=""},s.setFirstScreenDuration=function(e,t){this._firstScreenDuration=Math.round(e),this._firstScreenDetails=t,this._firstScreen=!0},s.setCustomHeader=function(e){void 0===this._customeHttpHeader&&(this._customeHttpHeader=(0,r.getCustomHeader)(e)||null)},s.setError=function(e,t){this._errorCode=e,this._errorMessage=t},s.buildAndStartNewInterval=function(e){var r=this._data,s=this._config,o=this._updateSnapshot(r),a=this._updateSnapshot(e),u=performance.now(),l={skip_cnt:o.cdnDropFrameCnt,skip_duration:o.cdnDropFrameDuration,v_rec_delay:e.recDelay||0,v_render_delay:e.displayDelay||0,a_render_delay:e.audioRenderDelay||0},d={load_count:o.download,seek_cnt:o.seekCnt,seek_load_cnt:o.seekLoadCnt,pause_duration:a.pause,preload_cnt:o.preloadCount},c={tick_index:this._tickIndex,tick_start:this._statTimestampMillisUTC,tick_duration:Math.round(u-this._statTimestampMillis),domain:new i.default(r.url).host,error_code:this._errorCode,error_message:this._errorMessage,kernel_version:r.version,session_id:r.sessionId,play_url:r.url,play_start_time:r.playStartTime||0,adaptive_multi_rate:r.abrNow?1:0,bitrate:r.bandwidth||0,protocol:r.protocol,stream_duration:r.streamDuration||0,reuse:r.reuse,kbytes_received:o.downloadedBytes>>10,block_count:o.blockCount||0,render_block_count:o.renderBlockCount||0,decoded_video_frames:o.decodedFrames||0,dropped_video_frames:o.droppedFrames||0,mse_update_count:o.mseUpdate||0,mse_remove_count:o.mseRemove||0,segment_count:o.segment||0,play_duration:a.play||0,buffer_time:a.buffer||0,actual_play_duration:a.play&&a.buffer?a.play-a.buffer:0,played_video_duration:e.play||0,a_buf_start:e.aBufStart||0,a_buf_end:e.aBufEnd||0,a_buf_len:e.aBufLen||0,a_buf_slices:e.aBufCount||0,v_buf_start:e.vBufStart||0,v_buf_end:e.vBufEnd||0,v_buf_len:e.vBufLen||0,v_buf_slices:e.vBufCount||0,play_pos:e.currentTime||0,v_data_rate:e.vDataRate||0,a_data_rate:e.aDataRate||0,buffer_queue_count:e.bufferQueueCount||0,hidden:(0,n.getHidden)()?1:0,v_ready_state:e.videoReadyState};return this._firstScreen&&(null===this._firstScreenDuration?c.first_screen_total_duration=0:(c.first_screen_total_duration=this._firstScreenDuration,c.first_screen_details=this._firstScreenDetails,"hls"===s.box&&(c.preload_hit=r.preloadHit,c.preload_cache_hit=r.preloadCacheHit,c.preload_cache_fail=r.preloadCacheFail),this._firstScreenDetails=null,this._firstScreenDuration=null,this._firstScreen=!1)),this._customeHttpHeader&&(c.custom_http_header=this._customeHttpHeader),r.qualityType&&(c.quality_type=r.qualityType),"flv"===s.box?(0,t.ObjectAssign)(c,l):(0,t.ObjectAssign)(c,d),this._resetForNewInterval(),this._tickIndex++,c},e}();e.default=o})?r.apply(t,n):r)||(e.exports=s)},"./src/monitor/stream-monitor.ts":
/*!***************************************!*\
  !*** ./src/monitor/stream-monitor.ts ***!
  \***************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js")],void 0===(s="function"==typeof(r=function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.StreamMonitor=void 0;var r=function(){function e(){this._qos=void 0,this.reset()}var r,n,s,o=e.prototype;return o.reset=function(){this._qos={traffic:0,streams:[],download:[]}},o.onKeyFrame=function(){this._qos.streams[this._qos.streams.length-1].keyFrame++},o.onStreamOpen=function(e,t,i,r){this._qos.streams.length>10&&this._qos.streams.shift(),this._qos.streams.push({index:e,startPos:t,url:i,bitrate:r,traffic:0,loadTimeCost:0,keyFrame:0,videoDataRate:0,audioDataRate:0,segments:{}})},o.onMediaInfo=function(e){var i=this.loadingInfo;i&&(i.mediaInfo=(0,t.ObjectAssign)({},e))},o.onDataReceive=function(e){this._qos.traffic+=e.byteLength;var t=this._qos.download;t.length>200&&t.pop(),t.unshift(e);var i=this._qos.streams[this._qos.streams.length-1];i.traffic+=e.byteLength,i.loadTimeCost+=e.timeCost},o.onMediaSegment=function(e){var t=this._qos,i=t.streams[t.streams.length-1],r=i.segments[e.type]||[];i.segments[e.type]=r,r.push({duration:e.duration,dts:e.dts,len:e.byteLength}),r.length>100&&r.shift();for(var n=0,s=0,o=0;o<r.length;o++)s+=r[o].len,n+=r[o].duration;n>0&&("video"===e.type?i.videoDataRate=Math.round(8*s/n):"audio"===e.type&&(i.audioDataRate=Math.round(8*s/n)))},o.getInfoByTime=function(e){for(var t=this._qos.streams.length-1;t>=0;t--)if(this._qos.streams[t].startPos<e)return this._qos.streams[t];return null},o.updateStartPos=function(e){this._qos.streams.length&&(this._qos.streams[this._qos.streams.length-1].startPos=e)},r=e,(n=[{key:"loadingInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1]:null}},{key:"downloadSpeed",get:function(){for(var e=this._qos,t=performance.now(),i=0,r=0,n=0;n<e.download.length&&e.download[n].ts>t-1e3;n++)i+=e.download[n].byteLength,r+=e.download[n].timeCost;return Math.round(i/r*1e3)||0}},{key:"mediaInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].mediaInfo:null}},{key:"videoDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].videoDataRate:0}},{key:"audioDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].audioDataRate:0}},{key:"bitrate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].bitrate:0}},{key:"traffic",get:function(){return this._qos.traffic}},{key:"data",get:function(){return this._qos}}])&&i(r.prototype,n),s&&i(r,s),e}();e.StreamMonitor=r})?r.apply(t,n):r)||(e.exports=s)},"./src/polyfills/number-isFinite.js":
/*!******************************************!*\
  !*** ./src/polyfills/number-isFinite.js ***!
  \******************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.isFiniteNumber=void 0;var t=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};e.isFiniteNumber=t})?r.apply(t,n):r)||(e.exports=s)},"./src/polyfills/object-assign.js":
/*!****************************************!*\
  !*** ./src/polyfills/object-assign.js ***!
  \****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.ObjectAssign=void 0;var t=Object.assign||function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=n[s])}return i};e.ObjectAssign=t})?r.apply(t,n):r)||(e.exports=s)},"./src/preload/preload-cache.ts":
/*!**************************************!*\
  !*** ./src/preload/preload-cache.ts ***!
  \**************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../utils/db-cache */"./src/utils/db-cache.ts")],void 0===(s="function"==typeof(r=function(e,t){var i,r;e.__esModule=!0,e.initPreloadCache=function(){i||(e.preloadCache=i=new t.default("kwai","pre"))},e.preloadCache=void 0,t=(r=t)&&r.__esModule?r:{default:r},e.preloadCache=i})?r.apply(t,n):r)||(e.exports=s)},"./src/preload/preload-id.ts":
/*!***********************************!*\
  !*** ./src/preload/preload-id.ts ***!
  \***********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../demux/hls/loader/kwai-hls */"./src/demux/hls/loader/kwai-hls.ts")],void 0===(s="function"==typeof(r=function(e,t){var i;e.__esModule=!0,e.getMemID=function(e){if(e){if("string"==typeof e&&!r.test(e)){var i;try{i=JSON.parse(e)}catch(e){}e=i||e}if(t.default.verify(e)){var n=e.adaptationSet.representation;return n.sort((function(e,t){return e.bandwidth-t.bandwidth})),""+s(n[0].url)}if("string"==typeof e)return""}return""},e.getDBID=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=0),t+"_"+i+"_"+s(e)},t=(i=t)&&i.__esModule?i:{default:i};var r=new RegExp("^(http|https)://"),n=new RegExp("[?, #]");function s(e){var t=e.search(n);return t>0&&(e=e.slice(0,t)),e}})?r.apply(t,n):r)||(e.exports=s)},"./src/preload/preload-manager.ts":
/*!****************************************!*\
  !*** ./src/preload/preload-manager.ts ***!
  \****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! ../config */"./src/config.ts"),i(/*! ../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../utils/log */"./src/utils/log.ts"),i(/*! ./preload */"./src/preload/preload.ts"),i(/*! ./preload-id */"./src/preload/preload-id.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o){function a(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,r=a(r),s=a(s);var u=function(){function e(e){this.tag="preloadM",this._waiting=[],this._running=void 0,this._cache=[],this._active=!1,this._monitor=void 0,this._updateTimer=void 0,this._monitor=e}var a=e.prototype;return a.check=function(e,t){if(t)for(var i=(0,o.getMemID)(e),r=0;r<this._cache.length;r++)if(this._cache[r].data.id===i){if(!(performance.now()-this._cache[r].ts<72e5))return void this._cache.splice(r,1);var n=this._cache.splice(r,1)[0];if(n.data.auto&&t.abrNow||!n.data.auto&&!t.abrNow&&n.data.level===t.level)return n}},a.add=function(e,r){if(n.Log.i(this.tag,"add preload task"),e=(0,t.ObjectAssign)({},e),i.ConfigHelper.setSrc(e,r),r){var s={data:{id:"",config:e},ts:performance.now()};this._waiting.push(s),this._delayUpdate()}},a.active=function(e){void 0===e&&(e=!1),this._active!==e&&(e?(this._active=e,this._delayUpdate()):(this._active=e,clearTimeout(this._updateTimer)))},a.clean=function(){this._waiting=[],this._running&&(this._running.app&&this._running.app.destroy(),this._running=void 0),this._active=!1},a.destroy=function(){this.clean(),this._cache.forEach((function(e){e.app&&e.app.destroy()})),this._cache=[],clearTimeout(this._updateTimer)},a.hasCache=function(){return this._cache.length>0},a._delayUpdate=function(){var e=this;clearTimeout(this._updateTimer),this._updateTimer=setTimeout((function(){e._update()}),1e3)},a._update=function(){var e=this;if(!this._running&&this._waiting.length&&this._active){var t=this._running=this._waiting.shift();if(t){var i=t.data;if(t.data.id=(0,o.getMemID)(i.config.src||i.config.manifest),!t.data.id)return this._running=void 0,void this._update();for(var a=0;a<this._cache.length;a++)if(this._cache[a].data.id===t.data.id)return this._cache.push(this._cache.splice(a,1)[0]),this._running=void 0,this._update(),void n.Log.i(this.tag,"preload exist");var u=new s.default(t.data);t.app=u,u.on("end",(function(i){i&&(n.Log.i(e.tag,"preload task done",e._waiting.length),e._cache.push(t),e._cache.length>50&&e._cache.shift(),e._monitor.onPreload()),e._running=void 0,e._delayUpdate()})),u.on(r.default.REPORT,(function(t){e._monitor.onReport(t)}));var l=this._monitor.data;u.start(l.abrNow,l.level),n.Log.i(this.tag,"preload task start")}}},e}();e.default=u})?r.apply(t,n):r)||(e.exports=s)},"./src/preload/preload.ts":
/*!********************************!*\
  !*** ./src/preload/preload.ts ***!
  \********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../core/trans-hls */"./src/core/trans-hls.ts"),i(/*! ../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! events */"./node_modules/events/events.js"),i(/*! ../core/report-types */"./src/core/report-types.ts"),i(/*! ../core/media */"./src/core/media.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s){function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,t=o(t),i=o(i),s=o(s);var u=function(e){var r,o;function u(t){var r;return(r=e.call(this)||this)._data=void 0,r._trans=void 0,r._eQueue=[],r._events=void 0,r._timeout=void 0,r._backupConf={fragBeforeWorker:2,retryWithBackup:!0},r._onEvents=function(e){return function(t){r._eQueue.push({type:e,data:t})}},r._onError=function(){r.destroy(),r.emit("end",!1)},r._data=t,r._events=[i.default.PARSING_DATA,i.default.PARSING_INIT_SEGMENT,i.default.LOAD_END,i.default.LEVEL_SWITCH_FAILED,i.default.LEVEL_SWITCHING,i.default.BUFFER_FLUSHING,i.default.SCRIPT_PARSED,i.default.MANIFEST_PARSED,i.default.LEVEL_UPDATED,i.default.SEEK_KEYFRAME],r}o=e,(r=u).prototype=Object.create(o.prototype),r.prototype.constructor=r,r.__proto__=o;var l,d,c,f=u.prototype;return f.start=function(e,i){if(!this._trans){var r=this._data.config;this._data.auto=e,this._data.level=i,this._backupConf.fragBeforeWorker=r.fragBeforeWorker,this._backupConf.retryWithBackup=r.retryWithBackup,r.fragBeforeWorker=2,r.retryWithBackup=!1,this._trans=new t.default(r,new s.default,!0),this._trans&&(this._trans.init(),this._trans.streamingMux(!1),this._bind(this._trans),this._trans.loadSource(),this._timeout=setTimeout(this._onError,5e3))}},f.destroy=function(){this._trans&&(this._trans.removeAllListeners(),this._trans.destroy(),this._trans=void 0),this._eQueue=[],clearTimeout(this._timeout)},f.use=function(){var e=this;this._eQueue.forEach((function(t){e._trans&&e._trans.emit(t.type,t.data)})),this._trans=void 0},f._bind=function(e){var t=this;this._events.forEach((function(i){e.on(i,t._onEvents(i))})),e.on(i.default.PRELOAD_COMPLETE,(function(){t._data.config.fragBeforeWorker=t._backupConf.fragBeforeWorker,t._data.config.retryWithBackup=t._backupConf.retryWithBackup,e.removeAllListeners(),clearTimeout(t._timeout),t.emit("end",!0)})),e.on(i.default.REPORT,(function(e){e.type===n.REPORT_TYPES.DOWNLOAD?t.emit(i.default.REPORT,e):t._onEvents(i.default.REPORT)(e)})),e.on(i.default.ERROR,this._onError)},l=u,(d=[{key:"trans",get:function(){return this._trans}}])&&a(l.prototype,d),c&&a(l,c),u}(r.EventEmitter);e.default=u})?r.apply(t,n):r)||(e.exports=s)},"./src/remux/aac-helper.ts":
/*!*********************************!*\
  !*** ./src/remux/aac-helper.ts ***!
  \*********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();e.default=t})?r.apply(t,n):r)||(e.exports=s)},"./src/remux/mp4-generator.ts":
/*!************************************!*\
  !*** ./src/remux/mp4-generator.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ../types/remux */"./src/types/remux.ts")],void 0===(s="function"==typeof(r=function(e,t){e.__esModule=!0,e.default=void 0;var i=Math.pow(2,32)-1,r=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],hev1:[],hvcC:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),u=new Uint8Array([104,101,118,49]),l=new Uint8Array([0,0,0,1]);e.FTYP_AVC=e.box(e.types.ftyp,o,l,o,a),e.FTYP_HEVC=e.box(e.types.ftyp,o,l,o,u),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(var n,s=8,o=i.length,a=o;o--;)s+=i[o].byteLength;for((n=new Uint8Array(s))[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=255&s,n.set(e,4),o=0,s=8;o<a;o++)n.set(i[o],s),s+=i[o].byteLength;return n},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,r){r*=t;var n=Math.floor(r/(i+1)),s=Math.floor(r%(i+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,i))},e.moov=function(t){for(var i=t.length,r=[];i--;)r[i]=e.trak(t[i]);return e.box.apply(e,[e.types.moov].concat([e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t))))},e.mvex=function(t){for(var i=t.length,r=[];i--;)r[i]=e.trex(t[i]);return e.box.apply(e,[e.types.mvex].concat(r))},e.mvhd=function(t,r){r*=t;var n=Math.floor(r/(i+1)),s=Math.floor(r%(i+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,o)},e.sdtp=function(t){var i,r,n=t.samples||[],s=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,s[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,s)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,r,n,s=[],o=[];for(i=0;i<t.sps.length;i++)n=(r=t.sps[i]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));for(i=0;i<t.pps.length;i++)n=(r=t.pps[i]).byteLength,o.push(n>>>8&255),o.push(255&n),o=o.concat(Array.prototype.slice.call(r));var a=e.box(e.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|t.sps.length].concat(s).concat([t.pps.length]).concat(o))),u=t.width,l=t.height,d=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,c>>24,c>>16&255,c>>8&255,255&c])))},e.hev1=function(t){var i=t.hvcc,r=t.codecWidth,n=t.codecHeight,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.hev1,s,e.box(e.types.hvcC,i))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(i){return i.type===t.TrackType.audio?i.isAAC||"mp3"!==i.codec?e.box(e.types.stsd,e.STSD,e.mp4a(i)):e.box(e.types.stsd,e.STSD,e.mp3(i)):0===i.codec.indexOf("hev1")?e.box(e.types.stsd,e.STSD,e.hev1(i)):e.box(e.types.stsd,e.STSD,e.avc1(i))},e.tkhd=function(t){var r=t.id,n=t.duration*t.timescale,s=Math.floor(n/(i+1)),o=Math.floor(n%(i+1)),a=0,u=0;return t.hasOwnProperty("width")&&(a=t.width),t.hasOwnProperty("height")&&(u=t.height),e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,u>>8&255,255&u,0,0]))},e.traf=function(t,r){var n=e.sdtp(t),s=t.id,o=Math.floor(r/(i+1)),a=Math.floor(r%(i+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var r,n,s,o,a,u,l=t.samples||[],d=l.length,c=12+16*d,f=new Uint8Array(c);for(i+=8+c,f.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),r=0;r<d;r++)s=(n=l[r]).duration,o=n.size,a=n.flags,u=n.cts,f.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,f)},e.initSegment=function(t){e.types||e.init();for(var i=e.FTYP_AVC,r=t.length;r--;)"video"===t[r].type&&0===t[r].codec.indexOf("hev1")&&(i=e.FTYP_HEVC);var n=e.moov(t),s=new Uint8Array(i.byteLength+n.byteLength);return s.set(i),s.set(n,i.byteLength),s},e}();r.types=void 0,r.HDLR_TYPES=void 0,r.STTS=void 0,r.STSC=void 0,r.STCO=void 0,r.STSZ=void 0,r.VMHD=void 0,r.SMHD=void 0,r.STSD=void 0,r.FTYP_AVC=void 0,r.FTYP_HEVC=void 0,r.DINF=void 0;var n=r;e.default=n})?r.apply(t,n):r)||(e.exports=s)},"./src/remux/mp4-remuxer.ts":
/*!**********************************!*\
  !*** ./src/remux/mp4-remuxer.ts ***!
  \**********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/number-isFinite */"./src/polyfills/number-isFinite.js"),i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! ./aac-helper */"./src/remux/aac-helper.ts"),i(/*! ./mp4-generator */"./src/remux/mp4-generator.ts"),i(/*! ../core/kernel-events */"./src/core/kernel-events.ts"),i(/*! ../core/kernel-errors */"./src/core/kernel-errors.ts"),i(/*! ../utils/log */"./src/utils/log.ts"),i(/*! ../utils/browser */"./src/utils/browser.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o,a,u){function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0,r=l(r),n=l(n),s=l(s),u=l(u);var c=function(){function e(e,t,i,r){void 0===r&&(r=""),this._observer=void 0,this._config=void 0,this._typeSupported=void 0,this._isSafari=void 0,this._forceFirstIDR=void 0,this._stash=void 0,this._stashInfo=void 0,this._stashLastVideoSample=void 0,this._ISGenerated=!1,this._videoTime=void 0,this._extra=void 0,this._nextAudioPts=void 0,this._nextAvcDts=void 0,this._initPTS=void 0,this._initDTS=void 0,this._initSegment={},this._observer=e,this._config=t,this._typeSupported=i;var s=navigator.userAgent;this._isSafari=!(!(r&&r.indexOf("Apple")>-1&&s)||s.match("CriOS")),this._ISGenerated=!1,this._stash=t.streamingMux&&!t.gopRemux,this._resetVideoTime(),this._stashInfo={},n.default.types||n.default.init(),this._forceFirstIDR=!(!u.default.chrome||!(u.default.version.major<50||50===u.default.version.major&&u.default.version.build<2661))}var l,c,f,h=e.prototype;return h.setStat=function(e){e&&(this._ISGenerated=e.ISGenerated,this._nextAudioPts=e.nextAudioPts,this._nextAvcDts=e.nextAvcDts,this._initPTS=e.initPTS,this._initDTS=e.initDTS,this._videoTime.nbSamples=e.videoTime.nbSamples,this._videoTime.firstDTS=e.videoTime.firstDTS,this._videoTime.sampleDuration=e.videoTime.sampleDuration,this._videoTime.vLastPTS=e.videoTime.vLastPTS,this._videoTime.aLastPTS=e.videoTime.aLastPTS,this._videoTime.endDts=e.videoTime.endDts)},h.getStat=function(){return{ISGenerated:this._ISGenerated,nextAudioPts:this._nextAudioPts,nextAvcDts:this._nextAvcDts,initPTS:this._initPTS,initDTS:this._initDTS,videoTime:{nbSamples:this._videoTime.nbSamples,firstDTS:this._videoTime.firstDTS,sampleDuration:this._videoTime.sampleDuration,vLastPTS:this._videoTime.vLastPTS,aLastPTS:this._videoTime.aLastPTS,endDts:this._videoTime.endDts}}},h.destroy=function(){},h.setExtra=function(e){this._extra=e},h.resetTimeStamp=function(e){this._initPTS=this._initDTS=e,this._resetVideoTime()},h.resetInitSegment=function(){this._ISGenerated=!1,this._initSegment={},this.resetStash()},h.getLastPTS=function(){return{video:this._videoTime.vLastPTS,audio:this._videoTime.aLastPTS}},h.flush=function(e){void 0===e&&(e=0);var t=null;if(this._stash&&this._stashLastVideoSample){var i=this._stashInfo;i.track.samples=[this._stashLastVideoSample],this._stashLastVideoSample=null,i.sequenceNumber+=1,t=this.remuxVideo(i.track,i.timeOffset,!0,e,i.accurateTimeOffset)}return this.resetStash(),t},h.resetStash=function(){this._stashLastVideoSample=null,this._stashInfo={}},h.remux=function(e,r,n,o,u,l){if(void 0===l&&(l=!1),this._ISGenerated||this.generateIS(e,r,n),!o&&r.samples.length&&(r.samples[0].pts=r.samples[0].dts),this._ISGenerated){var d=l&&this._stashLastVideoSample?1:0,c=e.samples.length,f=r.samples.length,h=n,_=n;if(c&&f)if(!o&&u){if(e.samples[0].pts-r.samples[0].pts<0){var p=(0,i.ObjectAssign)({},r.samples[0]);p.dts=p.pts=e.samples[0].pts,r.samples.unshift(p)}}else{var v=(e.samples[0].pts-r.samples[0].pts)/r.inputTimeScale;h+=Math.max(0,v),_+=Math.max(0,-v)}if(c){e.timescale||(a.Log.w("regenerate InitSegment as audio detected"),this.generateIS(e,r,n));var m,g=this.remuxAudio(e,h,o,u);g&&(m=g.endPTS-g.startPTS),f?(r.timescale||(a.Log.w("regenerate InitSegment as video detected"),this.generateIS(e,r,n)),this.remuxVideo(r,_,o,m,u,l)):this.flush(m)}else{var y=null;f?y=this.remuxVideo(r,_,o,0,u,l):d&&(y=this.flush()),y&&e.codec&&(0,t.isFiniteNumber)(y.startDTS)&&(0,t.isFiniteNumber)(y.endDTS)&&this.remuxEmptyAudio(e,h,o,y)}}this._observer.trigger(s.default.HLS_FRAG_PARSED)},h.generateIS=function(e,t,i){var r,u,l=this._observer,d=e.samples,c=t.samples,f=this._typeSupported,h={},_={tracks:h},p=void 0===this._initPTS,v="audio/mp4";if(p&&(r=u=1/0),e.config&&d.length&&(e.timescale=e.samplerate,a.Log.v("audio sampling rate : "+e.samplerate),e.isAAC||(f.mpeg?(v="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3")),this._initSegment.audio=!e.isAAC&&f.mpeg?new Uint8Array:n.default.initSegment([e]),h.audio={container:v,codec:e.codec,metadata:{channelCount:e.channelCount,audioSampleRate:e.samplerate}},p&&(r=u=d[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&c.length){var m=t.inputTimeScale;t.timescale=m,this._initSegment.video=n.default.initSegment([t]),h.video={container:"video/mp4",codec:t.codec,metadata:{width:t.width,height:t.height,fps:t.fps,profile:t.profile,level:t.level,chromaFormat:t.chromaFormat}},p&&(r=Math.min(r||1/0,c[0].pts-m*i),u=Math.min(u||1/0,c[0].dts-m*i),this._observer.trigger(s.default.INIT_PTS_FOUND,{initPTS:r}))}Object.keys(h).length?(l.trigger(s.default.PARSING_INIT_SEGMENT,_),this._ISGenerated=!0,p&&(this._initPTS=r,this._initDTS=u)):l.trigger(s.default.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},h.remuxVideo=function(e,t,i,r,u,l){void 0===u&&(u=!1),void 0===l&&(l=!1);var d,c,f,h,_=e.timescale,p=e.samples,v=[],m=this._PTSNormalize,g=this._initPTS,y=p[0].dts/_,b=p[0].key,E=this._videoTime,T=[],S=8,w=0,R=0,x=0,L=p.length;if(void 0!==g){var k=this._nextAvcDts,A=this._isSafari;if(0===L||0===e.timescale)return null;if(A&&(i=i||!!(p.length&&k&&(u&&Math.abs(t-k/_)<.1||Math.abs(p[0].pts-k-g)<_/5))),i||(k=t*_,this._resetVideoTime()),void 0!==k){p.forEach((function(e){e.pts=m(e.pts-g,k),e.dts=m(e.dts-g,k)})),p.sort((function(e,t){var i=e.dts-t.dts,r=e.pts-t.pts;return i||r||e.id-t.id}));var O=p.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)}),0);if(O<0){a.Log.w("PTS < DTS detected in video samples, shifting DTS by "+Math.round(O/90)+" ms to overcome this issue");for(var P=0;P<p.length;P++)p[P].dts+=O}this._stash&&(this._stashInfo.timeOffset=t,this._stashInfo.accurateTimeOffset=u,this._stashInfo.track=e,this._stashLastVideoSample&&(L++,p.unshift(this._stashLastVideoSample),this._stashLastVideoSample=null),p.length>1&&!l&&(this._stashLastVideoSample=p.pop(),L--));var D=p[0];x=Math.max(D.dts,0),R=Math.max(D.pts,0);var I=Math.round((x-k)/90);i&&I&&(I>1?a.Log.v("AVC:"+I+" ms hole between fragments detected,filling it"):I<-1&&a.Log.v("AVC:"+-I+" ms overlapping between fragments detected"),R=Math.max(R-(x-k),k),x=k,p[0].dts=x,p[0].pts=R,a.Log.v("Video/PTS/DTS adjusted: "+Math.round(R/90)+"/"+Math.round(x/90)+",delta:"+I+" ms")),D=p[p.length-1],h=Math.max(D.dts,0),f=Math.max(D.pts,0,h),A&&(w=Math.round((h-x)/(p.length-1)));for(var M=0,C=0,N=0;N<L;N++){for(var F=p[N],U=F.units,B=U.length,j=0,V=0;V<B;V++)j+=U[V].data.length;C+=j,M+=B,F.length=j,F.dts=A?x+N*w:Math.max(F.dts,x),F.pts=Math.max(F.pts,F.dts)}var H=C+4*M+8;try{d=new Uint8Array(H)}catch(e){return this._observer.trigger(s.default.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating video mdat "+H}),null}var G=new DataView(d.buffer);G.setUint32(0,H),d.set(n.default.types.mdat,4);for(var K=0;K<L;K++){for(var W=p[K],z=W.units,q=0,Y=void 0,X=0,Q=z.length;X<Q;X++){var J=z[X],Z=J.data,$=J.data.byteLength;G.setUint32(S,$),S+=4,d.set(Z,S),S+=$,q+=4+$}if(A)Y=Math.max(0,w*Math.round((W.pts-W.dts)/w));else{if(K<L-1)w=p[K+1].dts-W.dts;else{var ee=this._config,te=0;if(te=this._stashLastVideoSample?this._stashLastVideoSample.dts-W.dts:e.refSampleDuration||E.sampleDuration||W.dts-p[K>0?K-1:K].dts,te=90*Math.floor(te/90),ee.stretchShortVideoTrack&&this._nextAudioPts){var ie=ee.maxBufferHole,re=Math.floor(ie*_),ne=(r?R+r*_:this._nextAudioPts)-W.pts;ne>re?((w=ne-te)<0&&(w=te),a.Log.v("It is approximately "+ne/90+" ms to the next segment; using duration "+w/90+" ms for the last video frame.")):w=te}else w=te}Y=Math.round(W.pts-W.dts)}if(w<0||isNaN(w)){var se=0;i&&p.length<2&&(se=90*I),w=Math.max((e.refSampleDuration||E.sampleDuration)-se,90)}v.push({size:q,duration:w,cts:Y,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:W.key?2:1,isNonSync:W.key?0:1}}),W.extraInfo&&(W.extraInfo.ptsMs=D.pts/_*1e3,T.push(W.extraInfo))}this._nextAvcDts=h+w;var oe=e.dropped;if(e.dropped=0,v.length&&this._forceFirstIDR){var ae=v[0].flags;ae.dependsOn=2,ae.isNonSync=0}e.samples=v,c=n.default.moof(e.sequenceNumber++,x,e),e.samples=[];var ue={payload:this._mergeBoxes("video",c,d),startPTS:R/_,endPTS:(f+w)/_,startDTS:x/_,endDTS:this._nextAvcDts/_,type:"video",hasAudio:!1,hasVideo:!0,nb:v.length,dropped:oe,streamDTS:y,key:b,extra:this._extra,framesInfo:T};return this._videoTime.vLastPTS=ue.endPTS,ue.endStreamDts=ue.endDTS-ue.startDTS+ue.streamDTS,this._observer.trigger(s.default.PARSING_DATA,ue),0===E.nbSamples&&(E.firstDTS=x),E.nbSamples+=L,E.sampleDuration=Math.round((this._nextAvcDts-E.firstDTS)/E.nbSamples),E.endDts=this._nextAvcDts,ue}}},h.remuxAudio=function(e,t,i,u){if(void 0===u&&(u=!1),!e.samples.length)return null;var l,d,c,f,h,_,p=e.inputTimeScale,v=e.timescale,m=p/v,g=e.isAAC?1024:1152,y=g*m,b=this._PTSNormalize,E=this._initPTS,T=!e.isAAC&&this._typeSupported.mpeg,S=[],w=[],R=e.samples[0].dts/p,x=T?0:8,L=e.samples,k=this._nextAudioPts,A=!1;if(void 0!==E){if(i=i||!!(L.length&&k&&(u&&Math.abs(t-k/p)<.1||Math.abs(L[0].pts-k-E)<20*y)),L.forEach((function(e){e.pts=e.dts=b(e.pts-E,t*p)})),0===(L=L.filter((function(e){return e.pts>=0}))).length)return null;if(i&&void 0!==k||(k=u?t*p:L[0].pts,A=!0),void 0!==k){if(e.isAAC)for(var O=this._config.maxAudioFramesDrift,P=0,D=k;P<L.length;){var I=L[P],M=I.pts-D,C=Math.abs(1e3*M/p);if(M<=-O*y)a.Log.w("Dropping 1 audio frame @ "+(D/p).toFixed(3)+"s due to "+Math.round(C)+" ms overlap."),L.splice(P,1);else if(M>=O*y&&C<1e5&&D){var N=Math.round(M/y);a.Log.w("Injecting "+N+" audio frame @ "+(D/p).toFixed(3)+"s due to "+Math.round(1e3*M/p)+" ms gap.");for(var F=0;F<N;F++){var U=Math.max(D,0);(d=r.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(a.Log.v("Unable to get silent frame for given audio codec; duplicating last frame instead."),d=I.unit.subarray()),L.splice(P,0,{unit:d,pts:U,dts:U}),D+=y,P++}I.pts=I.dts=D,D+=y,P++}else Math.abs(M),I.pts=I.dts=D,D+=y,P++}for(var B=L.length,j=0;B--;)j+=L[B].unit.byteLength;for(var V=0,H=L.length;V<H;V++){var G=L[V],K=G.unit,W=G.pts;if(void 0!==_&&l)l.duration=Math.round((W-_)/m);else{var z=Math.round(1e3*(W-k)/p),q=0;if(i&&e.isAAC&&z){if(z>0&&z<1e5)q=Math.round((W-k)/y),a.Log.v(z+" ms hole between AAC samples detected,filling it"),q>0&&((d=r.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(d=K.subarray()),j+=q*d.length);else if(z<-12){a.Log.v("drop overlapping AAC sample, expected/parsed/delta:"+(k/p).toFixed(3)+"s/"+(W/p).toFixed(3)+"s/"+-z+"ms"),j-=K.byteLength;continue}W=k}if(h=W,!(j>0))return e.samples=[],null;j+=x;try{c=new Uint8Array(j)}catch(e){return this._observer.trigger(s.default.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:j,reason:"fail allocating audio mdat "+j}),null}T||(new DataView(c.buffer).setUint32(0,j),c.set(n.default.types.mdat,4));for(var Y=0;Y<q;Y++)(d=r.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(a.Log.v("Unable to get silent frame for given audio codec; duplicating this frame instead."),d=K.subarray()),c.set(d,x),x+=d.byteLength,l={size:d.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},S.push(l)}if(!c)return;c.set(K,x);var X=K.byteLength;x+=X,l={size:X,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},S.push(l),G.extraInfo&&(G.extraInfo.ptsMs=W/p*1e3,w.push(G.extraInfo)),_=W}var Q=0;if(B=S.length,l){if(B>=2&&(Q=S[B-2].duration,l.duration=Q),B&&"number"==typeof _&&c){l&&0===l.duration&&(l.duration=e.isAAC?1024:1152),this._nextAudioPts=k=_+m*(Q||g),e.samples=S,f=T?new Uint8Array:n.default.moof(e.sequenceNumber++,h/m,e),e.samples=[];var J=h/p,Z=k/p,$={payload:this._mergeBoxes("audio",f,c),startPTS:J,endPTS:Z,startDTS:J,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:B,streamDTS:R,endStreamDts:Z-J+R,extra:this._extra,framesInfo:w};return this._videoTime.aLastPTS=$.endPTS,this._observer.trigger(s.default.PARSING_DATA,$),$}return A&&delete this._nextAudioPts,e.samples=[],null}}}},h.remuxEmptyAudio=function(e,t,i,n){if(void 0!==this._initDTS){var s=e.inputTimeScale,o=s/(e.samplerate?e.samplerate:s),u=this._nextAudioPts,l=(void 0!==u?u:n.startDTS*s)+this._initDTS,d=n.endDTS*s+this._initDTS,c=1024*o,f=Math.ceil((d-l)/c),h=r.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(a.Log.w("remux empty Audio"),h){for(var _=[],p=0;p<f;p++){var v=l+p*c;_.push({unit:h,pts:v,dts:v})}e.samples=_,this.remuxAudio(e,t,i)}else a.Log.d("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},h._PTSNormalize=function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e},h._resetVideoTime=function(){this._videoTime={nbSamples:0,firstDTS:0,sampleDuration:3e3,vLastPTS:0,aLastPTS:0}},h._mergeBoxes=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this._initSegment[e]&&(i.unshift(this._initSegment[e]),delete this._initSegment[e]);var n=i.reduce((function(e,t){return t?e+t.byteLength:e}),0),s=new Uint8Array(n),o=0;return i.forEach((function(e){e&&(s.set(e,o),o+=e.byteLength)})),s},l=e,(c=[{key:"ISGenerated",get:function(){return this._ISGenerated}}])&&d(l.prototype,c),f&&d(l,f),e}();e.default=c})?r.apply(t,n):r)||(e.exports=s)},"./src/trans-conf.ts":
/*!***************************!*\
  !*** ./src/trans-conf.ts ***!
  \***************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./core/trans-flv */"./src/core/trans-flv.ts"),i(/*! ./core/trans-hls */"./src/core/trans-hls.ts")],void 0===(s="function"==typeof(r=function(e,t,i){function r(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,t=r(t);var n={hls:(i=r(i)).default,flv:t.default};e.default=n})?r.apply(t,n):r)||(e.exports=s)},"./src/types/core.ts":
/*!***************************!*\
  !*** ./src/types/core.ts ***!
  \***************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){var t,i;e.__esModule=!0,e.MediaBox=e.Protocol=void 0,e.Protocol=t,function(e){e.UNKNOWN="unknown",e.FLV="flv",e.HLS="hls",e.ABR_FLV="abrFlv",e.KWAI_HLS="kwaiHls",e.KWAI_HLS_SLICE="kwaiHlsSlice",e.KWAI_FLV="kwaiFlv"}(t||(e.Protocol=t={})),e.MediaBox=i,function(e){e.flv="flv",e.hls="hls"}(i||(e.MediaBox=i={}))})?r.apply(t,n):r)||(e.exports=s)},"./src/types/monitor-data.ts":
/*!***********************************!*\
  !*** ./src/types/monitor-data.ts ***!
  \***********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! uuid */"./node_modules/uuid/index.js"),i(/*! ./core */"./src/types/core.ts")],void 0===(s="function"==typeof(r=function(e,t,i){e.__esModule=!0,e.getNewMonitorData=function(e){return void 0===e&&(e=""),{version:e,decodedFPS:0,droppedFPS:0,decodedFrames:0,droppedFrames:0,sessionId:(0,t.v4)(),startTime:performance.now(),playStartTime:0,playDuration:0,pauseDuration:0,bufferTime:0,blockCount:0,renderBlockCount:0,streamDuration:0,seekCnt:0,seekDuration:0,seekLoadCnt:0,seekLoadDuration:0,seekStartTime:0,recoverMedia:0,flvLiveRetry:0,urlId:0,url:"",unknownTSPacketCount:0,audioNonMonotonous:0,startBitrate:0,smoothBitrate:-1,useBackup:0,abrAlgorithm:0,abrLowProfile:0,abr:!1,mseBufferFull:0,aacOverhead:0,protocol:i.Protocol.UNKNOWN,errorCode:0,errorMessage:"",bandwidth:0,downloadedBytes:0,cdnDropFrameCnt:0,cdnDropFrameDuration:0,download:0,mseUpdate:0,segment:0,mseRemove:0,preloadHit:0,preloadCount:0,preloadCacheHit:0,preloadCacheFail:0,reuse:0,videoReadyState:0}}})?r.apply(t,n):r)||(e.exports=s)},"./src/types/remux.ts":
/*!****************************!*\
  !*** ./src/types/remux.ts ***!
  \****************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){var t,i;e.__esModule=!0,e.RemuxerTrackIdConfig=e.TrackType=void 0,e.TrackType=t,function(e){e.video="video",e.audio="audio"}(t||(e.TrackType=t={})),e.RemuxerTrackIdConfig=i,function(e){e[e.video=1]="video",e[e.audio=2]="audio"}(i||(e.RemuxerTrackIdConfig=i={}))})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/attr-list.js":
/*!********************************!*\
  !*** ./src/utils/attr-list.js ***!
  \********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,r=function(){function e(t){for(var i in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(i)&&(this[i]=t[i])}var r=e.prototype;return r.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},r.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(2*r,2*r+2),16);return i}return null},r.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},r.decimalFloatingPoint=function(e){return parseFloat(this[e])},r.enumeratedString=function(e){return this[e]},r.decimalResolution=function(e){var i=t.exec(this[e]);return null===i?null:{width:parseInt(i[1],10),height:parseInt(i[2],10)}},e.parseAttrList=function(e){var t,r={};for(i.lastIndex=0;null!==(t=i.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1]]=n}return r},e}();e.default=r})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/binary-search.ts":
/*!************************************!*\
  !*** ./src/utils/binary-search.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t={search:function(e,t){for(var i=0,r=e.length-1,n=null,s=null;i<=r;){var o=t(s=e[n=(i+r)/2|0]);if(o>0)i=n+1;else{if(!(o<0))return s;r=n-1}}return null},searchIndex:function(e,t){for(var i=0,r=e.length-1,n=null;i<=r;){var s=t(e[n=(i+r)/2|0]);if(s>0)i=n+1;else{if(!(s<0))return n;r=n-1}}return-1}};e.default=t})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/bitrate-to-index.ts":
/*!***************************************!*\
  !*** ./src/utils/bitrate-to-index.ts ***!
  \***************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.bitrateToIndex=function(e,t){return e.reduce((function(i,r,n){return(e[i].bitrate+r.bitrate)/2>=t?i:n}),0)}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/browser.ts":
/*!******************************!*\
  !*** ./src/utils/browser.ts ***!
  \******************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t={};!function(){var e=self.navigator.userAgent.toLowerCase(),i=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:i[5]||i[3]||i[1]||"",version:i[2]||i[4]||"0",majorVersion:i[4]||i[2]||"0",platform:r[0]||""},s={};if(n.browser){s[n.browser]=!0;var o=n.majorVersion.split(".");s.version={major:parseInt(n.majorVersion,10),string:n.version},o.length>1&&(s.version.minor=parseInt(o[1],10)),o.length>2&&(s.version.build=parseInt(o[2],10))}for(var a in n.platform&&(s[n.platform]=!0),(s.chrome||s.opr||s.safari)&&(s.webkit=!0),(s.rv||s.iemobile)&&(s.rv&&delete s.rv,n.browser="msie",s.msie=!0),s.edge&&(delete s.edge,n.browser="msedge",s.msedge=!0),s.opr&&(n.browser="opera",s.opera=!0),s.safari&&s.android&&(n.browser="android",s.android=!0),s.name=n.browser,s.platform=n.platform,t)t.hasOwnProperty(a)&&delete t[a];t=s}();var i=t;e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/codecs.ts":
/*!*****************************!*\
  !*** ./src/utils/codecs.ts ***!
  \*****************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./mediasource-helper */"./src/utils/mediasource-helper.ts")],void 0===(s="function"==typeof(r=function(e,t){e.__esModule=!0,e.isCodecType=function(e,t){var r=i[t];return!!r&&!0===r[e.slice(0,4)]},e.isCodecSupportedInMp4=function(e,i){return void 0===i&&(i=""),(0,t.getMediaSource)().isTypeSupported((i||"video")+'/mp4;codecs="'+e+'"')};var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/db-cache.ts":
/*!*******************************!*\
  !*** ./src/utils/db-cache.ts ***!
  \*******************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! ./idb */"./src/utils/idb.ts"),i(/*! ../utils/log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r){function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s;e.__esModule=!0,e.default=void 0,i=(s=i)&&s.__esModule?s:{default:s};var o={version:1,indexKey:"index",expired:604800,limit:200,loadTimeout:100},a=function(){function e(e,r,n){this.tag="db-cache",this._idb=void 0,this._config=void 0,this._cacheIndex={list:[]},this._ready=!1,this._quotaExceeded=0,this._config=(0,t.ObjectAssign)({},o,n),this._idb=new i.default(e,r),this._readCacheIndex()}e.isSupport=function(){return!!indexedDB};var s,a,u,l=e.prototype;return l.hit=function(e){return this.ready?this._indexOfCacheIndex(e):-2},l.get=function(e,t){if(r.Log.i(this.tag,"get",e),this.ready){var i=this._config,n=this._cacheIndex,s=this._indexOfCacheIndex(e),o=!1;if(s>-1){var a=n.list[s];Date.now()-a.time<1e3*i.expired?(r.Log.i(this.tag,"read db",e),setTimeout((function(){o||(o=!0,t())}),i.loadTimeout),this._idb.get(e,(function(e,i){o||(o=!0,t(e,i))}))):(r.Log.i(this.tag,"get expired",e),this.del([e]),t())}else t()}},l.put=function(e,i){var n=this;if(r.Log.i(this.tag,"put",e),this.ready&&!this._checkLimit(this._config.limit)){var s=this._config,o=this._cacheIndex,a=(0,t.ObjectAssign)({},o),u=this._indexOfCacheIndex(e);u>-1?(a.list[u].time=Date.now(),a.list.push(a.list.splice(u,1)[0])):a.list.push({id:e,time:Date.now()}),this._idb.run({exec:function(t){return t.put(a,s.indexKey),t.put(i,e),t.get(s.indexKey)},callback:function(e,t){e?22===e.code&&(s.limit=o.list.length,n._quotaExceeded++):t&&(o=t.result)}})}},l.del=function(e){var i=this;if(r.Log.i(this.tag,"delete",e),this.ready&&e.length){var n=this._config.indexKey,s=(this._cacheIndex,(0,t.ObjectAssign)({},this._cacheIndex));e.forEach((function(e){var t=i._indexOfCacheIndex(e);t>-1&&s.list.splice(t,1)})),this._idb.run({exec:function(t){return e.forEach((function(e){t.delete(e)})),t.put(s,n),t.get(n)},callback:function(e,t){e||t&&t.result}})}},l.refresh=function(){var e=this;if(this.ready){var t=this._cacheIndex;this._idb.count(void 0,(function(i,r){r&&(parseInt(r.result)-t.list.length!=1?e._clear():e._checkExpired())}))}},l._readCacheIndex=function(){var e=this;r.Log.i(this.tag,"read index"),this._idb.get(this._config.indexKey,(function(t,i){t||(i&&i.result?e._verifyCacheIndex(i.result)?e._cacheIndex.list=i.result.list:e._clear():r.Log.i(e.tag,"no index"),e._ready=!0)}))},l._checkExpired=function(){if(r.Log.i(this.tag,"check expired"),this.ready){var e=this._config,t=this._cacheIndex,i=Date.now(),n=[];t.list.forEach((function(t){i-t.time>e.expired&&n.push(t.id)})),n.length&&this.del(n)}},l._checkLimit=function(e){var t=this._cacheIndex;if(e<=t.list.length){for(var i=Math.ceil(.2*t.list.length),r=[],n=0;n<i;n++)r.push(t.list[n].id);return this.del(r),r.length>0}return!1},l._clear=function(){var e=this;r.Log.i(this.tag,"clear"),this.ready&&this._idb.clear((function(t,i){t||(e._cacheIndex.list=[])}))},l._verifyCacheIndex=function(e){return!!(e&&e.list&&Array.isArray(e.list))},l._indexOfCacheIndex=function(e){for(var t=this._cacheIndex.list,i=0;i<t.length;i++)if(t[i].id===e)return i;return-1},s=e,(a=[{key:"ready",get:function(){return this._ready&&"error"!==this._idb.state}},{key:"quotaExceeded",get:function(){return this._quotaExceeded}}])&&n(s.prototype,a),u&&n(s,u),e}();e.default=a})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/decodeUTF8.ts":
/*!*********************************!*\
  !*** ./src/utils/decodeUTF8.ts ***!
  \*********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){function t(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}e.__esModule=!0,e.default=void 0;var i=function(e){for(var i=[],r=e,n=0,s=e.length;n<s;)if(r[n]<128)i.push(String.fromCharCode(r[n])),++n;else{if(r[n]<192);else if(r[n]<224){if(t(r,n,1)){var o=(31&r[n])<<6|63&r[n+1];if(o>=128){i.push(String.fromCharCode(65535&o)),n+=2;continue}}}else if(r[n]<240){if(t(r,n,2)){var a=(15&r[n])<<12|(63&r[n+1])<<6|63&r[n+2];if(a>=2048&&55296!=(63488&a)){i.push(String.fromCharCode(65535&a)),n+=3;continue}}}else if(r[n]<248&&t(r,n,3)){var u=(7&r[n])<<18|(63&r[n+1])<<12|(63&r[n+2])<<6|63&r[n+3];if(u>65536&&u<1114112){u-=65536,i.push(String.fromCharCode(u>>>10|55296)),i.push(String.fromCharCode(1023&u|56320)),n+=4;continue}}i.push(String.fromCharCode(65533)),++n}return i.join("")};e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/download-info.ts":
/*!************************************!*\
  !*** ./src/utils/download-info.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! ../core/report-types */"./src/core/report-types.ts"),i(/*! ./get-error-code */"./src/utils/get-error-code.ts"),i(/*! ./get-header */"./src/utils/get-header.ts"),i(/*! ./get-resource-timing */"./src/utils/get-resource-timing.ts"),i(/*! ../core/kernel-errors */"./src/core/kernel-errors.ts")],void 0===(s="function"==typeof(r=function(e,t,i,r,n,s,o){var a;e.__esModule=!0,e.downloadInfo=function(e,u,l,d,c){void 0===c&&(c=!1);var f={type:i.REPORT_TYPES.DOWNLOAD,url:u.url,startTime:l.tsload,spendTime:l.tload?Math.round(l.tload-l.tstart):Math.round(performance.now()-l.tstart),httpResponseTime:l.tfirst?Math.round(l.tfirst-l.tstart):0,status:e,httpStatusCode:l.code,retry:l.retry,errorCode:0,errorMessage:"",loaderId:l.id,byteLength:l.total||l.loaded||0,resourceType:u.type||"",preload:c,cacheHit:!!l.cacheHit,cacheFail:!!l.cacheFail},h=u.frag;if(h&&(f.slice=!0,f.slicePlayStartTime=Math.round(1e3*h.start),f.slicePlayDuration=Math.round(1e3*h.duration),f.sliceIndex=h.sn,f.sliceLevelIndex=h.level,d&&d[h.level]&&(f.sliceBitrate=d[h.level].bitrate)),e===a.FAIL&&(f.errorCode=(0,r.getErrorCode)(o.ErrorDetails.LOAD_ERROR,l.text,l.code)),l.text&&(f.errorMessage=l.text),u.responseHeader){var _=(0,n.getCustomHeader)(u.responseHeader);_&&(f.customHeader=_)}f.rangeStart=u.rangeStart,f.rangeEnd=u.rangeEnd;var p=(0,s.getResourceTiming)(u.url);return p&&(0,t.ObjectAssign)(f,p),f},e.DownloadStatus=void 0,e.DownloadStatus=a,function(e){e.FAIL="FAIL",e.ABORT="ABORT",e.SUCCESS="SUCCESS"}(a||(e.DownloadStatus=a={}))})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/get-error-code.ts":
/*!*************************************!*\
  !*** ./src/utils/get-error-code.ts ***!
  \*************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.getErrorCode=function(e,i,r){if(void 0===r&&(r=0),e>=100)return e;var n="00";return"timeout"===i?n=r?t.timeoutIO||n:t.timeoutOpen||n:t.hasOwnProperty(r)?n=t[r]||n:/^4\d{2}$/.test(r.toString())?n=t.other4xx||n:/^5\d{2}$/.test(r.toString())&&(n=t.serverError||n),parseInt(e+n,10)};var t={400:"01",401:"02",403:"03",404:"04",other4xx:"05",serverError:"06",timeoutOpen:"07",timeoutIO:"08",200:"09",206:"09"}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/get-header.ts":
/*!*********************************!*\
  !*** ./src/utils/get-header.ts ***!
  \*********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.getHeader=i,e.getCustomHeader=function(e){var r=i(e),n=[];return r&&(n=[],r.forEach((function(e){-1!==t.indexOf(e[0].toLowerCase())&&n.push(e[0]+": "+e[1].slice(0,255))}))),n.length?(n.slice(0,10),n):null};var t=["x-ks-cache","kwaisign","x-ks-request-id","x-ks-client-ip"];function i(e){var t=[];return"string"==typeof e?e.trim().split(/[\r\n]+/).forEach((function(e){var i=e.split(": "),r=i.shift(),n=i.join(":");r&&t.push([r,n])})):e&&e.forEach((function(e,i){e.split(",").forEach((function(e){t.push([i,e])}))})),t}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/get-hidden.ts":
/*!*********************************!*\
  !*** ./src/utils/get-hidden.ts ***!
  \*********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.getHidden=function(){for(var e=document,t=0,i=["hidden","webkitHidden","mozHidden"];t<i.length;t++){var r=i[t];if(r in e)return e[r]}return null}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/get-resource-timing.ts":
/*!******************************************!*\
  !*** ./src/utils/get-resource-timing.ts ***!
  \******************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.setResourceTimingBufferSize=function(e){performance&&("function"==typeof performance.setResourceTimingBufferSize?performance.setResourceTimingBufferSize(e):"function"==typeof performance.webkitSetResourceTimingBufferSize&&performance.webkitSetResourceTimingBufferSize(e))},e.clearResourceTimings=function(){performance&&("function"==typeof performance.clearResourceTimings?performance.clearResourceTimings():"function"==typeof performance.webkitClearResourceTimings&&performance.webkitClearResourceTimings())},e.getResourceTiming=function(e){if(performance&&"function"==typeof performance.getEntriesByName){var t=performance.getEntriesByName(e,"resource");if(t.length){var i=t[t.length-1],r={};return i.redirectStart&&(r.redirect=i.redirectEnd-i.redirectStart),r.dns=i.domainLookupEnd-i.domainLookupStart,r.tcp=i.connectEnd-i.connectStart,r.request=i.requestStart-i.connectEnd,r.firstResponse=i.responseStart-i.requestStart,i.responseStart>0?r.response=i.responseEnd-i.responseStart:r.response=i.responseEnd-i.fetchStart,r.duration=i.duration||0,r}}return null}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/get-self-scope.ts":
/*!*************************************!*\
  !*** ./src/utils/get-self-scope.ts ***!
  \*************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.getSelfScope=function(){return"undefined"==typeof window?self:window}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/idb.ts":
/*!**************************!*\
  !*** ./src/utils/idb.ts ***!
  \**************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.__esModule=!0,e.default=void 0;var i=function(){function e(e,t,i,r){var n=this;void 0===r&&(r=1),this._name=void 0,this._storeName=void 0,this._dbIndex=void 0,this._version=void 0,this._db=void 0,this._error=void 0,this._taskQueue=[],this._runTaskQueue=function(){for(;n._taskQueue.length;){var e=n._taskQueue.shift();e&&n.run(e.task,e.mode)}},this._name=e,this._storeName=t,this._dbIndex=i,this._version=r,this._initDB()}var i,r,n,s=e.prototype;return s.run=function(e,t){void 0===t&&(t="readwrite"),this._db||this._error?this._getStore(e,t):this._taskQueue.push({task:e,mode:t})},s.put=function(e,t,i){this.run({exec:function(i){return i.put(t,e)},callback:i})},s.get=function(e,t){this.run({exec:function(t){return t.get(e)},callback:t},"readonly")},s.count=function(e,t){this.run({exec:function(t){return t.count(e)},callback:t})},s.del=function(e,t){this.run({exec:function(t){return t.delete(e)},callback:t})},s.clear=function(e){this.run({exec:function(e){return e.clear()},callback:e})},s._getStore=function(e,t){if(void 0===t&&(t="readwrite"),this._db){var i,r=this._db.transaction(this._storeName,t);if(e.callback){var n=e.callback;r.oncomplete=function(){return n(void 0,i)},r.onabort=r.onerror=function(){return n(r.error)}}i=e.exec(r.objectStore(this._storeName))}else e.callback&&e.callback(this._error)},s._initDB=function(){var e=this;if(!this._db&&window.indexedDB){var t=window.indexedDB.open(this._name,this._version);t.onerror=function(){return e._error=t.error},t.onsuccess=function(){e._db=t.result,e._runTaskQueue()},t.onupgradeneeded=function(){t.result.objectStoreNames.contains(e._storeName)&&t.result.deleteObjectStore(e._storeName);var i=t.result.createObjectStore(e._storeName);e._dbIndex&&e._dbIndex.forEach((function(e){i.createIndex(e.name,e.keyPath,e.option)}))}}},i=e,(r=[{key:"state",get:function(){return this._error?"error":this._db?"ready":"initializing"}}])&&t(i.prototype,r),n&&t(i,n),e}();e.default=i})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/is-supported.ts":
/*!***********************************!*\
  !*** ./src/utils/is-supported.ts ***!
  \***********************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./mediasource-helper */"./src/utils/mediasource-helper.ts")],void 0===(s="function"==typeof(r=function(e,t){e.__esModule=!0,e.isSupported=function(){var e=(0,t.getMediaSource)(),i=window.SourceBuffer||window.WebKitSourceBuffer,r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!i||i.prototype&&"function"==typeof i.prototype.appendBuffer&&"function"==typeof i.prototype.remove;return r&&n}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/kwai-live-abs-time.ts":
/*!*****************************************!*\
  !*** ./src/utils/kwai-live-abs-time.ts ***!
  \*****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./src/polyfills/object-assign */"./src/polyfills/object-assign.js"),i(/*! ../io/loader */"./src/io/loader.ts")],void 0===(s="function"==typeof(r=function(e,t,i){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}var s;e.__esModule=!0,e.default=void 0,i=(s=i)&&s.__esModule?s:{default:s};var o={local:0,server:0},a=function(){function e(){this._loader=void 0,this._callback=void 0,this._loaderConfig=void 0,this._callback={onError:this._onLoaderError.bind(this),onEnd:this._onLoaderEnd.bind(this),onAbort:this._onLoaderAbort.bind(this)},this._loaderConfig={useFetch:!1,connectionTimeout:5e3}}e.serverMs=function(e){return o.server?e-o.local+o.server:null},n(e,null,[{key:"serverNowMs",get:function(){return o.server?performance.now()-o.local+o.server:null}}]);var r=e.prototype;return r.update=function(e){e?o={server:e,local:0}:this.load()},r.load=function(){this._disposeLoader();var e={url:"https://ntp.nc.gifshow.com/",responseType:"text"};(this._loader=new i.default).load(e,this._callback,this._loaderConfig)},r.destroy=function(){this._disposeLoader()},r._disposeLoader=function(){this._loader&&this._loader.destroy()},r._onLoaderError=function(){this._disposeLoader()},r._onLoaderAbort=function(){},r._onLoaderEnd=function(e,t){if(this._disposeLoader(),"string"==typeof t){o.local=performance.now();var i=t.split(",");o.server=1e3*parseFloat(i[0])+parseInt(i[1],10)/1e3/2}},n(e,[{key:"time",get:function(){return(0,t.ObjectAssign)({},o)}}]),e}();e.default=a})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/kwai-priv-nal.ts":
/*!************************************!*\
  !*** ./src/utils/kwai-priv-nal.ts ***!
  \************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.default=void 0;var t=function(){function e(){}return e.parse=function(t){var i={},r=525030175!==new DataView(t.buffer,t.byteOffset).getUint32(0),n=6,s=new Uint8Array(1024);s.set(t.slice(0,6),0);for(var o=t.byteLength,a=[t[o-2],t[o-1]],u=6;u<o;){var l=t[u];0===a[0]&&0===a[1]&&3===l||(s[n++]=l),a[0]=a[1],a[1]=l,++u}for(var d=6,c=new DataView(s.buffer);d<n;){var f=d,h=c.getUint16(f,r);f+=2;var _=c.getUint16(f,r);f+=2;var p=c.getUint16(f,r);f+=2,e._readElem(c,i,f,p,h,_,r),f+=p,d+=_}return i},e._readElem=function(t,i,r,n,s,o,a){var u=e._readString(t,r,n);switch(r+=n,s){case 1:break;case 2:i[u]=e._readString(t,r,o-4);break;case 3:i[u]=t.getUint32(r,a);break;case 4:var l=t.getUint32(r+4,a),d=t.getUint32(r,a);i[u]=Math.pow(2,32)*l+d;break;case 5:i[u]=t.getFloat32(r,a);break;case 6:i[u]=t.getFloat64(r,a)}},e._readString=function(e,t,i){for(var r="",n=t;n<t+i;n++)r+=String.fromCharCode(e.getUint8(n));return r},e}();e.default=t})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/log.ts":
/*!**************************!*\
  !*** ./src/utils/log.ts ***!
  \**************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){var t;function i(e,t){return t&&0!==t.length||(t=[e],e=""),e="kwai-k"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}e.__esModule=!0,e.LOG_LEVEL=e.Log=void 0,e.LOG_LEVEL=t,function(e){e.LEVEL_ERROR="e",e.LEVEL_WARN="w",e.LEVEL_INFO="i",e.LEVEL_DEBUG="d",e.LEVEL_VERBOSE="v"}(t||(e.LOG_LEVEL=t={}));var r=function(){function e(){}return e.level=function(i){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,i){case t.LEVEL_ERROR:e.ENABLE_ERROR=!0;break;case t.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case t.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case t.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case t.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0}},e.e=function(t){if(e.ENABLE_ERROR){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];var o=i(t,n);(console.error||console.warn||console.log).apply(console,o)}},e.w=function(t){if(e.ENABLE_WARN){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];var o=i(t,n);(console.warn||console.log).apply(console,o)}},e.i=function(t){if(e.ENABLE_INFO){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];var o=i(t,n);(console.info||console.log).apply(console,o)}},e.d=function(t){if(e.ENABLE_DEBUG){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];var o=i(t,n);(console.debug||console.log).apply(console,o)}},e.v=function(t){if(e.ENABLE_VERBOSE){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];var o=i(t,n);console.log.apply(console,o)}},e}();e.Log=r,r.ENABLE_ERROR=!0,r.ENABLE_WARN=!1,r.ENABLE_INFO=!1,r.ENABLE_DEBUG=!1,r.ENABLE_VERBOSE=!1})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/mediasource-helper.ts":
/*!*****************************************!*\
  !*** ./src/utils/mediasource-helper.ts ***!
  \*****************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t],void 0===(s="function"==typeof(r=function(e){e.__esModule=!0,e.getMediaSource=function(){return window.MediaSource||window.WebKitMediaSource}})?r.apply(t,n):r)||(e.exports=s)},"./src/utils/playback-rate-manager.ts":
/*!********************************************!*\
  !*** ./src/utils/playback-rate-manager.ts ***!
  \********************************************/
/*! no static exports found */ /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,s;"object"==typeof globalThis?globalThis:"object"==typeof self&&self,n=[t,i(/*! ./log */"./src/utils/log.ts")],void 0===(s="function"==typeof(r=function(e,t){e.__esModule=!0,e.default=void 0;var i=function(){function e(e,t){this.tag="PlaybackRateManager",this._media=void 0,this._config=void 0,this._interval=0,this._timer=void 0,this._media=e,this._config=t}var i=e.prototype;return i.start=function(){this._interval=this._interval||this._config.startDelay||this._config.interval||5,this._tick(),this._interval=this._config.interval||1},i.stop=function(){this._timer&&(clearTimeout(this._timer),this._timer=0)},i.dispose=function(){this._timer&&(clearTimeout(this._timer),this._timer=0)},i._tick=function(){var e=this;this._timer||(this._timer=setTimeout((function(){e._media.video&&e._nextPlayBackRate(e._media.bufferedSec(),e._media.video),e._timer=0,e._tick()}),1e3*this._interval))},i._nextPlayBackRate=function(e,i){var r=1,n=this._config.rule,s=0;for(s=0;s<n.length&&!(i.playbackRate>=n[s].rate);s++);var o=s<n.length-1?n[s+1]:null,a=s>0?n[s-1]:null;r=n[s].rate,a&&e>a.lower&&(r=a.rate),o&&e<o.upper&&(r=o.rate),i.playbackRate!==r&&(t.Log.v(this.tag,"Change playback rate from "+i.playbackRate+" to "+r),i.playbackRate=r)},e}();e.default=i})?r.apply(t,n):r)||(e.exports=s)}}).default}))},void 0===(s="function"==typeof r?r.apply(t,n):r)||(e.exports=s)},function(e,t,i){"use strict";var r,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,i,r){var n,s,o,a;if(l(i),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),o=s[t]),void 0===o)o=s[t]=i,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),(n=d(e))>0&&o.length>n&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,a=u,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=f.bind(r);return n.listener=i,r.wrapFn=n,n}function _(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):v(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function v(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return d(this)},a.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)s(u,this,t);else{var l=u.length,d=v(u,l);for(i=0;i<l;++i)s(d[i],this,t)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){return l(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var i,r,n,s,o;if(l(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){o=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return _(this,e,!0)},a.prototype.rawListeners=function(e){return _(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){var r,n,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[t,i(0)],void 0===(s="function"==typeof(r=function(e,t){"use strict";e.__esModule=!0,e.processConfig=function(e){var r=(0,t.ObjectAssign)({},i);if((0,t.ObjectAssign)(r,e),!r.logBaseConfig.product_name||!r.logBaseConfig.product_name.trim())throw new Error("config.logBaseConfig.product_name must be set");"production"===r.logEnv&&(r.logEnv="https://open-log-sdk.gifshow.com/rest/wd/common/log/collect/misc2");var n=r.logBaseConfig,s={product_name:n.product_name,service_name:"media_web_player_external"};return["user_id","network_type","sub_biz","need_encrypt","experiment","union_id"].forEach((function(e){r.logBaseConfig.hasOwnProperty(e)&&(s[e]=n[e])})),n&&(r.logBaseConfig=s),r};var i={debug:!1,box:"flv",isLive:!0,maxRetry:3,retryDelay:2e3,connectionTimeout:1e4,logEnv:"production",logBaseConfig:{product_name:"ks693554345971931249"}}})?r.apply(t,n):r)||(e.exports=s)},function(e,t,i){var r,n,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[t,i(0),i(8),i(1)],void 0===(s="function"==typeof(r=function(e,t,i,r){"use strict";e.__esModule=!0,e.default=void 0;var n=function(){function e(e,t,n){this._weblog=void 0,this._biz=void 0,this._version=void 0,this._mediaType=r.MediaType.unknown,this._weblog=new i.Weblog(e,t),this._version=n}var n=e.prototype;return n.setBiz=function(e){this._biz=(0,t.ObjectAssign)({},e)},n.setMediaType=function(e){this._mediaType=e},n.sendSummary=function(e){this._biz&&(e.biz=this._biz),e.media_type=this._mediaType,e.version=this._version,this._weblog.sendImmediately("CLICK","summary",e)},n.sendRealtime=function(e){this._biz&&(e.biz=this._biz),e.media_type=this._mediaType,e.version=this._version,this._weblog.sendImmediately("CLICK","realtime",e)},n.sendDownload=function(e){this._biz&&(e.biz=this._biz),e.media_type=this._mediaType,e.version=this._version,this._weblog.sendImmediately("CLICK","download",e)},e}();e.default=n})?r.apply(t,n):r)||(e.exports=s)},function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"Weblog",(function(){return je})),i.d(t,"BasePlugin",(function(){return Ae}));var r,n,s,o=i(2),a=i.n(o);Object.defineProperty||(Object.defineProperty=function(e,t,i){e[t]="[object Object]"===Object.prototype.toString.call(i)&&i.hasOwnProperty("value")?i.value:i}),Object.assign||Object.defineProperty(Object,"assign",{value:function(e){if(null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!==r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},writable:!0,configurable:!0}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),i=this,r=function(){},n=function(){var n=this instanceof r?this:e;return i.apply(n,t.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),n.prototype=new r,n}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i;if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),n=r.length>>>0;if(0===n)return-1;var s=+t||0;if(Math.abs(s)===1/0&&(s=0),s>=n)return-1;for(i=Math.max(s>=0?s:n-Math.abs(s),0);i<n;){if(i in r&&r[i]===e)return i;i++}return-1}),Object.keys||(Object.keys=(r=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable("toString"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var t=[];for(var i in e)r.call(e,i)&&t.push(i);if(n)for(var o=0,a=s;o<a.length;o++){var u=a[o];r.call(e,u)&&t.push(u)}return t})),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,r;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),s=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(i=t),r=0;r<s;){var o;r in n&&(o=n[r],e.call(i,o,r,n)),r++}})
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */;var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function l(e,t){function i(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var d=function(){return(d=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};var f=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){!function(t){function i(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function r(e,t,r,n,s,o){return i((a=i(i(t,e),i(n,o)))<<(u=s)|a>>>32-u,r);var a,u}function n(e,t,i,n,s,o,a){return r(t&i|~t&n,e,t,s,o,a)}function s(e,t,i,n,s,o,a){return r(t&n|i&~n,e,t,s,o,a)}function o(e,t,i,n,s,o,a){return r(t^i^n,e,t,s,o,a)}function a(e,t,i,n,s,o,a){return r(i^(t|~n),e,t,s,o,a)}function u(e,t){var r,u,l,d,c;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var f=1732584193,h=-271733879,_=-1732584194,p=271733878;for(r=0;r<e.length;r+=16)u=f,l=h,d=_,c=p,f=n(f,h,_,p,e[r],7,-680876936),p=n(p,f,h,_,e[r+1],12,-389564586),_=n(_,p,f,h,e[r+2],17,606105819),h=n(h,_,p,f,e[r+3],22,-1044525330),f=n(f,h,_,p,e[r+4],7,-176418897),p=n(p,f,h,_,e[r+5],12,1200080426),_=n(_,p,f,h,e[r+6],17,-1473231341),h=n(h,_,p,f,e[r+7],22,-45705983),f=n(f,h,_,p,e[r+8],7,1770035416),p=n(p,f,h,_,e[r+9],12,-1958414417),_=n(_,p,f,h,e[r+10],17,-42063),h=n(h,_,p,f,e[r+11],22,-1990404162),f=n(f,h,_,p,e[r+12],7,1804603682),p=n(p,f,h,_,e[r+13],12,-40341101),_=n(_,p,f,h,e[r+14],17,-1502002290),f=s(f,h=n(h,_,p,f,e[r+15],22,1236535329),_,p,e[r+1],5,-165796510),p=s(p,f,h,_,e[r+6],9,-1069501632),_=s(_,p,f,h,e[r+11],14,643717713),h=s(h,_,p,f,e[r],20,-373897302),f=s(f,h,_,p,e[r+5],5,-701558691),p=s(p,f,h,_,e[r+10],9,38016083),_=s(_,p,f,h,e[r+15],14,-660478335),h=s(h,_,p,f,e[r+4],20,-405537848),f=s(f,h,_,p,e[r+9],5,568446438),p=s(p,f,h,_,e[r+14],9,-1019803690),_=s(_,p,f,h,e[r+3],14,-187363961),h=s(h,_,p,f,e[r+8],20,1163531501),f=s(f,h,_,p,e[r+13],5,-1444681467),p=s(p,f,h,_,e[r+2],9,-51403784),_=s(_,p,f,h,e[r+7],14,1735328473),f=o(f,h=s(h,_,p,f,e[r+12],20,-1926607734),_,p,e[r+5],4,-378558),p=o(p,f,h,_,e[r+8],11,-2022574463),_=o(_,p,f,h,e[r+11],16,1839030562),h=o(h,_,p,f,e[r+14],23,-35309556),f=o(f,h,_,p,e[r+1],4,-1530992060),p=o(p,f,h,_,e[r+4],11,1272893353),_=o(_,p,f,h,e[r+7],16,-155497632),h=o(h,_,p,f,e[r+10],23,-1094730640),f=o(f,h,_,p,e[r+13],4,681279174),p=o(p,f,h,_,e[r],11,-358537222),_=o(_,p,f,h,e[r+3],16,-722521979),h=o(h,_,p,f,e[r+6],23,76029189),f=o(f,h,_,p,e[r+9],4,-640364487),p=o(p,f,h,_,e[r+12],11,-421815835),_=o(_,p,f,h,e[r+15],16,530742520),f=a(f,h=o(h,_,p,f,e[r+2],23,-995338651),_,p,e[r],6,-198630844),p=a(p,f,h,_,e[r+7],10,1126891415),_=a(_,p,f,h,e[r+14],15,-1416354905),h=a(h,_,p,f,e[r+5],21,-57434055),f=a(f,h,_,p,e[r+12],6,1700485571),p=a(p,f,h,_,e[r+3],10,-1894986606),_=a(_,p,f,h,e[r+10],15,-1051523),h=a(h,_,p,f,e[r+1],21,-2054922799),f=a(f,h,_,p,e[r+8],6,1873313359),p=a(p,f,h,_,e[r+15],10,-30611744),_=a(_,p,f,h,e[r+6],15,-1560198380),h=a(h,_,p,f,e[r+13],21,1309151649),f=a(f,h,_,p,e[r+4],6,-145523070),p=a(p,f,h,_,e[r+11],10,-1120210379),_=a(_,p,f,h,e[r+2],15,718787259),h=a(h,_,p,f,e[r+9],21,-343485551),f=i(f,u),h=i(h,l),_=i(_,d),p=i(p,c);return[f,h,_,p]}function l(e){var t,i="",r=32*e.length;for(t=0;t<r;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function d(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function c(e){var t,i,r="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),r+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return r}function f(e){return unescape(encodeURIComponent(e))}function h(e){return function(e){return l(u(d(e),8*e.length))}(f(e))}function _(e,t){return function(e,t){var i,r,n=d(e),s=[],o=[];for(s[15]=o[15]=void 0,n.length>16&&(n=u(n,8*e.length)),i=0;i<16;i+=1)s[i]=909522486^n[i],o[i]=1549556828^n[i];return r=u(s.concat(d(t)),512+8*t.length),l(u(o.concat(r),640))}(f(e),f(t))}function p(e,t,i){return t?i?_(t,e):c(_(t,e)):i?h(e):c(h(e))}e.exports?e.exports=p:t.md5=p}(c)})),h=["Kwai","Kwai_Lite","Kwai_Pro","livemate","ksthanos","ksNebula","ksnebula","kwaiying","pearl","kinder","m2u"],_=null,p="",v=function(){return _||(_=(new a.a).getResult()),_};function m(e){if(void 0===e&&(e=location.hostname),!e)return"";var t=e.split("."),i=t.length;return i<=2?"":"."+t[i-2]+"."+t[i-1]}function g(e,t){if(void 0===t&&(t={}),!document.cookie)return null;var i=function(e,t,i){void 0===i&&(i={});var r={};if(e.length>0)for(var n=t?decodeURIComponent:function(e){return e},s=e.split(/;\s/g),o=null,a=null,u=null,l=0,d=s.length;l<d;l++){if(null!==(u=s[l].match(/([^=]+)=/i)))try{o=decodeURIComponent(u[1]),a=n(s[l].substring(u[1].length+1))}catch(e){}else o=decodeURIComponent(s[l]),a="";null!==o&&(r[o]=a)}return r}(document.cookie,!t.raw,t)[e];return void 0===i?null:i}function y(e,t,i){void 0===i&&(i={}),document.cookie=function(e,t,i,r){void 0===r&&(r={});var n=encodeURIComponent(e)+"="+(i?encodeURIComponent(t):t),s=r.expires,o=r.path||"/",a=r.domain||"";return s instanceof Date&&(n+="; expires="+s.toUTCString()),"number"==typeof s&&(n+="; max-age=="+s),""!==o&&(n+="; path="+o),""!==a&&(n+="; domain="+a),!0===r.secure&&(n+="; secure"),n}(e,t,!i.raw,i)}function b(){for(var e=1e9*Math.random()>>>0,t=[],i=0;i<7;i++)t.push("0123456789ABCDEF".charAt(16*Math.random()));return e+t.join("")}function E(){var e=g("did")?"did":"_did",t=g(e),i=new Date;i.setFullYear(i.getFullYear()+1);var r=t||"web_"+b();return y(e,r,{expires:i,domain:m(),path:"/"}),r}function T(){return b()}function S(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function w(e,t,i,r){return"attachEvent"in e?e.attachEvent("on"+t,i):e.addEventListener(t,i,r)}function R(e,t,i,r){return"attachEvent"in e?e.detachEvent("on"+t,i):e.removeEventListener(t,i,r)}function x(e,t,i){if(void 0===i&&(i=" "),(t-=e.length)<=0)return e;for(var r="";t;)1&t&&(r+=i),t>>=1,i+=i;return r+e}var L,k=(L=null,function(){if(null===L)for(var e=0;e<h.length;e++)if(navigator.userAgent.indexOf(h[e])>-1){L=!0;break}return L});function A(e){return setTimeout(e,62.5)}var O=clearTimeout;function P(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function D(e){for(var t={},i=0,r=e.split("&");i<r.length;i++){var n=r[i].split("="),s=n[0],o=n[1];s in t?t[s]instanceof Array?t[s].push(o):t[s]=[t[s],o]:t[s]=o}return t}function I(e){var t=JSON.parse(e),i=[];return Object.keys(t).forEach((function(e){if(t[e]instanceof Array)for(var r=0,n=t[e];r<n.length;r++){var s=n[r];i.push(e+"="+s)}else"object"==typeof t[e]&&null!==t[e]?i.push(e+"="+JSON.stringify(t[e])):i.push(e+"="+t[e])})),i.join("&")}var M=function(){var e=E();if(!p){var t="http://logger-v2.corp.kuaishou.com/#/home?sessionId="+e;console.log("%cLogSDK logger: %c"+t,"color:#1abf89;font-size:1.4em;line-height:2.4em;","font-size:1.2em;"),p="http://logger-v2-backend.corp.kuaishou.com/"+e+"/rest/wd/common/log/collect/misc2"}return p},C=function(e){this.env="production",this.retries=0,this.maxErrLog=100,this.timeout=3e4,this.useBeacon=!1,this.wait=1e3,this.maxBatchLength=100,this.lazy=!1,this.showValidateMsg=!1,this.sampleRate=1,this.sampleRateFn=null,this.logger=!1,Object.assign(this,e)},N=["display: none;","position: absolute;","top: -9999px","left: -9999px"].join("");function F(e,t){var i=e.url,r=e.data,n="iframe_"+b(),s=function(e){var t=document.createElement("iframe");return document.body.appendChild(t),t.contentWindow.name=e,t.style.cssText=N,t}(n),o=function(e,t){var i=document.createElement("form");return document.body.appendChild(i),i.target=e,i.enctype="multipart/form-data",i.method="POST",i.action=t,i.style.cssText=N,i}(n,i);!function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var r=document.createElement("input");r.name=i,r.value=JSON.stringify(t[i]),e.appendChild(r)}}(o,r);try{o.submit()}catch(e){t(e)}s.onload=function(){document.body.removeChild(s),document.body.removeChild(o),s=null,o=null}}function U(e){var t=new FormData;for(var i in e)e.hasOwnProperty(i)&&t.append(i,JSON.stringify(e[i]));return t}function B(e,t){var i=e.url,r=e.data,n=e.async,s=void 0===n||n,o=e.timeout,a=new XMLHttpRequest;a.open("POST",i,s),s&&o&&(a.timeout=o),a.onload=function(){a.status<200&&a.status>=300&&304!==a.status&&t(a.response)},a.ontimeout=a.onerror=function(e){t(e)},a.send(U(r))}function j(e,t){var i=e.url,r=e.data;navigator.sendBeacon(i,U(r))||t()}var V=v(),H="Chrome"===V.browser.name&&+(V.browser.major||0)>77;function G(e,t){var i=e.url,r=e.data,n=e.async,s=e.useBeacon,o=void 0!==s&&s,a=e.timeout;if(o||H)return j({url:i,data:r},t);if(function(){var e=v();return"IE"===e.browser.name&&(e.browser.major&&+e.browser.major<=9)}())return F({url:i,data:r},t);if(n)return B({url:i,data:r,async:n,timeout:a},t);try{B({url:i,data:r,async:n,timeout:a},t)}catch(e){j({url:i,data:r},t)}}var K,W,z,q,Y,X=function(){function e(){var e=this;this.logQueue=[],this.errorQueue=[],this.batchWaitTimer=0,this.errorWaitTimer=0,this.flush=function(t){e.sendData(e.logQueue,t),e.logQueue=[]}}return e.prototype.updateBase=function(e){this.commonPackage=e},Object.defineProperty(e.prototype,"url",{get:function(){if(this.config.logger)return M();var e=this.config.env;return!e||0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&0!==e.indexOf("//")?"production"===e?"https://log-sdk.ksapisrv.com/rest/wd/common/log/collect/misc2":"https://webapi.test.gifshow.com/rest/wd/common/log/collect/misc2":e},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t){this.config=new C(d(d({},this.config),e)),this.updateBase(t)},e.prototype.sendData=function(e,t){var i=this,r=e instanceof Array?{retry:0,logs:e}:e;G({url:this.url,data:{common:this.commonPackage,logs:{event:r.logs}},useBeacon:this.config.useBeacon,async:void 0!==t?t:0!==this.config.wait,timeout:this.config.timeout},(function(){i.errHandler(r)}))},e.prototype.flushErrorQueue=function(){var e=this;this.errorQueue.forEach((function(t){t.retry>e.config.retries?S(e.errorQueue,t):(t.retry++,e.sendData(t))}))},e.prototype.send=function(e,t,i){var r=this;void 0===t&&(t=!1),t?this.sendData([e],i):this.config.lazy?this.logQueue.push(e):(clearTimeout(this.batchWaitTimer),this.logQueue.length>=this.config.maxBatchLength?this.flush(i):(this.logQueue.push(e),this.batchWaitTimer=window.setTimeout((function(){r.flush(i)}),this.config.wait)))},Object.defineProperty(e.prototype,"errorLogCount",{get:function(){return this.errorQueue.reduce((function(e,t){return e+t.logs.length}),0)},enumerable:!0,configurable:!0}),e.prototype.errHandler=function(e){var t=this;this.config.retries&&(this.errorQueue.push(e),clearTimeout(this.errorWaitTimer),this.errorLogCount>=this.config.maxErrLog?this.flushErrorQueue():this.errorWaitTimer=window.setTimeout((function(){t.flushErrorQueue()}),this.config.wait))},e}();!function(e){e[e.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",e[e.ENTER=1]="ENTER",e[e.LEAVE=2]="LEAVE",e[e.RESUME=3]="RESUME"}(K||(K={})),function(e){e[e.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",e[e.PAGE_ENTER=1]="PAGE_ENTER",e[e.PAGE_LEAVE=2]="PAGE_LEAVE",e[e.PAGE_RESUME=3]="PAGE_RESUME",e[e.PAGE_PAUSE=4]="PAGE_PAUSE"}(W||(W={})),function(e){e[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.PAGE_AUTO=10]="PAGE_AUTO",e[e.PAGE_CUSTOM=11]="PAGE_CUSTOM",e[e.ELEMENT=12]="ELEMENT"}(z||(z={})),function(e){e[e.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",e[e.SUCCESS=1]="SUCCESS",e[e.FAIL=2]="FAIL"}(q||(q={})),function(e){e[e.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",e[e.CLICK=1]="CLICK",e[e.LEFT_PULL=2]="LEFT_PULL",e[e.RIGHT_PULL=3]="RIGHT_PULL",e[e.UP_PULL=4]="UP_PULL",e[e.DOWN_PULL=5]="DOWN_PULL"}(Y||(Y={}));var Q,J,Z,$=!0,ee=function(e){this.first_load=$,this.action=K.ENTER,this.time_cost=0,this.sub_action=W.PAGE_ENTER,this.type=z.ELEMENT,this.status=q.SUCCESS,this.action_type=Y.CLICK,this.sub_page=!1,$=!1;var t=e.type,i=e.currentUrlPackage,r=e.referUrlPackage,n=e.name,s=void 0===n?"":n,o=e.action,a=e.beginTime,u=e.params,l=void 0===u?{}:u,d=e.contentPackage;if(this.url_package=i,this.refer_url_package=r,this.content_package=d,"PV"===t)switch(this.type=z.PAGE_AUTO,o){case"leave":this.action=K.LEAVE,this.sub_action=W.PAGE_LEAVE,a&&(this.stay_length=(new Date).valueOf()-a);break;case"enter":this.action=K.ENTER,this.sub_action=W.PAGE_ENTER;break;case"visible":this.action=K.RESUME,this.sub_action=W.PAGE_RESUME;break;case"hidden":this.action=K.LEAVE,this.sub_action=W.PAGE_PAUSE}"SHOW"===t&&s&&l&&(this.element_package={action:s,params:JSON.stringify(l)})};!function(e){e[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.USER_OPERATION=1]="USER_OPERATION",e[e.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",e[e.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(Q||(Q={})),function(e){e[e.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",e[e.CLICK=1]="CLICK",e[e.DOUBLE_CLICK=2]="DOUBLE_CLICK",e[e.TRIPLE_CLICK=3]="TRIPLE_CLICK",e[e.LONG_PRESS=4]="LONG_PRESS",e[e.PULL=5]="PULL",e[e.DRAG=6]="DRAG",e[e.SCALE=7]="SCALE",e[e.PULL_DOWN=8]="PULL_DOWN",e[e.PULL_UP=9]="PULL_UP"}(J||(J={})),function(e){e[e.UNKNOWN_OPERATION_DIRECTION=0]="UNKNOWN_OPERATION_DIRECTION",e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT"}(Z||(Z={}));var te,ie,re,ne,se,oe=function(e){this.type=Q.USER_OPERATION,this.operation_type=J.CLICK;var t=e.sessionId,i=e.currentUrlPackage,r=e.referUrlPackage,n=e.name,s=e.params,o=e.type,a=e.contentPackage;this.operation_type=J[o],this.session_id=t,this.url_package=i,this.refer_url_package=r,this.content_package=a,this.element_package={action:n,params:JSON.stringify(s)}},ae=function(e){var t=e.name,i=e.params,r=e.currentUrlPackage;this.key=t,this.value=JSON.stringify(d({url_package:r},i))},ue=[["a7","640x1136",["iPhone 5","iPhone 5s"]],["a7","1536x2048",["iPad Air","iPad Mini 2","iPad Mini 3"]],["a8","640x1136",["iPod touch (6th gen)"]],["a8","750x1334",["iPhone 6"]],["a8","1242x2208",["iPhone 6 Plus"]],["a8","1536x2048",["iPad Air 2","iPad Mini 4"]],["a9","640x1136",["iPhone SE"]],["a9","750x1334",["iPhone 6s"]],["a9","1242x2208",["iPhone 6s Plus"]],["a9x","1536x2048",["iPad Pro (1st gen 9.7-inch)"]],["a9x","2048x2732",["iPad Pro (1st gen 12.9-inch)"]],["a10","750x1334",["iPhone 7"]],["a10","1242x2208",["iPhone 7 Plus"]],["a10x","1668x2224",["iPad Pro (2th gen 10.5-inch)"]],["a10x","2048x2732",["iPad Pro (2th gen 12.9-inch)"]],["a11","750x1334",["iPhone 8"]],["a11","1242x2208",["iPhone 8 Plus"]],["a11","1125x2436",["iPhone X"]],["a12","828x1792",["iPhone Xr"]],["a12","1125x2436",["iPhone Xs"]],["a12","1242x2688",["iPhone Xs Max"]],["a12x","1668x2388",["iPad Pro (3rd gen 11-inch)"]],["a12x","2048x2732",["iPad Pro (3rd gen 12.9-inch)"]]],le=(te="",function(){if(te)return te;var e=window.devicePixelRatio||1,t=Math.min(screen.width,screen.height)*e,i=Math.max(screen.width,screen.height)*e;return te=t+"x"+i}),de=(ie="",function(){if(ie)return ie;var e=document.createElement("canvas").getContext("webgl");if(e){var t=e.getExtension("WEBGL_debug_renderer_info");ie=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):"unknown"}else ie="unknown";return ie}),ce=(re="",function(){if(re)return re;var e=v(),t=k();if("iOS"!==e.os.name||t)return e.device.model||"unknown";var i=de(),r=le(),n=i.match(/^apple\s+([_a-z0-9-]+)\s+gpu$/i);if(!n)return re="unknown";for(var s=0,o=ue;s<o.length;s++){var a=o[s];if(n[1].toLocaleLowerCase()===a[0]&&r===a[1]){re=a[2].join(" or ");break}}return re=re||e.device.model||"unknown"});function fe(e){console&&console.warn&&console.warn(e)}!function(e){e[e.UNKNOWN_NETWORK=0]="UNKNOWN_NETWORK",e[e.NOT_CONNECTED=1]="NOT_CONNECTED",e[e.WIFI=2]="WIFI",e[e.MOBILE_4G=3]="MOBILE_4G",e[e.MOBILE_3G=4]="MOBILE_3G",e[e.MOBILE_2G=5]="MOBILE_2G",e[e.MOBILE_UNKNOWN=6]="MOBILE_UNKNOWN"}(ne||(ne={})),function(e){e[e.UNKNOWN_PLATFORM=0]="UNKNOWN_PLATFORM",e[e.ANDROID_PHONE=1]="ANDROID_PHONE",e[e.ANDROID_PAD=2]="ANDROID_PAD",e[e.IPHONE=3]="IPHONE",e[e.IPAD=4]="IPAD",e[e.WINDOWS_PC=5]="WINDOWS_PC",e[e.ANDROID_PHONE_H5=6]="ANDROID_PHONE_H5",e[e.IPHONE_H5=7]="IPHONE_H5",e[e.OUTSIDE_ANDROID_H5=8]="OUTSIDE_ANDROID_H5",e[e.OUTSIDE_IOS_H5=9]="OUTSIDE_IOS_H5",e[e.PC_WEB=10]="PC_WEB"}(se||(se={}));var he={unknown:ne.UNKNOWN_NETWORK,none:ne.NOT_CONNECTED,wifi:ne.WIFI,"4g":ne.MOBILE_4G,"3g":ne.MOBILE_3G,"2g":ne.MOBILE_2G,"slow-2g":ne.MOBILE_2G};function _e(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!e)return he.unknown;var t=e.type,i=e.effectiveType;return he[t]||he[i]||he.unknown}function pe(){var e=v();if(!e.os.name)return se.UNKNOWN_PLATFORM;var t=k();return"Android"===e.os.name?t?se.ANDROID_PHONE_H5:se.OUTSIDE_ANDROID_H5:"iOS"===e.os.name?t?se.IPHONE_H5:se.OUTSIDE_IOS_H5:se.PC_WEB}var ve=[["identity_package","device_id"],["identity_package","global_id"],["identity_package","user_id"],["app_package","product"],["app_package","version_name"],["app_package","package_name"],["app_package","product_name"],["app_package","channel"],["network_package","type"]];var me,ge=function(e,t){if(this.identity_package={device_id:E()},this.app_package={language:navigator.language,platform:pe()},this.device_package={os_version:v().os.version||"unknown",model:ce(),ua:navigator.userAgent},this.network_package={type:_e()},this.need_encrypt=!1,function e(t,i){i&&Object.keys(i).forEach((function(r){var n=i[r];"object"==typeof n?e(t[r],n):n&&(t[r]=n)}))}(this,e),k()||function(e,t){for(var i=0,r=ve;i<r.length;i++){for(var n=r[i],s=void 0,o=0,a=n;o<a.length;o++){var u=a[o];s=s?s[u]:e[u]}s||t&&fe('Base Option "'+n[n.length-1]+'" should be set when in Kwai App')}}(this,t.showValidateMsg),this.app_package.version_name){var i=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(i+1)||0}this.network_package.type=this.network_package.type||_e()},ye=(me=(new Date).getTimezoneOffset()/60)<=0?"GMT+"+x(-me+"",2,"0")+":00":"GMT-"+x(me+"",2,"0")+":00",be=0,Ee=function(e){this.client_timestamp=(new Date).valueOf(),this.client_increment_id=++be,this.session_id=sessionStorage.getItem("sessionId")||T(),this.time_zone=ye,Object.assign(this,e)};function Te(e,t){switch(e){case"PV":case"SHOW":return new Ee({event_package:{show_event:new ee({type:e,currentUrlPackage:t.currentUrlPackage,referUrlPackage:t.referUrlPackage,action:t.type,beginTime:t.beginTime,name:t.name,params:t.params,contentPackage:t.contentPackage})}});case"CUSTOM":return new Ee({stat_package:{custom_stat_event:new ae({currentUrlPackage:t.currentUrlPackage,name:t.name,params:t.params})}});default:return new Ee({event_package:{task_event:new oe({type:e,sessionId:sessionStorage.getItem("sessionId")||T(),currentUrlPackage:t.currentUrlPackage,referUrlPackage:t.referUrlPackage,name:t.name,params:t.params,contentPackage:t.contentPackage})}})}}var Se,we=[{keys:["identity_package","device_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["identity_package","user_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["identity_package","union_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["identity_package","global_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["app_package","product"],type:"number",validator:function(e){return"number"==typeof e}},{keys:["app_package","channel"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["app_package","version_name"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["app_package","package_name"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["app_package","product_name"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["experiment"],type:"Array",validator:function(e){return e instanceof Array}},{keys:["service_name"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["sub_biz"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["need_encrypt"],type:"boolean",validator:function(e){return"boolean"==typeof e}},{keys:["safety_id"],type:"string",validator:function(e){return"string"==typeof e}}];function Re(e,t){for(var i={identity_package:{},network_package:{},app_package:{},experiment:[],service_name:"",safety_id:""},r=0,n=we;r<n.length;r++){var s=n[r],o=s.keys,a=s.validator,u=s.type,l=o[0],d=o[1],c=e[d||l];if(d?i[l][d]=e[d]:i[l]=e[l],void 0!==c&&!a(c))throw new Error(["There is an error init value on '"+(d||l)+"', ","the type should be '"+u+"', ","but your type is '"+typeof c+"'"].join(""))}return e.network_type&&(i.network_package=i.network_package||{},i.network_package.type=he[e.network_type]),new ge(i,t)}!function(e){e[e.UNKNOWN_PAGE_TYPE=0]="UNKNOWN_PAGE_TYPE",e[e.NATIVE=1]="NATIVE",e[e.H5=2]="H5",e[e.MINA=3]="MINA"}(Se||(Se={}));var xe=function(e,t){void 0===t&&(t="web");var i=function(e){void 0===e&&(e=location.href);var t=e.lastIndexOf("?");return-1===t?{page:e,params:void 0}:{page:e.slice(0,t),params:D(e.slice(t+1))}}(e),r=i.page,n=i.params;switch(t){case"web":this.page_type=Se.H5;break;case"native":this.page_type=Se.NATIVE;break;case"mina":this.page_type=Se.MINA;break;default:this.page_type=Se.UNKNOWN_PAGE_TYPE}this.params=JSON.stringify(n),this.page=r,this.identity=function(e){var t=e+(new Date).getTime()+E()+b();return f(t)}(r)},Le={device_id:"",global_id:"",union_id:"",user_id:"",product:0,channel:"",version_name:"",package_name:"",product_name:"",network_type:"unknown",appType:Se.H5,service_name:"",sub_biz:"",need_encrypt:!1,safety_id:"",experiment:[]},ke=function(){function e(){this.events={}}return e.prototype.on=function(e,t){t&&"function"==typeof t&&(this.events[e]=this.events[e]||[],this.events[e].push(t))},e.prototype.off=function(e,t){this.events[e]&&(t&&"function"==typeof t&&S(this.events[e],t),t||(this.events[e]=[]))},e.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.events[e]&&this.events[e].forEach((function(e){e.apply(void 0,t)}))},e}(),Ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t}(ke),Oe={updateInterval:2e4,crashThreshold:1e4},Pe=function(e){function t(t,i){var r=e.call(this)||this;r.eventName="onpagehide"in window?"pagehide":"beforeunload",r.options=d({},Oe),r.monitorId="@ks.monitor.crash",r.historyMoniorInfo=null,r.stop=function(){clearInterval(r.updateIntervalId);try{localStorage.removeItem(r.monitorId)}catch(e){}};try{var n=localStorage.getItem(r.monitorId);r.historyMoniorInfo=JSON.parse(n)||{}}catch(e){}return Object.assign(r.options,i),w(window,r.eventName,r.stop),r.on("crash",(function(e){t.sendImmediately("CUSTOM","crash",e)})),r.start(),r}return l(t,e),t.prototype.destroy=function(){this.stop(),this.off("crash"),R(window,this.eventName,this.stop)},t.prototype.checkHistoryCrash=function(){var e=(new Date).valueOf();this.historyMoniorInfo&&e-this.historyMoniorInfo.time>this.options.crashThreshold&&this.emit("crash",this.historyMoniorInfo)},t.prototype.start=function(){var e=this;this.checkHistoryCrash(),this.updateIntervalId=window.setInterval((function(){e.update()}),this.options.updateInterval),this.update()},t.prototype.update=function(){if(window.performance&&window.performance.memory){var e={time:(new Date).valueOf(),memory:{limit:window.performance.memory.jsHeapSizeLimit/1024,total:window.performance.memory.totalJSHeapSize/1024,used:window.performance.memory.usedJSHeapSize/1024}};try{localStorage.setItem(this.monitorId,JSON.stringify(e))}catch(e){}}},t.key="crachMonitor",t}(Ae),De={interval:1e4,decimals:2},Ie=function(e){function t(t,i){var r=e.call(this)||this;return r.options=d({},De),r.count=0,Object.assign(r.options,i),r.on("performance",(function(e){t.collect("CUSTOM","fps",{fps:e})})),r.start(),r}return l(t,e),t.prototype.destroy=function(){this.off("performance"),this.stop()},t.prototype.start=function(){this.loop(),this.fpsTick()},t.prototype.fpsTick=function(){var e=this;this.fpsTickId=function(e){return(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||A).call(this,e)}((function(){e.count++,e.fpsTick()}))},t.prototype.loop=function(){var e=this;this.loopBeginTime=(new Date).valueOf(),this.loopId=window.setTimeout((function(){e.loopEndTime=(new Date).valueOf();var t=e.calculate();e.emit("performance",t),e.count=0,e.loop()}),this.options.interval)},t.prototype.stop=function(){!function(e){(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||O).call(this,e)}(this.fpsTickId),window.clearTimeout(this.loopId)},t.prototype.calculate=function(){return+(1e3/((this.loopEndTime-this.loopBeginTime)/this.count)).toFixed(this.options.decimals)},t.key="fpsMonitor",t}(Ae),Me="undefined"!=typeof window?window.performance:null,Ce=Me&&Me.timing||null,Ne=(Me&&Me.getEntriesByType&&Me.getEntriesByType("navigation")[0],{dnsLookup:{end:"domainLookupEnd",start:"domainLookupStart"},tcpConnection:{end:"connectEnd",start:"connectStart"},resourceLoad:{end:"responseEnd",start:"requestStart"},jsCost:{custom:function(){if("function"!=typeof performance.getEntries)return 0;var e=performance.getEntries(),t=e[0],i=e.filter((function(e){return"script"===e.initiatorType}))[0];return i?t.domComplete-i.fetchStart:0}},documentContentLoaded:{end:"domComplete",start:"fetchStart"},load:{end:"loadEventEnd",start:"fetchStart"},timeToFirstByte:{end:"loadEventEnd",start:"fetchStart"},firstScreen:{custom:function(e,t){var i=(t||{}).endPoint,r=void 0!==i?i:(new Date).valueOf();return Ce&&r-Ce.fetchStart||0}},whiteScreen:{custom:function(e,t){var i=(t||{}).endPoint,r=void 0!==i?i:(new Date).valueOf();return Ce&&r-Ce.fetchStart||0}}}),Fe=function(e){function t(t){var i,r=e.call(this)||this;return r.load=function(){setTimeout((function(){var e=r.collect();e&&["load","documentContentLoaded","dnsLookup","tcpConnection","jsCost","timeToFirstByte"].forEach((function(t){var i;"jsCost"===t&&0===e[t]||r.weblog.collect("CUSTOM",Ue[t],((i={})[Ue[t]]=e[t],i))}))}))},r.weblog=t,Ce?(w(window,"load",r.load),r.on("perf",(function(e){var t,i=e.key,n=e.data;r.weblog.collect("CUSTOM",Ue[i],((t={})[Ue[i]]=n[i],t))})),r):(i="The Timing Monitor need performance APIs to Support!",console&&console.error&&console.error(i),r)}return l(t,e),t.prototype.destroy=function(){R(window,"load",this.load),this.off("perf")},t.prototype.calculate=function(e,t){var i=Ne[e];if(!i)throw new Error("The perf key is not correct!");return"function"==typeof i.custom?i.custom(e,t):Ce[Ne[e].end]-Ce[Ne[e].start]},t.prototype.mark=function(e,t){var i=this.collect(e,t);this.emit("perf",{key:e,data:i})},t.prototype.collect=function(e,t){var i,r=this;if(Ce){if(e)return(i={})[e]=this.calculate(e,t),i;return Object.keys(Ne).reduce((function(e,i){return e[i]=r.calculate(i,t),e}),{})}},t.key="timingMonitor",t}(Ae),Ue={load:"total_download_cost",documentContentLoaded:"operational_cost",dnsLookup:"dns_query_cost",tcpConnection:"tcp_cost",jsCost:"js_cost",whiteScreen:"white_screen_cost",firstScreen:"first_screen_cost",timeToFirstByte:"ttfb_cost"},Be=function(e){function t(t,i){var r=e.call(this)||this;return r.oldPushState=history.pushState,r.oldReplaceState=history.replaceState,r.beginTime=Ce&&Ce.fetchStart||(new Date).valueOf(),r.visibilityChange=function(){"hidden"===document.visibilityState&&r.weblog.collect("PV",{type:"hidden",beginTime:r.beginTime}),"visible"===document.visibilityState&&r.weblog.collect("PV",{type:"visible",beginTime:r.beginTime})},r.proxyPushState=function(e,t,i){return r.urlChange(),r.oldPushState.call(history,e,t,i)},r.proxyReplaceState=function(e,t,i){return r.urlChange(),r.oldReplaceState.call(history,e,t,i)},r.urlChange=function(){setTimeout((function(){if(!r.autoPVFilter(location.href,r.weblog.currentUrl))return!1;r.weblog.collect("PV",{type:"leave",beginTime:r.beginTime}),r.weblog.updateCurrentUrlPackage(location.href),r.weblog.collect("PV",{type:"enter",beginTime:r.beginTime}),r.beginTime=(new Date).valueOf()}))},r.autoPVFilter=i||function(){return!0},r.weblog=t,r.autoPVFilter(location.href,null)&&r.weblog.collect("PV",{type:"enter",beginTime:r.beginTime}),history.pushState=r.proxyPushState,history.replaceState=r.proxyReplaceState,w(window,P?"popstate":"hashchange",r.urlChange),w(document,"visibilitychange",r.visibilityChange),r}return l(t,e),t.prototype.destroy=function(){this.weblog.sendImmediately("PV",{type:"leave"}),R(window,P?"popstate":"hashchange",this.urlChange),R(document,"visibilitychange",this.visibilityChange),history.pushState=this.oldPushState,history.replaceState=this.oldReplaceState},t.key="autoPV",t}(Ae),je=function(e){function t(t,i){void 0===t&&(t={});var r=e.call(this)||this;r.eventName="onpagehide"in window?"pagehide":"beforeunload",r.currentUrlPackage=new xe(location.href),r.logConfig={},r.isSampled=!0,r.logger=new X,r.plugins={},r.flush=function(){r.logger.flush(!1)},Ce||fe("Your browser don't support performance API, the auto pv duration may not correct"),r.baseOption=d(d({},Le),i),r.logConfig=t,r.commomPackage=Re(r.baseOption,r.logConfig);var n=t.autoPV,s=t.fps,o=t.timing,a=t.crash,u=t.autoPVFilter,l=t.referer,c=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&(i[r[n]]=e[r[n]])}return i}(t,["autoPV","fps","timing","crash","autoPVFilter","referer"]),f="",h="web";return l?(f=l.value,h=l.type&&l.type||h):document.referrer&&(f=document.referrer),f&&(r.referUrlPackage=new xe(f,h)),r.logger.init(c,r.commomPackage),r.isSampled=r.getIfSampled(),w(window,r.eventName,r.flush),r.initBuildInPlugins({autoPV:n,fps:s,timing:o,crash:a,autoPVFilter:u}),r}return l(t,e),t.prototype.getIfSampled=function(){var e=this.logConfig.sampleRate||this.logger.config.sampleRate,t=this.logConfig.sampleRateFn||this.logger.config.sampleRateFn;if(t)try{return t()}catch(e){return console.log(e,"æ½æ ·å½æ°æ¥é"),!1}return!(!e||e<0)&&Math.random()<e},Object.defineProperty(t.prototype,"currentUrl",{get:function(){var e=this.currentUrlPackage,t=e.page,i=e.params;return i&&"object"==typeof i?t+"?"+I(i):t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"referUrl",{get:function(){if(!this.referUrlPackage)return"";var e=this.referUrlPackage,t=e.page,i=e.params;return i&&"object"==typeof i?t+"?"+I(i):t},enumerable:!0,configurable:!0}),t.prototype.initBuildInPlugins=function(e){var t=e.autoPV,i=e.fps,r=e.timing,n=e.crash,s=e.autoPVFilter;t=void 0===t||t,r=void 0===r||r,n=void 0===n||n,(i=void 0===i||i)&&this.plug(Ie),r&&this.plug(Fe),n&&this.plug(Pe),t&&this.plug(Be,s)},t.prototype.updateCurrentUrlPackage=function(e){void 0===e&&(e=location.href),this.referUrlPackage=this.currentUrlPackage,this.currentUrlPackage=new xe(e)},t.prototype.updateBase=function(e){this.logger.updateBase(Re(d(d({},this.baseOption),e),this.logConfig))},t.prototype.plug=function(e,t){if(this.plugins[e.key])throw new Error("There is a duplex plugin called "+e.key);return this.plugins[e.key]=new e(this,t),this},t.prototype.unplug=function(e){var t=this.plugins[e];t&&(t.destroy(),delete this.plugins[e])},t.prototype.unplugAll=function(){for(var e in this.plugins)this.plugins[e]&&this.unplug(e)},t.prototype.generateLog=function(e,t,i,r){if(void 0===e&&(e="CLICK"),"PV"===e){var n=t,s=n.type,o=n.beginTime,a=n.page,u=n.params,l=n.contentPackage;return a&&(this.currentUrlPackage.page=a),u&&(this.currentUrlPackage.params="string"==typeof u?u:JSON.stringify(u)),Te("PV",{type:s,beginTime:o,name:"PV",params:{},currentUrlPackage:this.currentUrlPackage,referUrlPackage:this.referUrlPackage,contentPackage:l})}return Te(e,{name:t,params:i,contentPackage:r,currentUrlPackage:this.currentUrlPackage,referUrlPackage:this.referUrlPackage})},t.prototype.send=function(e,t,i,r,n,s){if(void 0===e&&(e="CLICK"),this.isSampled){var o=this.generateLog(e,t,i,r);this.logger.send(o,!!n,s)}},t.prototype.collect=function(e,t,i,r){if(void 0===e&&(e="CLICK"),"string"==typeof e)this.send(e,t,i,r,!1);else{var n=e;this.send(n.type,t,i,r,!1,n.async)}},t.prototype.sendImmediately=function(e,t,i,r){if(void 0===e&&(e="CLICK"),"string"==typeof e)this.send(e,t,i,r,!0);else{var n=e;this.send(n.type,t,i,r,!0,n.async)}},t.prototype.destroy=function(){this.unplugAll(),R(window,this.eventName,this.flush)},t}(ke)}.call(this,i(9))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i}]).default}));
//# sourceMappingURL=index.min.js.map