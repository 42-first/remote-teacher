"undefined"!=typeof window&&function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.KwaiPlayerKernelExternal=t():e.KwaiPlayerKernelExternal=t()}(this,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=5)}([function(e,t,i){var r;
/*!
 * UAParser.js v0.7.21
 * Lightweight JavaScript-based User-Agent string parser
 * https://github.com/faisalman/ua-parser-js
 *
 * Copyright Â© 2012-2019 Faisal Salman <f@faisalman.com>
 * Licensed under MIT License
 */!function(n,a){"use strict";var s="model",o="name",u="type",d="vendor",l="version",c="mobile",h="tablet",f="smarttv",_={extend:function(e,t){var i={};for(var r in e)t[r]&&t[r].length%2==0?i[r]=t[r].concat(e[r]):i[r]=e[r];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},p={rgx:function(e,t){for(var i,r,n,a,s,o,u=0;u<t.length&&!s;){var d=t[u],l=t[u+1];for(i=r=0;i<d.length&&!s;)if(s=d[i++].exec(e))for(n=0;n<l.length;n++)o=s[++r],"object"==typeof(a=l[n])&&a.length>0?2==a.length?"function"==typeof a[1]?this[a[0]]=a[1].call(this,o):this[a[0]]=a[1]:3==a.length?"function"!=typeof a[1]||a[1].exec&&a[1].test?this[a[0]]=o?o.replace(a[1],a[2]):void 0:this[a[0]]=o?a[1].call(this,o,a[2]):void 0:4==a.length&&(this[a[0]]=o?a[3].call(this,o.replace(a[1],a[2])):void 0):this[a]=o||void 0;u+=2}},str:function(e,t){for(var i in t)if("object"==typeof t[i]&&t[i].length>0){for(var r=0;r<t[i].length;r++)if(_.has(t[i][r],e))return"?"===i?void 0:i}else if(_.has(t[i],e))return"?"===i?void 0:i;return e}},v={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},m={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[o,l],[/(opios)[\/\s]+([\w\.]+)/i],[[o,"Opera Mini"],l],[/\s(opr)\/([\w\.]+)/i],[[o,"Opera"],l],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[o,l],[/(konqueror)\/([\w\.]+)/i],[[o,"Konqueror"],l],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[o,"IE"],l],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[o,"Edge"],l],[/(yabrowser)\/([\w\.]+)/i],[[o,"Yandex"],l],[/(Avast)\/([\w\.]+)/i],[[o,"Avast Secure Browser"],l],[/(AVG)\/([\w\.]+)/i],[[o,"AVG Secure Browser"],l],[/(puffin)\/([\w\.]+)/i],[[o,"Puffin"],l],[/(focus)\/([\w\.]+)/i],[[o,"Firefox Focus"],l],[/(opt)\/([\w\.]+)/i],[[o,"Opera Touch"],l],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[o,"UCBrowser"],l],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],l],[/(windowswechat qbcore)\/([\w\.]+)/i],[[o,"WeChat(Win) Desktop"],l],[/(micromessenger)\/([\w\.]+)/i],[[o,"WeChat"],l],[/(brave)\/([\w\.]+)/i],[[o,"Brave"],l],[/(qqbrowserlite)\/([\w\.]+)/i],[o,l],[/(QQ)\/([\d\.]+)/i],[o,l],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[o,l],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[o,l],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[o,l],[/(MetaSr)[\/\s]?([\w\.]+)/i],[o],[/(LBBROWSER)/i],[o],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[l,[o,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[l,[o,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[o,l],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[l,[o,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[o,/(.+)/,"$1 WebView"],l],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[o,/(.+(?:g|us))(.+)/,"$1 $2"],l],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[l,[o,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[o,"Sailfish Browser"],l],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[o,l],[/(dolfin)\/([\w\.]+)/i],[[o,"Dolphin"],l],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[o,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[o,"Chrome"],l],[/(coast)\/([\w\.]+)/i],[[o,"Opera Coast"],l],[/fxios\/([\w\.-]+)/i],[l,[o,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[l,[o,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[l,o],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[o,"GSA"],l],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[o,[l,p.str,v.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[o,l],[/(navigator|netscape)\/([\w\.-]+)/i],[[o,"Netscape"],l],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[o,l]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",_.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",_.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",_.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[s,d,[u,h]],[/applecoremedia\/[\w\.]+ \((ipad)/],[s,[d,"Apple"],[u,h]],[/(apple\s{0,1}tv)/i],[[s,"Apple TV"],[d,"Apple"],[u,f]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[d,s,[u,h]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[s,[d,"Amazon"],[u,h]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[s,p.str,v.device.amazon.model],[d,"Amazon"],[u,c]],[/android.+aft([bms])\sbuild/i],[s,[d,"Amazon"],[u,f]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[s,d,[u,c]],[/\((ip[honed|\s\w*]+);/i],[s,[d,"Apple"],[u,c]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[d,s,[u,c]],[/\(bb10;\s(\w+)/i],[s,[d,"BlackBerry"],[u,c]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[s,[d,"Asus"],[u,h]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[d,"Sony"],[s,"Xperia Tablet"],[u,h]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[d,"Sony"],[u,c]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[d,s,[u,"console"]],[/android.+;\s(shield)\sbuild/i],[s,[d,"Nvidia"],[u,"console"]],[/(playstation\s[34portablevi]+)/i],[s,[d,"Sony"],[u,"console"]],[/(sprint\s(\w+))/i],[[d,p.str,v.device.sprint.vendor],[s,p.str,v.device.sprint.model],[u,c]],[/(htc)[;_\s-]+([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[d,[s,/_/g," "],[u,c]],[/(nexus\s9)/i],[s,[d,"HTC"],[u,h]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p|vog-l29|ane-lx1|eml-l29)/i],[s,[d,"Huawei"],[u,c]],[/android.+(bah2?-a?[lw]\d{2})/i],[s,[d,"Huawei"],[u,h]],[/(microsoft);\s(lumia[\s\w]+)/i],[d,s,[u,c]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[s,[d,"Microsoft"],[u,"console"]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[d,"Microsoft"],[u,c]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[s,[d,"Motorola"],[u,c]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[s,[d,"Motorola"],[u,h]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[d,_.trim],[s,_.trim],[u,f]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[d,"Samsung"],[u,f]],[/\(dtv[\);].+(aquos)/i],[s,[d,"Sharp"],[u,f]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[d,"Samsung"],s,[u,h]],[/smart-tv.+(samsung)/i],[d,[u,f],s],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[d,"Samsung"],s,[u,c]],[/sie-(\w*)/i],[s,[d,"Siemens"],[u,c]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[d,"Nokia"],s,[u,c]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[s,[d,"Acer"],[u,h]],[/android.+([vl]k\-?\d{3})\s+build/i],[s,[d,"LG"],[u,h]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[d,"LG"],s,[u,h]],[/(lg) netcast\.tv/i],[d,s,[u,f]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[s,[d,"LG"],[u,c]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[d,s,[u,h]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[s,[d,"Lenovo"],[u,h]],[/(lenovo)[_\s-]?([\w-]+)/i],[d,s,[u,c]],[/linux;.+((jolla));/i],[d,s,[u,c]],[/((pebble))app\/[\d\.]+\s/i],[d,s,[u,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[d,s,[u,c]],[/crkey/i],[[s,"Chromecast"],[d,"Google"],[u,f]],[/android.+;\s(glass)\s\d/i],[s,[d,"Google"],[u,"wearable"]],[/android.+;\s(pixel c)[\s)]/i],[s,[d,"Google"],[u,h]],[/android.+;\s(pixel( [23])?( xl)?)[\s)]/i],[s,[d,"Google"],[u,c]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:a\d|one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[s,/_/g," "],[d,"Xiaomi"],[u,c]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[s,/_/g," "],[d,"Xiaomi"],[u,h]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[s,[d,"Meizu"],[u,c]],[/(mz)-([\w-]{2,})/i],[[d,"Meizu"],s,[u,c]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[s,[d,"OnePlus"],[u,c]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[s,[d,"RCA"],[u,h]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[s,[d,"Dell"],[u,h]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[s,[d,"Verizon"],[u,h]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[d,"Barnes & Noble"],s,[u,h]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[s,[d,"NuVision"],[u,h]],[/android.+;\s(k88)\sbuild/i],[s,[d,"ZTE"],[u,h]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[s,[d,"Swiss"],[u,c]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[s,[d,"Swiss"],[u,h]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[s,[d,"Zeki"],[u,h]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[d,"Dragon Touch"],s,[u,h]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[s,[d,"Insignia"],[u,h]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[s,[d,"NextBook"],[u,h]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[d,"Voice"],s,[u,c]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[d,"LvTel"],s,[u,c]],[/android.+;\s(PH-1)\s/i],[s,[d,"Essential"],[u,c]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[s,[d,"Envizen"],[u,h]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[d,s,[u,h]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[s,[d,"MachSpeed"],[u,h]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[d,s,[u,h]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[s,[d,"Rotor"],[u,h]],[/android.+(KS(.+))\s+build/i],[s,[d,"Amazon"],[u,h]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[d,s,[u,h]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[u,_.lowerize],d,s],[/[\s\/\(](smart-?tv)[;\)]/i],[[u,f]],[/(android[\w\.\s\-]{0,9});.+build/i],[s,[d,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[l,[o,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[l,[o,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[o,l],[/rv\:([\w\.]{1,9}).+(gecko)/i],[l,o]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[o,l],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[o,[l,p.str,v.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[o,"Windows"],[l,p.str,v.os.windows.version]],[/\((bb)(10);/i],[[o,"BlackBerry"],l],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[o,l],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[o,"Symbian"],l],[/\((series40);/i],[o],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[o,"Firefox OS"],l],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[o,l],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[o,"Chromium OS"],l],[/(sunos)\s?([\w\.\d]*)/i],[[o,"Solaris"],l],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[o,l],[/(haiku)\s(\w+)/i],[o,l],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[l,/_/g,"."],[o,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[o,"Mac OS"],[l,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[o,l]]},g=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof g))return new g(e,t).getResult();var i=e||(n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),r=t?_.extend(m,t):m;return this.getBrowser=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,i,r.browser),e.major=_.major(e.version),e},this.getCPU=function(){var e={architecture:void 0};return p.rgx.call(e,i,r.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return p.rgx.call(e,i,r.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,i,r.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,i,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};g.VERSION="0.7.21",g.BROWSER={NAME:o,MAJOR:"major",VERSION:l},g.CPU={ARCHITECTURE:"architecture"},g.DEVICE={MODEL:s,VENDOR:d,TYPE:u,CONSOLE:"console",MOBILE:c,SMARTTV:f,TABLET:h,WEARABLE:"wearable",EMBEDDED:"embedded"},g.ENGINE={NAME:o,VERSION:l},g.OS={NAME:o,VERSION:l},void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=g),t.UAParser=g):void 0===(r=function(){return g}.call(t,i,t,e))||(e.exports=r);var y=n&&(n.jQuery||n.Zepto);if(y&&!y.ua){var b=new g;y.ua=b.getResult(),y.ua.get=function(){return b.getUA()},y.ua.set=function(e){b.setUA(e);var t=b.getResult();for(var i in t)y.ua[i]=t[i]}}}("object"==typeof window?window:this)},function(e,t,i){(function(t){var i;"undefined"!=typeof window&&(i=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="./src/index.ts")}({"./node_modules/@ks/adaptive-multi-rate/lib/adaptive-flv.js":
/*!******************************************************************!*\
  !*** ./node_modules/@ks/adaptive-multi-rate/lib/adaptive-flv.js ***!
  \******************************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){(function(e){var r,n;!function(a,s,o,u,d,l,c,h,f,_,p,v,m,g,y,b,E,S,T,w,L,R,x,k,A,O,P,D,I,C,N,M,U,B,F,V,j,H,G,K,q,W,z,Y,X,Q,J,Z,$,ee,te,ie,re,ne,ae,se,oe,ue,de,le,ce,he,fe,_e,pe,ve,me,ge,ye,be,Ee,Se,Te,we,Le,Re,xe,ke,Ae,Oe,Pe,De,Ie,Ce,Ne,Me,Ue,Be,Fe,Ve,je,He,Ge,Ke,qe,We,ze,Ye,Xe,Qe,Je,Ze,$e,et,tt,it,rt,nt,at,st,ot,ut,dt,lt,ct,ht,ft,_t,pt,vt,mt,gt,yt,bt,Et,St,Tt,wt,Lt,Rt,xt,kt,At,Ot,Pt,Dt,It,Ct,Nt,Mt,Ut,Bt,Ft,Vt,jt,Ht,Gt,Kt,qt,Wt,zt,Yt,Xt,Qt,Jt,Zt,$t,ei,ti,ii,ri,ni,ai,si,oi,ui,di,li,ci,hi,fi,_i,pi,vi,mi,gi,yi,bi,Ei,Si,Ti,wi,Li,Ri,xi,ki,Ai,Oi,Pi,Di,Ii,Ci,Ni,Mi,Ui,Bi,Fi,Vi,ji,Hi,Gi,Ki,qi,Wi,zi,Yi,Xi,Qi,Ji,Zi,$i,er,tr,ir,rr,nr,ar,sr,or,ur,dr,lr,cr,hr,fr,_r,pr,vr,mr,gr,yr,br,Er,Sr,Tr,wr,Lr,Rr,xr,kr,Ar,Or,Pr,Dr,Ir){!function(a,s){"object"==typeof t&&void 0!==e?e.exports=s():i(/*! !webpack amd define */"./node_modules/webpack/buildin/amd-define.js").amd?void 0===(n="function"==typeof(r=s)?r.call(t,i,t,e):r)||(e.exports=n):(a=a||self).adaptiveMultiRate=s()}(this,(function(){"use strict";var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t[_](i)&&(e[i]=t[i])})(t,i)},t=function(){return(t=Object.assign||function(e){for(var t,i=1,r=arguments[g];i<r;i++)for(var n in t=arguments[i])Object[b][_].call(t,n)&&(e[n]=t[n]);return e})[p](this,arguments)};function i(){}function r(){r.init.call(this)}function n(e){return void 0===e[T]?r.defaultMaxListeners:e[T]}function a(e,t,r,a){var s,o,u;if(d!=typeof r)throw new TypeError(L);if((o=e[R])?(o.newListener&&(e.emit("newListener",t,r[A]?r[A]:r),o=e[R]),u=o[t]):(o=e[R]=new i,e[O]=0),u){if(d==typeof u?u=o[t]=a?[r,u]:[u,r]:a?u.unshift(r):u.push(r),!u.warned&&(s=n(e))&&0<s&&u[g]>s){u.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+u[g]+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=u[g],function(e){d==typeof console.warn?console.warn(e):console.log(e)}(l)}}else u=o[t]=r,++e[O];return e}function s(e,t,i){var r=!1;function n(){e[K](t,n),r||(r=!0,i[p](e,arguments))}return n[A]=i,n}function o(e){var t=this[R];if(t){var i=t[e];if(d==typeof i)return 1;if(i)return i[g]}return 0}function u(e,t){for(var i=new Array(t);t--;)i[t]=e[t];return i}i[b]=Object.create(null),(r.EventEmitter=r).usingDomains=!1,r[b].domain=void 0,r[b][R]=void 0,r[b][T]=void 0,r.defaultMaxListeners=10,r.init=function(){this.domain=null,r.usingDomains&&(void 0).active,this[R]&&this[R]!==Object.getPrototypeOf(this)[R]||(this[R]=new i,this[O]=0),this[T]=this[T]||void 0},r[b].setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this[T]=e,this},r[b].getMaxListeners=function(){return n(this)},r[b].emit=function(e,t,i,r){var n,a,s,o,l,c,h,f="error"===e;if(c=this[R])f=f&&null==c.error;else if(!f)return!1;if(h=this.domain,f){if(n=t,h)return(n=n||new Error(ae)).domainEmitter=this,n.domain=h,n.domainThrown=!1,h.emit("error",n),!1;if(n instanceof Error)throw n;var _=new Error(oe+n+")");throw _.context=n,_}if(!(a=c[e]))return!1;var v=d==typeof a;switch(s=arguments[g]){case 1:!function(e,t,i){if(t)e.call(i);else for(var r=e[g],n=u(e,r),a=0;a<r;++a)n[a].call(i)}(a,v,this);break;case 2:!function(e,t,i,r){if(t)e.call(i,r);else for(var n=e[g],a=u(e,n),s=0;s<n;++s)a[s].call(i,r)}(a,v,this,t);break;case 3:!function(e,t,i,r,n){if(t)e.call(i,r,n);else for(var a=e[g],s=u(e,a),o=0;o<a;++o)s[o].call(i,r,n)}(a,v,this,t,i);break;case 4:!function(e,t,i,r,n,a){if(t)e.call(i,r,n,a);else for(var s=e[g],o=u(e,s),d=0;d<s;++d)o[d].call(i,r,n,a)}(a,v,this,t,i,r);break;default:for(o=new Array(s-1),l=1;l<s;l++)o[l-1]=arguments[l];!function(e,t,i,r){if(t)e[p](i,r);else for(var n=e[g],a=u(e,n),s=0;s<n;++s)a[s][p](i,r)}(a,v,this,o)}return!0},r[b].on=r[b].addListener=function(e,t){return a(this,e,t,!1)},r[b].prependListener=function(e,t){return a(this,e,t,!0)},r[b].once=function(e,t){if(d!=typeof t)throw new TypeError(L);return this.on(e,s(this,e,t)),this},r[b].prependOnceListener=function(e,t){if(d!=typeof t)throw new TypeError(L);return this.prependListener(e,s(this,e,t)),this},r[b][K]=function(e,t){var r,n,a,s,o;if(d!=typeof t)throw new TypeError(L);if(!(n=this[R]))return this;if(!(r=n[e]))return this;if(r===t||r[A]&&r[A]===t)0==--this[O]?this[R]=new i:(delete n[e],n[K]&&this.emit(K,e,r[A]||t));else if(d!=typeof r){for(a=-1,s=r[g];0<s--;)if(r[s]===t||r[s][A]&&r[s][A]===t){o=r[s][A],a=s;break}if(a<0)return this;if(1===r[g]){if(r[0]=void 0,0==--this[O])return this[R]=new i,this;delete n[e]}else!function(e,t){for(var i=t,r=i+1,n=e[g];r<n;i+=1,r+=1)e[i]=e[r];e.pop()}(r,a);n[K]&&this.emit(K,e,o||t)}return this},r[b][ye]=function(e){var t,r;if(!(r=this[R]))return this;if(!r[K])return 0===arguments[g]?(this[R]=new i,this[O]=0):r[e]&&(0==--this[O]?this[R]=new i:delete r[e]),this;if(0===arguments[g]){for(var n,a=Object.keys(r),s=0;s<a[g];++s)K!==(n=a[s])&&this[ye](n);return this[ye](K),this[R]=new i,this[O]=0,this}if(d==typeof(t=r[e]))this[K](e,t);else if(t)for(;this[K](e,t[t[g]-1]),t[0];);return this},r[b].listeners=function(e){var t,i=this[R];return i&&(t=i[e])?d==typeof t?[t[A]||t]:function(e){for(var t=new Array(e[g]),i=0;i<t[g];++i)t[i]=e[i][A]||e[i];return t}(t):[]},r[Se]=function(e,t){return d==typeof e[Se]?e[Se](t):o.call(e,t)},r[b][Se]=o,r[b].eventNames=function(){return 0<this[O]?Reflect.ownKeys(this[R]):[]};var l={version:"1.0",adaptationSet:{representation:[{bitrate:900,id:0,url:""},{bitrate:1e3,id:1,url:""},{bitrate:1500,id:2,url:""}]}},c={consistent_bitrate_threshold:3,lower_buffered_time:3e3,upper_buffered_time:6e3,timeout_minutes:129600,buffer_up_ahead:3,buffer_down_ahead:5,start_up_duration:3,speed_heartbeat_limit:9},h={buffered:0,download:{size:0,duration:0},currentTime:0},f={consistent_bitrate_threshold:{min:0,max:10},lower_buffered_time:{min:0,max:1e5},upper_buffered_time:{min:0,max:1e5},timeout_minutes:{min:0,max:Number.MAX_SAFE_INTEGER},buffer_up_ahead:{min:0,max:100},buffer_down_ahead:{min:0,max:100},start_up_duration:{min:0,max:100},speed_heartbeat_limit:{min:0,max:100},buffered:{min:0,max:3e5},videoTime:{min:0,max:Number.MAX_SAFE_INTEGER},bufferDiff:{min:-1300,max:3e5},videoTimeDiff:{min:0,max:1300},downloadSize:{min:0,max:1e9},downloadDuration:{min:0,max:1100},bitrate:{min:100,max:1e5}};function v(e){return(v=d==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&d==typeof Symbol&&e.constructor===Symbol&&e!==Symbol[b]?"symbol":typeof e})(e)}var m,y,E=[];function S(e,t){t&&0!==t[g]||(t=[e],e="");var i=t.map((function(e){return"object"===v(e)?JSON.stringify(e):e}));return i.unshift("[kwai-ae"+(e?"::"+e:"")+"] > "),i}(y=m=m||{}).LEVEL_ERROR="e",y.LEVEL_WARN="w",y.LEVEL_INFO="i",y.LEVEL_DEBUG="d",y.LEVEL_VERBOSE="v";var w=(x.level=function(e){switch(x[ot]=x[ut]=x[dt]=x[lt]=x[ct]=!1,e){case m.LEVEL_ERROR:x[ot]=!0;break;case m.LEVEL_WARN:x[ot]=x[ut]=!0;break;case m.LEVEL_INFO:x[ot]=x[ut]=x[dt]=!0;break;case m.LEVEL_DEBUG:x[ot]=x[ut]=x[dt]=x[lt]=!0;break;case m.LEVEL_VERBOSE:x[ot]=x[ut]=x[dt]=x[lt]=x[ct]=!0}},x.e=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];if(x[ot]){var r=S(e,t);(console.error||console.warn||console.log)[p](console,r)}},x.w=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];var r=S(e,t),n=(new Date).toLocaleTimeString("CN",{hour12:!1});E.push(n+" "+r.join(" ")),x[ut]&&(console.warn||console.log)[p](console,r)},x.i=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];if(x[dt]){var r=S(e,t);(console.info||console.log)[p](console,r)}},x.d=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];if(x[lt]){var r=S(e,t);(console.debug||console.log)[p](console,r)}},x.v=function(e){for(var t=[],i=1;i<arguments[g];i++)t[i-1]=arguments[i];if(x[ct]){var r=S(e,t);console.log[p](console,r)}},x.qos=function(){if(0===E[g])return{};var e=E.join(";    ");return E=[],{warning:e}},x[ot]=!0,x[ut]=!1,x[dt]=!1,x[lt]=!1,x[ct]=!1,x);function x(){}var k="check";function P(e,t,i){void 0===i&&(i=f[e].min);var r=f[e];return isNaN(t)||null===t?(w.w(k,"invalid number:",e,t,"default",i),i):((t<r.min||t>r.max||"number"!=typeof t)&&w.w(k,"unexpected number value or type:",e,t,"min",r.min,"max",r.max),Number(t))}function D(e){if(!e)return w.w(k,"invalid config:",e),c;var t=Object.assign[p](Object,function(){for(var e=0,t=0,i=arguments[g];t<i;t++)e+=arguments[t][g];var r=Array(e),n=0;for(t=0;t<i;t++)for(var a=arguments[t],s=0,o=a[g];s<o;s++,n++)r[n]=a[s];return r}([{}],Object.entries(c).map((function(t){var i,r=t[0],n=t[1];return(i={})[r]=P(r,e[r],n),i}))));return w.d(k,"config:",t),t}function I(e){if(!e)return w.w(k,"invalid info:",e),h;var t={buffered:P("buffered",e.buffered),download:function(e){return e?{size:P("downloadSize",e.size),duration:P("downloadDuration",e.duration)}:(w.w(k,"invalid download:",e),h.download)}(e.download),currentTime:P("videoTime",e.currentTime)};return w.d(k,"info:",t),t}var C=(N[b].checkBufferAndVideoTime=function(e,t){return P("bufferDiff",e-this[jt]),P("videoTimeDiff",t-this[Gt]),this[jt]=e,this[Gt]=t,this},N);function N(e,t){this[jt]=e,this[Gt]=t}var M=(U[b].write=function(e,t){if(U.available)try{localStorage.setItem(e,JSON.stringify({value:t,time:Date.now()}))}catch(e){}},U[b].read=function(e){if(U.available)try{var t=localStorage.getItem(e);if(t){var i=JSON.parse(t),r=i.value,n=i.time,a=void 0===n?0:n;if(Date.now()-a<this.timeout)return r}}catch(e){}},Object.defineProperty(U,"available",{get:function(){if(void 0===U._available)try{localStorage.setItem("alg","test"),U._available=!0}catch(e){U._available=!1}return U._available},enumerable:!0,configurable:!0}),U);function U(){this.timeout=2592e6}var B="bitrate",F=(V[b].reset=function(){this[oi]=0},V[b]._highestIndexBelowThan=function(e){return Math.max(0,this[li].filter((function(t){return t.bitrate<=e}))[g]-1)},V[b].nextIndexAndBitrate=function(e){var t=this,i=this[hi];return this._needToDecrease(e[i])?(i=Math.max(0,e.filter((function(e){return!t._needToDecrease(e)}))[g]-1),w.d(B,"index:",i)):this._needToIncrease(e[i])&&(i=Math.min(this[li][g]-1,i+1)),this._generateResult(i)},V[b].availableBitrates=function(){return this[li].map((function(e){return e.bitrate}))},V[b].nextStartUp=function(){return this._generateResult(this[hi])},V[b]._generateResult=function(e){this._recordIndex(e);var t=this[bi](e);this._recordBitrate(t);var i=this[Si](e);return w.d(B,"next index:",i,"bitrate:",t),{index:i,bitrate:t}},V[b]._needToDecrease=function(e){return e<this._config.lower_buffered_time},V[b]._needToIncrease=function(e){return e>=this._config.upper_buffered_time&&this[oi]>=this._config.consistent_bitrate_threshold},V[b]._recordIndex=function(e){e!==this[hi]?(this[hi]=e,this[oi]=1):this[oi]+=1},V[b][bi]=function(e){return this[li][e].bitrate},V[b]._recordBitrate=function(e){this._storage.write("bitrate",e)},V[b][Si]=function(e){return this[li][e].index},V[b].getQos=function(){return{}},V[b].setLastIndex=function(e){var t=this[li].findIndex((function(t){return t.index===e}));return-1===t?w.w(B,"fail to find index:",e):this[hi]=t,this},V[b].getLastBitrate=function(){return this[bi](this[hi])},V);function V(e,t,i){this[li]=e.map((function(e,t){return{bitrate:e.bitrate,index:t}})).filter((function(e){var t=e.bitrate;return t===P("bitrate",t)})).sort((function(e,t){return e.bitrate-t.bitrate})),w.d(B,"available bitrates:",this[li].map((function(e){return e.bitrate}))),this._storage=i,this._config=t;var r=this._storage.read("bitrate")||0;this[hi]=this._highestIndexBelowThan(r),this[oi]=0}var j=(H[b].reset=function(){this._buffer=0,this._speed=0},H[b].setBufferAndSpeed=function(e,t){this._buffer=e,this._speed=t},H[b].predictBuffers=function(){var e=this,t=this._bitrates.map((function(t){return e.predictBuffer(t)}));return w.d("buffer","predicted buffer:",t),t},H[b].predictBuffer=function(e){var t=this._speed/e*1e3-1e3,i=0<t?this._config.buffer_up_ahead:this._config.buffer_down_ahead;return this._buffer+i*t},H[b].getQos=function(){return{}},H);function H(e,t){this._buffer=0,this._speed=0,this._config=e,this._bitrates=t}var G,q,W,z="speed",Y=(X[b].recordDownload=function(e){return this[Qi]+=e.duration,this[Ji].unshift(e),this._speed=this._calculateSpeed(),w.d(z,"predictedSpeed:",this._speed),this._speed},X[b].reset=function(){this[Ji]=[],this._speed=0,this[er]=0,this[jt]=0,this[Qi]=0,this[Gt]=0},X[b]._calculateSpeed=function(){var e=this,t=0,i=0;return this[Ji].forEach((function(r,n){var a=r.size,s=r.duration,o=1e3*e._config.speed_heartbeat_limit-i;o<s&&(a=a*o/s,s=o,e[Ji][n]={size:a,duration:s},e[Ji].splice(n+1)),i+=s,t+=a})),t/i*8||0},X[b].getSpeed=function(){return Math.round(this._speed)},X[b].getQos=function(){return{speedUpperLimit:Math.round(this[er])}},X[b][or]=function(e,t,i){var r=i-this[Gt];this[Gt]=i,w.d(z,"playedVideo",r);var n=e-this[jt]+r;return this[jt]=e,w.d(z,"downloadBuffer",n),this[er]=n*t/Math.max(1,this[Qi],n),this[Qi]=0,w.d(z,"speedUpperLimit:",this[er]),this[er]},X);function X(e){this[Ji]=[],this._speed=0,this[er]=0,this[jt]=0,this[Qi]=0,this[Gt]=0,this._config=e}function Q(){this.constructor=G}function J(e,t,i){var r=W.call(this)||this;r._next=0,r._index=0,w.d("main","version:","3.0.1"),r._config=D(t);var n=function(e){return!e||!e[vr]||!e[vr][mr]||e[vr][mr][g]<1?(w.w(k,"invalid representation:",e),l[vr][mr]):e[vr][mr]}(e),a=new M;a.timeout=60*r._config.timeout_minutes*1e3,r[Er]=new F(n,r._config,a);var s=r[Er].availableBitrates();return r[Sr]=new j(r._config,s),r[Tr]=new Y(r._config),i&&r[Er].setLastIndex(i.index),r._next=r._startUpIndex().index,r}return e(G=J,q=W=r),G[b]=null===q?Object.create(q):(Q[b]=q[b],new Q),J.setLogLevel=function(e){w.level(e)},J[b].reset=function(){this[Er].reset(),this[Sr].reset(),this[Tr].reset()},J[b].onHeartbeat=function(e){var t=I(e),i=t.buffered,r=t.download,n=t.currentTime;this[xr]?this[xr].checkBufferAndVideoTime(i,n):this[xr]=new C(i,n);var a=this[Tr].recordDownload(r);this.emit(kr,{type:"heartbeat",data:{time:Date.now(),speed:a,buffered:i}})},J[b].onGOP=function(e){var t=I(e),i=t.buffered,r=t.download,n=t.currentTime,a=this[Tr].recordDownload(r),s=this[Er].getLastBitrate(),o=this[Tr][or](i,s,n);this[Sr].setBufferAndSpeed(i,o);var u=this._nextIndex(),d=u.index,l=u.bitrate,c=Date.now();this._next=d,this.emit(kr,{type:"heartbeat",data:{time:c,speed:a,buffered:i}}),this.emit(kr,{type:"bitrate",data:{time:c,bitrate:l,speedUpperLimit:o}})},J[b].onLevelLoad=function(e){this._index=e,this[Er].setLastIndex(e)},Object.defineProperty(J[b],"nextIndex",{get:function(){return this._next},enumerable:!0,configurable:!0}),J[b]._startUpIndex=function(){return this[Er].nextStartUp()},J[b]._nextIndex=function(){var e=this[Sr].predictBuffers();return this[Er].nextIndexAndBitrate(e)},Object.defineProperty(J[b],"qos",{get:function(){return{speed:this[Tr].getSpeed(),extra:t(t(t(t({},w.qos()),this[Er].getQos()),this[Sr].getQos()),this[Tr].getQos())}},enumerable:!0,configurable:!0}),J}))}(0,0,0,0,"function",0,0,0,0,"hasOwnProperty","apply",0,0,"length",0,"prototype",0,0,"_maxListeners",0,'"listener" argument must be a function',"_events",0,0,"listener","_eventsCount",0,0,0,0,0,0,0,0,0,0,0,0,0,"removeListener",0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Uncaught, unspecified "error" event',0,'Uncaught, unspecified "error" event. (',0,0,0,0,0,0,0,0,0,0,0,"removeAllListeners",0,0,"listenerCount",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"ENABLE_ERROR","ENABLE_WARN","ENABLE_INFO","ENABLE_DEBUG","ENABLE_VERBOSE",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_lastBuffer",0,"_lastVideoTime",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_consistentCount",0,0,"_availableBitrates",0,"_lastRequestedIndex",0,0,0,0,0,0,0,"_sortedIndex2Rate",0,"_sortedIndex2Representation",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_downloadDuration","_downloads",0,0,"_speedUpperLimit",0,0,0,0,0,0,"getSpeedUpperLimitAndUpdate",0,0,0,0,0,0,0,0,"adaptationSet","representation",0,0,0,"_bitrateCalculator","_bufferPredictor","_speedPredictor",0,0,0,"_heartbeatChecker","adaptiveAlgorithm")}).call(this,i(/*! ./../../../webpack/buildin/module.js */"./node_modules/webpack/buildin/module.js")(e))},"./node_modules/@ks/adaptive-multi-rate/lib/adaptive-hls.js":
/*!******************************************************************!*\
  !*** ./node_modules/@ks/adaptive-multi-rate/lib/adaptive-hls.js ***!
  \******************************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){(function(e){var r,n;!function(a,s,o,u,d,l,c,h,f,_,p,v,m,g,y,b,E,S,T,w,L,R,x,k,A,O,P,D,I,C,N,M,U,B,F,V,j,H,G,K,q,W,z,Y,X,Q,J,Z,$,ee,te,ie,re,ne,ae,se,oe,ue,de,le,ce,he,fe,_e,pe,ve,me,ge,ye,be,Ee,Se,Te,we,Le,Re,xe,ke,Ae,Oe,Pe,De,Ie,Ce,Ne,Me,Ue,Be,Fe,Ve,je,He,Ge,Ke,qe,We,ze,Ye,Xe,Qe,Je,Ze,$e,et,tt,it,rt,nt,at,st,ot,ut,dt,lt,ct,ht,ft,_t,pt,vt,mt,gt,yt,bt,Et,St,Tt,wt,Lt,Rt,xt,kt,At,Ot,Pt,Dt,It,Ct,Nt,Mt,Ut,Bt,Ft,Vt,jt,Ht,Gt,Kt,qt,Wt,zt,Yt,Xt,Qt,Jt,Zt,$t,ei,ti,ii,ri,ni,ai,si,oi,ui,di,li,ci,hi,fi,_i,pi,vi,mi,gi,yi,bi,Ei,Si,Ti,wi,Li,Ri,xi,ki,Ai,Oi,Pi,Di,Ii,Ci,Ni,Mi,Ui,Bi,Fi,Vi,ji,Hi,Gi,Ki,qi,Wi,zi,Yi,Xi,Qi,Ji,Zi,$i,er,tr,ir,rr,nr,ar,sr,or,ur,dr,lr,cr,hr,fr,_r,pr,vr,mr,gr,yr,br,Er,Sr,Tr,wr,Lr,Rr,xr,kr,Ar,Or,Pr,Dr,Ir,Cr,Nr,Mr,Ur,Br,Fr,Vr,jr,Hr,Gr,Kr,qr,Wr,zr,Yr,Xr,Qr,Jr,Zr,$r,en,tn,rn,nn,an,sn,on,un,dn,ln,cn,hn,fn,_n,pn,vn,mn,gn,yn,bn,En,Sn,Tn,wn,Ln,Rn,xn){!function(a,s){"object"==typeof t&&void 0!==e?e.exports=s():i(/*! !webpack amd define */"./node_modules/webpack/buildin/amd-define.js").amd?void 0===(n="function"==typeof(r=s)?r.call(t,i,t,e):r)||(e.exports=n):(a=a||self).adaptiveMultiRate=s()}(this,(function(){"use strict";function e(t){return(e=d==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&d==typeof Symbol&&e[_]===Symbol&&e!==Symbol[p]?"symbol":typeof e})(t)}function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments[y];t++){var i=arguments[t];for(var r in i)Object[p][E].call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t[E](i)&&(e[i]=t[i])})(e,t)};function r(){}function n(){n.init.call(this)}function a(e){return void 0===e[R]?n.defaultMaxListeners:e[R]}function s(e,t,i,n){var s,o,u;if(d!=typeof i)throw new TypeError(k);if((o=e[A])?(o.newListener&&(e.emit("newListener",t,i[D]?i[D]:i),o=e[A]),u=o[t]):(o=e[A]=new r,e[I]=0),u){if(d==typeof u?u=o[t]=n?[i,u]:[u,i]:n?u.unshift(i):u.push(i),!u.warned&&(s=a(e))&&0<s&&u[y]>s){u.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+u[y]+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=u[y],function(e){d==typeof console.warn?console.warn(e):console.log(e)}(l)}}else u=o[t]=i,++e[I];return e}function o(e,t,i){var r=!1;function n(){e[z](t,n),r||(r=!0,i.apply(e,arguments))}return n[D]=i,n}function u(e){var t=this[A];if(t){var i=t[e];if(d==typeof i)return 1;if(i)return i[y]}return 0}function l(e,t){for(var i=new Array(t);t--;)i[t]=e[t];return i}r[p]=Object.create(null),(n.EventEmitter=n).usingDomains=!1,n[p].domain=void 0,n[p][A]=void 0,n[p][R]=void 0,n.defaultMaxListeners=10,n.init=function(){this.domain=null,n.usingDomains&&(void 0).active,this[A]&&this[A]!==Object.getPrototypeOf(this)[A]||(this[A]=new r,this[I]=0),this[R]=this[R]||void 0},n[p].setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this[R]=e,this},n[p].getMaxListeners=function(){return a(this)},n[p].emit=function(e,t,i,r){var n,a,s,o,u,c,h,f="error"===e;if(c=this[A])f=f&&null==c.error;else if(!f)return!1;if(h=this.domain,f){if(n=t,h)return(n=n||new Error(ue)).domainEmitter=this,n.domain=h,n.domainThrown=!1,h.emit("error",n),!1;if(n instanceof Error)throw n;var _=new Error(le+n+")");throw _.context=n,_}if(!(a=c[e]))return!1;var p=d==typeof a;switch(s=arguments[y]){case 1:!function(e,t,i){if(t)e.call(i);else for(var r=e[y],n=l(e,r),a=0;a<r;++a)n[a].call(i)}(a,p,this);break;case 2:!function(e,t,i,r){if(t)e.call(i,r);else for(var n=e[y],a=l(e,n),s=0;s<n;++s)a[s].call(i,r)}(a,p,this,t);break;case 3:!function(e,t,i,r,n){if(t)e.call(i,r,n);else for(var a=e[y],s=l(e,a),o=0;o<a;++o)s[o].call(i,r,n)}(a,p,this,t,i);break;case 4:!function(e,t,i,r,n,a){if(t)e.call(i,r,n,a);else for(var s=e[y],o=l(e,s),u=0;u<s;++u)o[u].call(i,r,n,a)}(a,p,this,t,i,r);break;default:for(o=new Array(s-1),u=1;u<s;u++)o[u-1]=arguments[u];!function(e,t,i,r){if(t)e.apply(i,r);else for(var n=e[y],a=l(e,n),s=0;s<n;++s)a[s].apply(i,r)}(a,p,this,o)}return!0},n[p].on=n[p].addListener=function(e,t){return s(this,e,t,!1)},n[p].prependListener=function(e,t){return s(this,e,t,!0)},n[p].once=function(e,t){if(d!=typeof t)throw new TypeError(k);return this.on(e,o(this,e,t)),this},n[p].prependOnceListener=function(e,t){if(d!=typeof t)throw new TypeError(k);return this.prependListener(e,o(this,e,t)),this},n[p][z]=function(e,t){var i,n,a,s,o;if(d!=typeof t)throw new TypeError(k);if(!(n=this[A]))return this;if(!(i=n[e]))return this;if(i===t||i[D]&&i[D]===t)0==--this[I]?this[A]=new r:(delete n[e],n[z]&&this.emit(z,e,i[D]||t));else if(d!=typeof i){for(a=-1,s=i[y];0<s--;)if(i[s]===t||i[s][D]&&i[s][D]===t){o=i[s][D],a=s;break}if(a<0)return this;if(1===i[y]){if(i[0]=void 0,0==--this[I])return this[A]=new r,this;delete n[e]}else!function(e,t){for(var i=t,r=i+1,n=e[y];r<n;i+=1,r+=1)e[i]=e[r];e.pop()}(i,a);n[z]&&this.emit(z,e,o||t)}return this},n[p][Se]=function(e){var t,i;if(!(i=this[A]))return this;if(!i[z])return 0===arguments[y]?(this[A]=new r,this[I]=0):i[e]&&(0==--this[I]?this[A]=new r:delete i[e]),this;if(0===arguments[y]){for(var n,a=Object.keys(i),s=0;s<a[y];++s)z!==(n=a[s])&&this[Se](n);return this[Se](z),this[A]=new r,this[I]=0,this}if(d==typeof(t=i[e]))this[z](e,t);else if(t)for(;this[z](e,t[t[y]-1]),t[0];);return this},n[p].listeners=function(e){var t,i=this[A];return i&&(t=i[e])?d==typeof t?[t[D]||t]:function(e){for(var t=new Array(e[y]),i=0;i<t[y];++i)t[i]=e[i][D]||e[i];return t}(t):[]},n[Le]=function(e,t){return d==typeof e[Le]?e[Le](t):u.call(e,t)},n[p][Le]=u,n[p].eventNames=function(){return 0<this[I]?Reflect.ownKeys(this[A]):[]};var c,h,f=[];function v(t,i){i&&0!==i[y]||(i=[t],t="");var r=i.map((function(t){return"object"===e(t)?JSON.stringify(t):t}));return r.unshift("[kwai-ae"+(t?"::"+t:"")+"] > "),r}(h=c=c||{}).LEVEL_ERROR="e",h.LEVEL_WARN="w",h.LEVEL_INFO="i",h.LEVEL_DEBUG="d",h.LEVEL_VERBOSE="v";var m=(g.level=function(e){switch(g[qe]=g[We]=g[ze]=g[Ye]=g[Xe]=!1,e){case c.LEVEL_ERROR:g[qe]=!0;break;case c.LEVEL_WARN:g[qe]=g[We]=!0;break;case c.LEVEL_INFO:g[qe]=g[We]=g[ze]=!0;break;case c.LEVEL_DEBUG:g[qe]=g[We]=g[ze]=g[Ye]=!0;break;case c.LEVEL_VERBOSE:g[qe]=g[We]=g[ze]=g[Ye]=g[Xe]=!0}},g.e=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];if(g[qe]){var r=v(e,t);(console.error||console.warn||console.log).apply(console,r)}},g.w=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];var r=v(e,t),n=(new Date).toLocaleTimeString("CN",{hour12:!1});f.push(n+" "+r.join(" ")),g[We]&&(console.warn||console.log).apply(console,r)},g.i=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];if(g[ze]){var r=v(e,t);(console.info||console.log).apply(console,r)}},g.d=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];if(g[Ye]){var r=v(e,t);(console.debug||console.log).apply(console,r)}},g.v=function(e){for(var t=[],i=1;i<arguments[y];i++)t[i-1]=arguments[i];if(g[Xe]){var r=v(e,t);console.log.apply(console,r)}},g.qos=function(){if(0===f[y])return{};var e=f.join(";    ");return f=[],{warning:e}},g[qe]=!0,g[We]=!1,g[ze]=!1,g[Ye]=!1,g[Xe]=!1,g);function g(){}var b=(S.add=function(e,t){return e.copy().add(t)},S.subtract=function(e,t){return e.copy().subtract(t)},S.augment=function(e,t){return e.copy().augment(t)},S.multiply=function(e,t){return e.multiply(t)},S.zeros=function(e,t,i){return void 0===i&&(i=Float32Array),S.fill(e,t,0,i)},S.fill=function(e,t,i,r){if(void 0===i&&(i=0),void 0===r&&(r=Float32Array),e<=0||t<=0)throw new Error("invalid size");return new S(new r(e*t),{shape:[e,t]}).fill(i)},S.identity=function(e,t){return void 0===t&&(t=Float32Array),S.fill(e,e,(function(t){return t%e===Math.floor(t/e)?1:0}),t)},S[p]._init=function(t,i){if(function(e){return!!(e&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT)}(t))this.data=t,this.shape="object"===e(i)?i.shape:[this.data[y]],this[y]=this.data[y],this.type=function(e){switch(e[_].name){case"Int8Array":return Int8Array;case"Uint8Array":return Uint8Array;case"Int16Array":return Int16Array;case"Uint16Array":return Uint16Array;case"Int32Array":return Int32Array;case"Uint32Array":return Uint32Array;case"Uint8ClampedArray":return Uint8ClampedArray;case"Float64Array":return Float64Array;default:return Float32Array}}(t);else if(t instanceof Array)this.data=new Float32Array(function e(t){return t.reduce((function(t,i){return t.concat(Array.isArray(i)?e(i):i)}),[])}(t)),this.shape=function e(t){return Array.isArray(t)?[t[y]].concat(e(t[0])):[]}(t),this[y]=this.data[y];else if(t instanceof S)return t.copy()},S[p].multiply=function(e){var t=this.shape,i=t[0],r=t[1],n=e.shape,a=n[0],s=n[1];if(r!==a)throw new Error("sizes do not match");var o,u,d,l,c=this.data,h=e.data,f=new this.type(i*s);for(o=0;o<i;o+=1)for(u=0;u<s;u+=1){for(d=l=0;d<r;d+=1)l+=c[o*r+d]*h[u+d*s];f[o*s+u]=l}return new S(f,{shape:[i,s]})},S[p].add=function(e,t){void 0===t&&(t=1),this.equilateral(e),this.equidimensional(e);var i,r=this.data,n=this[y],a=e.data;for(i=0;i<n;i+=1)r[i]+=t*a[i];return this},S[p].subtract=function(e){return this.add(e,-1)},S[p].augment=function(e){var t=this.shape,i=t[0],r=t[1],n=e.shape,a=n[0],s=n[1];if(0===a||0===s)return this;if(i!==a)throw new Error("rows do not match");var o,u,d=this.data,l=e.data,c=r+s,h=new this.type(c*i);for(o=0;o<i;o+=1)for(u=0;u<r;u+=1)h[o*c+u]=d[o*r+u];for(o=0;o<a;o+=1)for(u=0;u<s;u+=1)h[o*c+u+r]=l[o*s+u];return this.shape=[i,c],this[y]=h[y],this.data=h,this},S[p].fill=function(e){void 0===e&&(e=0);var t,i=this.data,r=this[y];for(t=0;t<r;t+=1)i[t]=e instanceof Function?e(t):e;return this},S[p].transpose=function(){var e,t,i=this.shape,r=i[0],n=i[1],a=new this.type(n*r);for(e=0;e<r;e+=1)for(t=0;t<n;t+=1)a[t*r+e]=this.data[e*n+t];return new S(a,{shape:[n,r]})},S[p].inverse=function(){var e=this.shape,t=e[0],i=e[1];if(t!==i)throw new Error("invalid dimensions");var r,n,a=S.identity(t),s=S.augment(this,a).gauss(),o=S.zeros(t,i),u=S.zeros(t,i),d=s.shape[1];for(r=0;r<t;r+=1)for(n=0;n<d;n+=1)n<i?o.set(r,n,s.get(r,n)):u.set(r,n-t,s.get(r,n));if(!o.equals(S.identity(t)))throw new Error("matrix is not invertible");return u},S[p].gauss=function(){var e,t,i,r,n,a=this.shape,s=a[0],o=a[1],u=this.copy(),d=0;for(i=0;i<s;i+=1){if(o<=d)throw new Error("matrix is singular");for(r=i;0===u.data[r*o+d];)if(s===(r+=1)&&(r=i,o===(d+=1)))throw new Error("matrix is singular");if(u.swap(i,r),0!==(e=u.data[i*o+d]))for(n=0;n<o;n+=1)u.data[i*o+n]=u.data[i*o+n]/e;for(r=0;r<s;r+=1)if(t=u.data[r*o+d],r!==i)for(n=0;n<o;n+=1)u.data[r*o+n]=u.data[r*o+n]-u.data[i*o+n]*t;d+=1}for(i=0;i<s;i+=1){for(r=e=0;r<o;r+=1)0===e&&(e=u.data[i*o+r]);if(0===e)for(n=0;n<o;n+=1)u.data[i*o+n]=u.data[i*o+n]/e}return u},S[p].equals=function(e){this.equilateral(e),this.equidimensional(e);var t,i=this.data,r=this[y],n=e.data;for(t=0;t<r;t+=1)if(i[t]!==n[t])return!1;return!0},S[p].check=function(e,t){var i=this.shape,r=i[0],n=i[1];if(isNaN(e)||isNaN(t))throw new Error("one of the indices is not a number");if(e<0||t<0||r-1<e||n-1<t)throw new Error("index out of bounds")},S[p].set=function(e,t,i){return this.check(e,t),this.data[e*this.shape[1]+t]=i,this},S[p].get=function(e,t){return this.check(e,t),this.data[e*this.shape[1]+t]},S[p].swap=function(e,t){var i=this.shape,r=i[0],n=i[1];if(e<0||t<0||r-1<e||r-1<t)throw new Error("index out of bounds");if(this.data.slice){var a=this.data.slice(e*n,(e+1)*n);this.data.copyWithin(e*n,t*n,(t+1)*n),this.data.set(a,t*n)}else a=new this.data[_](this.data.buffer.slice(0)),this.data.set(a.subarray(e*n,(e+1)*n),t*n),this.data.set(a.subarray(t*n,(t+1)*n),e*n);return this},S[p].copy=function(){var e=t(Object.create(Object.getPrototypeOf(this)),this);return e.data=new this.type(this.data),e.shape=this.shape,e[y]=this[y],e.type=this.type,e},S[p].equidimensional=function(e){var t=this.shape,i=e.shape;if(!t.every((function(e,t){return e===i[t]})))throw new Error("shapes "+t+" and "+i+" do not match")},S[p].equilateral=function(e){var t=this[y],i=e[y];if(t!==i)throw new Error("lengths "+t+" and "+i+" do not match")},S);function S(e,t){this.data=new Float32Array(0),this[y]=0,this.shape=[0],this.type=Float32Array,"number"==typeof e&&"number"==typeof t?this._init(new Float32Array(e*t),{shape:[e,t]}):this._init(e,t)}var T,w,L=(x[p].write=function(e,t){if(x.available)try{localStorage.setItem(e,JSON.stringify({value:t,time:Date.now()}))}catch(e){}},x[p].read=function(e){if(x.available)try{var t=localStorage.getItem(e);if(t){var i=JSON.parse(t),r=i.value,n=i.time,a=void 0===n?0:n;if(Date.now()-a<this.timeout)return r}}catch(e){}},Object[li](x,"available",{get:function(){if(void 0===x._available)try{localStorage.setItem("alg","test"),x._available=!0}catch(e){x._available=!1}return x._available},enumerable:!0,configurable:!0}),x);function x(){this.timeout=2592e6}(w=T=T||{})[w.Default=0]="Default",w[w.Seek=1]="Seek";var O,P,C,N="adaptive-hls",M={beacon:!1,predictStep:5,targetBuffer:10,duration:5,smoothRatioToTarget:0,switchpanelty:2.5*1e-6,slidingWindowSize:3,kalmanR:Math.pow(.2,2),kalmanQ:4e-4,initBitrate:2e6,startBitrateLimit:!0,speedPredictRatio:1.5,speedPredictNum:3,algorithm:1,speedPredictRatioOnStart:3,lowProfileThreshold:4,lowProfileBitrate:25e5,lowProfileStartThreshold:5},U="kwai_hls_adaptive";function B(){this[_]=O}function F(e,t){var i=C.call(this)||this;i._xPrev=0,i._PPrev=0,i[Oi]=0,i[Pi]=0,i[Di]=[],i._index=0,i._nextIndex=0,i._status=T.Default,i[Mi]=0,i[Ui]=1,i[Bi]=!1,i[Fi]=0,i[Vi]=0,i[ji]=0,i._storage=new L,i._processConfig(t),m.i(N,"init",e,t,i._conf),i[Di]=[],e.levels.forEach((function(e){i[Di].push(e.bitrate)})),i._index=e.index,i._initParams(),i[Fi]=function(e,t){return e.reduce((function(e,i,r){return t<i?e:r}),0)}(i[Di],i._conf.lowProfileBitrate),i.MATRIX_E=b.zeros(i._conf[Zi],i._conf[Zi]),i.MATRIX_G=b.zeros(i._conf[Zi],2);for(var r=0;r<i._conf[Zi];r++)for(var n=0;n<r+1;n++)i.MATRIX_E.set(r,n,r-n+1);for(r=0;r<i._conf[Zi];r++)i.MATRIX_G.set(r,0,r+2),i.MATRIX_G.set(r,1,-r-1);return i._qos={},i}return i(O=F,P=C=n),O[p]=null===P?Object.create(P):(B[p]=P[p],new B),F.setLogLevel=function(e){m.level(e)},F[p].setAvailableBitrates=function(e){e[y]?this[rr]=e:this[rr]=this[Di]},F[p].bitrateInit=function(){var e=this,t=function(e,t){return e.reduce((function(i,r,n){return(e[i]+r)/2>=t?i:n}),0)}(this[Di],this._conf.initBitrate),i=this._storage.read(U);if(m.i(N,"storage read:"+i),void 0!==i&&0<=i.bitrate&&0<i.speed&&2===i.version){i.time&&i.lowProfile&&Date.now()-i.time<2592e5&&(this[Vi]=Math.min(parseInt(i.lowProfile),this._conf.lowProfileStartThreshold+1),this[Vi]>this._conf.lowProfileStartThreshold&&(this[Bi]=!0,t=Math.min(t,this[Fi])));var r=Math.min(i.bitrate,1024*i.speed/this._conf.speedPredictRatioOnStart),n=this[Di].reduce((function(t,i,n){return Math.abs(i-r)<Math.abs(e[Di][t]-r)?n:t}),0);t=this._conf.startBitrateLimit?Math.min(t,n):n}return t},F[p].onDownload=function(e){if(e.byteLength){var i=e.duration||e.spendTime,r=e.byteLength/i*7.8125;this._qos=t({cache:!1},e),m.v(N,"report download time:"+i+" bytes:"+e.byteLength+" buffered:"+e.buffered+" speed:"+r+" cache:"+this._qos.cache),this._nextIndex=this._nextRateIndex(r,e.buffered/1e3),this._qos.speed=r,this._qos.buffered=e.buffered,this._qos.nextBitrate=this[Di][this._nextIndex],this._qos.currentBitrate=this[Di][this._index]}},F[p].onLevelLoad=function(e){e<this[Di][y]&&0<=e&&(this._index=e)},F[p].onSeek=function(e){m.v(N,"report seek buffered:"+e.buffered+" inBuffer:"+e.isInBuffer),e.isInBuffer?this._resetAlgorithm():this._qos.seek=1,(!e.isInBuffer||e.buffered/1e3<this._conf.targetBuffer)&&(m.i(N,"status change to seek."),this._status=T.Seek,this[Mi]=this._conf.speedPredictNum)},F[p].onRatechange=function(e){e&&(this[Ui]=e)},F[p].onWaiting=function(e){1e3<e.buffered&&this._index>this[Fi]&&(this[ji]++,this[ji]>this._conf.lowProfileThreshold&&(this[Bi]=!0))},F[p].onDownloadEnabled=function(e){e||this._resetAlgorithm()},Object[li](F[p],"qos",{get:function(){var e=this._qos;return{download_spend_time:e.duration||e.spendTime,hls_slice_bytes:e.byteLength,hls_slice_play_start_time:e.slicePlayStartTime,hls_slice_play_duration:e.slicePlayDuration,hls_slice_index:e.sliceIndex,is_browser_cache:e.cache,speed:Math.round(e.speed),estimated_throughput:e.estimatedThroughput,next_bitrate:e.nextBitrate,current_bitrate:e.currentBitrate,buffered:e.buffered,seek:e.seek,algorithm:this._conf.algorithm}},enumerable:!0,configurable:!0}),Object[li](F[p],"nextIndex",{get:function(){var e=this._nextIndex;return this._storage.write(U,{version:2,index:e,bitrate:this[Di][e],speed:this._qos&&this._qos.speed?this._qos.speed:0,lowProfile:Math.max(0,this[Bi]?this[Vi]+1:this[Vi]-1),time:Date.now()}),e},enumerable:!0,configurable:!0}),Object[li](F[p],"algorithm",{get:function(){return this._conf?this._conf.algorithm:M.algorithm},enumerable:!0,configurable:!0}),Object[li](F[p],"lowProfile",{get:function(){return this[Bi]},enumerable:!0,configurable:!0}),Object[li](F[p],"beacon",{get:function(){return!!this._conf&&this._conf.beacon},enumerable:!0,configurable:!0}),F[p]._initParams=function(){m.v(N,"initParams"),this._nextIndex=0,this[Oi]=this._conf.duration,this[Pi]=0,this[nn]=new Array(this._conf[an]),this[nn][this._conf[an]-1]=0,this._xPrev=0,this._PPrev=0,this._status=T.Default},F[p]._processConfig=function(e){var i=t({},M);this._conf=t(i,e)},F[p]._quantization=function(e){for(var t=this._index,i=this[Di][y]-1;0<=i;i--)e>=this[Di][i]&&(t=i);return t},F[p]._nextRateIndex=function(e,t){this[Oi]=t,this[nn].shift(),this[nn].push(e),this._status===T.Seek&&(t>=this._conf.targetBuffer||this[Mi]<=0)&&(this[Mi]=0,this._status=T.Default,m.i(N,"status change to default. buffered:"+t+" step:"+this[Mi]));var i=-1;if(i=this._status===T.Seek?(this[Mi]--,this[Pi]=this[Oi],this._nextRateBySpeed(e)):1===this._conf.algorithm?this[cn](e,t):this[hn](e,t),this[Bi]&&(i=Math.min(i,this[Fi])),this[rr]&&this[rr][y]&&-1===this[rr].indexOf(i)){for(var r=this[rr][y]-1;0<=r;r--)if(this[rr][r]<=i){i=this[rr][r];break}i=Math.max(i,this[rr][0])}return i},F[p]._resetAlgorithm=function(){this[Oi]=0,this[Pi]=0,this[nn]=new Array(this._conf[an])},F[p]._nextRateBySpeed=function(e){var t=1024*e,i=this[Di][this._index];if(t<i||t>i*this._conf.speedPredictRatio)for(var r=this[Di][y]-1;0<=r;r--)if(t>this[Di][r]*this._conf.speedPredictRatio)return r;return this._index},F[p][cn]=function(e,t){var i,r=1024*e,n=this[Di],a=n[this._index];for(i=n[y]-1;0<i&&!(r>n[i]*this[Ui]);i--);var s=n[i],o=this._index,u=t/this[Ui];return a<s?u>s*this._conf.duration/r&&(o=i):s<a&&u<a*this._conf.duration/r+this._conf.duration&&(o=i),m.v(N,"_nextRateBySpeedAndBufferedB bitrateBySpeed:"+s+", nextBitrate:"+o+", bitrate:"+a+", remainingTime:"+u+", speed:"+r+", playbackRate:"+this[Ui]),o},F[p][hn]=function(e,t){for(var i=this,r=b.zeros(this._conf[Zi],this._conf[Zi]),n=0;n<this._conf[Zi];n++)r.set(n,n,this._conf.switchpanelty*(this._conf[Zi]-n));var a=this.MATRIX_E,s=this.MATRIX_G,o=this._multistepPred(this[nn],this._conf[Zi]);m.v(N,"algorithm kalman:"+o);var u=-1;if(this[Oi]>=this._conf.targetBuffer)u=this._quantization(1024*o[0]);else{var d=o.map((function(e){return-i._conf.duration/e})),l=new b([[this[Oi]],[this[Pi]]]),c=[];for(c[0]=[this[Oi]],n=0;n<this._conf[Zi];n++)c[n+1]=[this._conf.smoothRatioToTarget*c[n]+(1-this._conf.smoothRatioToTarget)*this._conf.targetBuffer];var h=c.slice(1),f=new b(h),_=a.multiply(this._diag(d)),p=b.multiply(b.multiply(b.add(b.multiply(_.transpose(),_),r).inverse(),_.transpose()),b.subtract(f,b.multiply(s,l)));this[Pi]=this[Oi],m.v(N,"algorithm input speed:"+e+" buffered:"+t,"output result:"+p.get(0,0)),u=this._quantization(this[Di][this._index]+1024*p.get(0,0))}return u},F[p]._multistepPred=function(e,t){for(var i=new Array(t),r=e.slice(0),n=0;n<t;n++){for(var a=0,s=0,o=0;o<e[y];o++)r[o]&&(a+=1/r[o],s+=1);0!==s&&(i[n]=1/(a/s),r.shift(),r.push(i[n]))}return i},F[p]._diag=function(e){for(var t=[],i=e[y],r=0;r<i;r++){t[r]=new Array(i);for(var n=0;n<i;n++)t[r][n]=0;t[r][r]=e[r]}return new b(t,{shape:[i,i]})},F}))}(0,0,0,0,"function",0,0,0,0,"constructor","prototype",0,0,0,"length",0,"hasOwnProperty",0,0,0,0,"_maxListeners",0,'"listener" argument must be a function',"_events",0,0,"listener","_eventsCount",0,0,0,0,0,0,0,0,0,0,0,0,0,"removeListener",0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Uncaught, unspecified "error" event',0,'Uncaught, unspecified "error" event. (',0,0,0,0,0,0,0,0,0,0,0,"removeAllListeners",0,0,"listenerCount",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"ENABLE_ERROR","ENABLE_WARN","ENABLE_INFO","ENABLE_DEBUG","ENABLE_VERBOSE",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"defineProperty",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_bufferSize","_lastBufferSize","_bitrates",0,0,0,"_speedPredictCnt","_playbackRate","_lowProfile","_lowProfileIndex","_lowProfileHistory","_renderBlockCount",0,0,0,0,0,0,0,0,0,0,"predictStep",0,0,0,0,"_availableList",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"_pastThroughput","slidingWindowSize",0,0,0,0,0,"_nextRateBySpeedAndBufferedB","_nextRateBySpeedAndBuffered")}).call(this,i(/*! ./../../../webpack/buildin/module.js */"./node_modules/webpack/buildin/module.js")(e))},"./node_modules/events/events.js":
/*!***************************************!*\
  !*** ./node_modules/events/events.js ***!
  \***************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r,n="object"==typeof Reflect?Reflect:null,a=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function d(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function l(e,t,i,r){var n,a,s,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"==typeof s?s=a[t]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),(n=d(e))>0&&s.length>n&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,o=u,console&&console.warn&&console.warn(o)}return e}function c(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}function h(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=c.bind(r);return n.listener=i,r.wrapFn=n,n}function f(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):p(n,n.length)}function _(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var d=u.length,l=p(u,d);for(i=0;i<d;++i)a(l[i],this,t)}return!0},o.prototype.addListener=function(e,t){return l(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return l(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,n,a,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,n=a;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,a=Object.keys(i);for(r=0;r<a.length;++r)"removeListener"!==(n=a[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},o.prototype.listenerCount=_,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},"./node_modules/querystringify/index.js":
/*!**********************************************!*\
  !*** ./node_modules/querystringify/index.js ***!
  \**********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=Object.prototype.hasOwnProperty;function n(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}t.stringify=function(e,t){t=t||"";var i,n,a=[];for(n in"string"!=typeof t&&(t="?"),e)if(r.call(e,n)){if((i=e[n])||null!=i&&!isNaN(i)||(i=""),n=encodeURIComponent(n),i=encodeURIComponent(i),null===n||null===i)continue;a.push(n+"="+i)}return a.length?t+a.join("&"):""},t.parse=function(e){for(var t,i=/([^=?&]+)=?([^&]*)/g,r={};t=i.exec(e);){var a=n(t[1]),s=n(t[2]);null===a||null===s||a in r||(r[a]=s)}return r}},"./node_modules/requires-port/index.js":
/*!*********************************************!*\
  !*** ./node_modules/requires-port/index.js ***!
  \*********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},"./node_modules/url-parse/index.js":
/*!*****************************************!*\
  !*** ./node_modules/url-parse/index.js ***!
  \*****************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,i,r){"use strict";var n=r(/*! requires-port */"./node_modules/requires-port/index.js"),a=r(/*! querystringify */"./node_modules/querystringify/index.js"),s=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,o=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,u=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function d(e){return(e||"").toString().replace(u,"")}var l=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function h(e){var i,r=("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}).location||{},n={},a=typeof(e=e||r);if("blob:"===e.protocol)n=new _(unescape(e.pathname),{});else if("string"===a)for(i in n=new _(e,{}),c)delete n[i];else if("object"===a){for(i in e)i in c||(n[i]=e[i]);void 0===n.slashes&&(n.slashes=s.test(e.href))}return n}function f(e){e=d(e);var t=o.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function _(e,t,i){if(e=d(e),!(this instanceof _))return new _(e,t,i);var r,s,o,u,c,p,v=l.slice(),m=typeof t,g=this,y=0;for("object"!==m&&"string"!==m&&(i=t,t=null),i&&"function"!=typeof i&&(i=a.parse),t=h(t),r=!(s=f(e||"")).protocol&&!s.slashes,g.slashes=s.slashes||r&&t.slashes,g.protocol=s.protocol||t.protocol||"",e=s.rest,s.slashes||(v[3]=[/(.*)/,"pathname"]);y<v.length;y++)"function"!=typeof(u=v[y])?(o=u[0],p=u[1],o!=o?g[p]=e:"string"==typeof o?~(c=e.indexOf(o))&&("number"==typeof u[2]?(g[p]=e.slice(0,c),e=e.slice(c+u[2])):(g[p]=e.slice(c),e=e.slice(0,c))):(c=o.exec(e))&&(g[p]=c[1],e=e.slice(0,c.index)),g[p]=g[p]||r&&u[3]&&t[p]||"",u[4]&&(g[p]=g[p].toLowerCase())):e=u(e);i&&(g.query=i(g.query)),r&&t.slashes&&"/"!==g.pathname.charAt(0)&&(""!==g.pathname||""!==t.pathname)&&(g.pathname=function(e,t){if(""===e)return t;for(var i=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=i.length,n=i[r-1],a=!1,s=0;r--;)"."===i[r]?i.splice(r,1):".."===i[r]?(i.splice(r,1),s++):s&&(0===r&&(a=!0),i.splice(r,1),s--);return a&&i.unshift(""),"."!==n&&".."!==n||i.push(""),i.join("/")}(g.pathname,t.pathname)),n(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(u=g.auth.split(":"),g.username=u[0]||"",g.password=u[1]||""),g.origin=g.protocol&&g.host&&"file:"!==g.protocol?g.protocol+"//"+g.host:"null",g.href=g.toString()}_.prototype={set:function(e,t,i){var r=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(i||a.parse)(t)),r[e]=t;break;case"port":r[e]=t,n(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="");break;case"hostname":r[e]=t,r.port&&(t+=":"+r.port),r.host=t;break;case"host":r[e]=t,/:\d+$/.test(t)?(t=t.split(":"),r.port=t.pop(),r.hostname=t.join(":")):(r.hostname=t,r.port="");break;case"protocol":r.protocol=t.toLowerCase(),r.slashes=!i;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";r[e]=t.charAt(0)!==s?s+t:t}else r[e]=t;break;default:r[e]=t}for(var o=0;o<l.length;o++){var u=l[o];u[4]&&(r[u[1]]=r[u[1]].toLowerCase())}return r.origin=r.protocol&&r.host&&"file:"!==r.protocol?r.protocol+"//"+r.host:"null",r.href=r.toString(),r},toString:function(e){e&&"function"==typeof e||(e=a.stringify);var t,i=this,r=i.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var n=r+(i.slashes?"//":"");return i.username&&(n+=i.username,i.password&&(n+=":"+i.password),n+="@"),n+=i.host+i.pathname,(t="object"==typeof i.query?e(i.query):i.query)&&(n+="?"!==t.charAt(0)?"?"+t:t),i.hash&&(n+=i.hash),n}},_.extractProtocol=f,_.location=h,_.trimLeft=d,_.qs=a,e.exports=_},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,a,s,o;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=o.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=o.normalizePath(r.path),o.buildURLFromParts(r)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var u=n.exec(s.path);s.netLoc=u[1],s.path=u[2]}s.netLoc&&!s.path&&(s.path="/");var d={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var l=s.path,c=l.substring(0,l.lastIndexOf("/")+1)+a.path;d.path=o.normalizePath(c)}else d.path=s.path,a.params||(d.params=s.params,a.query||(d.query=s.query));return null===d.path&&(d.path=i.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(d)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},"./node_modules/uuid/index.js":
/*!************************************!*\
  !*** ./node_modules/uuid/index.js ***!
  \************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./v1 */"./node_modules/uuid/v1.js"),n=i(/*! ./v4 */"./node_modules/uuid/v4.js"),a=n;a.v1=r,a.v4=n,e.exports=a},"./node_modules/uuid/lib/bytesToUuid.js":
/*!**********************************************!*\
  !*** ./node_modules/uuid/lib/bytesToUuid.js ***!
  \**********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){for(var i=[],r=0;r<256;++r)i[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,n=i;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},"./node_modules/uuid/lib/rng-browser.js":
/*!**********************************************!*\
  !*** ./node_modules/uuid/lib/rng-browser.js ***!
  \**********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var r=new Uint8Array(16);e.exports=function(){return i(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},"./node_modules/uuid/v1.js":
/*!*********************************!*\
  !*** ./node_modules/uuid/v1.js ***!
  \*********************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,a=i(/*! ./lib/rng */"./node_modules/uuid/lib/rng-browser.js"),s=i(/*! ./lib/bytesToUuid */"./node_modules/uuid/lib/bytesToUuid.js"),o=0,u=0;e.exports=function(e,t,i){var d=t&&i||0,l=t||[],c=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:n;if(null==c||null==h){var f=a();null==c&&(c=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=n=16383&(f[6]<<8|f[7]))}var _=void 0!==e.msecs?e.msecs:(new Date).getTime(),p=void 0!==e.nsecs?e.nsecs:u+1,v=_-o+(p-u)/1e4;if(v<0&&void 0===e.clockseq&&(h=h+1&16383),(v<0||_>o)&&void 0===e.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=_,u=p,n=h;var m=(1e4*(268435455&(_+=122192928e5))+p)%4294967296;l[d++]=m>>>24&255,l[d++]=m>>>16&255,l[d++]=m>>>8&255,l[d++]=255&m;var g=_/4294967296*1e4&268435455;l[d++]=g>>>8&255,l[d++]=255&g,l[d++]=g>>>24&15|16,l[d++]=g>>>16&255,l[d++]=h>>>8|128,l[d++]=255&h;for(var y=0;y<6;++y)l[d+y]=c[y];return t||s(l)}},"./node_modules/uuid/v4.js":
/*!*********************************!*\
  !*** ./node_modules/uuid/v4.js ***!
  \*********************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./lib/rng */"./node_modules/uuid/lib/rng-browser.js"),n=i(/*! ./lib/bytesToUuid */"./node_modules/uuid/lib/bytesToUuid.js");e.exports=function(e,t,i){var a=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[a+o]=s[o];return t||n(s)}},"./node_modules/webpack/buildin/amd-define.js":
/*!***************************************!*\
  !*** (webpack)/buildin/amd-define.js ***!
  \***************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},"./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){function r(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var r=i(i.s=ENTRY_MODULE);return r.default||r}function n(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(e,t,r){var a={};a[r]=[];var s=t.toString(),o=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return a;for(var u,d=o[1],l=new RegExp("(\\\\n|\\W)"+n(d)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");u=l.exec(s);)"dll-reference"!==u[3]&&a[r].push(u[3]);for(l=new RegExp("\\("+n(d)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");u=l.exec(s);)e[u[2]]||(a[r].push(u[1]),e[u[2]]=i(u[1]).m),a[u[2]]=a[u[2]]||[],a[u[2]].push(u[4]);for(var c,h=Object.keys(a),f=0;f<h.length;f++)for(var _=0;_<a[h[f]].length;_++)c=a[h[f]][_],isNaN(1*c)||(a[h[f]][_]=1*a[h[f]][_]);return a}function s(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:i.m},o=t.all?{main:Object.keys(n.main)}:function(e,t){for(var i={main:[t]},r={main:[]},n={main:{}};s(i);)for(var o=Object.keys(i),u=0;u<o.length;u++){var d=o[u],l=i[d].pop();if(n[d]=n[d]||{},!n[d][l]&&e[d][l]){n[d][l]=!0,r[d]=r[d]||[],r[d].push(l);for(var c=a(e,e[d][l],d),h=Object.keys(c),f=0;f<h.length;f++)i[h[f]]=i[h[f]]||[],i[h[f]]=i[h[f]].concat(c[h[f]])}}return r}(n,e),u="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),u=u+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var d=new window.Blob([u],{type:"text/javascript"});if(t.bare)return d;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),c=new window.Worker(l);return c.objectURL=l,c}},"./src/core/kernel-errors.ts":
/*!***********************************!*\
  !*** ./src/core/kernel-errors.ts ***!
  \***********************************/
/*! exports provided: ErrorTypes, ErrorDetails */function(e,t,i){"use strict";var r,n;i.r(t),i.d(t,"ErrorTypes",(function(){return r})),i.d(t,"ErrorDetails",(function(){return n})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e.MSE_ERROR="mseError"}(r||(r={})),function(e){e[e.LOAD_ERROR=10]="LOAD_ERROR",e[e.HLS_MANIFEST_LOAD_ERROR=11]="HLS_MANIFEST_LOAD_ERROR",e[e.HLS_LEVEL_LOAD_ERROR=12]="HLS_LEVEL_LOAD_ERROR",e[e.HLS_AUDIO_TRACK_LOAD_ERROR=13]="HLS_AUDIO_TRACK_LOAD_ERROR",e[e.HLS_KEY_LOAD_ERROR=14]="HLS_KEY_LOAD_ERROR",e[e.CANNOT_SEEK=100]="CANNOT_SEEK",e[e.VIDEO_ERROR=101]="VIDEO_ERROR",e[e.UNSUPPORTED=102]="UNSUPPORTED",e[e.CONFIG_ERROR=103]="CONFIG_ERROR",e[e.MEDIASOURCE_ERROR=200]="MEDIASOURCE_ERROR",e[e.ADDSOURCEBUFFER_ERROR=201]="ADDSOURCEBUFFER_ERROR",e[e.SOURCEBUFFER_ERROR=202]="SOURCEBUFFER_ERROR",e[e.ENDOFSTREAM_ERROR=203]="ENDOFSTREAM_ERROR",e[e.APPENDBUFFER_ERROR=204]="APPENDBUFFER_ERROR",e[e.PARSING_ERROR=301]="PARSING_ERROR",e[e.REMUX_ERROR=302]="REMUX_ERROR",e[e.REMUX_ALLOC_ERROR=303]="REMUX_ALLOC_ERROR",e[e.HLS_MANIFEST_PARSING_ERROR=400]="HLS_MANIFEST_PARSING_ERROR",e[e.HLS_LEVEL_SWITCH_ERROR=401]="HLS_LEVEL_SWITCH_ERROR",e[e.KEY_SYSTEM_NO_ACCESS=500]="KEY_SYSTEM_NO_ACCESS",e[e.KEY_SYSTEM_NO_SESSION=501]="KEY_SYSTEM_NO_SESSION",e[e.KEY_SYSTEM_URL_ERROR=502]="KEY_SYSTEM_URL_ERROR",e[e.KEY_SYSTEM_LICENSE_REQUEST_FAILED=503]="KEY_SYSTEM_LICENSE_REQUEST_FAILED",e[e.KEY_SYSTEM_LICENSE_REQUEST_TIMEOUT=504]="KEY_SYSTEM_LICENSE_REQUEST_TIMEOUT",e[e.KEY_SYSTEM_NO_KEYS=505]="KEY_SYSTEM_NO_KEYS",e[e.FRAG_DECRYPT_ERROR=506]="FRAG_DECRYPT_ERROR",e[e.LIVE_DISCONNECTED_ERROR=1009]="LIVE_DISCONNECTED_ERROR"}(n||(n={}))},"./src/core/kernel-events.ts":
/*!***********************************!*\
  !*** ./src/core/kernel-events.ts ***!
  \***********************************/
/*! exports provided: default */function(e,t,i){"use strict";var r;i.r(t),function(e){e.METADATA="metadata",e.PARSING_INIT_SEGMENT="parsingInitSegment",e.PARSING_DATA="parsingData",e.PARSED_DATA="parsedData",e.SCRIPT_PARSED="scriptParsed",e.REPORT="report",e.LOAD_END="loadEnd",e.DISCONTINUITY="discontinuity",e.ERROR="kernelError",e.LEVEL_SWITCH_FAILED="levelSwitchFailed",e.LEVEL_SWITCHING="levelSwitching",e.LEVEL_SWITCHED="levelSwitched",e.LEVEL_SWITCH_PLAYING="levelSwitchPlaying",e.LEVEL_LOADED="levelLoaded",e.LEVEL_UPDATED="levelUpdated",e.MANIFEST_PARSED="manifestParsed",e.HLS_MANIFEST_LOADED="hlsManifestLoaded",e.HLS_INIT_PTS_FOUND="hlsInitPtsFound",e.HLS_FRAG_PARSED="hlsFragParsed",e.HLS_KEY_LOADED="hlsKeyLoaded",e.AUDIO_TRACK_LOADED="audioLoaded",e.ADAPTIVE_ALGORITHM="adaptiveAlgorithm",e.BUFFER_FLUSHING="bufferFlushing",e.INIT_PTS_FOUND="initPTSFound",e.SEEK_KEYFRAME="seekKeyframe",e.PRELOAD_COMPLETE="preloadComplete",e.PRELOAD_HIT="preloadHit",e.ABR_NEXT="abrNext",e.FLV_HEAD="flvHead",e.PRIV_NAL="privNal"}(r||(r={})),t.default=r},"./src/core/observer.ts":
/*!******************************!*\
  !*** ./src/core/observer.ts ***!
  \******************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var r=i(/*! events */"./node_modules/events/events.js"),n=function(e){var t,i;function r(){return e.apply(this,arguments)||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r.prototype.trigger=function(t){for(var i,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return(i=e.prototype.emit).call.apply(i,[this,t,t].concat(n))},r}(r.EventEmitter);t.default=n},"./src/core/report-types.ts":
/*!**********************************!*\
  !*** ./src/core/report-types.ts ***!
  \**********************************/
/*! exports provided: REPORT_TYPES */function(e,t,i){"use strict";i.r(t),i.d(t,"REPORT_TYPES",(function(){return r}));var r={LOADER_CHUNK_ARRIVAL:"loader-chunk-arrival",MEDIA_DEMUX:"media-demux",NEW_SOURCE:"newSource",TIMEUPDATE:"timeupdate",LIVE_ADAPTIVE_QOS_STAT:"liveAdaptiveQosStat",KEY_FRAME:"keyFrame",DISCONTINUITY:"discontinuity",DOWNLOAD:"download",SEEK:"seek",SEEK_WITH_LOAD:"seekWithLoad",HEARTBEAT:"heartbeat",MUX_INFO:"muxInfo",LOST_FRAMES:"lostFrames",HLS_VOD_ADAPTIVE_QOS_STAT:"hlsVodAdaptiveQosStat",USE_BACKUP:"useBackup",ABR_INIT:"abrInit",ABR_LOW_PROFILE:"abrLowProfile"}},"./src/demux/exp-golomb.ts":
/*!*********************************!*\
  !*** ./src/demux/exp-golomb.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.r(t);var n=function(){function e(e){this._buffer=void 0,this._buffer_index=void 0,this._total_bytes=void 0,this._total_bits=void 0,this._current_word=void 0,this._current_word_bits_left=void 0,this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}var t,i,n,a=e.prototype;return a.destroy=function(){this._buffer=null},a._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0||!this._buffer)throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},a.readBits=function(e){if(e>32)throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(r,this._current_word_bits_left),a=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,i=i<<n|a},a.readBool=function(){return 1===this.readBits(1)},a.readUByte=function(){return this.readBits(8)},a.readUShort=function(){return this.readBits(16)},a.readUInt=function(){return this.readBits(32)},a.readByte=function(){return this.readBits(8)},a._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},a.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},a.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},a.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a.getBitsLeft=function(){return 8*(this._total_bytes-this._buffer_index)+this._current_word_bits_left},t=e,(i=[{key:"bytesAvailable",get:function(){return this._total_bytes-this._buffer_index}}])&&r(t.prototype,i),n&&r(t,n),e}();t.default=n},"./src/demux/flv/flv-demuxer-inline.ts":
/*!*********************************************************!*\
  !*** ./src/demux/flv/flv-demuxer-inline.ts + 7 modules ***!
  \*********************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/kernel-errors.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/kernel-events.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/report-types.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/flv/flv.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/get-audio-config.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/sps-parser.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/remux/mp4-remuxer.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/types/remux.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/log.ts because of ./src/index.ts */function(e,t,i){"use strict";i.r(t);var r=i("./src/core/kernel-events.ts"),n=i("./src/remux/mp4-remuxer.ts"),a=i("./src/core/kernel-errors.ts"),s=i("./src/core/report-types.ts"),o=i("./src/types/remux.ts"),u=function(){function e(){}return e.parse=function(t){var i={},r=525030175!==new DataView(t.buffer,t.byteOffset).getUint32(0),n=6,a=new Uint8Array(1024);a.set(t.slice(0,6),0);for(var s=t.byteLength,o=[t[s-2],t[s-1]],u=6;u<s;){var d=t[u];0===o[0]&&0===o[1]&&3===d||(a[n++]=d),o[0]=o[1],o[1]=d,++u}for(var l=6,c=new DataView(a.buffer);l<n;){var h=l,f=c.getUint16(h,r);h+=2;var _=c.getUint16(h,r);h+=2;var p=c.getUint16(h,r);h+=2,e._readElem(c,i,h,p,f,_,r),h+=p,l+=_}return i},e._readElem=function(t,i,r,n,a,s,o){var u=e._readString(t,r,n);switch(r+=n,a){case 1:break;case 2:i[u]=e._readString(t,r,s-4);break;case 3:i[u]=t.getUint32(r,o);break;case 4:var d=t.getUint32(r+4,o),l=t.getUint32(r,o);i[u]=Math.pow(2,32)*d+l;break;case 5:i[u]=t.getFloat32(r,o);break;case 6:i[u]=t.getFloat64(r,o)}},e._readString=function(e,t,i){for(var r="",n=t;n<t+i;n++)r+=String.fromCharCode(e.getUint8(n));return r},e}(),d=i("./src/utils/log.ts"),l=i("./src/demux/get-audio-config.ts"),c=i("./src/demux/sps-parser.ts");function h(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}var f=function(e){for(var t=[],i=e,r=0,n=e.length;r<n;)if(i[r]<128)t.push(String.fromCharCode(i[r])),++r;else{if(i[r]<192);else if(i[r]<224){if(h(i,r,1)){var a=(31&i[r])<<6|63&i[r+1];if(a>=128){t.push(String.fromCharCode(65535&a)),r+=2;continue}}}else if(i[r]<240){if(h(i,r,2)){var s=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2];if(s>=2048&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),r+=3;continue}}}else if(i[r]<248&&h(i,r,3)){var o=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3];if(o>65536&&o<1114112){o-=65536,t.push(String.fromCharCode(o>>>10|55296)),t.push(String.fromCharCode(1023&o|56320)),r+=4;continue}}t.push(String.fromCharCode(65533)),++r}return t.join("")},_=function(){function e(){}return e.parseMetadata=function(t){var i={};try{var r=e.parseScript(t,0),n=e.parseScript(t,r.size);i[r.data]=n.data}catch(e){d.Log.e("AMF",e.toString())}return i},e.parseObject=function(t,i){var r=e.parseString(t,i),n=e.parseScript(t,i+r.size),a=n.objectEnd;return{data:{name:r.data,value:n.data},size:n.size,objectEnd:a}},e.parseVariable=function(t,i){return e.parseObject(t,i)},e.parseLongString=function(e,t){var i=new DataView(e,t).getUint32(0);return{data:i>0?f(new Uint8Array(e,t+4,i)):"",size:4+i}},e.parseDate=function(e,t){var i=new DataView(e,t),r=i.getFloat64(0),n=i.getInt16(8);return{data:new Date(r+=60*n*1e3),size:10}},e.parseString=function(e,t){var i=new DataView(e,t).getUint16(0);return{data:i>0?f(new Uint8Array(e,t+2,i)):"",size:2+i}},e.parseScript=function(t,i){var r=t.byteLength,n=i,a=t,s=new DataView(a,0),o=null,u=s.getUint8(n);n+=1;var l=!1;switch(u){case 0:o=s.getFloat64(n),n+=8;break;case 1:o=!!s.getUint8(n),n+=1;break;case 2:var c=e.parseString(a,n);o=c.data,n+=c.size;break;case 3:for(o={},s.getUint32(r-4);n<r-4;){var h=e.parseObject(a,n);if(h.objectEnd)break;o[h.data.name]=h.data.value,n=h.size}n<=r-3&&9==(16777215&s.getUint32(n-1))&&(n+=3);break;case 8:for(o={},n+=4,s.getUint32(r-4);n<r-8;){var f=e.parseVariable(a,n);if(f.objectEnd)break;o[f.data.name]=f.data.value,n=f.size}n<=r-3&&9==(16777215&s.getUint32(n-1))&&(n+=3);break;case 9:o=void 0,n=1,l=!0;break;case 10:o=[];var _=s.getUint32(n);n+=4;for(var p=0;p<_;p++){var v=e.parseScript(a,n);o.push(v.data),n=v.size}break;case 11:var m=e.parseDate(a,n+1);o=m.data,n+=m.size;break;case 12:var g=e.parseString(a,n+1);o=g.data,n+=g.size;break;default:n=r,d.Log.v("AMF","AMF","Unsupported AMF value type "+u)}return{data:o,size:n,objectEnd:l}},e}(),p=i("./src/demux/flv/flv.ts"),v=new Uint8Array([23,0,0,0,0,1,100,0,10,255,225,0,24,103,100,0,10,172,114,4,68,122,16,0,0,3,0,16,0,0,3,3,32,241,34,88,70,1,0,6,104,232,67,143,44,139]),m=new Uint8Array([23,1,0,0,0,0,0,2,176,6,5,255,255,172,220,69,233,189,230,217,72,183,150,44,216,32,217,35,238,239,120,50,54,52,32,45,32,99,111,114,101,32,49,53,50,32,114,50,56,53,52,32,101,57,97,53,57,48,51,32,45,32,72,46,50,54,52,47,77,80,69,71,45,52,32,65,86,67,32,99,111,100,101,99,32,45,32,67,111,112,121,108,101,102,116,32,50,48,48,51,45,50,48,49,55,32,45,32,104,116,116,112,58,47,47,119,119,119,46,118,105,100,101,111,108,97,110,46,111,114,103,47,120,50,54,52,46,104,116,109,108,32,45,32,111,112,116,105,111,110,115,58,32,99,97,98,97,99,61,49,32,114,101,102,61,49,54,32,100,101,98,108,111,99,107,61,49,58,48,58,48,32,97,110,97,108,121,115,101,61,48,120,51,58,48,120,49,51,51,32,109,101,61,117,109,104,32,115,117,98,109,101,61,49,48,32,112,115,121,61,49,32,112,115,121,95,114,100,61,49,46,48,48,58,48,46,48,48,32,109,105,120,101,100,95,114,101,102,61,49,32,109,101,95,114,97,110,103,101,61,50,52,32,99,104,114,111,109,97,95,109,101,61,49,32,116,114,101,108,108,105,115,61,50,32,56,120,56,100,99,116,61,49,32,99,113,109,61,48,32,100,101,97,100,122,111,110,101,61,50,49,44,49,49,32,102,97,115,116,95,112,115,107,105,112,61,49,32,99,104,114,111,109,97,95,113,112,95,111,102,102,115,101,116,61,45,50,32,116,104,114,101,97,100,115,61,49,32,108,111,111,107,97,104,101,97,100,95,116,104,114,101,97,100,115,61,49,32,115,108,105,99,101,100,95,116,104,114,101,97,100,115,61,48,32,110,114,61,48,32,100,101,99,105,109,97,116,101,61,49,32,105,110,116,101,114,108,97,99,101,100,61,48,32,98,108,117,114,97,121,95,99,111,109,112,97,116,61,48,32,99,111,110,115,116,114,97,105,110,101,100,95,105,110,116,114,97,61,48,32,98,102,114,97,109,101,115,61,56,32,98,95,112,121,114,97,109,105,100,61,50,32,98,95,97,100,97,112,116,61,50,32,98,95,98,105,97,115,61,48,32,100,105,114,101,99,116,61,51,32,119,101,105,103,104,116,98,61,49,32,111,112,101,110,95,103,111,112,61,48,32,119,101,105,103,104,116,112,61,50,32,107,101,121,105,110,116,61,50,53,48,32,107,101,121,105,110,116,95,109,105,110,61,50,53,32,115,99,101,110,101,99,117,116,61,52,48,32,105,110,116,114,97,95,114,101,102,114,101,115,104,61,48,32,114,99,95,108,111,111,107,97,104,101,97,100,61,54,48,32,114,99,61,99,114,102,32,109,98,116,114,101,101,61,49,32,99,114,102,61,50,51,46,48,32,113,99,111,109,112,61,48,46,54,48,32,113,112,109,105,110,61,48,32,113,112,109,97,120,61,54,57,32,113,112,115,116,101,112,61,52,32,105,112,95,114,97,116,105,111,61,49,46,52,48,32,97,113,61,49,58,49,46,48,48,0,128,0,0,0,29,101,136,129,0,5,127,254,246,115,124,10,107,109,176,149,46,5,118,246,150,55,45,60,239,89,160,124,49,129]),g=function(){function e(){}return e.getFlvVideoTag=function(e,t){void 0===t&&(t=!1);var i=new p.FlvTag;return i.tagType=p.FlvTagType.VIDEO,i.body=t?v:m,i.dataSize=i.body.byteLength,i.timestamp=Math.round(e),i.frameType=1,i.codecId=7,i.fill=!0,i},e}();function y(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(e,t,i){this._videoTrack=void 0,this._audioTrack=void 0,this._startBufferTime=void 0,this._videoTrack=e,this._audioTrack=t,this._startBufferTime=9e4*i}var t,i,r;return e.prototype._getTrackDuraion=function(e,t){var i=-1,r=-1;return e&&e.samples.length&&(i=e.samples[e.samples.length-1].dts-e.samples[0].dts),t&&t.samples.length&&(r=t.samples[t.samples.length-1].dts-t.samples[0].dts),r>=0?r:i>=0?i:0},t=e,(i=[{key:"isBufferEnough",get:function(){return this._getTrackDuraion(this._videoTrack,this._audioTrack)>=this._startBufferTime||this._audioTrack.samples.length>=300||this._videoTrack.samples.length>=300}}])&&y(t.prototype,i),r&&y(t,r),e}();function E(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(e,t,i){this.tag="FlvDemux",this._observer=void 0,this._remuxer=void 0,this._config=void 0,this._duration=void 0,this._naluLengthSize=void 0,this._hasVideo=void 0,this._hasAudio=void 0,this._videoTrack=void 0,this._audioTrack=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._currentTimestamp=0,this._aLastDTS=0,this._vLastDTS=0,this._nonMonotonousCache=void 0,this._fillAtStart={enabled:!0,start:0,avcConfig:!0},this._startBufferHelper=void 0,this._observer=e,this._remuxer=t,this._config=i,this._duration=1/0,this._naluLengthSize=4,this._hasVideo=!0,this._hasAudio=!0,this._videoTrack={id:1,type:o.TrackType.video,container:"",codec:"",timescale:9e4,duration:1/0,samples:[],inputTimeScale:9e4,sequenceNumber:0,pid:-1,width:0,height:0,codecWidth:0,codecHeight:0,sps:[],pps:[],pixelRatio:[],profile:"",level:"",chromaFormat:"",fps:0,dropped:0,refSampleDuration:0,hvcc:null},this._audioTrack={id:2,type:o.TrackType.audio,container:"",codec:"",timescale:9e4,duration:1/0,samples:[],inputTimeScale:9e4,sequenceNumber:0,pid:-1,isAAC:!0,samplerate:0,channelCount:0,config:[]},this._config.startPlayBufferSec&&(this._startBufferHelper=new b(this._videoTrack,this._audioTrack,this._config.startPlayBufferSec))}var t,i,n,h=e.prototype;return h.append=function(e,t,i,r){var n=this;if(this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:r}),e.length){if(e.forEach((function(e){e.tagType===p.FlvTagType.VIDEO&&n._hasVideo&&(n._fillAtStart.enabled&&(n._fillAtStart.enabled=!1,n._audioTrack.samples.length&&n._fillFrame(n._audioTrack.samples[n._audioTrack.samples.length-1].dts/90)),n._parseVideoData(e)),e.tagType===p.FlvTagType.AUDIO&&n._hasAudio&&n._parseAudioData(e),e.tagType===p.FlvTagType.SCRIPT&&n._parseScriptTag(e)})),this._fillAtStart.enabled&&this._audioTrack.samples.length){var a=this._audioTrack.samples[0].dts/90,s=this._audioTrack.samples[this._audioTrack.samples.length-1].dts/90;this._fillAtStart.start<=0&&(this._fillAtStart.start=a),s>this._fillAtStart.start&&this._fillFrame(s)}this._remux()}},h.flvHead=function(e,t){this._hasAudio=e,this._hasVideo=t,this._fillAtStart.enabled=this._hasVideo},h.destroy=function(){},h.flush=function(){this._remux(!0),this._remuxStat=void 0},h.resetInitSegment=function(){this._firstRemux=!0,this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=0,this._remuxStat=void 0,this._startBufferHelper=void 0},h.resetTimeStamp=function(){},h._parseScriptTag=function(e){if(e.body){var t=_.parseMetadata(e.body.buffer);if(t.timestamp=this._currentTimestamp||0,t.hasOwnProperty("onMetaData")){var i=t.onMetaData;"number"==typeof i.duration&&(this._duration=this._duration||i.duration),"number"==typeof i.framerate&&(this._videoTrack.fps=this._videoTrack.fps||i.framerate),d.Log.i(this.tag,"Parsed onMetaData")}this._observer.trigger(r.default.SCRIPT_PARSED,t)}},h._parseVideoData=function(e){if(e.body){var t=e.body[0];e.frameType=(240&t)>>>4;var i=15&t;if(7===i||12===i){e.codecId=i;var n=e.body[1];if(e.cts=((255&e.body[2])<<16)+((255&e.body[3])<<8)+(255&e.body[4]),0===n)7===i?this._parseAVCDecoderConfigurationRecord(e,5):12===i&&(this._config.gopRemux=!0,this._parseHEVCDecoderConfigurationRecord(e,5));else if(1===n){var s=this._parseAVCVideoData(e,5)||{};1===e.frameType&&(s.timestamp=e.timestamp,s.ptsOrignMs=e.timestamp+e.cts,this._observer.trigger(r.default.PRIV_NAL,s))}else if(2!==n)return void this._observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid video packet type "+n})}else this._observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Unsupported codec in video frame: "+i})}},h._parseHEVCDecoderConfigurationRecord=function(e,t){if(e.body){for(var i,r=this._videoTrack,n=e.body.buffer,a=e.body.byteLength-t,s=new DataView(n,t,a),o=s.getUint8(1)>>6,u=s.getUint8(1),l=31&s.getUint8(1),h=s.getUint32(2),f="",_=[],p=11;p>=6;p--){var v=s.getUint8(p);(v>0||f.length)&&(f.length&&(f+="."),f+=v.toString(16)),_.push()}0===f.length&&(f="0");for(var m=s.getUint8(12),g=s.getUint8(22),y=23,b=0;b<g;b++){var E=63&s.getUint8(y);y+=1;var S=s.getUint16(y);y+=2;for(var T=0;T<S;T++){var w=s.getUint16(y);if(y+=2,0!==w){if(32===E)d.Log.v(this.tag,"VPS lengh "+w);else if(33===E){d.Log.v(this.tag,"SPS lengh "+w);var L=new Uint8Array(n,t+y,w);i=c.default.parseHEVCSPS(L)}else 34===E&&d.Log.v(this.tag,"PPS lengh "+w);y+=w}}}for(var R=h.toString(16);R.length>1;){var x=R.length-1;if("0"!==R.charAt(x))break;R=R.slice(0,x)}i||(i={});var k="hev1."+["","A","B","C"][o]+l+"."+R+"."+(0===u?"L":"H")+m+"."+f;r.width=r.codecWidth=i.width,r.height=r.codecHeight=i.height,r.codec=k,r.profile=i.profile_string,r.level=i.level_string,r.chromaFormat=i.chroma_format_string,r.hvcc=new Uint8Array(a),r.hvcc=e.body.slice(t,e.body.byteLength)}},h._parseAVCDecoderConfigurationRecord=function(e,t){if(e.body){var i=this._videoTrack,n=e.body.buffer,s=e.body.byteLength-t,o=new DataView(n,t,s),u=o.getUint8(0),l=o.getUint8(1);if(1===u&&0!==l)if(this._naluLengthSize=1+(3&o.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var h=31&o.getUint8(5);if(0===h||h>1)this._observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid H264 SPS count: "+h});else{for(var f=6,_=[],p=0;p<h;p++){var v=o.getUint16(f);if(f+=2,0!==v){var m=new Uint8Array(n,t+f,v);f+=v,_.push(m);for(var g=c.default.parseSPS(m),y=m.subarray(1,4),b="avc1.",E=0;E<3;E++){var S=y[E].toString(16);S.length<2&&(S="0"+S),b+=S}!i.codec||i.width===g.codec_size.width&&i.height===g.codec_size.height&&b===i.codec||(e.fill||this._remux(!0),this._remuxer.ISGenerated&&this._remuxer.resetInitSegment()),i.sps=_,i.width=g.codec_size.width,i.height=g.codec_size.height,i.pixelRatio=[g.sar_ratio.width,g.sar_ratio.height],g.frame_rate.fixed&&0!==g.frame_rate.fps&&(i.fps=g.frame_rate.fps),i.codec=b,i.profile=g.profile_string,i.level=g.level_string,i.chromaFormat=g.chroma_format_string}}var T=o.getUint8(f);if(0===T||T>1)this._observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid H264 PPS count: "+T});else{f++,i.pps=[];for(var w=0;w<T;w++){var L=o.getUint16(f);f+=2;var R=new Uint8Array(n,t+f,L);i.pps.push(R),0!==L&&(f+=L)}d.Log.v(this.tag,"Parsed AVCDecoderConfigurationRecord"),i.duration=this._duration,i.container="video/mp4",i.fps?i.refSampleDuration=Math.floor(i.timescale/i.fps):i.refSampleDuration=Math.floor(i.timescale/30)}}}else this._observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1)});else this._observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid AVCDecoderConfigurationRecord"})}},h._parseAVCVideoData=function(e,t,i){if(void 0===i&&(i=!1),e.body){var r,n=e.body.buffer,a=e.body.byteLength-t,s=new DataView(n,t,a),l=[],c=0,h=0,f=this._naluLengthSize,_=e.timestamp,p=1===e.frameType;if(!i&&_<=this._vLastDTS&&this._vLastDTS>0)return d.Log.w(this.tag,"debug Non-monotonous DTS dts:"+_+" last:"+this._vLastDTS),void this._onNonMonotonous({tag:e,dataOffset:t},o.TrackType.video);!i&&this._nonMonotonousCache&&this._flushNonMonotonousCache();for(var v=_+e.cts;h<a;){if(h+4>=a){d.Log.v(this.tag,"Malformed Nalu near timestamp "+_+", offset = "+h+", dataSize = "+a);break}var m=s.getUint32(h);if(3===f&&(m>>>=8),m>a-f)return void d.Log.v(this.tag,"Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var g=new Uint8Array(n,t+h+4,f+m-4),y=void 0;if(7===e.codecId){if(5==(y=31&s.getUint8(h+f)))p=!0;else if(31===y)try{r=u.parse(g)}catch(e){d.Log.w(this.tag,"PrivNal parse error "+e)}}else if(12===e.codecId)if(19==(y=(126&s.getUint8(h+f))>>1)||20===y||21===y)p=!0;else if(63===y)try{r=u.parse(g)}catch(e){d.Log.w(this.tag,"PrivNal parse error "+e)}var b={type:y,data:g};l.push(b),c+=g.byteLength,h+=f+m}if(l.length){var E=this._videoTrack,S={units:l,length:c,dts:90*_,cts:90*e.cts,pts:90*v,streamDts:_,key:p,extraInfo:{dtsOrignMs:_,ptsOrignMs:_+e.cts,parseMs:0}};self.performance&&(S.extraInfo.parseMs=performance.now()),E.samples.push(S)}return this._vLastDTS=_,r}},h._parseAudioData=function(e,t){var i;if(void 0===t&&(t=!1),e.body)if(e.body.byteLength<=1)d.Log.v(this.tag,"Flv: Invalid audio packet, missing SoundData payload!");else{var n=this._audioTrack,a=e.body[1];if(0===a){if(e.body.byteLength<4)return;return function(e,t,i,r,n){if(void 0===n&&(n=""),!e.samplerate){var a=Object(l.getAudioConfig)(t,function(e,t){return{objectType:e[t+2]>>>3,sampleingIndex:(7&e[t+2])<<1|e[t+3]>>>7,chanelConfig:(120&e[t+3])>>>3}}(i,r),n);a&&(e.config=a.config,e.timescale=e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,e.isAAC=!0)}}(n,this._observer,e.body,0,this._config.audioCodec),void(n.duration=this._duration)}if(1===a){var u=e.body.subarray(2),c=e.timestamp,h=(i=1024e3/n.samplerate)*this._config.maxAudioFramesDrift;if(this._aLastDTS>0){c=this._aLastDTS+i;var f=e.timestamp-c;if(f>h)c=e.timestamp,this._observer.trigger(r.default.REPORT,{type:s.REPORT_TYPES.LOST_FRAMES,drop:f});else if(!t&&f<-h)return void this._onNonMonotonous({tag:e},o.TrackType.audio)}!t&&this._nonMonotonousCache&&this._flushNonMonotonousCache();var _=c*n.inputTimeScale/1e3,p={unit:u,dts:_,pts:_,streamDts:c,length:u.byteLength,extraInfo:{dtsOrignMs:c,ptsOrignMs:c,parseMs:0}};self.performance&&(p.extraInfo.parseMs=performance.now()),this._aLastDTS=c,n.samples.push(p)}else d.Log.v(this.tag,"Flv: Unsupported AAC data type "+a)}},h._onNonMonotonous=function(e,t){this._nonMonotonousCache||(this._nonMonotonousCache={video:[],audio:[]});var i=this._nonMonotonousCache[t];if(i.length>10){this.flush();var r=this._remuxer.getLastPTS(),n=r.audio;(0===n||r.video>0&&r.video<n)&&(n=r.video),this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=0,this._remuxStat={accurateTimeOffset:!1,contiguous:!1,timeOffset:n},this._remuxer.resetInitSegment(),this._remuxer.resetTimeStamp(),d.Log.i(this.tag,"NON_MONOTONOUS reset time"),this._flushNonMonotonousCache()}else i.push(e)},h._flushNonMonotonousCache=function(){if(this._nonMonotonousCache){var e=this._nonMonotonousCache;for(var t in e)for(var i=e[t];i.length;){var r=i.shift();r&&("video"===t?this._parseAVCVideoData(r.tag,r.dataOffset,!0):"audio"===t&&this._parseAudioData(r.tag,!0))}this._nonMonotonousCache=void 0}},h._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,i=this._videoTrack;if(this._startBufferHelper){if(!e&&!this._startBufferHelper.isBufferEnough)return;this._startBufferHelper=void 0}var n=!0,o=0,u=!1;if(this._remuxStat&&(n=this._remuxStat.contiguous,o=this._remuxStat.timeOffset,u=this._remuxStat.accurateTimeOffset),0!==t.samples.length||0!==i.samples.length){if(e||!(this._hasAudio&&0===t.samples.length||this._hasVideo&&i.samples.length<2)){this._firstRemux&&(this._firstRemux=!1,this._observer.trigger(r.default.REPORT,{type:s.REPORT_TYPES.MEDIA_DEMUX}));try{this._remuxer.remux(t,i,o,n,u,e),this._remuxStat=void 0}catch(e){d.Log.e(this.tag,e),this._observer.trigger(r.default.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},h._fillFrame=function(e){var t=this;if(0!==this._audioTrack.samples.length){var i=this._fillAtStart.start||90*this._audioTrack.samples[0].dts;if(e>i){d.Log.i(this.tag,"fill video frame: "+i+" "+e),this._fillAtStart.start=e;var r=[g.getFlvVideoTag(i),g.getFlvVideoTag(e-1)];this._fillAtStart.avcConfig&&(r.unshift(g.getFlvVideoTag(i,!0)),this._fillAtStart.avcConfig=!1),r.forEach((function(e){t._parseVideoData(e)}))}}},t=e,(i=[{key:"duration",set:function(e){this._duration=e}}])&&E(t.prototype,i),n&&E(t,n),e}(),T=function(){function e(e,t,i,r){this.tag="FlvDemuxerInline",this._observer=void 0,this._config=void 0,this._extraData=void 0,this._demuxer=void 0,this._remuxer=void 0,this._bitrate=void 0,this._vendor=void 0,this._observer=e,this._config=t,this._bitrate=this._config.bitrate,this._extraData=i,this._vendor=r}var t=e.prototype;return t.init=function(){var e=this._config,t=this._observer,i=this._remuxer=new n.default(t,e,{mp4:!0,mpeg:!1,mp3:!1});this._demuxer=new S(t,i,e),i.setExtra(this._extraData)},t.flvHead=function(e,t){this._demuxer.flvHead(e,t)},t.append=function(e,t,i,r,n){i&&(this._demuxer.resetInitSegment(),this._remuxer.resetInitSegment(),this._demuxer.resetTimeStamp(),this._remuxer.resetTimeStamp()),this._demuxer.append(e,t,r,n)},t.end=function(){this._demuxer.flush(),this._remuxer.flush(),this._observer.trigger(r.default.LOAD_END)},t.flush=function(){this._demuxer&&this._demuxer.flush()},t.setExtra=function(e){this._extraData=e,this._extraData.bitrate=this._bitrate,this._remuxer&&this._remuxer.setExtra(this._extraData)},t.destroy=function(){},e}();t.default=T},"./src/demux/flv/flv-demuxer-worker.ts":
/*!*********************************************!*\
  !*** ./src/demux/flv/flv-demuxer-worker.ts ***!
  \*********************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/core/trans-flv.ts (referenced with require.resolve) */function(e,t,i){"use strict";i.r(t);var r=i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),n=i(/*! ../../core/observer */"./src/core/observer.ts"),a=i(/*! ../../utils/log */"./src/utils/log.ts"),s=i(/*! ./flv-demuxer-inline */"./src/demux/flv/flv-demuxer-inline.ts");t.default=function(e){var t,i=new n.default,o=function(t,i){e.postMessage({event:t,data:i})};i.on(r.default.METADATA,o),i.on(r.default.PARSING_INIT_SEGMENT,o),i.on(r.default.ERROR,o),i.on(r.default.SCRIPT_PARSED,o),i.on(r.default.REPORT,o),i.on(r.default.PRIV_NAL,o),i.on(r.default.LOAD_END,o),i.on(r.default.PARSING_DATA,(function(t,i){var r={event:t,data:i};r.payload=i.payload,delete i.payload,e.postMessage(r,[r.payload.buffer])})),e.addEventListener("message",(function(e){var r=e.data;switch(r.cmd){case"init":a.Log.level(r.config.kwaiKernelLog),function(e,i,r,n){(t=new s.default(e,i,r,n)).init()}(i,r.config,r.data,r.vendor);break;case"destroy":t&&t.destroy(),i&&i.removeAllListeners();break;case"append":t.append(r.tags,r.timeOffset,r.discontinuity,r.contiguous,r.accurateTimeOffset);break;case"flvHead":t.flvHead(r.hasAudio,r.hasVideo);break;case"flush":t.flush();break;case"setExtra":t.setExtra(r.data);break;case"end":t.end()}}))}},"./src/demux/flv/flv.ts":
/*!******************************!*\
  !*** ./src/demux/flv/flv.ts ***!
  \******************************/
/*! exports provided: FlvTagType, FlvSize, FlvTag */function(e,t,i){"use strict";var r;i.r(t),i.d(t,"FlvTagType",(function(){return r})),i.d(t,"FlvSize",(function(){return n})),i.d(t,"FlvTag",(function(){return a})),function(e){e[e.AUDIO=8]="AUDIO",e[e.VIDEO=9]="VIDEO",e[e.SCRIPT=18]="SCRIPT"}(r||(r={}));var n={FLV_HEAD_LEN:13,FLV_TAG_HEAD_LEN:11,FLV_TAG_SIZE_LEN:4,AVC_KEY_FRAME_CHECK_LEN:2},a=function(){this.tagType=r.VIDEO,this.dataSize=0,this.timestamp=0,this.size=0,this.cts=0,this.frameType=0,this.codecId=0,this.body=null,this.fill=void 0}},"./src/demux/get-audio-config.ts":
/*!***************************************!*\
  !*** ./src/demux/get-audio-config.ts ***!
  \***************************************/
/*! exports provided: getAudioConfig */function(e,t,i){"use strict";i.r(t),i.d(t,"getAudioConfig",(function(){return s}));var r=i(/*! ../core/kernel-events */"./src/core/kernel-events.ts"),n=i(/*! ../core/kernel-errors */"./src/core/kernel-errors.ts"),a=i(/*! ../utils/log */"./src/utils/log.ts");function s(e,t,i){void 0===i&&(i="");var s,o,u=t.objectType,d=t.sampleingIndex,l=t.chanelConfig,c=navigator.userAgent.toLowerCase(),h=i,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return d<0||d>=f.length?(e.trigger(r.default.ERROR,{type:n.ErrorTypes.MUX_ERROR,details:n.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid sampling index:"+d}),null):l<0||l>=8?(e.trigger(r.default.ERROR,{type:n.ErrorTypes.MUX_ERROR,details:n.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"invalid chanelConfig:"+l}),null):(a.Log.v("manifest codec:"+i+",data:type:"+u+",sampleingIndex:"+d+"["+f[d]+"Hz],channelConfig:"+l),/firefox/i.test(c)?d>=6?(u=5,o=new Array(4),s=d-3):(u=2,o=new Array(2),s=d):-1!==c.indexOf("android")?(u=2,o=new Array(2),s=d):(u=5,o=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&d>=6?s=d-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(d>=6&&1===l||/vivaldi/i.test(c))||!i&&1===l)&&(u=2,o=new Array(2)),s=d)),o[0]=u<<3,o[0]|=(14&d)>>1,o[1]|=(1&d)<<7,o[1]|=l<<3,5===u&&(o[1]|=(14&s)>>1,o[2]=(1&s)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:f[d],channelCount:l,codec:"mp4a.40."+u,manifestCodec:h})}},"./src/demux/hls/demuxer-inline.ts":
/*!*****************************************************!*\
  !*** ./src/demux/hls/demuxer-inline.ts + 8 modules ***!
  \*****************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/kernel-errors.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/kernel-events.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/report-types.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/exp-golomb.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/get-audio-config.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/sps-parser.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/object-assign.js because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/remux/aac-helper.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/remux/mp4-remuxer.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/types/remux.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/log.ts because of ./src/index.ts */function(e,t,i){"use strict";i.r(t);var r=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),n=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC",length:128},!1,["encrypt","decrypt"])},e}(),a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),r=0;r<4;r++)i[r]=t.getUint32(4*r);return i},t.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],n=i[1],a=i[2],s=i[3],o=this.invSubMix,u=o[0],d=o[1],l=o[2],c=o[3],h=new Uint32Array(256),f=0,_=0,p=0;for(p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=_^_<<1^_<<2^_<<3^_<<4;v=v>>>8^255&v^99,e[f]=v,t[v]=f;var m=h[f],g=h[m],y=h[g],b=257*h[v]^16843008*v;r[f]=b<<24|b>>>8,n[f]=b<<16|b>>>16,a[f]=b<<8|b>>>24,s[f]=b,b=16843009*y^65537*g^257*m^16843008*f,u[v]=b<<24|b>>>8,d[v]=b<<16|b>>>16,l[v]=b<<8|b>>>24,c[v]=b,f?(f=m^h[h[h[y^m]]],_^=h[h[_]]):f=_=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,r=0;r<t.length&&i;)i=t[r]===this.key[r],r++;if(!i){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a,s,o,u,d=this.ksRows=4*(n+6+1),l=this.keySchedule=new Uint32Array(d),c=this.invKeySchedule=new Uint32Array(d),h=this.sBox,f=this.rcon,_=this.invSubMix,p=_[0],v=_[1],m=_[2],g=_[3];for(a=0;a<d;a++)a<n?o=l[a]=t[a]:(u=o,a%n==0?(u=h[(u=u<<8|u>>>24)>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u],u^=f[a/n|0]<<24):n>6&&a%n==4&&(u=h[u>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u]),l[a]=o=(l[a-n]^u)>>>0);for(s=0;s<d;s++)a=d-s,u=3&s?l[a]:l[a-4],c[s]=s<4||a<=4?u:p[h[u>>>24]]^v[h[u>>>16&255]]^m[h[u>>>8&255]]^g[h[255&u]],c[s]=c[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,i,r){for(var n,a,s,o,u,d,l,c,h,f,_,p,v,m,g,y,b,E=this.keySize+6,S=this.invKeySchedule,T=this.invSBox,w=this.invSubMix,L=w[0],R=w[1],x=w[2],k=w[3],A=this.uint8ArrayToUint32Array_(i),O=A[0],P=A[1],D=A[2],I=A[3],C=new Int32Array(e),N=new Int32Array(C.length),M=this.networkToHostOrderSwap;t<C.length;){for(h=M(C[t]),f=M(C[t+1]),_=M(C[t+2]),p=M(C[t+3]),u=h^S[0],d=p^S[1],l=_^S[2],c=f^S[3],v=4,m=1;m<E;m++)n=L[u>>>24]^R[d>>16&255]^x[l>>8&255]^k[255&c]^S[v],a=L[d>>>24]^R[l>>16&255]^x[c>>8&255]^k[255&u]^S[v+1],s=L[l>>>24]^R[c>>16&255]^x[u>>8&255]^k[255&d]^S[v+2],o=L[c>>>24]^R[u>>16&255]^x[d>>8&255]^k[255&l]^S[v+3],u=n,d=a,l=s,c=o,v+=4;n=T[u>>>24]<<24^T[d>>16&255]<<16^T[l>>8&255]<<8^T[255&c]^S[v],a=T[d>>>24]<<24^T[l>>16&255]<<16^T[c>>8&255]<<8^T[255&u]^S[v+1],s=T[l>>>24]<<24^T[c>>16&255]<<16^T[u>>8&255]<<8^T[255&d]^S[v+2],o=T[c>>>24]<<24^T[u>>16&255]<<16^T[d>>8&255]<<8^T[255&l]^S[v+3],v+=3,N[t]=M(n^O),N[t+1]=M(o^P),N[t+2]=M(s^D),N[t+3]=M(a^I),O=h,P=f,D=_,I=p,t+=4}return r?(g=N.buffer,y=g.byteLength,(b=y&&new DataView(g).getUint8(y-1))?g.slice(0,y-b):g):N.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),s=i("./src/core/kernel-errors.ts"),o=i("./src/utils/log.ts"),u=i("./src/core/kernel-events.ts"),d="undefined"==typeof window?self:window,l=function(){function e(e,t,i){var r=(void 0===i?{}:i).removePKCS7Padding,n=void 0===r||r;if(this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.logEnabled=!0,this.key=null,this.fastAesKey=void 0,this.decryptor=void 0,this.disableWebCrypto=void 0,this.subtle=void 0,this.observer=e,this.config=t,this.removePKCS7Padding=n,n)try{var a=d.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){console.error(e)}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,i,s){var u=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(o.Log.v("JS AES decrypt"),this.logEnabled=!1);var d=this.decryptor;d||(this.decryptor=d=new a),d.expandKey(t),s(d.decrypt(e,0,i,this.removePKCS7Padding))}else if(this.subtle){this.logEnabled&&(o.Log.v("WebCrypto AES decrypt"),this.logEnabled=!1);var l=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new n(l,t)),this.fastAesKey&&this.fastAesKey.expandKey().then((function(n){new r(l,i).decrypt(e,n).catch((function(r){u.onWebCryptoError(r,e,t,i,s)})).then((function(e){s(e)}))})).catch((function(r){u.onWebCryptoError(r,e,t,i,s)}))}},t.onWebCryptoError=function(e,t,i,r,n){this.config.enableSoftwareAES?(o.Log.v("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,r,n)):(o.Log.e("decrypting error : "+e.message),this.observer.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=null)},e}(),c=i("./src/polyfills/object-assign.js"),h=i("./src/demux/get-audio-config.ts");function f(e,t){return 255===e[t]&&240==(246&e[t+1])}function _(e,t){return 1&e[t+1]?7:9}function p(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function v(e,t){return!!(t+1<e.length&&f(e,t))}function m(e,t,i,r,n){if(!e.samplerate){var a=Object(h.getAudioConfig)(t,function(e,t){return{objectType:1+((192&e[t+2])>>>6),sampleingIndex:(60&e[t+2])>>>2,chanelConfig:(1&e[t+2])<<2|(192&e[t+3])>>>6}}(i,r),n);a&&(e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,o.Log.v("parsed codec:"+e.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount))}}function g(e){return 9216e4/e}function y(e,t,i,r,n){var a=function(e,t,i,r,n){var a,s=e.length,o=_(e,t);return a=p(e,t),(a-=o)>0&&t+o+a<=s?{headerLength:o,frameLength:a,stamp:i+r*n}:null}(t,i,r,n,g(e.samplerate));if(a){var s=a.stamp,o=a.headerLength,u=a.frameLength,d={unit:t.subarray(i+o,i+o+u),pts:s,dts:s};return e.samples.push(d),{sample:d,length:u+o}}return null}var b=i("./src/core/report-types.ts"),E=i("./src/demux/exp-golomb.ts"),S=i("./src/demux/sps-parser.ts"),T=function(){function e(e,t,i,r){this._decrypter=void 0,this._decryptdata=void 0,this._discardEPB=void 0,this._decryptdata=i,this._discardEPB=r,this._decrypter=new l(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var r=this._decrypter.isSync();if(this._decryptAacSample(e,t,i,r),!r)return}}},t.decryptAvcSamples=function(e,t,i,r){for(;;t++,i=0){if(t>=e.length)return void r();for(var n=e[t].units;!(i>=n.length);i++){var a=n[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this._decrypter.isSync();if(this._decryptAvcSample(e,t,i,r,a,s),!s)return}}}},t._decryptBuffer=function(e,t){this._decryptdata.key&&this._decrypter.decrypt(e,this._decryptdata.key.buffer,this._decryptdata.iv.buffer,t)},t._decryptAacSample=function(e,t,i,r){var n=e[t].unit,a=n.subarray(16,n.length-n.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this._decryptBuffer(s,(function(a){a=new Uint8Array(a),n.set(a,16),r||o.decryptAacSamples(e,t+1,i)}))},t._getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Uint8Array(t),r=0,n=32;n<=e.length-16;n+=160,r+=16)i.set(e.subarray(n,n+16),r);return i},t._getAvcDecryptedUnit=function(e,t){for(var i=new Uint8Array(t),r=0,n=32;n<=e.length-16;n+=160,r+=16)e.set(i.subarray(r,r+16),n);return e},t._decryptAvcSample=function(e,t,i,r,n,a){var s=this._discardEPB(n.data),o=this._getAvcEncryptedData(s),u=this;this._decryptBuffer(o.buffer,(function(o){n.data=u._getAvcDecryptedUnit(s,o),a||u.decryptAvcSamples(e,t,i+1,r)}))},e}(),w=i("./src/types/remux.ts"),L=i("./src/remux/aac-helper.ts"),R=function(){function e(e,t,i,r){this._observer=void 0,this._config=void 0,this._typeSupported=void 0,this._remuxer=void 0,this._sampleAes=void 0,this._remuxStat=void 0,this._pmtParsed=!1,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._audioCodec="",this._videoCodec="",this._duration=0,this._vLastDts=0,this._lastDts=0,this._aLastDts=0,this._aacOverFlow=null,this._aacLastPTS=null,this._avcSample=null,this._stashSec=0,this._contiguous=!1,this._timeOffset=0,this._accurateTimeOffset=!1,this._spsUpdated=!1,this._firstNalTypes=0,this._extra=void 0,this._audioNonMonotonous=0,this._qos={vMaxDtsDiff:0,aMaxDtsDiff:0,aacOverhead:0,unknownTSPacketCount:0},this._observer=e,this._config=i,this._typeSupported=r,this._remuxer=t,this._sampleAes=null,this._remuxStat=null}var t=e.prototype;return t.setStat=function(e){e&&(this._pmtParsed=e.pmtParsed,this._pmtId=e.pmtId,this._audioCodec=e.audioCodec,this._videoCodec=e.videoCodec,this._duration=e.duration,this._vLastDts=e.vLastDts,this._lastDts=e.lastDts,this._aLastDts=e.aLastDts,this._aacLastPTS=e.aacLastPTS,this._firstNalTypes=e.firstNalTypes,this._audioNonMonotonous=e.audioNonMonotonous,this._qos=e.qos,this._avcTrack.pid=e.avc.pid,this._avcTrack.sequenceNumber=e.avc.sequenceNumber,this._avcTrack.timescale=e.avc.timescale,this._avcTrack.width=e.avc.width,this._avcTrack.height=e.avc.height,this._avcTrack.codec=e.avc.codec,this._audioTrack.pid=e.audio.pid,this._audioTrack.sequenceNumber=e.audio.sequenceNumber,this._audioTrack.config=e.audio.config,this._audioTrack.samplerate=e.audio.samplerate,this._audioTrack.timescale=e.audio.timescale,this._audioTrack.channelCount=e.audio.channelCount,this._audioTrack.codec=e.audio.codec,this._audioTrack.manifestCodec=e.audio.manifestCodec)},t.getStat=function(){return{pmtParsed:this._pmtParsed,pmtId:this._pmtId,audioCodec:this._audioCodec,videoCodec:this._videoCodec,duration:this._duration,vLastDts:this._vLastDts,lastDts:this._lastDts,aLastDts:this._aLastDts,aacLastPTS:this._aacLastPTS,firstNalTypes:this._firstNalTypes,audioNonMonotonous:this._audioNonMonotonous,qos:Object(c.ObjectAssign)({},this._qos),avc:{pid:this._avcTrack.pid,sequenceNumber:this._avcTrack.sequenceNumber,timescale:this._avcTrack.timescale,width:this._avcTrack.width,height:this._avcTrack.height,codec:this._avcTrack.codec},audio:{pid:this._audioTrack.pid,sequenceNumber:this._audioTrack.sequenceNumber,config:this._audioTrack.config,samplerate:this._audioTrack.samplerate,timescale:this._audioTrack.timescale,channelCount:this._audioTrack.channelCount,codec:this._audioTrack.codec,manifestCodec:this._audioTrack.manifestCodec}}},t.setDecryptData=function(e){e&&e.key&&"SAMPLE-AES"===e.method?this._sampleAes=new T(this._observer,this._config,e,this.discardEPB):this._sampleAes=null},e.probe=function(t){var i=e._syncOffset(t);return!(i<0||(i&&o.Log.w("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){var i={type:e,id:w.RemuxerTrackIdConfig[e],pid:-1,inputTimeScale:9e4,timescale:0,codec:"",sequenceNumber:0,samples:[],container:"video/mp2t",duration:t};if(e===w.TrackType.audio){var r=i;return r.isAAC=!0,r}return i},t.resetInitSegment=function(t,i,r,n){this._pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack(w.TrackType.video,n),this._audioTrack=e.createTrack(w.TrackType.audio,n),this._aacOverFlow=null,this._aacLastPTS=null,this._avcSample=null,this._audioCodec=i,this._videoCodec=r,this._duration=n,this._vLastDts=0,this._aLastDts=0,this._audioNonMonotonous=0,this._qos.vMaxDtsDiff=0,this._qos.aMaxDtsDiff=0,this._qos.aacOverhead=0},t.resetTimeStamp=function(){},t.append=function(t,i,r,n,a){void 0===a&&(a=!1),this._contiguous=r,this._timeOffset=i,this._accurateTimeOffset=n,null===this._remuxStat&&(this._remuxStat={timeOffset:i,contiguous:r,accurateTimeOffset:n});var o,d,l,c,h,f=this._remuxStat,_=this._avcTrack,p=this._audioTrack,v=this._parsePAT,m=this._parsePMT,g=this._parsePES,y=this._parseAVCPES.bind(this),b=this._parseAACPES.bind(this),E=this._parseMPEGPES.bind(this),S=t.length,T=!1,w=this._pmtParsed,L=_.pid,R=p.pid,x=this._pmtId,k=_.pesData,A=p.pesData,O=e._syncOffset(t);for(S-=(S+O)%188,o=O;o<S;o+=188)if(71===t[o]){if(d=!!(64&t[o+1]),l=((31&t[o+1])<<8)+t[o+2],(48&t[o+3])>>4>1){if((c=o+5+t[o+4])===o+188)continue}else c=o+4;switch(l){case L:d&&(k&&(h=g(k,!0))&&void 0!==h.pts&&y(h,!1),k={data:[],size:0}),k&&(k.data.push(t.subarray(c,o+188)),k.size+=o+188-c);break;case R:d&&(A&&(h=g(A))&&void 0!==h.pts&&(p.isAAC?b(h):E()),A={data:[],size:0}),A&&(A.data.push(t.subarray(c,o+188)),A.size+=o+188-c);break;case 0:d&&(c+=t[c]+1),x=this._pmtId=v(t,c);break;case x:d&&(c+=t[c]+1);var P=m(t,c,!0===this._typeSupported.mpeg||!0===this._typeSupported.mp3,null!==this._sampleAes);(L=P.avc)>0&&(_.pid=L),(R=P.audio)>0&&(p.pid=R,p.isAAC=P.isAAC),T&&!w&&(T=!1),w=this._pmtParsed=!0;break;case 17:case 8191:break;default:this._qos.unknownTSPacketCount++,T=!0}}else this._observer.trigger(u.default.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});k&&(h=g(k,a))&&void 0!==h.pts?(y(h,a),_.pesData=null):_.pesData=k,A&&(h=g(A))&&void 0!==h.pts?(p.isAAC?b(h):E(),p.pesData=null):(A&&A.size,p.pesData=A),(R>0&&0===p.samples.length||L>0&&0===_.samples.length||L<=0&&R<=0)&&!a||((a||!this._config.gopRemux&&this._isStashEnd())&&(this._remux(f.timeOffset,f.contiguous,f.accurateTimeOffset,a),this._remuxStat=null),a&&this._onParsed())},t._isStashEnd=function(){if(this._stashSec){var e=this._avcTrack.samples;return e.length>1&&this._stashSec<=(e[e.length-1].dts-e[0].dts)/this._avcTrack.inputTimeScale||e.length>=600}return!0},t._onParsed=function(){var e=Object(c.ObjectAssign)({extra:this._extra,audioNonMonotonous:this._audioNonMonotonous,fragStartWithNonIdr:5!==this._firstNalTypes},this._qos);this._observer.trigger(u.default.PARSED_DATA,e),this._qos.vMaxDtsDiff=0,this._qos.aMaxDtsDiff=0,this._firstNalTypes=0},t.flush=function(){var e,t=this._avcTrack,i=this._audioTrack,r=t.pesData,n=i.pesData,a=this._parsePES,s=this._parseAVCPES.bind(this),o=this._parseAACPES.bind(this);if(r&&(e=a(r,!0))&&void 0!==e.pts&&s(e,!0),t.pesData=null,n&&(e=a(n))&&void 0!==e.pts&&i.isAAC&&o(e),i.pesData=null,i.pid&&0===i.samples.length&&t.pid&&0===t.samples.length)this._remuxer.flush();else{var u=this._remuxStat;u?this._remux(u.timeOffset,u.contiguous,u.accurateTimeOffset,!0):this._remux(this._timeOffset,!0,this._accurateTimeOffset,!0),this._avcSample=null,this._remuxStat=null,this._firstNalTypes=0}},t._remux=function(e,t,i,r){void 0===r&&(r=!1);var n=this._audioTrack,a=this._avcTrack;0==a.samples.length&&0===n.samples.length||(this._config.ensureAudio&&(n.codec||m(n,this._observer,new Uint8Array([255,241,92,128,93]),0,this._audioCodec||(/firefox/.test(navigator.userAgent.toLowerCase())?"mp4a.40.2":"mp4a.40.5")),0===n.samples.length&&a.samples.length&&(n.samples=[{unit:L.default.getSilentFrame(n.codec,n.channelCount),pts:a.samples[0].dts,dts:a.samples[0].dts}])),this._stashSec=0,this._observer.trigger(u.default.REPORT,{type:b.REPORT_TYPES.MEDIA_DEMUX}),this._sampleAes?this.decryptAndRemux(n,a,e,t,i,r):this._remuxer.remux(n,a,e,t,i,r))},t.reset=function(e){void 0===e&&(e=0);var t=this._avcTrack,i=this._audioTrack;t.pesData=null,t.samples=[],t.audFound=!1,i.pesData=null,i.samples=[],this._aacOverFlow=null,this._avcSample=null,this._remuxStat=null,this._vLastDts=0,this._aLastDts=0,this._firstNalTypes=0,this._stashSec=e,this._aacLastPTS=null,this._audioNonMonotonous=0},t.setExtra=function(e){this._extra=e},t.decryptAndRemux=function(e,t,i,r,n,a){if(void 0===a&&(a=!1),e.samples&&e.isAAC&&this._sampleAes){var s=this;this._sampleAes.decryptAacSamples(e.samples,0,(function(){s.decryptAndRemuxAvc(e,t,i,r,n,a)}))}else this.decryptAndRemuxAvc(e,t,i,r,n,a)},t.decryptAndRemuxAvc=function(e,t,i,r,n,a){if(void 0===a&&(a=!1),t.samples&&this._sampleAes){var s=this;this._sampleAes.decryptAvcSamples(t.samples,0,0,(function(){s._remuxer.remux(e,t,i,r,n,a)}))}else this._remuxer.remux(e,t,i,r,n,a)},t.destroy=function(){this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._parsePMT=function(e,t,i,r){var n,a,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){o.Log.v("unkown stream type:"+e[t]);break}case 15:-1===s.audio&&(s.audio=a);break;case 21:-1===s.id3&&(s.id3=a);break;case 219:if(!r){o.Log.v("unkown stream type:"+e[t]);break}case 27:-1===s.avc&&(s.avc=a);break;case 3:case 4:i?-1===s.audio&&(s.audio=a,s.isAAC=!1):o.Log.v("MPEG audio found, not supported in this browser for now");break;case 36:o.Log.w("HEVC stream type found, not supported for now");break;default:o.Log.v("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s},t._parsePES=function(e,t){void 0===t&&(t=!1);var i,r,n,a,s,u,d=e.data,l=0,c=0,h=0;if(!e||0===e.size)return null;for(;d[0].length<19&&d.length>1;){var f=new Uint8Array(d[0].length+d[1].length);f.set(d[0]),f.set(d[1],d[0].length),d[0]=f,d.splice(1,1)}if(1===((i=d[0])[0]<<16)+(i[1]<<8)+i[2]){if((n=(i[4]<<8)+i[5])&&n>e.size-6)return null;if(0===n&&!t)return null;192&(r=i[7])&&((c=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)>4294967295&&(c-=8589934592),64&r?((h=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>4294967295&&(h-=8589934592),c-h>54e5&&(o.Log.w(Math.round((c-h)/9e4)+"s delta between PTS and DTS, align them"),c=h)):h=c),u=(a=i[8])+9,e.size-=u,s=new Uint8Array(e.size);for(var _=0,p=d.length;_<p;_++){var v=(i=d[_]).byteLength;if(u){if(u>v){u-=v;continue}i=i.subarray(u),v-=u,u=0}s.set(i,l),l+=v}return n&&(n-=a+3),{data:s,pts:c,dts:h,len:n}}return null},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,r=i.length;if(!this._config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this._contiguous)){if(this._isStashEnd()&&this._config.gopRemux&&e.key&&i&&i.length>1&&this._remuxStat){var n=this._remuxStat;this._remux(n.timeOffset,n.contiguous,n.accurateTimeOffset)}e.id=this._avcTrack.samples.length,this._avcTrack.samples.push(e)}else t.dropped++}e.debug.length&&o.Log.v(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){var i=this;if(e.data){var r,n,a,s=this._avcTrack,o=this._parseAVCNALu(e.data),u=this.pushAccesUnit.bind(this),d=this,l=function(e,t,i,r){return i===d._lastDts&&(i+=1),d._lastDts=i,{key:e,pts:t,dts:i,units:[],debug:r}},c=this._avcSample,h=!1;if(this._vLastDts>0){var f=e.dts-this._vLastDts;Math.abs(f)>Math.abs(this._qos.vMaxDtsDiff)&&(this._qos.vMaxDtsDiff=f)}this._vLastDts=e.dts,e.data=null,c&&o.length&&!s.audFound&&(u(c,s),c=this._avcSample=l(!1,e.pts,e.dts,"")),o.forEach((function(t){switch(t.type){case 1:i._firstNalTypes||(i._firstNalTypes=t.type),n=!0,c||(c=i._avcSample=l(!0,e.pts,e.dts,"")),c.frame=!0;var o=t.data;if(h&&o.length>4){var d=new E.default(o).readSliceType();2!==d&&4!==d&&7!==d&&9!==d||(c.key=!0)}break;case 5:i._firstNalTypes||(i._firstNalTypes=t.type),n=!0,c||(c=i._avcSample=l(!0,e.pts,e.dts,"")),c.key=!0,c.frame=!0;break;case 6:n=!0,(r=new E.default(i.discardEPB(t.data))).readUByte();for(var f=0,_=0,p=!1,v=0;!p&&r.bytesAvailable>1;){f=0;do{f+=v=r.readUByte()}while(255===v);_=0;do{_+=v=r.readUByte()}while(255===v);if(4===f&&0!==r.bytesAvailable){if(p=!0,181===r.readUByte()&&49===r.readUShort()&&1195456820===r.readUInt()&&3===r.readUByte()){var m=r.readUByte(),g=31&m,y=[m,r.readUByte()];for(a=0;a<g;a++)y.push(r.readUByte()),y.push(r.readUByte()),y.push(r.readUByte())}}else if(_<r.bytesAvailable)for(a=0;a<_;a++)r.readUByte()}break;case 7:n=!0,h=!0;var b=t.data.subarray(1,4),T="avc1.";for(a=0;a<3;a++){var w=b[a].toString(16);w.length<2&&(w="0"+w),T+=w}var L=S.default.parseSPS(t.data);!s.width||s.width===L.codec_size.width&&s.height===L.codec_size.height&&T===s.codec||(i._spsUpdated=!0),s.width=L.codec_size.width,s.height=L.codec_size.height,s.pixelRatio=[L.sar_ratio.width,L.sar_ratio.height],s.sps=[t.data],s.duration=i._duration,s.fps=L.frame_rate.fps,s.profile=L.profile_string,s.level=L.level_string,s.chromaFormat=L.chroma_format_string,s.codec=T;break;case 8:n=!0,s.pps||(s.pps=[t.data]);break;case 9:n=!1,s.audFound=!0,c&&u(c,s),c=i._avcSample=l(!1,e.pts,e.dts,"");break;case 12:n=!1;break;default:n=!1,c&&(c.debug+="unknown NAL "+t.type+" ")}i._spsUpdated&&s.sps&&s.pps&&(i._remuxer.ISGenerated&&i._remuxer.resetInitSegment(),i._spsUpdated=!1),c&&n&&c.units.push(t)})),t&&c&&(u(c,s),this._avcSample=null)}},t._getLastNalUnit=function(){var e,t=this._avcSample;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e},t._parseAVCNALu=function(e){var t,i,r,n,a=this._avcTrack,s=e.byteLength,o=[],u=0,d=a.naluState||0,l=-1,c=d;for(-1===d&&(l=0,n=31&e[0],d=0,u=1);u<s;)if(t=e[u++],d)if(1!==d)if(t)if(1===t){if(l>=0)r={data:e.subarray(l,u-d-1),type:n},o.push(r);else{var h=this._getLastNalUnit();if(h&&(c&&u<=4-c&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-c)),(i=u-d-1)>0)){var f=new Uint8Array(h.data.byteLength+i);f.set(h.data,0),f.set(e.subarray(0,i),h.data.byteLength),h.data=f}}u<s?(l=u,n=31&e[u],d=0):d=-1}else d=0;else d=3;else d=t?0:2;else d=t?0:1;if(l>=0&&d>=0&&(r={data:e.subarray(l,s),type:n,state:d},o.push(r)),0===o.length){var _=this._getLastNalUnit();if(_){var p=new Uint8Array(_.data.byteLength+e.byteLength);p.set(_.data,0),p.set(e,_.data.byteLength),_.data=p}}return a.naluState=d,o},t.discardEPB=function(e){for(var t,i=e.byteLength,r=[],n=1,a=null;n<i-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;t=i-r.length,a=new Uint8Array(t);var s=0;for(n=0;n<t;s++,n++)s===r[0]&&(s++,r.shift()),a[n]=e[s];return a},t._parseMPEGPES=function(){this._observer.trigger(u.default.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"unsupport mpeg"})},t._parseAACPES=function(e){if(e.data){var t,i,r,n,a,d,l=this._audioTrack,c=this._aacLastPTS,h=e.data,f=e.pts,_=this._aacOverFlow,p=null;if(this._aLastDts>0){var b=e.dts-this._aLastDts;Math.abs(b)>Math.abs(this._qos.aMaxDtsDiff)&&(this._qos.aMaxDtsDiff=b)}if(this._aLastDts=e.dts,_){var E=new Uint8Array(_.byteLength+h.byteLength);E.set(_,0),E.set(h,_.byteLength),h=E}for(r=0,n=h.length;r<n-1&&!v(h,r);r++);if(r&&(r<n-1?(a="AAC PES did not start with ADTS header,offset:"+r,d=!1):(a="no ADTS header found in AAC PES",d=!0),o.Log.w("parsing error:"+a),this._observer.trigger(u.default.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.PARSING_ERROR,fatal:d,reason:a}),d))return;if(m(l,this._observer,h,r,this._audioCodec),i=0,t=g(l.samplerate),c&&(this._audioNonMonotonous||(this._audioNonMonotonous=f<c?1:0),this._audioNonMonotonous||_)){var S=c+t;Math.abs(S-f)>1&&(o.Log.v("AAC: align PTS for overlapping frames by "+Math.round((S-f)/90)),f=S)}for(;r<n;)if(v(h,r)&&r+5<n){var T=y(l,h,r,f,i);if(!T)break;r+=T.length,p=T.sample.pts,i++}else r++;i>1&&(this._qos.aacOverhead=1),_=r<n?h.subarray(r,n):null,this._aacOverFlow=_,this._aacLastPTS=p}},e}(),x=i("./src/remux/mp4-remuxer.ts"),k=function(){function e(e,t,i,r,n,a){this._observer=void 0,this._config=void 0,this._vendor=void 0,this._typeSupported=void 0,this._decrypter=void 0,this._nextIV=null,this._data=void 0,this.probe=void 0,this._demuxer=void 0,this._remuxer=void 0,this._demuxerStat=void 0,this._remuxerStat=void 0,this._observer=e,this._typeSupported=t,this._config=i,this._data=r,this._vendor=n,a&&(this._demuxerStat=a.demuxer,this._remuxerStat=a.remuxer)}var t=e.prototype;return t.push=function(e,t,i,r,n,a,s,o,u,d,c,h,f){var _=this;if(e.byteLength>0&&t&&t.key&&"AES-128"===t.method){var p=this._decrypter;p||(p=this._decrypter=new l(this._observer,this._config,{removePKCS7Padding:h}));var v=this._nextIV?this._nextIV:t.iv;p.decrypt(e,t.key.buffer,v.buffer,(function(e){_._pushDecrypted(new Uint8Array(e),t,i?new Uint8Array(i):null,r,n,a,s,o,u,d,c,h,f)})),h?this._nextIV=null:(this._nextIV=new Uint8Array(16),this._nextIV.set(new Uint8Array(e,e.byteLength-16)))}else this._pushDecrypted(new Uint8Array(e),t,i?new Uint8Array(i):null,r,n,a,s,o,u,d,c,h,f)},t.reset=function(e){this._nextIV=null,this._demuxer&&(this._demuxer.setExtra(e),this._demuxer.reset(e.stashSec)),this._remuxer&&(this._remuxer.setExtra(e),this._remuxer.resetStash()),this._data=e},t.flush=function(){this._demuxer&&this._demuxer.flush()},t.end=function(){this._observer.trigger(u.default.LOAD_END)},t.getStat=function(){return this._demuxer&&this._remuxer?{demuxer:this._demuxer.getStat(),remuxer:this._remuxer.getStat()}:null},t._pushDecrypted=function(e,t,i,r,n,a,o,d,l,c,h,f,_){var p=this._demuxer,v=!1;if(!p||l&&!this.probe(e)){for(var m=this._observer,g=this._typeSupported,y=this._config,b=[{Demux:R,Remux:x.default}],E=0,S=b.length;E<S;E++){var T=b[E],w=T.Demux.probe;if(w(e)){var L=this._remuxer=new T.Remux(m,y,g,this._vendor);L.setExtra(this._data),(p=new T.Demux(m,L,y,g)).setExtra(this._data),this.probe=w,v=!0;break}}if(!p)return void this._observer.trigger(u.default.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this._demuxer=p}var k=this._remuxer,A=v&&this._demuxerStat;(d||l||A)&&(p.resetInitSegment(i,r,n,h),k.resetInitSegment()),(l||A)&&(p.resetTimeStamp(),k.resetTimeStamp()),"function"==typeof p.setDecryptData&&p.setDecryptData(t),A&&(p.setStat(this._demuxerStat),k.setStat(this._remuxerStat)),_&&this.reset(_),p.append(e,a,o,c,f)},e}();t.default=k},"./src/demux/hls/demuxer-worker.ts":
/*!*****************************************!*\
  !*** ./src/demux/hls/demuxer-worker.ts ***!
  \*****************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/demux/hls/demuxer.ts (referenced with require.resolve) */function(e,t,i){"use strict";i.r(t);var r=i(/*! ../../core/observer */"./src/core/observer.ts"),n=i(/*! ./demuxer-inline */"./src/demux/hls/demuxer-inline.ts"),a=i(/*! ../../core/kernel-events */"./src/core/kernel-events.ts"),s=i(/*! ../../utils/log */"./src/utils/log.ts");t.default=function(e){var t,i=new r.default,o=function(t,i){e.postMessage({event:t,data:i})};i.on(a.default.PARSING_INIT_SEGMENT,o),i.on(a.default.PARSED_DATA,o),i.on(a.default.LOAD_END,o),i.on(a.default.ERROR,o),i.on(a.default.REPORT,o),i.on(a.default.PARSING_DATA,(function(t,i){var r={event:t,data:i,payload:i.payload};delete i.payload,e.postMessage(r,[r.payload.buffer])})),e.addEventListener("message",(function(e){var r=e.data;switch(r.cmd){case"init":s.Log.level(r.config.kwaiKernelLog),function(e,i,r,a,s,o){t=new n.default(e,i,r,a,s,o)}(i,r.typeSupported,r.config,r.data,r.vendor,r.stat);break;case"push":t.push(r.data,r.decryptdata,r.initSegment,r.audioCodec,r.videoCodec,r.timeOffset,r.contiguous,r.trackSwitch,r.discontinuity,r.accurateTimeOffset,r.duration,r.fragEnd,r.resetData);break;case"flush":t.flush();break;case"end":t.end()}}))}},"./src/demux/sps-parser.ts":
/*!*********************************!*\
  !*** ./src/demux/sps-parser.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var r=i(/*! ./exp-golomb */"./src/demux/exp-golomb.ts"),n={1:"Main",2:"Main 10",3:"Main Still Picture",4:"Rext"},a={30:1,60:2,63:2.1,90:3,93:3.1,120:4,123:4.1,150:5,153:5.1,156:5.2,180:6,183:6.1,186:6.2,255:8.5},s=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,a=0;a<i;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(r[n]=t[a],n++);return new Uint8Array(r.buffer,0,n)},e.parseHEVCSPS=function(t){var i=e._ebsp2rbsp(t),n=new r.default(i),a={general_ptl:{},sub_layer_ptl:{}};n.readBits(16),n.readBits(4);var s=n.readBits(3)+1;if(n.readBits(1),!e._parsePTL(n,a,s))return null;if(n.readUEG()>=16)return null;var o=n.readUEG();3==o&&n.readBits(1)&&(o=0);var u=n.readUEG(),d=n.readUEG();return n.destroy(),n=null,{chroma_format_string:3===o?"4:4:4":"4:2:0",profile_string:a.general_ptl.profile_string,level_string:a.general_ptl.level_string,width:u,height:d}},e._parsePTL=function(e,t,i){if(!this._decodeProfileTierLevel(e,t.general_ptl)||e.getBitsLeft()<8+16*(i-1>0?1:0))return!1;t.general_ptl.level_idc=e.readBits(8),t.general_ptl.level_string=this.getHEVCLevelString(t.general_ptl.level_idc),t.sub_layer_profile_present_flag=[],t.sub_layer_level_present_flag=[];for(var r=0;r<i-1;r++)t.sub_layer_profile_present_flag[r]=e.readBits(1),t.sub_layer_level_present_flag[r]=e.readBits(1);if(i-1>0)for(var n=i-1;n<8;n++)e.readBits(2);for(var a=0;a<i-1;a++){if(t.sub_layer_profile_present_flag[a]&&this._decodeProfileTierLevel(e,t.sub_layer_ptl))return!1;if(t.sub_layer_level_present_flag[a]){if(e.getBitsLeft()<8)return!1;t.sub_layer_ptl[a].level_idc=e.readBits(8)}}return!0},e._decodeProfileTierLevel=function(e,t){if(e.getBitsLeft()<88)return!1;t.profile_space=e.readBits(2),t.tier_flag=e.readBits(1),t.profile_idc=e.readBits(5),t.profile_compatibility_flag=[];for(var i=0;i<32;i++)t.profile_compatibility_flag[i]=e.readBits(1),0==t.profile_idc&&i>0&&t.profile_compatibility_flag[i]&&(t.profile_idc=i);return t.progressive_source_flag=e.readBits(1),t.interlaced_source_flag=e.readBits(1),t.non_packed_constraint_flag=e.readBits(1),t.frame_only_constraint_flag=e.readBits(1),e.readBits(16),e.readBits(16),e.readBits(12),t.profile_string=this.getHEVCProfileString(t.profile_idc),!0},e.parseSPS=function(t){var i=e._ebsp2rbsp(t),n=new r.default(i);n.readByte();var a=n.readByte();n.readByte();var s=n.readByte();n.readUEG();var o=e.getProfileString(a),u=e.getLevelString(s),d=1,l=420,c=8;if((100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a||138===a||144===a)&&(3===(d=n.readUEG())&&n.readBits(1),d<=3&&(l=[0,420,422,444][d]),c=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var h=3!==d?8:12,f=0;f<h;f++)n.readBool()&&(f<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var _=n.readUEG();if(0===_)n.readUEG();else if(1===_){n.readBits(1),n.readSEG(),n.readSEG();for(var p=n.readUEG(),v=0;v<p;v++)n.readSEG()}n.readUEG(),n.readBits(1);var m=n.readUEG(),g=n.readUEG(),y=n.readBits(1);0===y&&n.readBits(1),n.readBits(1);var b=0,E=0,S=0,T=0;n.readBool()&&(b=n.readUEG(),E=n.readUEG(),S=n.readUEG(),T=n.readUEG());var w=1,L=1,R=0,x=!0,k=0,A=0;if(n.readBool()){if(n.readBool()){var O=n.readByte();O>0&&O<16?(w=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][O-1],L=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][O-1]):255===O&&(w=n.readByte()<<8|n.readByte(),L=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var P=n.readBits(32),D=n.readBits(32);x=n.readBool(),R=(k=D)/(A=2*P)}}var I=1;1===w&&1===L||(I=w/L);var C=0,N=0;0===d?(C=1,N=2-y):(C=3===d?1:2,N=(1===d?2:1)*(2-y));var M=16*(m+1),U=16*(g+1)*(2-y);M-=(b+E)*C,U-=(S+T)*N;var B=Math.ceil(M*I);return n.destroy(),n=null,{profile_string:o,level_string:u,bit_depth:c,chroma_format:l,chroma_format_string:e.getChromaFormatString(l),frame_rate:{fixed:x,fps:R,fps_den:A,fps_num:k},sar_ratio:{width:w,height:L},codec_size:{width:M,height:U},present_size:{width:B,height:U}}},e._skipScalingList=function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e.getHEVCProfileString=function(e){return n[e]},e.getHEVCLevelString=function(e){return a[e]},e}();t.default=s},"./src/index.ts":
/*!***********************************!*\
  !*** ./src/index.ts + 62 modules ***!
  \***********************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/@ks/adaptive-multi-rate/lib/adaptive-flv.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/@ks/adaptive-multi-rate/lib/adaptive-hls.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/kernel-errors.ts because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/kernel-events.ts because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/observer.ts because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/report-types.ts because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/flv/flv-demuxer-inline.ts because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/flv/flv.ts because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/hls/demuxer-inline.ts because of ./src/demux/hls/demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number-isFinite.js because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/object-assign.js because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/browser.ts because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/log.ts because of ./src/demux/flv/flv-demuxer-worker.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/events/events.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/url-parse/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/url-toolkit/src/url-toolkit.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/uuid/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/webworkify-webpack/index.js (<- Module is not an ECMAScript module) */function(e,t,i){"use strict";i.r(t);var r,n=i("./src/polyfills/object-assign.js"),a=i("./node_modules/events/events.js"),s=function(){function e(){this.tag="fetch",this._context=void 0,this._callbacks=null,this._controller=null,this._reader=null,this._abort=!1}e.isSupport=function(){return!(!self.fetch||!self.ReadableStream)};var t=e.prototype;return t.load=function(e,t){var i=this;this._context=e,this._callbacks=t;var r=new Headers;e.headers&&e.headers.forEach((function(e){r.append(e.header,e.value)})),e.range&&r.append("Range",e.range);var n={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:this._getAbortSignal()};e.credentials&&(n.credentials="include"),fetch(e.url,n).then((function(t){if(e.responseUrl=t.url,e.responseHeader=t.headers,i._callbacks&&i._callbacks.onConnect&&i._callbacks.onConnect(t.status),t.ok)return i._abort?void(t.body&&t.body.getReader().cancel()):"arraybuffer"===e.responseType?e.progress?void(t.body&&(i._reader=t.body.getReader(),i._pump(i._reader))):void t.arrayBuffer().then((function(t){i._onEnd(e,t)})):void t.text().then((function(t){i._onEnd(e,t)}));var r=new Error(t.status+" "+t.statusText);i._onError(r)})).catch((function(e){"AbortError"!==e.name&&i._onError(e)}))},t.abort=function(){this._controller?this._controller.abort():this._reader&&(this._reader.cancel(),this._reader=null),this._abort=!0},t.destroy=function(){this._callbacks=null,this.abort()},t._onProgress=function(e,t){this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t)},t._onEnd=function(e,t){this._callbacks&&this._callbacks.onEnd&&(this._reader=null,this._controller=null,this._callbacks.onEnd(e,t))},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},t._pump=function(e){var t=this;e.read().then((function(i){if(t._abort)return e.cancel(),null;if(i.done)return t._onEnd(t._context,null),null;var r=i.value.buffer;return t._onProgress(t._context,r),t._pump(e)})).catch((function(e){"AbortError"!==e.name&&t._onError(e)}))},t._getAbortSignal=function(){try{if(AbortController)return this._controller=new AbortController,this._controller.signal}catch(e){return null}return null},e}();!function(e){e.MOZ_CHUNK="moz-chunked-arraybuffer",e.MS_STREAM="ms-stream",e.UNKNOW="unknow",e.UNSUPPORT=""}(r||(r={}));var o,u,d=function(){function e(){this.tag="xhr",this._xhr=null,this._context=void 0,this._callbacks=null,this._reader=null,this._msBufferOffset=0,this._msBufferUpper=16777216,this._progress=r.UNKNOW,this._xhr=null,this._msBufferOffset=0}e.isSupportChunk=function(){if(e.supportChunk!==r.UNKNOW)return e.supportChunk;try{var t=new XMLHttpRequest;if(t.open("GET","https://example.com",!0),t.responseType=r.MOZ_CHUNK,t.responseType===r.MOZ_CHUNK)return e.supportChunk=r.MOZ_CHUNK,e.supportChunk}catch(t){e.supportChunk=r.UNSUPPORT}try{var i=new XMLHttpRequest;if(i.open("GET","https://example.com",!0),i.responseType=r.MS_STREAM,i.responseType===r.MS_STREAM)return e.supportChunk=r.MS_STREAM,e.supportChunk}catch(t){e.supportChunk=r.UNSUPPORT}return r.UNSUPPORT};var t=e.prototype;return t.load=function(t,i){if(this._callbacks=i,this._context=t,this._progress=r.UNSUPPORT,t.progress&&"arraybuffer"===t.responseType&&(this._progress=e.isSupportChunk(),this._progress===r.MS_STREAM)){var n=this._reader=new self.MSStreamReader;n.onprogress=this._msrOnProgress.bind(this),n.onload=this._onLoadEnd.bind(this),n.onerror=this._onError.bind(this)}var a=this._xhr=new XMLHttpRequest;a.open("GET",this._context.url,!0),this._progress===r.MOZ_CHUNK?(a.responseType=r.MOZ_CHUNK,a.onprogress=this._onProgress.bind(this),a.onload=this._onLoadEnd.bind(this)):this._progress===r.MS_STREAM?a.responseType=r.MS_STREAM:(a.responseType=t.responseType||"arraybuffer",a.onload=this._onLoadEnd.bind(this)),a.onreadystatechange=this._onReadyStateChange.bind(this),a.onerror=this._onError.bind(this),a.withCredentials=!!t.credentials,t.range&&a.setRequestHeader("Range",t.range),a.send()},t.abort=function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.destroy=function(){this._callbacks=null,this.abort()},t._onReadyStateChange=function(e){var t=e.target;2===t.readyState?(this._context.responseUrl=t.responseURL,this._context.responseHeader=t.getAllResponseHeaders(),this._callbacks&&this._callbacks.onConnect&&this._callbacks.onConnect(t.status),(t.status<200||t.status>299)&&this._onError(new Error("xhr error"))):3===t.readyState&&this._reader&&0===this._reader.readyState&&t.status>=200&&t.status<=299&&this._reader.readAsArrayBuffer(t.response)},t._onProgress=function(e){var t=e.target.response;this._callbacks&&this._callbacks.onProgress&&t&&this._callbacks.onProgress(this._context,t)},t._msrOnProgress=function(e){var t=e.target.result;if(t){var i=t.slice(this._msBufferOffset);this._msBufferOffset=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(this._context,i),t.byteLength>=this._msBufferUpper&&this._onError(new Error("ms buffer too large"))}else this._onError(new Error("ms buffer null"))},t._onLoadEnd=function(e){var t=null,i=e.target;!this._progress&&i&&(t=i.response),this._callbacks&&this._callbacks.onEnd(this._context,t)},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},e}();d.supportChunk=r.UNKNOW,function(e){e.UNKNOWN="unknown",e.FLV="flv",e.HLS="hls",e.ABR_FLV="abrFlv",e.KWAI_HLS="kwaiHls",e.KWAI_HLS_SLICE="kwaiHlsSlice",e.KWAI_FLV="kwaiFlv"}(o||(o={})),function(e){e.flv="flv",e.hls="hls"}(u||(u={}));var l,c,h=i("./src/utils/browser.ts"),f=i("./src/utils/log.ts"),_=new RegExp("^(http|https)://"),p={isLive:!1,box:u.flv,alwaysSeekKeyframe:!1,lazyLoadMaxDuration:90,lazyLoadRecoverDuration:60,webWorker:!0,fragBeforeWorker:2,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:15,appendErrorMaxRetry:3,credentials:!1,streamingMux:!0,autoPlaybackRate:!0,autoPlaybackRateConf:void 0,enableSoftwareAES:!0,startPlayBufferSec:0,startFromSec:0,startFromKeyframe:!0,defaultSpts:-7e3,lazyLoad:!1,kwaiKernelLog:f.LOG_LEVEL.LEVEL_ERROR,retryWithBackup:!0,resourceBuffer:!0,resourceBufferSize:500,ntp:!0,ensureAudio:!0,dbCache:!0,adaptive:!0,stretchShortVideoTrack:!1,maxBufferHole:.5,maxAudioFramesDrift:5,forceKeyFrameOnDiscontinuity:!1,maxRetry:3,connectionTimeout:1e4,transmissionTimeout:3e4,retryDelay:2e3,maxFragFailSec:11,manifestLoadingMaxRetry:3,manifestConnectionTimeout:1e4,manifestTransmissionTimeout:1e4,manifestLoadingRetryDelay:1,levelLoadingMaxRetry:3,levelConnectionTimeout:1e4,levelTransmissionTimeout:1e4,levelLoadingRetryDelay:100,keyLoadingMaxRetry:3,keyConnectionTimeout:5e3,keyTransmissionTimeout:5e3,keyLoadingRetryDelay:300},v={maxRetry:1,retryDelay:100,connectionTimeout:1e4,levelConnectionTimeout:1e4,manifestConnectionTimeout:1e4},m={startDelay:10,interval:.6,rule:[{rate:1.2,lower:20,upper:Number.MAX_SAFE_INTEGER},{rate:1.1,lower:14,upper:17},{rate:1,lower:5,upper:11},{rate:.9,lower:0,upper:3}]},g={startDelay:10,interval:.6,rule:[{rate:1.1,lower:11,upper:Number.MAX_SAFE_INTEGER},{rate:1,lower:0,upper:10}]},y=function(){function e(){}return e.isStreamingSupport=function(e){return e&&"flv"===e.box&&e.isLive?s.isSupport()||d.isSupportChunk()===r.MOZ_CHUNK:s.isSupport()||d.isSupportChunk()},e.processConfig=function(t){var i=t.box===u.hls?Object(n.ObjectAssign)({},p,v):Object(n.ObjectAssign)({},p);return Object(n.ObjectAssign)(i,t),i.startPlayBufferSec=Math.min(5,Math.max(0,i.startPlayBufferSec)),h.default.msedge&&(i.startPlayBufferSec=Math.max(i.startPlayBufferSec,1),i.adaptive=i.box===u.hls),e.setSrc(i),this._initPlayBackRateRule(i),window.Worker||(i.webWorker=!1),i.isLive&&(i.startFromSec=0),i.lazyLoad=!(i.isLive&&i.box===u.flv),e.detectStreamingMux(i),i.autoCleanupMaxBackwardDuration=Math.max(i.autoCleanupMaxBackwardDuration,i.autoCleanupMinBackwardDuration+10),i},e.detectStreamingMux=function(t){t.streamingMux=!(!t.streamingMux||!e.isStreamingSupport(t));var i=h.default.safari&&!t.isLive||h.default.opera&&h.default.version.major<37;t.gopRemux=t.streamingMux&&i},e.setSrc=function(e,t){if(void 0===t&&(t=null),t&&(e.src=t,e.manifest=""),"string"==typeof e.src&&!_.test(e.src))try{e.src=JSON.parse(e.src)}catch(t){e.manifest=""}"object"==typeof e.src&&(e.manifest=e.src,e.src="")},e._initPlayBackRateRule=function(e){e.autoPlaybackRate=e.isLive&&e.autoPlaybackRate;var t=e.autoPlaybackRateConf;if(t){var i=t.rule;if(i&&Array.isArray(i)&&((i=i.filter((function(e){return e.upper>e.lower&&e.rate>0}))).sort((function(e,t){return t.rate-e.rate})),i.length>1))return t.rule=i,void(e.autoPlaybackRateConf=t)}else e.autoPlaybackRateConf=e.adaptive?g:m},e}(),b=10,E=100,S=101,T=102,w=103,L=104,R=105,x=107,k=108,A=111;!function(e){e.REPORT="report",e.ERROR="error",e.LEVEL_SWITCHING="levelSwitching",e.LEVEL_SWITCHED="levelSwitched",e.LEVEL_SWITCH_PLAYING="levelSwitchPlaying",e.LEVEL_SWITCH_FAILED="levelSwitchFailed",e.MANIFEST_PARSED="manifestParsed",e.LEVEL_UPDATED="levelUpdated",e.PRELOAD_HIT="preloadHit",e.LOAD_END="loadEnd"}(l||(l={})),function(e){e.METADATA="metadata",e.MEDIA_INFO="mediaInfo",e.HEARTBEAT="heartbeat",e.PERFORMANCE="performance",e.DOWNLOAD="download",e.REALTIME_BEACON="realtimeBeacon",e.DISCONTINUITY="discontinuity",e.LIVE_STREAM_ADAPTIVE_QOS_STAT="liveStreamAdaptiveQosStat",e.HLS_VOD_ADAPTIVE_QOS_STAT="hlsVodAdaptiveQosStat"}(c||(c={}));var O=i("./src/core/kernel-errors.ts"),P=i("./src/core/kernel-events.ts");function D(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I=function(){function e(){this._video=void 0,this._mse=void 0}var t,i,r,n=e.prototype;return n.attachVideo=function(e){this._video=e},n.attachMSE=function(e){this._mse=e},n.isTimeinBuffered=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++)if(e>=t.start(i)&&e<t.end(i))return!0;return!1},n.bufferedSec=function(){return this._video&&this._video.buffered.length>0?Math.max(0,this._video.buffered.end(this._video.buffered.length-1)-this._video.currentTime):0},n.bufferedSecByType=function(e){return this._mse&&this._video&&this._mse.bufferedEndByType(e)>0?this._mse.bufferedEndByType(e)-this._video.currentTime:0},n.mseBufferedSecByType=function(e){return this._mse?this._mse.bufferedByType(e):{start:0,end:0}},n.bufferSliceNumByType=function(e){return this._mse?this._mse.bufferSliceNumByType(e):0},n.pendingNum=function(){return this._mse?this._mse.pendingNum():0},n.pendingSecByType=function(e){return this._mse?this._mse.pendingSecByType(e):0},n.currentBuffer=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r<=e&&e<n)return{start:r,end:n}}},n.nextBuffer=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r>e)return{start:r,end:n}}},t=e,(i=[{key:"video",get:function(){return this._video}},{key:"mse",get:function(){return this._mse}},{key:"mseReadyState",get:function(){return this._mse?this._mse.readyState:"closed"}},{key:"videoReadyState",get:function(){return this._video?this._video.readyState:0}},{key:"currentTime",get:function(){return this._video?this._video.currentTime:0}}])&&D(t.prototype,i),r&&D(t,r),e}(),C=i("./src/polyfills/number-isFinite.js");function N(){return window.MediaSource||window.WebKitMediaSource}function M(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this).tag="mse-controller",i._config=void 0,i.video=void 0,i._sourceBuffer=void 0,i._mediaSource=null,i._mimeCodec=void 0,i._cleanUpTask=void 0,i._appendQueue=void 0,i._hasVideo=void 0,i._hasAudio=void 0,i._endOfData=!1,i._appendEnabled=void 0,i._duration=null,i._appendError=0,i._appendBufferError=!1,i._mseDuration=null,i._sbHandler={},i._souceBufferLocked=!1,i._onSourceOpen=function(){f.Log.i(i.tag,"MediaSource onSourceOpen"),i._mediaSource&&(i._mediaSource.removeEventListener("sourceopen",i._onSourceOpen),i._checkSourceBuffer(),i.refresh(),i.emit("source_open"))},i._onSourceEnded=function(){f.Log.i(i.tag,"MediaSource onSourceEnded")},i._onSourceClose=function(){f.Log.i(i.tag,"MediaSource onSourceClose"),i._mediaSource&&(i._mediaSource.removeEventListener("sourceopen",i._onSourceOpen),i._mediaSource.removeEventListener("sourceended",i._onSourceEnded),i._mediaSource.removeEventListener("sourceclose",i._onSourceClose))},i._onSourceBufferUpdateEnd=function(e){i._update(e),i._endOfData&&i._endOfStream(),i._updateDuration(),i.emit("updateend")},i._onSourceBufferError=function(e){f.Log.e(i.tag,"SourceBuffer Error: "+e),i.emit(P.default.ERROR,{type:O.ErrorTypes.MSE_ERROR,details:O.ErrorDetails.SOURCEBUFFER_ERROR,fatal:!0,reason:"source buffer error"})},i._config=t,i._hasVideo=!1,i._hasAudio=!1,i._appendQueue={video:[],audio:[]},i._sourceBuffer={},i._cleanUpTask={video:[],audio:[]},i._mimeCodec={},i._appendEnabled=!0,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,a,s,o=r.prototype;return o.attach=function(e){var t=this;this.video=e;var i=N();if(i){var r=this._mediaSource=new i;this.video.src=URL.createObjectURL(r),this.video.load(),r.addEventListener("sourceopen",this._onSourceOpen),r.addEventListener("sourceended",this._onSourceEnded),r.addEventListener("sourceclose",this._onSourceClose),this._souceBufferLocked=!1}else setTimeout((function(){t.emit(P.default.ERROR,{type:O.ErrorTypes.MSE_ERROR,details:O.ErrorDetails.MEDIASOURCE_ERROR,fatal:!0,reason:"MediaSource is not support"})}),0)},o.trackInfo=function(e){if((this._hasAudio!==e.hasAudio||this._hasVideo!==e.hasVideo)&&this.video&&this.hasSourceBuffer()){for(var t in f.Log.i(this.tag,"trackInfo rebuild mse"),this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend));this._sourceBuffer={},this._mediaSource&&(this._mediaSource.removeEventListener("sourceopen",this._onSourceOpen),this._mediaSource.removeEventListener("sourceended",this._onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this._onSourceClose)),this._mimeCodec={},this._hasAudio=e.hasAudio,this._hasVideo=e.hasVideo,this.attach(this.video)}e.hasAudio&&e.audioCodec&&(this._mimeCodec.audio='audio/mp4; codecs="'+e.audioCodec+'"'),e.hasVideo&&e.videoCodec&&(this._mimeCodec.video='video/mp4; codecs="'+e.videoCodec+'"'),this._hasAudio=this._hasAudio||e.hasAudio,this._hasVideo=this._hasVideo||e.hasVideo,this._checkSourceBuffer()},o.updateDuration=function(e){this._duration=e,this._updateDuration()},o._updateDuration=function(){if(null!==this._duration&&this.video&&this._mediaSource&&this._sourceBuffer&&0!==this.video.readyState&&"open"===this._mediaSource.readyState){for(var e in this._sourceBuffer)if(this._sourceBuffer[e]&&this._sourceBuffer[e].updating)return;var t=this.video.duration;if(null===this._mseDuration&&(this._mseDuration=this._mediaSource.duration),this._config.isLive)this._mseDuration=this._mediaSource.duration=1/0;else if(this._duration!==this._mseDuration&&this._duration!==t||!Object(C.isFiniteNumber)(t)){var i=!0;for(var r in this._sourceBuffer)i=i&&this.bufferedEndByType(r)<this._duration;i&&(this._mseDuration=this._mediaSource.duration=this._duration),this._duration=null}}},o._checkSourceBuffer=function(){var e=(this._hasAudio?1:0)+(this._hasVideo?1:0),t=(this._mimeCodec.audio?1:0)+(this._mimeCodec.video?1:0);if(f.Log.v(this.tag,"checkSourceBuffer",e,t,this._mimeCodec),this._mediaSource&&"open"===this._mediaSource.readyState&&e>0&&t>=e)for(var i in this._mimeCodec)this._mimeCodec[i]&&this._addSourceBuffer(i)},o._addSourceBuffer=function(e){var t=this;if(!this._sourceBuffer[e]&&!this._souceBufferLocked){try{this._mediaSource&&(this._sourceBuffer[e]=this._mediaSource.addSourceBuffer(this._mimeCodec[e]))}catch(e){return f.Log.e(this.tag,e),void this.emit(P.default.ERROR,{type:O.ErrorTypes.MSE_ERROR,details:O.ErrorDetails.ADDSOURCEBUFFER_ERROR,fatal:!0,reason:e.message})}var i=this._sourceBuffer[e];this._sbHandler[e]={updateend:function(){t._onSourceBufferUpdateEnd(e)},error:function(e){t._onSourceBufferError(e)}},i.addEventListener("error",this._sbHandler[e].error),i.addEventListener("updateend",this._sbHandler[e].updateend),this._duration&&this._mediaSource&&(this._mediaSource.duration=this._duration)}},o._hasPendingData=function(){return!(!this._appendQueue||!(this._appendQueue.video&&this._appendQueue.video.length||this._appendQueue.audio&&this._appendQueue.audio.length))},o.refresh=function(){for(var e in this._sourceBuffer)this._update(e)},o._doAppend=function(e){if(this._appendQueue[e]&&this._appendQueue[e].length>0){if(!this._appendEnabled)return void(this._getBufferQueueSize()>209715200&&!this._appendBufferError&&(this._appendBufferError=!0,this.emit(P.default.ERROR,{type:O.ErrorTypes.MSE_ERROR,details:O.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull"})));if(this._sourceBuffer[e]&&!this._sourceBuffer[e].updating&&!this._appendBufferError){var t=this._appendQueue[e].shift();this._appendBuffer(t,e)}}},o.mediaSegment=function(e){var t=e.type,i=this._appendQueue[t];this._souceBufferLocked&&!this._sourceBuffer[t]||i.push(e),this._sourceBuffer[t]&&(this._souceBufferLocked=!0,this._update(t))},o.bufferedByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?{start:t.buffered.start(0),end:t.buffered.end(t.buffered.length-1)}:{start:0,end:0}},o.bufferedEndByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?t.buffered.end(t.buffered.length-1):0},o.bufferSliceNumByType=function(e){var t=this._sourceBuffer[e];return t?t.buffered.length:0},o.pendingSecByType=function(e){var t=this._appendQueue[e];return t?t.reduce((function(e,t){return e+t.duration}),0):0},o.pendingNum=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].length;return e},o._calculateRemoveRange=function(e){var t=this.video;if(t&&!t.seeking){var i=t.currentTime;if(this._sourceBuffer[e]){var r=this._cleanUpTask[e],n=this._sourceBuffer[e].buffered;if(n.length>=1&&i-n.start(0)>=this._config.autoCleanupMaxBackwardDuration){var a=i-this._config.autoCleanupMinBackwardDuration;if(r.length&&0===r[r.length-1].start&&r[r.length-1].end===a)return;r.push({start:0,end:a})}}}},o._cleanUpRange=function(e,t){try{for(var i=0;i<e.buffered.length;i++){var r=e.buffered.start(i),n=e.buffered.end(i),a=Math.max(r,t.start),s=Math.min(n,t.end);if(s>a)return e.remove(a,s),this.emit("remove"),!(t.end>n&&i<e.buffered.length-1&&(t.start=Math.max(t.start,s),1));if(!(t.end>s))break;t.start=Math.max(t.start,s)}return!0}catch(t){return!(e&&e.updating)}},o._appendBuffer=function(e,t){if(this._sourceBuffer[t]&&this.video&&!this.video.error)try{this._sourceBuffer[t].appendBuffer(e.data.buffer)}catch(s){if(f.Log.w(this.tag,s.code,s),22!==s.code)this._appendError?this._appendError++:this._appendError=1,this._appendError>this._config.appendErrorMaxRetry?(this._appendBufferError=!0,this.emit(P.default.ERROR,{type:O.ErrorTypes.MSE_ERROR,details:O.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:s.message})):this._appendQueue[t].unshift(e);else{var i=this.video,r=this._config;this._appendEnabled=!1,this._appendQueue[t].unshift(e);var n=i.buffered.end(i.buffered.length-1)-i.currentTime;if(r.lazyLoadMaxDuration>30&&r.lazyLoad)r.lazyLoadMaxDuration=Math.max(r.lazyLoadMaxDuration/2,30),r.lazyLoadRecoverDuration=20;else{var a=i.currentTime-i.buffered.start(0);n<30?(a<r.autoCleanupMaxBackwardDuration&&(r.autoCleanupMaxBackwardDuration=Math.max(r.autoCleanupMaxBackwardDuration/2,20),r.autoCleanupMinBackwardDuration=10),this._calculateRemoveRange(t),this.hasCleanUpTask(t)&&this._cleanUp(t)):a<r.autoCleanupMinBackwardDuration&&this.emit(P.default.ERROR,{type:O.ErrorTypes.MSE_ERROR,details:O.ErrorDetails.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull-appendError"})}f.Log.i(this.tag,"mse bufferfull"),this.emit("bufferFull")}}},o.flush=function(e,t,i){var r=0,n=Number.POSITIVE_INFINITY;for(var a in this._endOfData=!1,this._sourceBuffer)if((!i||i===a)&&this._sourceBuffer[a]){if(e){r=Math.max(r,e);for(var s=this._appendQueue[a].length-1;s>=0&&(!this._appendQueue[a][s].startPTS||this._appendQueue[a][s].startPTS>=e);s--)this._appendQueue[a].pop()}else this._appendQueue[a]=[];t&&(n=Math.min(n,t)),this._cleanUpTask[a].push({start:r,end:n}),this._cleanUp(a)}this._appendEnabled=!0},o.setAppendEnabled=function(e){!this._appendEnabled&&e?(this._appendEnabled=e,this.refresh()):this._appendEnabled=e},o.getAppendEnabled=function(){return this._appendEnabled},o.endOfData=function(){this._endOfData=!0,this._hasPendingData()||this._endOfStream()},o.ended=function(){return this._endOfData},o._endOfStream=function(){var e=this._mediaSource;if(e&&"open"===e.readyState){for(var t in this._sourceBuffer){var i=this._sourceBuffer[t];if(i&&i.updating)return}try{e.endOfStream()}catch(e){f.Log.e(this.tag,e),this.emit(P.default.ERROR,{type:O.ErrorTypes.MSE_ERROR,details:O.ErrorDetails.ENDOFSTREAM_ERROR,fatal:!0,reason:e.message})}}},o.destroy=function(){if(this._mediaSource){var e=this._mediaSource;if(this._endOfStream(),"closed"!==e.readyState)for(var t in this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend),e.removeSourceBuffer(this._sourceBuffer[t]));e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceended",this._onSourceEnded),e.removeEventListener("sourceclose",this._onSourceClose),this._mediaSource=null}this.removeAllListeners(),this._appendQueue={},this._mimeCodec={},this._cleanUpTask={},this._sourceBuffer={},this._sbHandler={}},o.hasCleanUpTask=function(e){var t=0;if(void 0===e)for(var i in this._cleanUpTask)t+=this._cleanUpTask[i].length;else this._cleanUpTask[e]&&(t=this._cleanUpTask[e].length);return t>0},o.hasSourceBuffer=function(){return!!Object.keys(this._sourceBuffer).length},o._getBufferQueueSize=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].reduce((function(e,t){return t.data&&t.data.byteLength?e+t.data.byteLength:e}),0);return e},o.getBufferQueueSec=function(e){var t=this;return this._appendQueue?(e?[e]:Object.keys(this._appendQueue)).reduce((function(e,i){return t._appendQueue[i]&&t._appendQueue[i].length>0&&(0===Object.keys(t._sourceBuffer).length||t._sourceBuffer[i])?Math.max(e,t._appendQueue[i].reduce((function(e,t){return t.duration?e+t.duration:e}),0)):e}),0):0},o._update=function(e){this.hasCleanUpTask(e)&&this._cleanUp(e),this._doAppend(e)},o._cleanUp=function(e){for(var t=this._cleanUpTask[e];t&&t.length;){var i=t[0],r=this._sourceBuffer[e];if(r){if(r.updating||!this._cleanUpRange(r,i))return;t.shift()}else t.shift()}this.refresh()},n=r,(a=[{key:"readyState",get:function(){return this._mediaSource?this._mediaSource.readyState:"closed"}}])&&M(n.prototype,a),s&&M(n,s),r}(a.EventEmitter),B=i("./node_modules/url-parse/index.js"),F=i.n(B),V=i("./src/core/report-types.ts");function j(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var H=function(){function e(e,t,i,r){var n=this;void 0===r&&(r=1),this._name=void 0,this._storeName=void 0,this._dbIndex=void 0,this._version=void 0,this._db=void 0,this._error=void 0,this._taskQueue=[],this._runTaskQueue=function(){for(;n._taskQueue.length;){var e=n._taskQueue.shift();e&&n.run(e.task,e.mode)}},this._name=e,this._storeName=t,this._dbIndex=i,this._version=r,this._initDB()}var t,i,r,n=e.prototype;return n.run=function(e,t){void 0===t&&(t="readwrite"),this._db||this._error?this._getStore(e,t):this._taskQueue.push({task:e,mode:t})},n.put=function(e,t,i){this.run({exec:function(i){return i.put(t,e)},callback:i})},n.get=function(e,t){this.run({exec:function(t){return t.get(e)},callback:t},"readonly")},n.count=function(e,t){this.run({exec:function(t){return t.count(e)},callback:t})},n.del=function(e,t){this.run({exec:function(t){return t.delete(e)},callback:t})},n.clear=function(e){this.run({exec:function(e){return e.clear()},callback:e})},n._getStore=function(e,t){if(void 0===t&&(t="readwrite"),this._db){var i,r=this._db.transaction(this._storeName,t);if(e.callback){var n=e.callback;r.oncomplete=function(){return n(void 0,i)},r.onabort=r.onerror=function(){return n(r.error)}}i=e.exec(r.objectStore(this._storeName))}else e.callback&&e.callback(this._error)},n._initDB=function(){var e=this;if(!this._db&&window.indexedDB){var t=window.indexedDB.open(this._name,this._version);t.onerror=function(){return e._error=t.error},t.onsuccess=function(){e._db=t.result,e._runTaskQueue()},t.onupgradeneeded=function(){t.result.objectStoreNames.contains(e._storeName)&&t.result.deleteObjectStore(e._storeName);var i=t.result.createObjectStore(e._storeName);e._dbIndex&&e._dbIndex.forEach((function(e){i.createIndex(e.name,e.keyPath,e.option)}))}}},t=e,(i=[{key:"state",get:function(){return this._error?"error":this._db?"ready":"initializing"}}])&&j(t.prototype,i),r&&j(t,r),e}();function G(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var K,q,W,z={version:1,indexKey:"index",expired:604800,limit:200,loadTimeout:100},Y=function(){function e(e,t,i){this.tag="db-cache",this._idb=void 0,this._config=void 0,this._cacheIndex={list:[]},this._ready=!1,this._quotaExceeded=0,this._config=Object(n.ObjectAssign)({},z,i),this._idb=new H(e,t),this._readCacheIndex()}e.isSupport=function(){return!!indexedDB};var t,i,r,a=e.prototype;return a.hit=function(e){return this.ready?this._indexOfCacheIndex(e):-2},a.get=function(e,t){if(f.Log.i(this.tag,"get",e),this.ready){var i=this._config,r=this._cacheIndex,n=this._indexOfCacheIndex(e),a=!1;if(n>-1){var s=r.list[n];Date.now()-s.time<1e3*i.expired?(f.Log.i(this.tag,"read db",e),setTimeout((function(){a||(a=!0,t())}),i.loadTimeout),this._idb.get(e,(function(e,i){a||(a=!0,t(e,i))}))):(f.Log.i(this.tag,"get expired",e),this.del([e]),t())}else t()}},a.put=function(e,t){var i=this;if(f.Log.i(this.tag,"put",e),this.ready&&!this._checkLimit(this._config.limit)){var r=this._config,a=this._cacheIndex,s=Object(n.ObjectAssign)({},a),o=this._indexOfCacheIndex(e);o>-1?(s.list[o].time=Date.now(),s.list.push(s.list.splice(o,1)[0])):s.list.push({id:e,time:Date.now()}),this._idb.run({exec:function(i){return i.put(s,r.indexKey),i.put(t,e),i.get(r.indexKey)},callback:function(e,t){e?22===e.code&&(r.limit=a.list.length,i._quotaExceeded++):t&&(a=t.result)}})}},a.del=function(e){var t=this;if(f.Log.i(this.tag,"delete",e),this.ready&&e.length){var i=this._config.indexKey,r=(this._cacheIndex,Object(n.ObjectAssign)({},this._cacheIndex));e.forEach((function(e){var i=t._indexOfCacheIndex(e);i>-1&&r.list.splice(i,1)})),this._idb.run({exec:function(t){return e.forEach((function(e){t.delete(e)})),t.put(r,i),t.get(i)},callback:function(e,t){e||t&&t.result}})}},a.refresh=function(){var e=this;if(this.ready){var t=this._cacheIndex;this._idb.count(void 0,(function(i,r){r&&(parseInt(r.result)-t.list.length!=1?e._clear():e._checkExpired())}))}},a._readCacheIndex=function(){var e=this;f.Log.i(this.tag,"read index"),this._idb.get(this._config.indexKey,(function(t,i){t||(i&&i.result?e._verifyCacheIndex(i.result)?e._cacheIndex.list=i.result.list:e._clear():f.Log.i(e.tag,"no index"),e._ready=!0)}))},a._checkExpired=function(){if(f.Log.i(this.tag,"check expired"),this.ready){var e=this._config,t=this._cacheIndex,i=Date.now(),r=[];t.list.forEach((function(t){i-t.time>e.expired&&r.push(t.id)})),r.length&&this.del(r)}},a._checkLimit=function(e){var t=this._cacheIndex;if(e<=t.list.length){for(var i=Math.ceil(.2*t.list.length),r=[],n=0;n<i;n++)r.push(t.list[n].id);return this.del(r),r.length>0}return!1},a._clear=function(){var e=this;f.Log.i(this.tag,"clear"),this.ready&&this._idb.clear((function(t,i){t||(e._cacheIndex.list=[])}))},a._verifyCacheIndex=function(e){return!!(e&&e.list&&Array.isArray(e.list))},a._indexOfCacheIndex=function(e){for(var t=this._cacheIndex.list,i=0;i<t.length;i++)if(t[i].id===e)return i;return-1},t=e,(i=[{key:"ready",get:function(){return this._ready&&"error"!==this._idb.state}},{key:"quotaExceeded",get:function(){return this._quotaExceeded}}])&&G(t.prototype,i),r&&G(t,r),e}(),X=i("./node_modules/uuid/index.js");function Q(){for(var e=document,t=0,i=["hidden","webkitHidden","mozHidden"];t<i.length;t++){var r=i[t];if(r in e)return e[r]}return null}function J(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.FIRST_FRAME="normal",e.FIRST_FRAME_SEEK="seek",e.FIRST_FRAME_SELECT_BITRATE="select_bitrate"}(q||(q={})),function(e){e.START="start",e.MANIFEST="manifest",e.LEVEL="level",e.DATA="data",e.DEMUX="demux",e.SEGMENT="segment",e.CANPLAY="canplay",e.LOADEDDATA="loadeddata"}(W||(W={}));var Z,$=[{event:W.START,emitEvent:"first_loader_open_timestamp",detailName:"first-loader-open"},{event:W.MANIFEST,detailName:"manifest-duration"},{event:W.LEVEL,detailName:"level-duration"},{event:W.DATA,emitEvent:"receive-first-package-duration",detailName:"first-package-duration"},{event:W.DEMUX,emitEvent:"first-flv-package-duration",detailName:"first-remux-duration"},{event:W.SEGMENT,emitEvent:"first-flv-to-mp4",detailName:"first-segment-duration"},{event:[W.LOADEDDATA,W.CANPLAY],emitEvent:"first_video_frame_duration",detailName:"first-frame-duration"}],ee=function(){function e(e,t){this._complete=0,this._duration=0,this._events=void 0,this._start=0,this._lastEventTime=0,this._details={},this._eventEmitter=void 0,this._media=void 0,this._events=$.slice(0),this._eventEmitter=e,this._media=t}var t,i,r,n=e.prototype;return n.start=function(e){this._complete=0,this._start=performance.now(),this._duration=0,this._events=$.slice(0),this._lastEventTime=0,this._details={type:e,error_cnt:0},this.process(W.START,this._start)},n.process=function(e,t){if(void 0===t&&(t=0),this._complete)return!1;var i=this._events,r=-1;t=t||performance.now();for(var n=0;n<i.length;n++){var a=i[n];if(Array.isArray(a.event)){if(-1!==a.event.indexOf(e)){r=n;break}}else if(a.event===e){r=n;break}}if(-1===r)return!1;var s=i.splice(0,r+1).pop(),o="closed"===this._media.mseReadyState;if((0===i.length||o&&e===W.SEGMENT)&&(this._duration=t-this._start,this._complete=Date.now()),s){var u=Math.round(t-this._lastEventTime);0===this._lastEventTime&&(u=Date.now()),this._lastEventTime=t,this._details[s.detailName]=u,s.emitEvent&&this._eventEmitter&&this._eventEmitter.emit(l.REPORT,{type:c.PERFORMANCE,value:{type:s.emitEvent,value:u}})}return!!this._complete},n.onError=function(){this._details.error_cnt++},t=e,(i=[{key:"complete",get:function(){return this._complete}},{key:"duration",get:function(){return this._duration}},{key:"details",get:function(){return this._details}}])&&J(t.prototype,i),r&&J(t,r),e}(),te=window.performance,ie=function(){function e(){var e=this;this.tag="fps",this._lastDroppedFrames=0,this._lastDecodedFrames=0,this._video=null,this._isVideoPlaybackQualityAvailable=!1,this._lastTime=0,this._decoded=0,this._dropped=0,this._seeked=function(){e.checkFPSInterval()}}var t=e.prototype;return t.attachMedia=function(e){var t=this._video=e instanceof window.HTMLVideoElement?e:null;t&&(this._isVideoPlaybackQualityAvailable="function"==typeof t.getVideoPlaybackQuality,t.addEventListener("seeked",this._seeked))},t.destory=function(){this._video&&this._video.removeEventListener("seeked",this._seeked)},t.reset=function(){this._lastTime=te.now(),this._lastDroppedFrames=this._lastDecodedFrames=this._decoded=this._dropped=0;var e=this._video;if(e)try{if(this._isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this._lastDecodedFrames=t.totalVideoFrames,this._lastDroppedFrames=t.droppedVideoFrames}else this._lastDecodedFrames=e.webkitDecodedFrameCount,this._lastDroppedFrames=e.webkitDroppedFrameCount}catch(e){return}},t.checkFPSInterval=function(){var e=this._video,t=te.now(),i=null,r=0,n=0;if(e)if(this._isVideoPlaybackQualityAvailable){var a=e.getVideoPlaybackQuality();r=a.totalVideoFrames,n=a.droppedVideoFrames}else r=e.webkitDecodedFrameCount||0,n=e.webkitDroppedFrameCount||0;if(r){r<this._lastDecodedFrames&&(this._lastDecodedFrames=0,this._lastDroppedFrames=0);var s=t-this._lastTime,o=n-this._lastDroppedFrames,u=r-this._lastDecodedFrames,d=0,l=0;this._lastTime&&(d=parseFloat((1e3*o/s).toFixed(2)),l=parseFloat((1e3*u/s).toFixed(2))),this._decoded=this._decoded+=u,this._dropped=this._dropped+=o,this._lastTime=t,this._lastDroppedFrames=n,this._lastDecodedFrames=r,i={decoded:this._decoded,dropped:this._dropped,decodedFPS:l,droppedFPS:d}}return this._lastTime=t,i},e}(),re=0,ne=function(){var e=t.prototype;function t(){this.tag="loader",this.context=void 0,this._loader=void 0,this._callbacks=null,this._config=void 0,this._loaderCallback=void 0,this._stats=void 0,this._retryDelay=0,this._loading=!1,this._aborted=!1,this._requestTimeout=void 0,this._transTimer=void 0,this._retryTimeout=void 0,this._rangeStart=void 0,this._continuedTransmissionRetry=!1,this._progressTime=0,this.tag="loader",re++,this._loader=null,this._config={useFetch:!1,connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0},this._loaderCallback={onConnect:this._onConnect.bind(this),onProgress:this._onProgress.bind(this),onEnd:this._onEnd.bind(this),onError:this._onError.bind(this)}}return e._getInternalLoader=function(e){if(void 0!==Z)return Z;if(Z=null,h.default.msie||h.default.msedge){if(e)return s.isSupport()&&(Z=s),Z;d.isSupportChunk()?Z=d:s.isSupport()&&(Z=s)}else s.isSupport()?Z=s:d.isSupportChunk()&&(Z=d);return Z},e.load=function(e,t,i){this._init(e,t,i),this._loadInternal()},e.destroy=function(){this._stopTimer(),this._abortInternal(),this._destroyLoader(),this._callbacks=null},e._init=function(e,t,i){this.context=e,this._rangeStart=e.rangeStart,this._callbacks=t,this._config=i||this._config,this._stats={id:"",trequest:performance.now(),retry:0,loaded:0,code:0,output:0,tfirst:0,tload:0,total:0,tsload:0,tstart:0,fatal:!1,text:""},this._config.retryDelay&&(this._retryDelay=this._config.retryDelay)},e._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=null)},e._loadInternal=function(){this._loading=!0,this._aborted=!1;var e=this._stats;e.code=0,e.tfirst=0,e.loaded=0,this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this.context.progress?this._loader=new(this._getInternalLoader(!!this._config.useFetch)):this._loader=new d,this._loader&&(e.id=this._loader.tag+"-"+re,this._config.connectionTimeout&&(this._requestTimeout=setTimeout(this._onTimeout.bind(this),this._config.connectionTimeout)),this.context.rangeEnd?this.context.range="bytes="+this.context.rangeStart+"-"+(this.context.rangeEnd-1):this.context.rangeStart&&(this.context.range="bytes="+this.context.rangeStart+"-"),e.tsload=Date.now(),e.tstart=performance.now(),this._loader.load(this.context,this._loaderCallback))},e._abortInternal=function(){this._callbacks&&this._callbacks.onAbort&&!this._aborted&&this._loading&&this._callbacks.onAbort(this.context,this._stats),this._aborted=!0,this._loader&&this._loader.abort()},e.abort=function(){this._stopTimer(),this._abortInternal()},e._stopTimer=function(){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this._stopTransmissionTimer()},e._onConnect=function(e){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._startTransmissionTimer(),this._stats.code=e,this._stats.tfirst=Math.max(this._stats.trequest,performance.now())},e._onProgress=function(e,t){var i=this._stats;if(this._progressTime=performance.now(),!this._continuedTransmissionRetry&&i.output>i.loaded){if(i.loaded+t.byteLength-i.output>0){var r=t.slice(i.output-i.loaded);this._callProgress(this.context,r,i)}}else this._callProgress(this.context,t,i);i.loaded+=t.byteLength},e._callProgress=function(e,t,i){this._stats.output+=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t,i)},e._onEnd=function(e,t){this._stopTimer();var i=this._stats;i.total=t?i.loaded="string"==typeof t?t.length||0:t.byteLength||0:i.loaded,i.tload=Math.max(i.tfirst,performance.now()),this._loading=!1,i.output=0,this._callbacks&&this._callbacks.onEnd(e,t,i)},e._onError=function(e){f.Log.i(this.tag,e),this._stopTimer(),this._destroyLoader();var t=this._stats,i=this._config;this._loading=!1,t.fatal=!i.maxRetry||t.retry>=i.maxRetry||!i.maxRetry,t.text=e.message||"load error",this._callbacks&&this._callbacks.onError&&this._callbacks.onError(this.context,t),t.fatal||(this._stats.output&&this._stats.loaded>0?(this._rangeStart?this.context.rangeStart=this._rangeStart+this._stats.output:this.context.rangeStart=this._stats.output,this._continuedTransmissionRetry=!0):(this.context.rangeStart=this._rangeStart,this._continuedTransmissionRetry=!1),t.retry++,this._callbacks&&(this._retryDelay?(this._retryTimeout=setTimeout(this._loadInternal.bind(this),this._retryDelay),this._retryDelay=2*this._retryDelay):this._loadInternal()))},e._onTimeout=function(){this._loading=!1,this._abortInternal();var e=new Error("timeout");this._onError(e)},e._startTransmissionTimer=function(){var e=this;this._stopTransmissionTimer(),this._progressTime=performance.now();var t=this._config.transmissionTimeout||0;t&&(this._transTimer=setInterval((function(){performance.now()-e._progressTime>t&&e._onTimeout()}),1e3))},e._stopTransmissionTimer=function(){this._transTimer&&(clearInterval(this._transTimer),this._transTimer=null)},t}();function ae(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function se(e,t,i){return t&&ae(e.prototype,t),i&&ae(e,i),e}var oe={local:0,server:0},ue=function(){function e(){this._loader=void 0,this._callback=void 0,this._loaderConfig=void 0,this._callback={onError:this._onLoaderError.bind(this),onEnd:this._onLoaderEnd.bind(this),onAbort:this._onLoaderAbort.bind(this)},this._loaderConfig={useFetch:!1,connectionTimeout:5e3}}e.serverMs=function(e){return oe.server?e-oe.local+oe.server:null},se(e,null,[{key:"serverNowMs",get:function(){return oe.server?performance.now()-oe.local+oe.server:null}}]);var t=e.prototype;return t.update=function(e){e?oe={server:e,local:0}:this.load()},t.load=function(){this._disposeLoader();var e={url:"https://ntp.nc.gifshow.com/",responseType:"text"};(this._loader=new ne).load(e,this._callback,this._loaderConfig)},t.destroy=function(){this._disposeLoader()},t._disposeLoader=function(){this._loader&&this._loader.destroy()},t._onLoaderError=function(){this._disposeLoader()},t._onLoaderAbort=function(){},t._onLoaderEnd=function(e,t){if(this._disposeLoader(),"string"==typeof t){oe.local=performance.now();var i=t.split(",");oe.server=1e3*parseFloat(i[0])+parseInt(i[1],10)/1e3/2}},se(e,[{key:"time",get:function(){return Object(n.ObjectAssign)({},oe)}}]),e}();function de(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var le=function(){function e(){this._ntp=void 0,this._media=void 0,this._priv={keyAbstMs:0,keyPtsOrignMs:0,keyDtsOrignMs:0},this._vLastFrameInfo=void 0,this._aLastFrameInfo=void 0}var t,i,r,n=e.prototype;return n.init=function(e){this._ntp=new ue,this._media=e},n.onPrivNal=function(e){this._priv.keyAbstMs=e.abst,this._priv.keyPtsOrignMs=e.ptsOrignMs,this._priv.keyDtsOrignMs=e.timestamp},n.onParsing=function(e){e.framesInfo&&("video"===e.type?this._vLastFrameInfo=e.framesInfo[e.framesInfo.length-1]:"audio"===e.type&&(this._aLastFrameInfo=e.framesInfo[e.framesInfo.length-1]))},n.destroy=function(){this._ntp&&(this._ntp.destroy(),this._ntp=void 0)},n._renderDelay=function(e){var t=ue.serverNowMs,i=this._priv;if(t&&e&&this._media&&i.keyAbstMs){var r=1e3*this._media.currentTime;return e.ptsMs-r+t-(e.ptsOrignMs-i.keyPtsOrignMs+i.keyAbstMs)}return 0},t=e,r=[{key:"workerTimeOffset",set:function(t){e._workerStartMs=t}}],(i=[{key:"displayDelay",get:function(){return this._renderDelay(this._vLastFrameInfo)}},{key:"audioRenderDelay",get:function(){return this._renderDelay(this._aLastFrameInfo)}},{key:"recDelay",get:function(){var t=this._vLastFrameInfo;if(ue.serverNowMs&&t&&this._media){var i=this._priv;return ue.serverMs(t.parseMs+e._workerStartMs)-(t.dtsOrignMs-i.keyDtsOrignMs+i.keyAbstMs)}return 0}}])&&de(t.prototype,i),r&&de(t,r),e}();le._workerStartMs=0;var ce=le,he=["x-ks-cache","kwaisign","x-ks-request-id","x-ks-client-ip"];function fe(e){var t=function(e){var t=[];return"string"==typeof e?e.trim().split(/[\r\n]+/).forEach((function(e){var i=e.split(": "),r=i.shift(),n=i.join(":");r&&t.push([r,n])})):e&&e.forEach((function(e,i){e.split(",").forEach((function(e){t.push([i,e])}))})),t}(e),i=[];return t&&(i=[],t.forEach((function(e){-1!==he.indexOf(e[0].toLowerCase())&&i.push(e[0]+": "+e[1].slice(0,255))}))),i.length?(i.slice(0,10),i):null}var _e=function(){function e(e,t){this._data=void 0,this._config=void 0,this._snapshot=void 0,this._tickIndex=1,this._statTimestampMillis=0,this._statTimestampMillisUTC=0,this._firstScreen=!0,this._firstScreenDetails=void 0,this._firstScreenDuration=null,this._clickToFirstFrame=void 0,this._customeHttpHeader=void 0,this._errorCode=0,this._errorMessage="",this._data=e,this._config=t,this._tickIndex=1,this._snapshot={play:0,pause:0,buffer:0,blockCount:0,pauseCnt:0,renderBlockCount:0,seekCnt:0,seekLoadCnt:0,decodedFrames:0,droppedFrames:0,downloadedBytes:0,cdnDropFrameCnt:0,cdnDropFrameDuration:0,download:0,mseUpdate:0,mseRemove:0,segment:0,preloadCount:0},this._resetForNewInterval()}var t=e.prototype;return t._updateSnapshot=function(e){var t={};for(var i in this._snapshot)"number"==typeof e[i]&&(t[i]=e[i]-this._snapshot[i],this._snapshot[i]=e[i]);return t},t._resetForNewInterval=function(){this._statTimestampMillis=performance.now(),this._statTimestampMillisUTC=Date.now(),this._customeHttpHeader=void 0,this._firstScreenDuration=null,this._firstScreenDetails=void 0,this._clickToFirstFrame=void 0,this._errorCode=0,this._errorMessage=""},t.setFirstScreenDuration=function(e,t,i){this._firstScreenDuration=Math.round(e),this._firstScreenDetails=t,this._firstScreen=!0,this._clickToFirstFrame=i},t.setCustomHeader=function(e){void 0===this._customeHttpHeader&&(this._customeHttpHeader=fe(e)||null)},t.setError=function(e,t){this._errorCode=e,this._errorMessage=t},t.buildAndStartNewInterval=function(e){var t=this._data,i=this._config,r=this._updateSnapshot(t),a=this._updateSnapshot(e),s=performance.now(),o={skip_cnt:r.cdnDropFrameCnt,skip_duration:r.cdnDropFrameDuration,v_rec_delay:e.recDelay||0,v_render_delay:e.displayDelay||0,a_render_delay:e.audioRenderDelay||0},u={load_count:r.download,seek_cnt:r.seekCnt,seek_load_cnt:r.seekLoadCnt,pause_duration:a.pause,pause_cnt:r.pauseCnt,preload_cnt:r.preloadCount},d={tick_index:this._tickIndex,tick_start:this._statTimestampMillisUTC,tick_duration:Math.round(s-this._statTimestampMillis),domain:new F.a(t.url).host,error_code:this._errorCode,error_message:this._errorMessage,kernel_version:t.version,session_id:t.sessionId,play_url:t.url,load_start_time:t.loadStartTime||0,play_start_time:t.playStartTime||0,adaptive_multi_rate:t.abrNow?1:0,max_bitrate:t.maxBitrate||0,avg_bitrate:t.avg_bitrate||0,protocol:t.protocol,stream_duration:t.streamDuration||0,reuse:t.reuse,kbytes_received:r.downloadedBytes>>10,block_count:r.blockCount||0,render_block_count:r.renderBlockCount||0,decoded_video_frames:r.decodedFrames||0,dropped_video_frames:r.droppedFrames||0,mse_update_count:r.mseUpdate||0,mse_remove_count:r.mseRemove||0,segment_count:r.segment||0,play_duration:a.play||0,buffer_time:a.buffer||0,actual_play_duration:a.play&&a.buffer?a.play-a.buffer:0,played_video_duration:e.play||0,a_buf_start:e.aBufStart||0,a_buf_end:e.aBufEnd||0,a_buf_len:e.aBufLen||0,a_buf_slices:e.aBufCount||0,v_buf_start:e.vBufStart||0,v_buf_end:e.vBufEnd||0,v_buf_len:e.vBufLen||0,v_buf_slices:e.vBufCount||0,play_pos:e.currentTime||0,v_data_rate:e.vDataRate||0,a_data_rate:e.aDataRate||0,buffer_queue_count:e.bufferQueueCount||0,hidden:Q()?1:0,v_ready_state:e.videoReadyState};return this._firstScreen&&(null===this._firstScreenDuration?d.first_screen_total_duration=0:(d.first_screen_total_duration=this._firstScreenDuration,d.first_screen_details=this._firstScreenDetails,"hls"===i.box&&(d.preload_hit=t.preloadHit,d.preload_cache_hit=t.preloadCacheHit,d.preload_cache_fail=t.preloadCacheFail),this._firstScreenDetails=null,this._firstScreenDuration=null,this._firstScreen=!1)),"number"==typeof this._clickToFirstFrame&&t.playStartTime&&(d.click_to_first_frame=this._clickToFirstFrame,this._clickToFirstFrame>0&&(this._clickToFirstFrame=void 0)),this._customeHttpHeader&&(d.custom_http_header=this._customeHttpHeader),t.qualityType&&(d.quality_type=t.qualityType),t.qualityLabel&&(d.quality_label=t.qualityLabel),t.avgBitrate&&(d.avg_bitrate=t.avgBitrate),"flv"===i.box?Object(n.ObjectAssign)(d,o):Object(n.ObjectAssign)(d,u),this._resetForNewInterval(),this._tickIndex++,d},e}();function pe(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ve,me=function(){function e(){this._qos=void 0,this.reset()}var t,i,r,a=e.prototype;return a.reset=function(){this._qos={traffic:0,streams:[],download:[]}},a.onKeyFrame=function(){this._qos.streams[this._qos.streams.length-1].keyFrame++},a.onStreamOpen=function(e,t,i,r){this._qos.streams.length>10&&this._qos.streams.shift(),this._qos.streams.push({index:e,startPos:t,url:i,bitrate:r,traffic:0,loadTimeCost:0,keyFrame:0,videoDataRate:0,audioDataRate:0,segments:{}})},a.onMediaInfo=function(e){var t=this.loadingInfo;t&&(t.mediaInfo=Object(n.ObjectAssign)({},e))},a.onDataReceive=function(e){this._qos.traffic+=e.byteLength;var t=this._qos.download;t.length>200&&t.pop(),t.unshift(e);var i=this._qos.streams[this._qos.streams.length-1];i.traffic+=e.byteLength,i.loadTimeCost+=e.timeCost},a.onMediaSegment=function(e){var t=this._qos,i=t.streams[t.streams.length-1],r=i.segments[e.type]||[];i.segments[e.type]=r,r.push({duration:e.duration,dts:e.dts,len:e.byteLength}),r.length>100&&r.shift();for(var n=0,a=0,s=0;s<r.length;s++)a+=r[s].len,n+=r[s].duration;n>0&&("video"===e.type?i.videoDataRate=Math.round(8*a/n):"audio"===e.type&&(i.audioDataRate=Math.round(8*a/n)))},a.getInfoByTime=function(e){for(var t=this._qos.streams.length-1;t>=0;t--)if(this._qos.streams[t].startPos<e)return this._qos.streams[t];return null},a.updateStartPos=function(e){this._qos.streams.length&&(this._qos.streams[this._qos.streams.length-1].startPos=e)},t=e,(i=[{key:"loadingInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1]:null}},{key:"downloadSpeed",get:function(){for(var e=this._qos,t=performance.now(),i=0,r=0,n=0;n<e.download.length&&e.download[n].ts>t-1e3;n++)i+=e.download[n].byteLength,r+=e.download[n].timeCost;return Math.round(i/r*1e3)||0}},{key:"mediaInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].mediaInfo:null}},{key:"videoDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].videoDataRate:0}},{key:"audioDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].audioDataRate:0}},{key:"bitrate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].bitrate:0}},{key:"traffic",get:function(){return this._qos.traffic}},{key:"data",get:function(){return this._qos}}])&&pe(t.prototype,i),r&&pe(t,r),e}();function ge(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.NORMEL="normal",e.SEEK="seek",e.END="end",e.LEVEL_SWITCH="levelSwitch"}(ve||(ve={}));var ye,be=function(e){var t,i;function r(t,i,r){var n;return(n=e.call(this)||this)._version=void 0,n._config=void 0,n._beaconTimer=void 0,n._runningStartTime=void 0,n._media=void 0,n._fps=void 0,n._firstFrame=void 0,n._data=void 0,n._realtimeBeacon=void 0,n._firstLoadTime=0,n._hiddenStart=!1,n._playing=!1,n._sm=void 0,n._seekLoadFlag=!1,n._liveDelay=void 0,n._version=t,n._config=r,n._beaconTimer=null,n._runningStartTime=performance.now(),n._firstFrame=new ee(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),i),n._sm=new me,n._media=i,i.video&&(n._fps=new ie,n._fps.attachMedia(i.video)),r.isLive&&r.box===u.flv&&(n._liveDelay=new ce,n._liveDelay.init(i)),n.reset(),n}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a,s,d,h=r.prototype;return h.reset=function(e){var t;void 0===e&&(e=!1),this._data=(void 0===(t=this._version)&&(t=""),{version:t,decodedFPS:0,droppedFPS:0,decodedFrames:0,droppedFrames:0,sessionId:Object(X.v4)(),startTime:performance.now(),loadStartTime:0,playStartTime:0,playDuration:0,pauseDuration:0,pauseCnt:0,bufferTime:0,blockCount:0,renderBlockCount:0,streamDuration:0,seekCnt:0,seekDuration:0,seekLoadCnt:0,seekLoadDuration:0,seekStartTime:0,recoverMedia:0,flvLiveRetry:0,urlId:0,url:"",unknownTSPacketCount:0,audioNonMonotonous:0,startBitrate:0,smoothBitrate:-1,useBackup:0,abrAlgorithm:0,abrLowProfile:0,abr:!1,mseBufferFull:0,aacOverhead:0,protocol:o.UNKNOWN,errorCode:0,errorMessage:"",maxBitrate:0,downloadedBytes:0,cdnDropFrameCnt:0,cdnDropFrameDuration:0,download:0,mseUpdate:0,segment:0,mseRemove:0,preloadHit:0,preloadCount:0,preloadCacheHit:0,preloadCacheFail:0,reuse:0,videoReadyState:0}),this._data.reuse=e?1:0,this._sm.reset(),this._fps&&this._fps.reset(),this.refresh()},h.onReport=function(e){var t=this;e.ts=e.ts||performance.now();var i=this._data;switch(e.type){case V.REPORT_TYPES.LOADER_CHUNK_ARRIVAL:i.downloadedBytes+=e.byteLength,this._sm.onDataReceive(e),this._realtimeBeacon&&this._realtimeBeacon.setCustomHeader(e.header),this._processFirstFrame(W.DATA,e.ts);break;case V.REPORT_TYPES.MEDIA_DEMUX:this._processFirstFrame(W.DEMUX,e.ts);break;case V.REPORT_TYPES.LIVE_ADAPTIVE_QOS_STAT:e.bitrate_playing=this.playingInfo?this.playingInfo.bitrate:0,e.bitrate_downloading=this.loadingInfo?this.loadingInfo.bitrate:0,e.extra?e.extra.session_id=i.sessionId:e.extra={session_id:i.sessionId},this.emit(l.REPORT,{type:c.LIVE_STREAM_ADAPTIVE_QOS_STAT,value:e});break;case V.REPORT_TYPES.HLS_VOD_ADAPTIVE_QOS_STAT:delete e.type,delete e.ts,e.session_id=i.sessionId,this.emit(l.REPORT,{type:c.HLS_VOD_ADAPTIVE_QOS_STAT,value:e});break;case V.REPORT_TYPES.MUX_INFO:i.unknownTSPacketCount=i.unknownTSPacketCount||e.unknownTSPacketCount,i.audioNonMonotonous=i.audioNonMonotonous||e.audioNonMonotonous,i.aacOverhead=i.aacOverhead||e.aacOverhead;break;case V.REPORT_TYPES.NEW_SOURCE:e.urlId&&(i.urlId=e.urlId),this._sm.onStreamOpen(e.index||0,e.sync,e.url,e.bitrate),i.level=e.index,i.maxBitrate=e.maxBitrate,i.avgBitrate=e.avgBitrate,i.qualityType=e.qualityType,i.qualityLabel=e.qualityLabel,i.protocol===o.UNKNOWN&&(i.protocol="flv"===this._config.box?o.FLV:o.HLS);break;case V.REPORT_TYPES.KEY_FRAME:this._sm.onKeyFrame();break;case V.REPORT_TYPES.DISCONTINUITY:this.emit(l.REPORT,{type:c.DISCONTINUITY,value:e});break;case V.REPORT_TYPES.DOWNLOAD:if(e.cacheHit)return void(e.preload||(i.preloadCacheHit=1));i.preloadCacheFail=e.cacheFail?1:0,e.errorCode&&!this._firstFrame.complete&&this._firstFrame.onError(),i.download++;var r=function(e){var t;return"flv"===e.resourceType?t={domain:new F.a(e.url).host,downloaded_size:e.byteLength,error_code:e.errorCode,load_status:e.status,network_cost:Math.round(e.spendTime),resource_type:"flv",total_size:e.byteLength,url:e.url}:(t={download_url:e.url,domain:new F.a(e.url).host,download_start_time:e.startTime,download_spend_time:Math.round(e.spendTime),download_status:e.status,http_status_code:e.httpStatusCode,retry_index:e.retry,error_code:e.errorCode,error_message:e.errorMessage,loader_id:e.loaderId,download_size:e.byteLength,resource_type:e.resourceType,preload:e.preload?1:0},e.slice&&(t.hls_slice_bytes=e.byteLength,t.hls_slice_play_start_time=e.slicePlayStartTime,t.hls_slice_play_duration=e.slicePlayDuration,t.hls_slice_index=e.sliceIndex,e.sliceLevelIndex&&(t.hls_slice_level_index=e.sliceLevelIndex,t.hls_slice_bitrate=e.sliceBitrate)),"number"==typeof e.rangeStart&&(t.range_start=e.rangeStart),e.rangeEnd&&(t.range_end=e.rangeEnd)),e.httpResponseTime&&(t.http_response_time=e.httpResponseTime),e.customHeader&&(t.custom_http_header=e.customHeader),void 0!==e.redirect&&(t.time_redirect=Math.round(e.redirect)),void 0!==e.dns&&(t.time_dns=Math.round(e.dns)),void 0!==e.tcp&&(t.time_tcp=Math.round(e.tcp)),void 0!==e.request&&(t.time_request=Math.round(e.request)),void 0!==e.firstResponse&&(t.time_first_response=Math.round(e.firstResponse)),void 0!==e.response&&(t.time_response=Math.round(e.response)),e.duration&&(t.duration=Math.round(e.duration)),t}(e);r.session_id=i.sessionId,r.kernel_version=this._version,r.load_start_time=i.loadStartTime||0,r.protocol=i.protocol,r.use_backup=i.useBackup,r.first_screen=i.firstScreenTotalDuration?1:0,1009===e.errorCode?setTimeout((function(){t.emit(l.REPORT,{type:c.DOWNLOAD,value:r})}),0):this.emit(l.REPORT,{type:c.DOWNLOAD,value:r});break;case V.REPORT_TYPES.LOST_FRAMES:i.cdnDropFrameCnt++,i.cdnDropFrameDuration+=Math.round(e.drop);break;case V.REPORT_TYPES.USE_BACKUP:i.useBackup=1;break;case V.REPORT_TYPES.ABR_INIT:i.abrAlgorithm=e.algorithm,i.abrLowProfile=e.lowProfile;break;case V.REPORT_TYPES.ABR_LOW_PROFILE:i.abrLowProfile=1}},h.heartbeat=function(){this.refresh();var e=this._data,t=this._sm,i={totalReceive:t.traffic,speed:t.downloadSpeed,videoDataRate:t.videoDataRate,audioDataRate:t.audioDataRate,decodedFPS:e.decodedFPS,droppedFPS:e.droppedFPS,decodedFrames:e.decodedFrames,droppedFrames:e.droppedFrames};this._refreshDelay(),this.emit(l.REPORT,{type:c.HEARTBEAT,value:i})},h.refresh=function(){var e;this._fps&&(e=this._fps.checkFPSInterval());var t=this._data;e?(t.decodedFPS=e.decodedFPS,t.droppedFPS=e.droppedFPS,t.droppedFrames=e.dropped,t.decodedFrames=e.decoded):t.decodedFPS=t.droppedFPS=t.droppedFrames=t.decodedFrames=0},h.destroy=function(){this._sendRealtimeBeacon(ve.END),this._stopBeaconTimer(),this._fps&&(this._fps.destory(),this._fps=void 0)},h.onPreloadHit=function(e){this._data.loadStartTime=Date.now(),this._data.preloadHit=1,this._firstLoadTime||(this._firstLoadTime=performance.now(),this._hiddenStart=Q()),this._data.url=e,this._firstFrame.start(q.FIRST_FRAME),this._realtimeBeacon=new _e(this._data,this._config),this._startBeaconTimer()},h.onPreload=function(){this._data.preloadCount++},h.onLoad=function(e,t){void 0===t&&(t=!1),t||(this._data.loadStartTime=Date.now(),this._firstFrame.start(q.FIRST_FRAME),this._firstLoadTime||(this._firstLoadTime=performance.now(),this._hiddenStart=Q()),this._data.url=e,this._realtimeBeacon=new _e(this._data,this._config))},h.onStopLoad=function(){this._sendRealtimeBeacon(ve.END),this._stopBeaconTimer()},h.onManifest=function(e,t,i,r,n){void 0===n&&(n=0),e&&(this._data.url=e),this._data.protocol=t,this._data.startBitrate||(this._data.startBitrate=i),this._data.abrNow=this._data.abr=this._data.abr||r,this._processFirstFrame(W.MANIFEST,n)},h.onLevel=function(e){void 0===e&&(e=0),this._processFirstFrame(W.LEVEL,e)},h.onSegmentInit=function(e){this._sm.onMediaInfo(e)},h.onSegment=function(e){this._liveDelay&&this._liveDelay.onParsing(e),this._sm.onMediaSegment(e),this._processFirstFrame(W.SEGMENT,e.ts),this._data.segment++},h.onPrivNal=function(e){this._liveDelay&&this._liveDelay.onPrivNal(e)},h.onPlay=function(){this._data.playStartTime||(this._data.playStartTime=Date.now()),this._startBeaconTimer()},h.onLoadeddata=function(){this._processFirstFrame(W.LOADEDDATA),this._waitingEnd()},h.onCanplay=function(){this._processFirstFrame(W.CANPLAY),this._waitingEnd()},h.onPlaying=function(){this._playing=!0,this._playStart(),this._pauseEnd(),this._waitingEnd()},h.onPause=function(){this._playEnd(),this._pauseStart()},h.onEnd=function(){this._playEnd(),this._pauseEnd(),this._waitingEnd(),this._sendRealtimeBeacon(ve.END),this._stopBeaconTimer()},h.onWaiting=function(e,t){this._playing&&this._firstFrame.complete&&e&&this._waitingStart(t)},h.mseUpdate=function(){this._data.mseUpdate++},h.mseRemove=function(){this._data.mseRemove++},h.onSeek=function(e){void 0===e&&(e=!1),this._config.isLive||e||(this._data.seekStartTime=performance.now())},h.onSeekWithLoad=function(e){this._sendRealtimeBeacon(ve.SEEK),this._resetBeaconTimer(),this._firstFrame.start(q.FIRST_FRAME_SEEK),this._sm.updateStartPos(e),this._seekLoadFlag=!0},h.onSeeked=function(){if(this._data.seekStartTime){this._data.seekCnt++;var e=Math.round(performance.now()-this._data.seekStartTime);this._data.seekDuration+=e,this._data.seekStartTime=0,this._seekLoadFlag&&(this._data.seekLoadCnt++,this._data.seekLoadDuration+=e)}this._seekLoadFlag=!1},h.onMSEBufferFull=function(){this._data.mseBufferFull++},h.mediaCapabilities=function(e){this._data.smoothBitrate=e},h.recoverMedia=function(){this._data.recoverMedia++},h.flvLiveRetry=function(){this._data.flvLiveRetry++},h.levelSwitching=function(e,t){e&&(this._data.url=e),this._data.abrNow=t,this._data.abr=this._data.abr||t},h.selectBitrate=function(){this._sendRealtimeBeacon(ve.LEVEL_SWITCH),this._resetBeaconTimer(),this._firstFrame.start(q.FIRST_FRAME_SELECT_BITRATE)},h.onDurationChange=function(e){this._data.streamDuration=Math.round(1e3*e)},h.onRateChange=function(e){},h.onError=function(e,t){this._data.errorCode=e,this._data.errorMessage=t,this._realtimeBeacon&&this._realtimeBeacon.setError(e,t)},h._getRealtimeDuration=function(){var e=this._data;return{play:Math.round(e.playDuration+(e.playStartMS?performance.now()-e.playStartMS:0)),pause:Math.round(e.pauseDuration+(e.pauseStartMS?performance.now()-e.pauseStartMS:0)),buffer:Math.round(e.bufferTime+(e.bufferingStartMS?performance.now()-e.bufferingStartMS:0))}},h._getRealtimeBeacon=function(){if(!this._realtimeBeacon)return null;var e=this._sm,t=this._media,i=t.mseBufferedSecByType("video"),r=t.mseBufferedSecByType("audio"),a=t.currentTime,s=this._getRealtimeDuration(),o={play:0,pause:0,buffer:0,aBufStart:Math.round(1e3*r.start),aBufEnd:Math.round(1e3*r.end),aBufLen:Math.round(1e3*Math.max(0,r.end-a)),aBufCount:t.bufferSliceNumByType("audio"),vBufStart:Math.round(1e3*i.start),vBufEnd:Math.round(1e3*i.end),vBufLen:Math.round(1e3*Math.max(0,i.end-a)),vBufCount:t.bufferSliceNumByType("video"),aDataRate:Math.round(e.audioDataRate),vDataRate:Math.round(e.videoDataRate),currentTime:Math.round(1e3*a),bufferQueueCount:t.pendingNum(),videoReadyState:t.videoReadyState};return this._refreshDelay(),Object(n.ObjectAssign)(o,s),this.refresh(),this._realtimeBeacon.buildAndStartNewInterval(o)},h._processFirstFrame=function(e,t){void 0===t&&(t=0),!this._firstFrame.complete&&this._firstFrame.process(e,t)&&this._onFirstFrame()},h._playStart=function(){this._data.playStartMS=this._data.playStartMS||performance.now()},h._playEnd=function(){this._data.playStartMS&&(this._data.playDuration+=performance.now()-this._data.playStartMS),this._data.playStartMS=null},h._pauseStart=function(){this._data.pauseCnt++,this._data.pauseStartMS=this._data.pauseStartMS||performance.now()},h._pauseEnd=function(){this._data.pauseStartMS&&(this._data.pauseDuration+=performance.now()-this._data.pauseStartMS),this._data.pauseStartMS=null},h._waitingStart=function(e){this._data.bufferingStartMS||(this._data.blockCount++,this._data.bufferingStartMS=this._data.bufferingStartMS||performance.now(),e>.6&&this._data.renderBlockCount++)},h._waitingEnd=function(){this._data.bufferingStartMS&&(this._data.bufferTime+=performance.now()-this._data.bufferingStartMS),this._data.bufferingStartMS=null},h._onFirstFrame=function(){var e=this._data;e.firstScreenTotalDuration=e.firstScreenTotalDuration||Math.round(this._firstFrame.duration),e.firstScreenDetails=e.firstScreenDetails||this._firstFrame.details,e.playStartTime&&this._firstFrame.complete?e.clickToFirstFrame=Math.max(1,this._firstFrame.complete-e.playStartTime):e.clickToFirstFrame=1,this._realtimeBeacon&&this._realtimeBeacon.setFirstScreenDuration(this._firstFrame.duration,this._firstFrame.details,e.clickToFirstFrame)},h._startBeaconTimer=function(){null===this._beaconTimer&&(this._beaconTimer=setInterval(this._sendRealtimeBeacon.bind(this),1e4))},h._stopBeaconTimer=function(){this._beaconTimer&&(clearTimeout(this._beaconTimer),this._beaconTimer=null)},h._resetBeaconTimer=function(){this._stopBeaconTimer(),this._startBeaconTimer()},h._sendRealtimeBeacon=function(e){void 0===e&&(e=ve.NORMEL);var t=this._getRealtimeBeacon();t&&(t.type=e,this.emit(l.REPORT,{type:c.REALTIME_BEACON,value:t}))},h._refreshDelay=function(){var e=this._liveDelay,t=this._data;e&&(t.displayDelay=Math.round(e.displayDelay),t.recDelay=Math.round(e.recDelay),t.audioRenderDelay=Math.round(e.audioRenderDelay))},a=r,(s=[{key:"sid",get:function(){return this._data.sessionId}},{key:"playingInfo",get:function(){return this._sm.getInfoByTime(this._media.currentTime)}},{key:"loadingInfo",get:function(){return this._sm.loadingInfo}},{key:"snapshot",get:function(){var e=this._sm,t={downloadSpeed:this._sm.downloadSpeed,videoDataRate:e.videoDataRate,audioDataRate:e.audioDataRate};return Object(n.ObjectAssign)(t,this._data,this._sm.data)}},{key:"data",get:function(){return this._data}},{key:"audienceStat",get:function(){var e=this._data,t=this._sm,i="",r=this.loadingInfo;r&&r.mediaInfo&&(i=(r.mediaInfo.videoCodec||"")+","+(r.mediaInfo.audioCodec||""));var n=this._getRealtimeDuration(),a={session_id:e.sessionId,kernel_version:this._version,load_start_time:e.loadStartTime,play_start_time:e.playStartTime,play_duration:n.play,actual_play_duration:n.play-n.buffer,traffic:t.traffic>>10,buffer_time:n.buffer,block_cnt:e.blockCount,render_block_cnt:e.renderBlockCount,stream_duration:e.streamDuration,play_url:e.url,stream_host:new F.a(e.url).host,click_to_first_frame:e.playStartTime&&e.clickToFirstFrame||0,first_screen_total_duration:Math.round(e.firstScreenTotalDuration)||0,first_screen_details:e.firstScreenDetails||this._firstFrame.details||null,error_code:e.errorCode||0,error_message:e.errorMessage||"",remux_process_type:(this._config.streamingMux?1:0)+(this._config.gopRemux?1:0),hidden_start:this._hiddenStart?1:0,adaptive_multi_rate:this._config.adaptive?1:0,current_running_time:Math.round(performance.now()-e.startTime),running_time:Math.round(performance.now()-this._runningStartTime),codec:i,recover_media:e.recoverMedia,protocol:e.protocol,smooth_bitrate:e.smoothBitrate,start_bitrate:e.startBitrate||0,use_backup:e.useBackup,abr_algorithm:e.abrAlgorithm,abr:e.abr?1:0,abr_low_profile:e.abrLowProfile,mse_buffer_full:e.mseBufferFull,mse_remove:e.mseRemove,max_bitrate:e.maxBitrate,reuse:e.reuse,play_pos:Math.round(1e3*this._media.currentTime),pause_cnt:e.pauseCnt};return this._config.isLive?(a.skip_cnt=e.cdnDropFrameCnt,a.skip_duration=e.cdnDropFrameDuration,a.flv_live_retry=e.flvLiveRetry):(a.pause_duration=n.pause,a.seek_cnt=e.seekCnt,a.seek_duration=e.seekDuration,a.seek_load_cnt=e.seekLoadCnt,a.seek_load_duration=e.seekLoadDuration,a.start_sec=Math.round(this._config.startFromSec)),this._config.box===u.hls&&(a.url_id=e.urlId,a.unknown_ts_packet_count=e.unknownTSPacketCount,a.audio_non_monotonous=e.audioNonMonotonous,a.aac_overhead=e.aacOverhead,a.preload_hit=e.preloadHit,a.preload_cache_hit=e.preloadCacheHit,a.preload_cache_fail=e.preloadCacheFail,a.preload_cnt=e.preloadCount,a.db_quota_exceeded=K?K.quotaExceeded:0),e.qualityType&&(a.quality_type=e.qualityType),e.qualityLabel&&(a.quality_label=e.qualityLabel),e.avgBitrate&&(a.avg_bitrate=e.avgBitrate),a}}])&&ge(a.prototype,s),d&&ge(a,d),r}(a.EventEmitter),Ee=i("./node_modules/@ks/adaptive-multi-rate/lib/adaptive-hls.js"),Se=i.n(Ee),Te=i("./src/core/observer.ts"),we={400:"01",401:"02",403:"03",404:"04",other4xx:"05",serverError:"06",timeoutOpen:"07",timeoutIO:"08",200:"09",206:"09"};function Le(e,t,i){if(void 0===i&&(i=0),e>=100)return e;var r="00";return"timeout"===t?r=i?we.timeoutIO||r:we.timeoutOpen||r:we.hasOwnProperty(i)?r=we[i]||r:/^4\d{2}$/.test(i.toString())?r=we.other4xx||r:/^5\d{2}$/.test(i.toString())&&(r=we.serverError||r),parseInt(e+r,10)}function Re(){performance&&("function"==typeof performance.clearResourceTimings?performance.clearResourceTimings():"function"==typeof performance.webkitClearResourceTimings&&performance.webkitClearResourceTimings())}function xe(e,t,i,r,a){void 0===a&&(a=!1);var s={type:V.REPORT_TYPES.DOWNLOAD,url:t.url,startTime:i.tsload,spendTime:i.tload?Math.round(i.tload-i.tstart):Math.round(performance.now()-i.tstart),httpResponseTime:i.tfirst?Math.round(i.tfirst-i.tstart):0,status:e,httpStatusCode:i.code,retry:i.retry,errorCode:0,errorMessage:"",loaderId:i.id,byteLength:i.total||i.loaded||0,resourceType:t.type||"",preload:a,cacheHit:!!i.cacheHit,cacheFail:!!i.cacheFail},o=t.frag;if(o&&(s.slice=!0,s.slicePlayStartTime=Math.round(1e3*o.start),s.slicePlayDuration=Math.round(1e3*o.duration),s.sliceIndex=o.sn,s.sliceLevelIndex=o.level,r&&r[o.level]&&(s.sliceBitrate=r[o.level].bitrate)),e===ye.FAIL&&(s.errorCode=Le(O.ErrorDetails.LOAD_ERROR,i.text,i.code)),i.text&&(s.errorMessage=i.text),t.responseHeader){var u=fe(t.responseHeader);u&&(s.customHeader=u)}s.rangeStart=t.rangeStart,s.rangeEnd=t.rangeEnd;var d=function(e){if(performance&&"function"==typeof performance.getEntriesByName){var t=performance.getEntriesByName(e,"resource");if(t.length){var i=t[t.length-1],r={};return i.redirectStart&&(r.redirect=i.redirectEnd-i.redirectStart),r.dns=i.domainLookupEnd-i.domainLookupStart,r.tcp=i.connectEnd-i.connectStart,r.request=i.requestStart-i.connectEnd,r.firstResponse=i.responseStart-i.requestStart,i.responseStart>0?r.response=i.responseEnd-i.responseStart:r.response=i.responseEnd-i.fetchStart,r.duration=i.duration||0,r}}return null}(t.url);return d&&Object(n.ObjectAssign)(s,d),s}function ke(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Ae(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Oe(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.FAIL="FAIL",e.ABORT="ABORT",e.SUCCESS="SUCCESS"}(ye||(ye={}));var Pe={speedPredictRatioOnStart:6},De=function(e){var t,i;function r(t,i){var r;return(r=e.call(this)||this)._config=void 0,r._media=void 0,r._algorithm=void 0,r._info=void 0,r._activity=!1,r._downloadEnd=void 0,r._downloadStartTime=0,r._index=0,r._config=t,r._media=i,Se.a.setLogLevel(t.kwaiKernelLog),r._downloadEnd=0,r}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,a,s,o=r.prototype;return o.init=function(e){return this._info=e,this._index=e.index,this._activity=!!(this._config.adaptive&&e.levels.length>1),this._activity?(this._algorithm=new Se.a(e,this._config.hlsAdaptiveConfig||Pe),this._index=this._algorithm.bitrateInit()||0,this.trigger(P.default.REPORT,{type:V.REPORT_TYPES.ABR_INIT,algorithm:this._algorithm.algorithm,lowProfile:this._algorithm.lowProfile?1:0})):this.active(!1),this._index||0},o.setAvailableAbrLevels=function(e){this._algorithm&&this._algorithm.setAvailableBitrates(e)},o.destory=function(){this._algorithm&&(this._algorithm.removeAllListeners(),this._algorithm=void 0)},o.onRatechange=function(e){this._algorithm&&this._algorithm.onRatechange(e)},o.onWaiting=function(){this._algorithm&&(this._algorithm.onWaiting({buffered:1e3*this._media.bufferedSec()}),this._algorithm.lowProfile&&this.trigger(P.default.REPORT,{type:V.REPORT_TYPES.ABR_LOW_PROFILE}))},o.onMessage=function(e,t){if(this._algorithm&&this._info)switch(e){case P.default.REPORT:if(t.type===V.REPORT_TYPES.DOWNLOAD){if(Object(C.isFiniteNumber)(t.slicePlayStartTime)&&t.status===ye.SUCCESS){this._downloadEnd=t.slicePlayStartTime+t.slicePlayDuration;var i={buffered:this._downloadEnd-1e3*this._media.currentTime,duration:t.duration||0,spendTime:t.spendTime,byteLength:t.byteLength};this._algorithm.onDownload(i)}}else if(t.type===V.REPORT_TYPES.NEW_SOURCE)this._downloadStartTime=this._downloadStartTime||performance.now(),this._info&&t.index>=0&&t.index<this._info.levels.length&&(this._index=t.index),this._algorithm.onLevelLoad(t.index);else if(t.type===V.REPORT_TYPES.SEEK){var r={isInBuffer:t.isInBuffer,buffered:this._downloadEnd-1e3*this._media.currentTime};this._algorithm.onSeek(r)}}},o.active=function(e){this._activity=e},o.nextBitrateIndex=function(){if(this._sendAdaptiveQosStat(),this._activity&&this._info&&this._info.levels.length>1&&this._algorithm){var e=this._algorithm.nextIndex;if(e!==this._index&&e>=0&&e<this._info.levels.length)return e}return this._index},o.setDownloadEnabled=function(e){this._algorithm&&this._algorithm.onDownloadEnabled(e)},o._sendAdaptiveQosStat=function(){if(this._algorithm&&this._algorithm.beacon){var e=this._algorithm.qos,t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ke(i,!0).forEach((function(t){Ae(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ke(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({type:V.REPORT_TYPES.HLS_VOD_ADAPTIVE_QOS_STAT},e);this.trigger(P.default.REPORT,t)}},n=r,(a=[{key:"autoLevelEnabled",get:function(){return!!this._activity}}])&&Oe(n.prototype,a),s&&Oe(n,s),r}(Te.default),Ie={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function Ce(e,t){return void 0===t&&(t=""),N().isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}function Ne(e,t,i){var r=e[t],n=e[i],a=n.startPTS;Object(C.isFiniteNumber)(a)?i>t?(r.duration=a-r.start,r.duration<0&&f.Log.w("LevelHelper","negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(n.duration=r.start-a,n.duration<0&&f.Log.w("LevelHelper","negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):n.start=i>t?r.start+r.duration:Math.max(r.start-n.duration,0)}function Me(e,t,i,r,n,a){var s=i;if(Object(C.isFiniteNumber)(t.startPTS)){var o=Math.abs(t.startPTS-i);Object(C.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(o,t.deltaPTS):t.deltaPTS=o,s=Math.max(i,t.startPTS),i=Math.min(i,t.startPTS),r=Math.max(r,t.endPTS),n=Math.min(n,t.startDTS),a=Math.max(a,t.endDTS)}var u=i-t.start;t.start=t.startPTS=i,t.maxStartPTS=s,t.endPTS=r,t.startDTS=n,t.endDTS=a,t.duration=r-i;var d,l=t.sn;if(!e||l<e.startSN||l>e.endSN||"number"!=typeof l)return 0;var c=l-e.startSN,h=e.fragments;for(h[c]=t,d=c;d>0;d--)Ne(h,d,d-1);for(d=c;d<h.length-1;d++)Ne(h,d,d+1);return e.PTSKnown=!0,u}function Ue(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var i,r=0;if(Be(e,t,(function(e,n){r=e.cc-n.cc,Object(C.isFiniteNumber)(e.startPTS)&&(n.start=n.startPTS=e.startPTS,n.endPTS=e.endPTS,n.duration=e.duration,n.backtracked=e.backtracked,n.dropped=e.dropped,i=n),t.PTSKnown=!0})),t.PTSKnown){if(r){f.Log.v("LevelHelper","discontinuity sliding from playlist, take drift into account");for(var n=t.fragments,a=0;a<n.length;a++)n[a].cc+=r}i?Me(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):function(e,t){var i=t.startSN-e.startSN,r=e.fragments,n=t.fragments;if(!(i<0||i>r.length))for(var a=0;a<n.length;a++)n[a].start+=r[i].start}(e,t),t.PTSKnown=e.PTSKnown}}function Be(e,t,i){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,s=r;s<=n;s++){var o=e.fragments[a+s],u=t.fragments[s];if(!o||!u)break;i(o,u,s)}}function Fe(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ve=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url="",this.urlId=0,this.version=null,this.details=null,this.PTSKnown=!1,this.m3u8=void 0,this.m3u8Slice=void 0,this.width=void 0,this.height=void 0,this.bitrate=0,this.bandwidth=0,this.averageBandwidth=0,this.alwaysRetryLiveLevel=!0,this.audioGroupIds=void 0,this.textGroupIds=void 0,this.audioCodec="",this.videoCodec="",this.attrs=void 0,this.averagetargetduration=void 0,this.unknownCodecs=void 0,this.name=void 0,this.qualityType=void 0,this.qualityLabel=void 0,this.url=e}var t,i,r;return t=e,(i=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||"number"!=typeof this.fragments[0].programDateTime||!Object(C.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&Fe(t.prototype,i),r&&Fe(t,r),e}(),je=i("./node_modules/url-toolkit/src/url-toolkit.js");function He(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ge,Ke=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=void 0,this.baseuri=e,this.reluri=t}var t,i,r;return t=e,(i=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(je.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&He(t.prototype,i),r&&He(t,r),e}();function qe(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.AUDIO="audio",e.VIDEO="video"}(Ge||(Ge={}));var We=function(){function e(){var e;this._url="",this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[Ge.AUDIO]=!1,e[Ge.VIDEO]=!1,e),this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.sn=0,this.levelkey=void 0,this.level=0,this.start=0,this.cc=0,this.maxStartPTS=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.deltaPTS=void 0,this.dropped=void 0,this.backtracked=void 0,this.type=void 0,this.loader=void 0,this.title=null,this.urlId=void 0}var t,i,r,n=e.prototype;return n.setByteRange=function(e,t){var i=e.split("@",2),r=[];1===i.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(i[1],10),r[1]=parseInt(i[0],10)+r[0],this._byteRange=r},n.addElementaryStream=function(e){this._elementaryStreams[e]=!0},n.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},n.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},n.setDecryptDataFromLevelKey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new Ke(e.baseuri,e.reluri)).method=e.method,i.iv=this.createInitializationVector(t)),i},t=e,(i=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(je.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(C.isFiniteNumber)(this.programDateTime))return null;var e=Object(C.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&qe(t.prototype,i),r&&qe(t,r),e}(),ze=/^(\d+)x(\d+)$/,Ye=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Xe=function(){function e(t){for(var i in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(i)&&(this[i]=t[i])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(2*r,2*r+2),16);return i}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){var t=ze.exec(this[e]);return null===t?null:{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,i={};for(Ye.lastIndex=0;null!==(t=Ye.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),i[t[1]]=r}return i},e}(),Qe=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Je=/#EXT-X-MEDIA:(.*)/g,Ze=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),$e=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,et=/\.(mp4|m4s|m4v|m4a)$/i;function tt(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),"number"==typeof e.programDateTime&&Object(C.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var it,rt,nt=function(){function e(){}return e.findGroup=function(e,t){if(!e)return null;for(var i=null,r=0;r<e.length;r++){var n=e[r];n.id===t&&(i=n)}return i},e.convertAVC1ToAVCOTI=function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift(),10).toString(16),t+=("000"+parseInt(i.shift(),10).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return Object(je.buildAbsoluteURL)(t,e,{alwaysNormalize:!0})},e.setCodecs=function(e,t){["video","audio"].forEach((function(i){var r=e.filter((function(e){return function(e,t){var i=Ie[t];return!!i&&!0===i[e.slice(0,4)]}(e,i)}));if(r.length){var n=r.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[i+"Codec"]=n.length>0?n[0]:r[0],e=e.filter((function(e){return-1===r.indexOf(e)}))}})),t.unknownCodecs=e},e.parseMasterPlaylist=function(t,i){var r,n=[];for(Qe.lastIndex=0;null!==(r=Qe.exec(t));){var a=new Ve(i),s=a.attrs=new Xe(r[1]);a.url=e.resolve(r[2],i);var o=s.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.bandwidth=s.decimalInteger("BANDWIDTH"),a.averageBandwidth=s.decimalInteger("AVERAGE-BANDWIDTH"),a.bitrate=a.averageBandwidth||a.bandwidth,a.name=s.NAME,e.setCodecs([].concat((s.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),n.push(a)}return n},e.parseMasterPlaylistMedia=function(t,i,r,n){var a;void 0===n&&(n=[]);var s=[],o=0;for(Je.lastIndex=0;null!==(a=Je.exec(t));){var u={},d=new Xe(a[1]);if(d.TYPE===r){if(u.groupId=d["GROUP-ID"],u.name=d.NAME,u.type=r,u.default="YES"===d.DEFAULT,u.autoselect="YES"===d.AUTOSELECT,u.forced="YES"===d.FORCED,d.URI&&(u.url=e.resolve(d.URI,i)),u.lang=d.LANGUAGE,u.name||(u.name=u.lang),n.length){var l=e.findGroup(n,u.groupId);u.audioCodec=l?l.codec:n[0].codec}u.id=o++,s.push(u)}}return s},e.parseLevelPlaylist=function(e,t,i,r,n){var a,s,o,u=0,d=0,l=0,c=null,h=new We,_=null,p=new Ve(t);for(Ze.lastIndex=0;null!==(s=Ze.exec(e));){var v=s[1];if(v){h.duration=parseFloat(v);var m=(" "+s[2]).slice(1);h.title=m||null,h.tagList.push(m?["INF",v,m]:["INF",v])}else if(s[3]){if(Object(C.isFiniteNumber)(h.duration)){var g=u++;h.type=r,h.start=d,h.levelkey=a,h.sn=g,h.level=i,h.cc=l,h.urlId=n,h.baseurl=t,h.relurl=(" "+s[3]).slice(1),tt(h,c),p.fragments.push(h),c=h,d+=h.duration,h=new We}}else if(s[4]){var y=(" "+s[4]).slice(1);c?h.setByteRange(y,c):h.setByteRange(y)}else if(s[5])h.rawProgramDateTime=(" "+s[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]),null===_&&(_=p.fragments.length);else{if(!(s=s[0].match($e))||s.length<=0)break;for(o=1;o<s.length&&void 0===s[o];o++);var b=(" "+s[o+1]).slice(1),E=(" "+s[o+2]).slice(1);switch(s[o]){case"#":h.tagList.push(E?[b,E]:[b]);break;case"PLAYLIST-TYPE":p.type=b.toUpperCase();break;case"MEDIA-SEQUENCE":u=p.startSN=parseInt(b,10);break;case"TARGETDURATION":p.targetduration=parseFloat(b);break;case"VERSION":p.version=parseInt(b,10);break;case"EXTM3U":break;case"ENDLIST":p.live=!1;break;case"DIS":l++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":l=parseInt(b,10);break;case"KEY":var S=new Xe(b),T=S.enumeratedString("METHOD"),w=S.URI,L=S.hexadecimalInteger("IV");T&&(a=new Ke(t,w),w&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(T)>=0&&(a.method=T,a.key=null,a.iv=L));break;case"START":var R=new Xe(b).decimalFloatingPoint("TIME-OFFSET");Object(C.isFiniteNumber)(R)&&(p.startTimeOffset=R);break;case"MAP":var x=new Xe(b);h.relurl=x.URI,x.BYTERANGE&&h.setByteRange(x.BYTERANGE),h.baseurl=t,h.level=i,h.type=r,h.sn="initSegment",p.initSegment=h,(h=new We).rawProgramDateTime=p.initSegment.rawProgramDateTime;break;default:f.Log.w("line parsed but not handled: "+s)}}}return(h=c)&&!h.relurl&&(p.fragments.pop(),d-=h.duration),p.totalduration=d,p.averagetargetduration=d/p.fragments.length,p.endSN=u-1,p.startCC=p.fragments[0]?p.fragments[0].cc:0,p.endCC=l,!p.initSegment&&p.fragments.length&&p.fragments.every((function(e){return et.test(e.relurl)}))&&(f.Log.w("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(h=new We).relurl=p.fragments[0].relurl,h.baseurl=t,h.level=i,h.type=r,h.sn="initSegment",p.initSegment=h,p.needSidxRanges=!0),_&&function(e,t){for(var i=e[t],r=t-1;r>=0;r--){var n=e[r];i.programDateTime&&(n.programDateTime=i.programDateTime-1e3*n.duration),i=n}}(p.fragments,_),p},e}();!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack"}(it||(it={})),function(e){e.MAIN="main",e.AUDIO="audio"}(rt||(rt={}));var at=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this).loaders={},i.tag="PlaylistLoader",i._config=void 0,i._config=t,i.loaders={},i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r.canHaveQualityLevels=function(e){return e!==it.AUDIO_TRACK},r.mapContextToLevelType=function(e){switch(e.type){case it.AUDIO_TRACK:return rt.AUDIO;default:return rt.MAIN}},r.getResponseUrl=function(e){var t=e.responseUrl;return t&&0!==t.indexOf("data:")||(t=e.url),t};var n=r.prototype;return n.createInternalLoader=function(e){var t=new ne;return e.loader=t,this.loaders[e.type]=t,t},n.getInternalLoader=function(e){return this.loaders[e.type]},n.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},n.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},n.destroy=function(){this.destroyInternalLoaders()},n.load=function(e){f.Log.d(this.tag,"Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var t,i,r,n,a=this.getInternalLoader(e);if(a){var s=a.context;if(s&&s.url===e.url)return f.Log.i(this.tag,"playlist request ongoing"),!1;f.Log.w(this.tag,"aborting previous loader for type: "+e.type),a.abort()}switch(e.type){case it.MANIFEST:t=this._config.manifestLoadingMaxRetry,i=this._config.manifestConnectionTimeout,r=this._config.manifestTransmissionTimeout,n=this._config.manifestLoadingRetryDelay;break;default:t=this._config.levelLoadingMaxRetry,i=this._config.levelConnectionTimeout,r=this._config.levelTransmissionTimeout,n=this._config.levelLoadingRetryDelay}a=this.createInternalLoader(e),e.responseType=e.responseType||"text";var o={connectionTimeout:i,transmissionTimeout:r,maxRetry:t,retryDelay:n},u={onEnd:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onAbort:this.loadAbort.bind(this)};return f.Log.d(this.tag,"Calling internal loader delegate for URL: "+e.url),a.load(e,u,o),!0},n.loadsuccess=function(e,t,i){if(this.emit(P.default.REPORT,xe(ye.SUCCESS,e,i)),e.isSidxRequest)this.emit(P.default.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.UNSUPPORTED,fatal:!0,url:e.url,reason:"unsupport sidx",statusCode:i.code});else if(this.resetInternalLoader(e.type),"string"==typeof t){var r=t;if(0!==r.indexOf("#EXTM3U")){var n=r;return n.length>4096&&(n=n.slice(0,4096)),void this._handleManifestParsingError(e,n,i)}r.indexOf("#EXTINF:")>0||r.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,i):this._handleMasterPlaylist(e,t,i)}else this.emit(P.default.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.HLS_MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:'expected responseType of "text" for PlaylistLoader',statusCode:i.code})},n.loaderror=function(e,t){this._handleNetworkError(e,t)},n.loadAbort=function(e,t){this.emit(P.default.REPORT,xe(ye.ABORT,e,t))},n._handleMasterPlaylist=function(e,t,i){var n=t,a=r.getResponseUrl(e),s=nt.parseMasterPlaylist(n,a);if(s.length){var o=s.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),u=nt.parseMasterPlaylistMedia(n,a,"AUDIO",o);if(u.length){var d=!1;u.forEach((function(e){e.url||(d=!0)})),!1===d&&s[0].audioCodec&&!s[0].attrs.AUDIO&&(f.Log.v(this.tag,"audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main"}))}this.emit(P.default.HLS_MANIFEST_LOADED,{levels:s,audioTracks:u,url:a,stats:i})}else this._handleManifestParsingError(e,"no level found in manifest",i)},n._handleTrackOrLevelPlaylist=function(e,t,i){var n=e.id,a=e.level,s=e.type,o=r.getResponseUrl(e),u=Object(C.isFiniteNumber)(n)?n:0,d=Object(C.isFiniteNumber)(a)?a:u,l=r.mapContextToLevelType(e),c=nt.parseLevelPlaylist(t,o,d,l,u);if(s===it.MANIFEST){var h={url:o,details:c};this.emit(P.default.HLS_MANIFEST_LOADED,{levels:[h],singleLevel:!0,url:o,stats:i})}if(c.needSidxRanges&&c.initSegment){var f=c.initSegment.url;this.load({url:f,isSidxRequest:!0,type:s,level:a,levelDetails:c,id:n,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else e.levelDetails=c,this._handlePlaylistLoaded(e,i)},n._handleManifestParsingError=function(e,t,i){this.emit(P.default.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.HLS_MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:t,statusCode:i.code})},n._handleNetworkError=function(e,t){var i,r;f.Log.i(this.tag,"A network error occured while loading a "+e.type+"-type playlist");var n=this.getInternalLoader(e);switch(e.type){case it.MANIFEST:i=O.ErrorDetails.HLS_MANIFEST_LOAD_ERROR,r=!0;break;case it.LEVEL:i=O.ErrorDetails.HLS_LEVEL_LOAD_ERROR,r=!1;break;case it.AUDIO_TRACK:i=O.ErrorDetails.HLS_AUDIO_TRACK_LOAD_ERROR,r=!1;break;default:r=!1}this.emit(P.default.REPORT,xe(ye.FAIL,e,t)),t.fatal&&(n&&(n.abort(),this.resetInternalLoader(e.type)),this.emit(P.default.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:i,fatal:r,url:e.url,reason:t.text,statusCode:t.code}))},n._handlePlaylistLoaded=function(e,t){var i=e.type,n=e.level,a=e.id,s=e.levelDetails;if(s&&s.targetduration)if(r.canHaveQualityLevels(e.type))this.emit(P.default.LEVEL_LOADED,{details:s,level:n||0,id:a||0,stats:t});else switch(i){case it.AUDIO_TRACK:this.emit(P.default.AUDIO_TRACK_LOADED,{details:s,id:a,stats:t})}else this._handleManifestParsingError(e,"invalid target duration",t)},r}(Te.default),st=function(){function e(){}return e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.length)&&e.adaptationSet.reduce((function(e,t){return!!(e&&t.representation&&t.representation.length)}),!0)},e}(),ot=function(){function e(){}return e.parse=function(t){var i=[];if(e.verify(t))t.adaptationSet.representation.forEach((function(e){if(e&&(e.url||e.m3u8)){var t=new Ve(e.url||e.baseUrl);t.url=e.baseUrl?nt.resolve(e.url,e.baseUrl):e.url,t.bitrate=e.bandwidth,t.bandwidth=e.bandwidth,t.averageBandwidth=e.averageBandwidth,t.bitrate=t.averageBandwidth||t.bandwidth,t.qualityType=e.qualityType,t.qualityLabel=e.qualityLabel,e.width&&e.height&&(t.width=e.width,t.height=e.height),nt.setCodecs([].concat((e.codecs||"").split(/[ ,]+/)),t),t.audioCodec="",t.m3u8=e.m3u8,t.m3u8Slice=e.m3u8Slice,t.totalduration=e.duration,e.backupUrl&&e.backupUrl.length&&(t.url=[t.url].concat(e.backupUrl)),t.urlId=0,i.push(t)}}));else if(st.verify(t))return e.parseKwai(t);return i},e.parseKwai=function(e){var t=[];if(st.verify(e)){var i=e;if(i.adaptationSet[0]){var r=i.adaptationSet[0].duration;i.adaptationSet[0].representation.sort((function(e,t){return e.maxBitrate-t.maxBitrate})),i.adaptationSet[0].representation.forEach((function(e){if(e){var i=new Ve(e.url);i.bandwidth=e.maxBitrate,i.averageBandwidth=e.avgBitrate,i.bitrate=i.averageBandwidth||i.bandwidth,i.qualityType=e.qualityType,i.qualityLabel=e.qualityLabel,e.width&&e.height&&(i.width=e.width,i.height=e.height),nt.setCodecs([].concat((e.codecs||"").split(/[ ,]+/)),i),i.audioCodec="",i.m3u8Slice=e.m3u8Slice,i.totalduration=r,e.backupUrl&&e.backupUrl.length&&(i.url=[i.url].concat(e.backupUrl)),i.urlId=0,t.push(i)}}))}}return t},e.parseLevel=function(e,t){if(e.m3u8){var i=nt.parseLevelPlaylist(e.m3u8,e.url[0],t,rt.MAIN,0);return delete e.m3u8,e.details=i,!0}return!1},e.parseLevelSlice=function(e,t){if(e.m3u8Slice){var i=nt.parseLevelPlaylist(e.m3u8Slice,e.url[0],t,rt.MAIN,0);return delete e.m3u8Slice,e.details=i,e.alwaysRetryLiveLevel=!1,e.live=!0,i.totalduration=e.totalduration,!0}return!1},e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.representation&&e.adaptationSet.representation.length)},e}(),ut=new RegExp("^(http|https)://"),dt=new RegExp("[?, #]");function lt(e){var t=e.search(dt);return t>0&&(e=e.slice(0,t)),e}function ct(e){if(e){if("string"==typeof e&&!ut.test(e)){var t;try{t=JSON.parse(e)}catch(e){}e=t||e}if(ot.verify(e)){var i=e.adaptationSet.representation;return i.sort((function(e,t){return e.bandwidth-t.bandwidth})),""+lt(i[0].url)}if("string"==typeof e)return""}return""}function ht(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=0),t+"_"+i+"_"+lt(e)}var ft=function(e){var t,i;function r(){var t;return(t=e.call(this)||this)._cache=void 0,t._writeCache=!1,t._cache=K,t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.load=function(e,t,i){var r=this;if(this._init(e,t,i),this._writeCache=!!i.cache,this._cache&&this._cache.ready){var n=ht(this.context.url,this.context.rangeStart,this.context.rangeEnd);this._cache.hit(n)>=0?this._cache.get(n,(function(e,t){r._callbacks&&(!e&&t?(r._writeCache=!1,r._stats.cacheHit=!0,r._stats.id="cache",r._stats.tsload=Date.now(),r._stats.tstart=performance.now(),r._onEnd(r.context,t.result),f.Log.i(r.tag,"db cache hit!")):(r._stats.cacheFail=!0,r._loadInternal()))})):this._loadInternal()}else this._loadInternal()},n._onEnd=function(t,i){e.prototype._onEnd.call(this,t,i),this._cache&&this._cache.ready&&this._writeCache&&i&&"string"!=typeof i&&this._cache.put(ht(this.context.url,this.context.rangeStart,this.context.rangeEnd),i)},r}(ne),_t=i("./node_modules/webworkify-webpack/index.js"),pt=i.n(_t);function vt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var mt=function(){function e(t){void 0===t&&(t=0),this._size=void 0,this._readOffset=0,this._writeOffset=0,this._storage=void 0,this._cache=void 0,this._size=t>0?t:e.DEFAULT_CACHE_SIZE,this._storage=new ArrayBuffer(this._size),this._cache=new Uint8Array(this._storage)}var t,i,r,n=e.prototype;return n.put=function(e){if(this._readOffset===this._writeOffset&&(this._readOffset=this._writeOffset=0),this._writeOffset+e.byteLength>this._size){var t=this._writeOffset+e.byteLength-this._readOffset;t>this._size?(this._collateCache(),this.expandCache(t)):this._collateCache()}this._cache.set(e,this._writeOffset),this._writeOffset+=e.byteLength},n.get=function(e){if(e+this._readOffset>this._writeOffset)return null;var t=null;if(this._cache.slice)t=this._cache.slice(this._readOffset,this._readOffset+e);else{var i=this._cache.byteOffset+this._readOffset;t=new Uint8Array(this._storage.slice(i,i+e))}return this._readOffset+=e,t},n.read=function(e){return e+this._readOffset>this._writeOffset?null:new Uint8Array(this._storage,this._readOffset,e)},n.skip=function(e){e+this._readOffset>this._writeOffset||(this._readOffset+=e)},n.clear=function(){this._readOffset=this._writeOffset=0},n.expandCache=function(t){if(void 0===t&&(t=0),this._size=Math.max(2*this._size,t),this._size>=e.MAX_CACHE_SIZE)throw new Error("max cache size");0===this._readOffset&&0===this._writeOffset?this._storage=new ArrayBuffer(this._size):this._storage=this._transfer(this._storage,this._size),this._cache=new Uint8Array(this._storage)},n._collateCache=function(){var e=new Uint8Array(this._storage,this._readOffset,this._writeOffset-this._readOffset);this._cache.set(e),this._writeOffset-=this._readOffset,this._readOffset=0},n._transfer=function(e,t){if(!(e instanceof ArrayBuffer))throw new TypeError("Source must be an instance of ArrayBuffer");if(t<=e.byteLength)return e.slice(0,t);var i=new Uint8Array(e),r=new Uint8Array(new ArrayBuffer(t));return r.set(i),r.buffer},t=e,(i=[{key:"unreadLen",get:function(){return this._writeOffset-this._readOffset}}])&&vt(t.prototype,i),r&&vt(t,r),e}();mt.MAX_CACHE_SIZE=104857600,mt.DEFAULT_CACHE_SIZE=3145728;var gt=mt,yt=i("./src/demux/hls/demuxer-inline.ts");function bt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Et=function(){function e(e,t,i){var r=this;this.MUX_MIN_LEN=752,this._id=void 0,this._observer=void 0,this._config=void 0,this._inlineObserver=null,this._w=null,this._typeSupported=void 0,this._cache=void 0,this._chunkIndex=void 0,this._remuxId=void 0,this._seek=!1,this._frag=null,this._demuxer=null,this._duration=0,this._progressTime=0,this._initSegment=void 0,this._resetData=null,this._fragInfo=void 0,this._onWorkMessage=function(e){var t=e.data;e.data.event===P.default.PARSING_DATA&&(t.data.payload=t.payload),r._onMessage(e.data.event,t.data)},this._id=i,this._observer=e,this._config=t,this._typeSupported={mp4:!0,mpeg:!1,mp3:!1},this._frag=null,this._fragInfo={},t.webWorker&&t.fragBeforeWorker>0?this._cache=new gt(524288):this._cache=new gt,this._chunkIndex=0,this._remuxId=1,this.init()}var t,i,r,a=e.prototype;return a.init=function(){var e=this._inlineObserver=new Te.default,t=this._onMessage.bind(this);e.on(P.default.PARSING_INIT_SEGMENT,t),e.on(P.default.PARSED_DATA,t),e.on(P.default.LOAD_END,t),e.on(P.default.ERROR,t),e.on(P.default.REPORT,t),e.on(P.default.PARSING_DATA,t),this._config.webWorker&&this._config.fragBeforeWorker<=0?this._initWorker():this._demuxer=new yt.default(e,this._typeSupported,this._config,{remuxId:this._remuxId,stashSec:0},navigator.vendor,null)},a.mixedModeWorkerStart=function(){this._cache.expandCache(gt.DEFAULT_CACHE_SIZE),this._initWorker()},a._initWorker=function(){if(this._config.webWorker&&!this._w&&(this._w=pt()(/*! ./demuxer-worker */"./src/demux/hls/demuxer-worker.ts"),this._w)){var e=null;this._demuxer&&(e=this._demuxer.getStat()),this._w.addEventListener("message",this._onWorkMessage),this._w.postMessage({cmd:"init",typeSupported:this._typeSupported,config:this._config,data:{remuxId:this._remuxId,stashSec:0},vendor:navigator.vendor,stat:e})}},a.destroy=function(){this._config.webWorker&&this._w&&(this._w.postMessage({cmd:"destroy"}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate()),this._inlineObserver&&(this._inlineObserver.removeAllListeners(),this._inlineObserver=null)},a.resetData=function(e){this._remuxId++,this._cache.clear(),this._resetData={remuxId:this._remuxId,stashSec:e},this._chunkIndex=0},a.reset=function(e,t){this.resetData(t),this._seek=e,this._frag=null},a.end=function(){this._config.webWorker&&this._w?this._w.postMessage({cmd:"end"}):this._demuxer&&this._demuxer.end()},a.onFragProgress=function(e){this._demux(e,!1)},a.onFragLoaded=function(e){this._demux(e,!0)},a._demux=function(e,t){if("initSegment"===e.context.frag.sn&&e.data)this._initSegment=e.data;else{var i=this._cache,r=e.context.frag,n=this._frag,a=Object(C.isFiniteNumber)(r.startDTS)?r.startDTS:r.start,s=e.progress,o=!1,u=!1,d=!0,l=null;if(e.data&&e.data.byteLength){var c={type:V.REPORT_TYPES.LOADER_CHUNK_ARRIVAL,byteLength:e.data.byteLength,timeCost:performance.now()-(this._progressTime||e.stats.trequest)};this._progressTime=performance.now(),this._observer.trigger(P.default.REPORT,c),s&&i.put(new Uint8Array(e.data))}if(0===this._chunkIndex){this._fragInfo={},o=!(n&&r.level===n.level),u=!(n&&r.cc===n.cc);var h=n&&r.sn===n.sn+1;d=(d=!(o||!h))||e.remuxContiguous}if(t)this._progressTime=0,this._chunkIndex=0,this._frag=e.context.frag,s&&i.unreadLen&&(l=i.get(i.unreadLen)),i.clear(),this._frag=r;else if(s){var f=Math.floor(i.unreadLen/this.MUX_MIN_LEN)*this.MUX_MIN_LEN-this.MUX_MIN_LEN;f>=this.MUX_MIN_LEN&&(l=i.get(f),this._chunkIndex++)}var _=null;s?l&&(_=l.buffer):_=e.data,_&&(this._push(_,r.decryptdata,this._initSegment,e.audioCodec,e.videoCodec,a,d,o,u,!this._seek||0===e.context.frag.start,this._duration,t),this._seek=!1)}},a._onParsing=function(e){if(e.expired=!(!e.extra||e.extra.remuxId===this._remuxId),e.id=this.id,e.expired)f.Log.i("Demuxer","parsing data expired");else{var t=this._fragInfo;t.hasOwnProperty(e.type)?(t[e.type].endPTS=e.endPTS,t[e.type].endDTS=e.endDTS):t[e.type]={startDTS:e.startDTS,startPTS:e.startPTS,endPTS:e.endPTS,endDTS:e.endDTS}}},a._onParsed=function(e){e.expired=!(!e.extra||e.extra.remuxId===this._remuxId),e.expired?f.Log.i("Demuxer","parsed expired"):(e.info=Object(n.ObjectAssign)({},this._fragInfo),e.frag=this._frag,this._fragInfo={})},a._push=function(e,t,i,r,n,a,s,o,u,d,l,c){this._config.webWorker&&this._w?this._w.postMessage({cmd:"push",data:e,decryptdata:t,initSegment:i,audioCodec:r,videoCodec:n,timeOffset:a||0,contiguous:s,trackSwitch:o,discontinuity:u,accurateTimeOffset:d,duration:l,fragEnd:c,resetData:this._resetData},[e]):this._demuxer&&this._demuxer.push(e,t,i,r,n,a,s,o,u,d,l,c,this._resetData),this._resetData=null},a._onMessage=function(e,t){switch(e){case P.default.PARSING_DATA:if(this._onParsing(t),t.expired)return;break;case P.default.PARSED_DATA:if(this._onParsed(t),t.expired)return}this._observer.trigger(e,t)},t=e,(i=[{key:"totalDuration",set:function(e){this._duration=e}},{key:"seek",set:function(e){this._seek=e}},{key:"id",get:function(){return this._id}},{key:"hasWorker",get:function(){return!!this._w}}])&&bt(t.prototype,i),r&&bt(t,r),e}(),St={search:function(e,t){for(var i=0,r=e.length-1,n=null,a=null;i<=r;){var s=t(a=e[n=(i+r)/2|0]);if(s>0)i=n+1;else{if(!(s<0))return a;r=n-1}}return null},searchIndex:function(e,t){for(var i=0,r=e.length-1,n=null;i<=r;){var a=t(e[n=(i+r)/2|0]);if(a>0)i=n+1;else{if(!(a<0))return n;r=n-1}}return-1}};function Tt(e,t){return t?St.searchIndex(t,(function(t){return e<t.start?-1:e>t.start+t.duration?1:0})):-1}var wt=function(e){var t,i;function r(t,i){var r;return(r=e.call(this)||this)._loaders=void 0,r._config=void 0,r._loaderConfig=void 0,r._decryptkey=void 0,r._decrypturl=void 0,r._config=t,r._loaderConfig=i,r._loaders={},r._decryptkey=null,r._decrypturl=null,r}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.destroy=function(){for(var e in this._loaders){var t=this._loaders[e];t&&t.destroy()}this._loaders={}},n.load=function(e){var t=e.type,i=this._loaders[t],r=e.decryptdata,n=null;if(r&&(n=r.uri),!n||n===this._decrypturl&&null!==this._decryptkey)this._decryptkey&&(r&&(r.key=this._decryptkey),this.emit(P.default.HLS_KEY_LOADED,{frag:e}));else{var a=this._loaderConfig;i&&(f.Log.w("KeyLoader","abort previous key loader for type:"+t),i.abort()),e.loader=this._loaders[t]=new ne,this._decrypturl=n,this._decryptkey=null;var s={url:n,frag:e,responseType:"arraybuffer",credentials:this._config.credentials},o=a,u={onEnd:this.loadEnd.bind(this),onError:this.loadError.bind(this),onAbort:function(){}};e.loader.load(s,u,o)}},n.loadEnd=function(e,t,i){if(t&&t instanceof ArrayBuffer){var r=e.frag;this._decryptkey=r.decryptdata.key=new Uint8Array(t),this._loaders[r.type]=null,this.emit(P.default.HLS_KEY_LOADED,{frag:r})}else this.emit(P.default.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.HLS_KEY_LOAD_ERROR,fatal:!0,reason:"key empty",statusCode:i.code})},n.loadError=function(e,t){var i=e.frag.loader;t.fatal&&(i&&i.abort(),this._loaders[e.frag.type]=null,this.emit(P.default.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.HLS_KEY_LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code}))},r}(Te.default);function Lt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Rt=function(e){var t,i;function r(t,i,r,n,a,s){return void 0===s&&(s=!1),e.call(this,rt.MAIN,t,i,r,n,a,s)||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r}(function(){function e(e,t,i,r,n,a,s){void 0===s&&(s=!1),this._observer=void 0,this._type=void 0,this._config=void 0,this._levels=void 0,this._index=void 0,this._next=void 0,this._pos=void 0,this._failPos=-1,this._demuxer=void 0,this._loadEnabled=void 0,this._newSource=void 0,this._startSN=0,this._inited=!1,this._fragLoadFailSec=0,this._demuxing=!1,this._loader=void 0,this._keyLoader=void 0,this._remuxContiguous=!1,this._media=void 0,this._fragAlign=void 0,this._callback=void 0,this._loadConfig=void 0,this._keyLoadConfig=void 0,this._streamingMux=!0,this._fragCnt=0,this._preload=!1,this._preloadData=void 0,this._type=e,this._observer=t,this._media=i,this._config=r,this._levels=n,this._next=this._index=a,this._pos=0,this._callback={onProgress:this._onProgress.bind(this),onEnd:this._onEnd.bind(this),onError:this._onError.bind(this),onAbort:this._onAbort.bind(this)},this._loadConfig={connectionTimeout:r.connectionTimeout,transmissionTimeout:r.transmissionTimeout,maxRetry:r.maxRetry,retryDelay:r.retryDelay},this._keyLoadConfig={connectionTimeout:r.keyConnectionTimeout,transmissionTimeout:r.keyTransmissionTimeout,maxRetry:r.keyLoadingMaxRetry,retryDelay:r.keyLoadingRetryDelay},this._observer.on(P.default.PARSED_DATA,this._fragParsed.bind(this)),this._demuxer=new Et(t,r,e),this._loadEnabled=!0,this._newSource=!0,this._preload=s,this._preload&&this.streamingMux(!1)}var t,i,r,n=e.prototype;return n.levelUpdated=function(){if(this.level&&this.level.details){var e=this.level.details.startSN;Object(C.isFiniteNumber)(this._startSN)&&this._startSN!==e&&(this._pos=Math.max(0,this._pos-(e-this._startSN))),this._startSN=e,this._tryLoadNext()}},n.seek=function(e,t){void 0===t&&(t=!1),this._remuxContiguous=!1;var i=this.level;this._loadEnabled=!0;var r=0;if(this._destroyLoader(),i&&i.details){var n=0===e?0:Tt(e,i.details.fragments);this._pos=n>=0?n:i.details.fragments.length-1;var a=this._config.startPlayBufferSec,s=i.details.fragments[this._pos].start;r=t?a:Math.max(e+a-s,0),this._reset(!0,r),t&&this._observer.trigger(P.default.SEEK_KEYFRAME,{keyFrameSec:s}),this._tryLoadNext()}},n.setDownloadEnabled=function(e){void 0===e&&(e=!0),!this._loadEnabled&&e?(this._loadEnabled=e,this._tryLoadNext()):this._loadEnabled=e},n.destroy=function(){this._destroyLoader(),this._demuxer&&this._demuxer.destroy(),this._keyLoader&&(this._keyLoader.destroy(),this._keyLoader=void 0),this._fragAlign=void 0},n.nextBackup=function(e){if(this._levels)for(var t=0;t<this._levels.length;t++){var i=this._levels[t];if(i.urlId>=i.url.length-1)return!1;i.urlId++,delete i.m3u8,delete i.m3u8Slice,i.details=null}this._destroyLoader(),this._newSource=!0,this._failPos>=0&&(this._pos=this._failPos);var r=0;if(this.level&&this.level.details){var n=this._config.startPlayBufferSec;r=Math.max(e+n-this.level.details.fragments[this._pos].start,0)}return this._reset(!0,r),!0},n.streamingMux=function(e){this._streamingMux=e},n.usePreload=function(){this._preloadData&&(this._demuxer.onFragLoaded(this._preloadData),this._preloadData=void 0,this._preload=!1)},n._getFragStartByPos=function(e){if(this.level.details){var t=this.level.details.fragments[e];if(t)return t.maxStartPTS||t.startPTS||t.start}return 0},n._reset=function(e,t){this._inited=!1,this._demuxing=!1,this._demuxer.reset(e,t)},n._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},n._loadKey=function(e){var t=this;this._keyLoader||(this._keyLoader=new wt({credentials:this._config.credentials},this._keyLoadConfig),this._keyLoader.on(P.default.HLS_KEY_LOADED,this._tryLoadNext.bind(this)),this._keyLoader.on(P.default.ERROR,(function(e){t._observer.trigger(P.default.ERROR,e)}))),this._keyLoader.load(e)},n._tryLoadNext=function(){this._next!==this._index&&(this._index=this._next);var e=this.level;if(e){if(this._fragAlign&&e.details){var t=this._fragAlign.frag,i=e.details.fragments[this._pos];i&&(this._pos===this._fragAlign.pos&&this._index===this._fragAlign.level&&Me(e.details,i,t.startPTS,t.endPTS,t.startDTS,t.endDTS),this._fragAlign=void 0)}if(this._loadEnabled&&!this._loader&&!this._demuxing){if(this._isLevelEnd())return void this._demuxer.end();var r=this._nextFragment();if(r){if("encrypted"===r)return;this._loadFrag(r)}}}},n._isLevelEnd=function(){var e=this.level;return!!(e&&e.details&&!e.details.live&&this._pos>=e.details.fragments.length)},n._nextFragment=function(){var e=this.level,t=null;if(e&&e.details&&(this._inited&&e.details.initSegment?t=e.details.initSegment:this._pos<e.details.fragments.length&&(t=e.details.fragments[this._pos])),t){if(t.encrypted&&t.decryptdata)return this._loadKey(t),"encrypted";this._inited?this._inited=!1:this._pos++}return t},n._fragParsed=function(e,t){for(var i in this._demuxing=!1,this._remuxContiguous=!1,t.type=V.REPORT_TYPES.MUX_INFO,this._observer.trigger(P.default.REPORT,t),t.info){var r=t.info[i];if(r&&r.endPTS&&r.endDTS){var n=t.frag,a=this._levels[n.level].details;a&&Me(a,n,r.startPTS,r.endPTS,r.startDTS,r.endDTS)}}this._isLevelEnd()?this._demuxer.end():(this._observer.trigger(P.default.ABR_NEXT,{startSec:this._getFragStartByPos(this._pos)}),this._tryLoadNext())},n._loadFrag=function(e){if(e){var t={url:e.url,responseType:"arraybuffer",progress:this._streamingMux&&this._config.streamingMux,frag:e,type:"frag",credentials:this._config.credentials},i=e.byteRangeStartOffset,r=e.byteRangeEndOffset;Object(C.isFiniteNumber)(i)&&Object(C.isFiniteNumber)(r)&&(t.rangeStart=i,t.rangeEnd=r),this._destroyLoader(),this._loadConfig.cache=this._preload;var n=0===this._fragCnt&&this._config.dbCache?ft:ne;if(this._loader=new n,this._loader.load(t,this._callback,this._loadConfig),this._demuxing=!0,this._newSource){var a={type:V.REPORT_TYPES.NEW_SOURCE,index:this._index,sync:e.start,url:this._config.src,bitrate:0,maxBitrate:0,avgBitrate:0,urlId:0,qualityType:this.level.qualityType,qualityLabel:this.level.qualityLabel};this.level&&this.level.bitrate&&(a.bitrate=Math.round(this.level.bitrate),a.maxBitrate=Math.round(this.level.bandwidth),a.avgBitrate=Math.round(this.level.averageBandwidth),a.urlId=this.level.urlId),this._observer.trigger(P.default.REPORT,a),this._newSource=!1}this._config.fragBeforeWorker>0&&this._fragCnt===this._config.fragBeforeWorker&&this._demuxer.mixedModeWorkerStart(),this._fragCnt++}},n._onProgress=function(e,t,i){var r=this._levels[e.frag.level]||{};t instanceof ArrayBuffer&&this._demuxer.onFragProgress({context:e,data:t,stats:i,audioCodec:r.audioCodec,videoCodec:r.videoCodec,remuxContiguous:this._remuxContiguous,progress:!0})},n._onEnd=function(e,t,i){this._failPos=-1,this._fragLoadFailSec=0,this._destroyLoader();var r=this._levels[e.frag.level]||{},n=xe(ye.SUCCESS,e,i,this._levels,this._preload);if(this._observer.trigger(P.default.REPORT,n),"string"!=typeof t){var a={context:e,data:t,stats:i,audioCodec:r.audioCodec,videoCodec:r.videoCodec,remuxContiguous:this._remuxContiguous,progress:!!e.progress};this._preload?(this._preloadData=a,this._observer.trigger(P.default.PRELOAD_COMPLETE)):this._demuxer.onFragLoaded(a)}},n._onError=function(e,t){this._demuxing=!1,this._observer.trigger(P.default.REPORT,xe(ye.FAIL,e,t,this._levels,this._preload)),t.fatal&&(this._remuxContiguous=!1,this._failPos<0&&(this._failPos=Math.max(0,this._pos-1)),this._destroyLoader(),this._fragLoadFailSec+=e.frag.duration||0,"initSegment"===e.frag.sn||404!==t.code||this._config.maxFragFailSec&&this._fragLoadFailSec>=this._config.maxFragFailSec||this._isLevelEnd()?this._observer.trigger(P.default.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url}):this._tryLoadNext())},n._onAbort=function(e,t){this._observer.trigger(P.default.REPORT,xe(ye.ABORT,e,t,this._levels,this._preload))},t=e,(i=[{key:"isNetworkInUse",get:function(){return!(!this._loadEnabled&&!this._loader)}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._levels[this._index]}},{key:"index",get:function(){return this._index},set:function(e){this._destroyLoader(),this._newSource=!0,this._index=this._next=e,this._fragAlign=void 0}},{key:"next",get:function(){return this._next},set:function(e){this._newSource=!0,this._next=e,this._remuxContiguous=!0}},{key:"manualNext",set:function(e){var t=this.level.details;if(t){var i=Tt(this._media.currentTime+(t.targetduration||5)/2,t.fragments)+1;if(i>0&&i<t.fragments.length){i<this._pos&&(this._loader&&this._destroyLoader(),this._reset(!1,0),this._pos=i,this._remuxContiguous=!1),this._newSource=!0,this._next=e;var r=t.fragments[this._pos],n=this._getFragStartByPos(this._pos);return this._observer.trigger(P.default.LEVEL_SWITCHING,{startSec:n,level:e,smooth:!0}),this._fragAlign={level:this._next,pos:this._pos,frag:r},this._observer.trigger(P.default.BUFFER_FLUSHING,{startSec:n}),void this._tryLoadNext()}}this._observer.trigger(P.default.LEVEL_SWITCH_FAILED,{smooth:!0,level:e})}},{key:"nextLoadStart",get:function(){return this._getFragStartByPos(this._pos)}}])&&Lt(t.prototype,i),r&&Lt(t,r),e}());function xt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var kt=function(){function e(e,t,i,r){var n=this;void 0===r&&(r=!1),this.tag="HLS",this._observer=void 0,this._config=void 0,this._abr=void 0,this._media=void 0,this._playlistLoader=void 0,this._main=void 0,this._timer=void 0,this._startTimeSec=void 0,this._seekKeyframe=void 0,this._levels=null,this._totalduration=0,this._protocol=o.HLS,this._preload=!1,this._manifestReady=!1,this._levelLoadDelayTimer=void 0,this._sortLevels=function(e){return e.sort((function(e,t){return e.bitrate-t.bitrate==0&&e.height&&t.height?e.height-t.height:e.bitrate-t.bitrate}))},this._abrNext=function(e,t){if(n._abr&&n._abr.autoLevelEnabled&&n._main){var i=n._abr.nextBitrateIndex();i>=0&&i!==n._main.index&&(n._observer.trigger(P.default.LEVEL_SWITCHING,{startSec:t.startSec,level:i,smooth:!0}),n.nextLevel=i)}},this.tag="HLS",this._observer=e,this._config=t,this._media=i,this._preload=r,this._startTimeSec=t.startFromSec||-1,this._seekKeyframe=t.startFromKeyframe,"object"==typeof t.manifest&&(this._protocol=o.KWAI_HLS)}var t,i,r,n=e.prototype;return n.init=function(){var e=this;this._initMultirate(),this._playlistLoader=new at(this._config),this._playlistLoader.on(P.default.HLS_MANIFEST_LOADED,this._onManifestLoaded.bind(this)),this._playlistLoader.on(P.default.LEVEL_LOADED,this._onLevelLoaded.bind(this)),this._playlistLoader.on(P.default.REPORT,(function(t){e._observer.trigger(P.default.REPORT,t)})),this._playlistLoader.on(P.default.ERROR,(function(t){!e.current||e.current.details&&e.current.details.live&&e.current.alwaysRetryLiveLevel||(t.fatal=!0),e._observer.trigger(P.default.ERROR,t)}))},n.destroy=function(){this._playlistLoader&&(this._playlistLoader.removeAllListeners(),this._playlistLoader.destroy(),this._playlistLoader=void 0),this._clearLevelTimer(),this._main&&(this._main.destroy(),this._main=void 0),this._abr&&(this._abr.removeAllListeners(),this._abr.destory(),this._abr=void 0),clearTimeout(this._levelLoadDelayTimer)},n.loadSource=function(){if(this._protocol!==o.KWAI_HLS)this._playlistLoader&&this._playlistLoader.load({url:this._config.src,type:it.MANIFEST,level:0,id:null,credentials:this._config.credentials});else{var e=ot.parse(this._config.manifest);this._onManifestLoaded({levels:e,audioTracks:null})}},n.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._main&&this._main.setDownloadEnabled(e),this._abr&&this._abr.setDownloadEnabled(e)},n.seek=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),this._abr&&this._abr.onMessage(P.default.REPORT,{type:V.REPORT_TYPES.SEEK,isInBuffer:i}),this._main&&!i){var r=this._main.level;r&&r.details&&this._main&&!r.details.live?(this._main.seek(e,t),this._startTimeSec=-1):(this._startTimeSec=e,this._seekKeyframe=t)}},n.nextBackup=function(){return!(!this._main||!this._main.nextBackup(this._media.currentTime))&&(this._main.setDownloadEnabled(!1),this._seekKeyframe=!1,this._loadLevel(this._main.index),!0)},n.streamingMux=function(e){this._main&&this._main.streamingMux(e)},n.setAvailableAbrLevels=function(e){this._abr&&this._abr.setAvailableAbrLevels(e)},n.usePreload=function(){this._main&&this._main.usePreload(),this._preload=!1},n._onManifestLoaded=function(e){var t=this;f.Log.i(this.tag,"_onManifestLoaded",e);var i=[],r={},n=!1,a=!1,s=h.default.chrome||h.default.firefox;if(e.levels.forEach((function(e){n=n||!!e.videoCodec,a=a||!!e.audioCodec||!(!e.attrs||!e.attrs.AUDIO),s&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=""),t._config.audioCodec&&t._config.audioCodecSwap&&(e.audioCodec&&e.audioCodec!==t._config.audioCodec?-1!==e.audioCodec.indexOf("mp4a.40.5")?e.audioCodec="mp4a.40.2":e.audioCodec="mp4a.40.5":e.audioCodec=t._config.audioCodec),r[e.bitrate],e.url="string"==typeof e.url?[e.url]:e.url,e.urlId=0,r[e.bitrate]=e,i.push(e)})),n&&a&&(i=i.filter((function(e){return!!e.videoCodec}))),(i=i.filter((function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||Ce(t))&&(!i||Ce(i))}))).length>0){var u=0;i=this._sortLevels(i);for(var d=0;d<i.length;d++)for(var l=0;l<d;l++)if(i[l].bitrate===i[d].bitrate){i[d].bitrate=i[d].bitrate+d-l;break}this._levels=i,this._abr&&i.length>1&&!i[u].details&&(u=this._abr.init({levels:i,index:u})||0),this._main=new Rt(this._observer,this._media,this._config,i,u,this._preload),i[0].m3u8Slice&&(this._protocol=o.KWAI_HLS_SLICE),this._observer.trigger(P.default.MANIFEST_PARSED,{}),this._manifestReady=!0,this._levels[this._main.index].details?this._levelUpdated():this._loadLevel(this._main.index)}else n||a?this._observer.trigger(P.default.ERROR,{type:O.ErrorTypes.MUX_ERROR,details:O.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"no supported codec"}):this._observer.trigger(P.default.ERROR,{type:O.ErrorTypes.MUX_ERROR,details:O.ErrorDetails.HLS_MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parsing error"})},n._onLevelLoaded=function(e){var t=this,i=e.level;if(this._main&&this._main.level&&i===this._main.index){var r=this._main.level,n=e.details;if(n.live){var a=r.details,s=function(e,t,i){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),n=r/2;return e&&t.endSN===e.endSN&&(r=n),i&&(r=Math.max(n,r-(window.performance.now()-i))),Math.round(r)}(r.details,e.details,e.stats.trequest);a&&n.endSN!==a.endSN&&(Ue(a,n),r.details=n,this._levelUpdated()),f.Log.v("live playlist, reload in "+Math.round(s)+" ms"),this._timer=setTimeout((function(e){return t._loadLevel(e)}),s,this._main.index)}else this._clearLevelTimer(),r.details&&Ue(r.details,n),r.details=n,r.live=r.details.live,this._levelUpdated();this._observer.trigger(P.default.LEVEL_LOADED,{bitrate:this._main.level.bitrate,duration:this._totalduration})}},n._levelUpdated=function(){if(this._startTimeSec>=0&&this.seek(this._startTimeSec,this._seekKeyframe),this._main&&this._main.level&&this._main.level.details){this._main.setDownloadEnabled(!0),this._totalduration=this._main.level.details.totalduration;var e=[];this._main.level.details.live||this._main.level.details.fragments.forEach((function(t){e.push(t.start)})),this._observer.trigger(P.default.LEVEL_UPDATED,{duration:this._totalduration,times:e,targetduration:this._main.level.details.targetduration}),this._main.levelUpdated()}},n._loadLevel=function(e){var t=this;if(this._levels){var i=this._levels[e];if(i.m3u8)return ot.parseLevel(i,e),void this._levelUpdated();if(i.m3u8Slice&&this._startTimeSec<=0)return ot.parseLevelSlice(i,e),this._levelUpdated(),void(this._levelLoadDelayTimer=setTimeout((function(){t._requestLevel(e),t._levelLoadDelayTimer=void 0}),200));this._requestLevel(e)}},n._requestLevel=function(e){if(this._levels){var t=this._levels[e];if(t&&"object"==typeof t&&t.url.length>0&&this._playlistLoader){var i=t.urlId,r=t.url[i];this._playlistLoader.load({url:r,type:it.LEVEL,level:e,id:i,credentials:this._config.credentials})}}},n._clearLevelTimer=function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null)},n._initMultirate=function(){var e=this;this._config.adaptive&&!this._abr&&(this._abr=new De(this._config,this._media),this._abr.active(!0),this._abr.on(P.default.REPORT,(function(t,i){t===P.default.REPORT&&e._observer.trigger(P.default.REPORT,i)})),this._observer.on(P.default.ABR_NEXT,this._abrNext),this._observer.on(P.default.REPORT,(function(t,i){e._abr&&e._abr.onMessage(t,i)})),this._observer.on("mainNotify",(function(t){e._abr&&("ratechange"===t.type?e._abr.onRatechange(t.playbackRate):"waiting"===t.type&&e._abr.onWaiting())})))},n._checkNextLevel=function(e){this._main&&this._main.levels&&(!this._main.levels[e].details||this._main.levels[e].live)&&(this._main.setDownloadEnabled(!1),this._loadLevel(e))},n._abrActive=function(e){this._abr&&this._config.adaptive&&(e&&!this._abr.autoLevelEnabled&&this._observer.trigger(P.default.LEVEL_SWITCHING,{startSec:this._media.currentTime,level:-1,smooth:!0}),this._abr.active(e))},t=e,(i=[{key:"levels",get:function(){var e=[];return this._main&&this._main.levels.forEach((function(t){e.push({bandwidth:t.bitrate,bitrate:t.bitrate,maxBitrate:t.bandwidth,avgBitrate:t.averageBandwidth,width:t.width,height:t.height,qualityType:t.qualityType,qualityLabel:t.qualityLabel})})),e}},{key:"protocol",get:function(){return this._protocol}},{key:"isNetworkInUse",get:function(){return!!this._main&&this._main.isNetworkInUse}},{key:"autoLevelEnabled",get:function(){return!!this._abr&&!!this._abr.autoLevelEnabled}},{key:"current",get:function(){return!!this._main&&this._main.level}},{key:"currentLevel",get:function(){return this._main?this._main.index:0},set:function(e){e>=0?(this._abrActive(!1),this._main&&(e=Math.min(e,this._main.levels.length-1),this._main.index=e,this._manifestReady&&(this.seek(this._media.currentTime),this._checkNextLevel(e),this._observer.trigger(P.default.LEVEL_SWITCHING,{startSec:this._media.currentTime,level:e,smooth:!1})))):this._abrActive(!0)}},{key:"manualNextLevel",set:function(e){this._abrActive(e<0),this._manifestReady?this._main&&this._main.level.details&&e>=0&&(e=Math.min(e,this._main.levels.length-1),this._main.manualNext=e,this._checkNextLevel(e)):this.currentLevel=e}},{key:"nextLevel",get:function(){return this._main?this._main.next:0},set:function(e){this._main&&this._main.next!==e&&(this._main.next=e,this._checkNextLevel(e))}}])&&xt(t.prototype,i),r&&xt(t,r),e}();function At(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ot=function(e){var t,i;function r(t,i,r){var n;return void 0===r&&(r=!1),(n=e.call(this)||this)._config=void 0,n._observer=void 0,n._hls=void 0,n._onMessage=function(e,t){switch(e){case P.default.REPORT:n.emit(P.default.REPORT,t);break;case P.default.PARSING_INIT_SEGMENT:n._hls.current&&(t.manifestAudioCodec=n._hls.current.audioCodec,t.manifestVideoCodec=n._hls.current.videoCodec),n.emit(P.default.PARSING_INIT_SEGMENT,t);break;case P.default.PARSING_DATA:n.emit(P.default.PARSING_DATA,{data:t.payload,type:t.type,startDTS:t.startDTS||0,endDTS:t.endDTS||0,startPTS:t.startPTS||0,endPTS:t.endPTS||0,duration:t.endDTS-t.startDTS});break;case P.default.ERROR:n._config.retryWithBackup&&n._hls.nextBackup()?n.emit(P.default.REPORT,{type:V.REPORT_TYPES.USE_BACKUP}):n.emit(e,t);break;default:n.emit(e,t)}},n._config=t,n._observer=new Te.default,n._hls=new kt(n._observer,n._config,i,r),n}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,a,s,o=r.prototype;return o.init=function(){var e=this;this._bindObserver(this._observer),this._hls.init(),this.on("mainNotify",(function(t){e._observer.emit("mainNotify",t)}))},o.destroy=function(){var e=this._hls;e&&e.destroy();var t=this._observer;t&&t.removeAllListeners()},o.loadSource=function(){this._hls.loadSource()},o.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._hls.setDownloadEnabled(e)},o.seek=function(e,t,i){void 0===i&&(i=!1),this._hls.seek(e,t,i)},o.heartbeat=function(){},o.getCurrentUrl=function(){var e=this._hls.current;return e?e.url[e.urlId]:""},o.isSeekable=function(){return!this._config.isLive},o.setAvailableAbrLevels=function(e){this._hls.setAvailableAbrLevels(e)},o.streamingMux=function(e){this._hls.streamingMux(e)},o.usePreload=function(){this._hls.usePreload()},o._bindObserver=function(e){var t=this._onMessage;e.on(P.default.PARSING_INIT_SEGMENT,t),e.on(P.default.PARSING_DATA,t),e.on(P.default.ERROR,t),e.on(P.default.LEVEL_UPDATED,t),e.on(P.default.LEVEL_SWITCH_FAILED,t),e.on(P.default.LEVEL_SWITCHING,t),e.on(P.default.MANIFEST_PARSED,t),e.on(P.default.REPORT,t),e.on(P.default.LOAD_END,t),e.on(P.default.BUFFER_FLUSHING,t),e.on(P.default.SEEK_KEYFRAME,t),e.on(P.default.PRELOAD_COMPLETE,t)},n=r,(a=[{key:"levels",get:function(){return this._hls.levels}},{key:"autoLevelEnabled",get:function(){return this._hls.autoLevelEnabled}},{key:"nextLevel",get:function(){return this._hls.nextLevel},set:function(e){this._hls.manualNextLevel=e}},{key:"currentLevel",get:function(){return this._hls.currentLevel},set:function(e){this._hls.currentLevel=e}},{key:"protocol",get:function(){return this._hls.protocol}},{key:"isNetworkInUse",get:function(){return this._hls.isNetworkInUse}}])&&At(n.prototype,a),s&&At(n,s),r}(Te.default);function Pt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Dt=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this)._data=void 0,i._trans=void 0,i._eQueue=[],i._events=void 0,i._timeout=void 0,i._backupConf={fragBeforeWorker:2,retryWithBackup:!0},i._onEvents=function(e){return function(t){i._eQueue.push({type:e,data:t})}},i._onError=function(){i.destroy(),i.emit("end",!1)},i._data=t,i._events=[P.default.PARSING_DATA,P.default.PARSING_INIT_SEGMENT,P.default.LOAD_END,P.default.LEVEL_SWITCH_FAILED,P.default.LEVEL_SWITCHING,P.default.BUFFER_FLUSHING,P.default.SCRIPT_PARSED,P.default.MANIFEST_PARSED,P.default.LEVEL_UPDATED,P.default.SEEK_KEYFRAME],i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,a,s,o=r.prototype;return o.start=function(e,t){if(!this._trans){var i=this._data.config;this._data.auto=e,this._data.level=t,this._backupConf.fragBeforeWorker=i.fragBeforeWorker,this._backupConf.retryWithBackup=i.retryWithBackup,i.fragBeforeWorker=2,i.retryWithBackup=!1,this._trans=new Ot(i,new I,!0),this._trans&&(this._trans.init(),this._trans.streamingMux(!1),this._bind(this._trans),this._trans.loadSource(),this._timeout=setTimeout(this._onError,5e3))}},o.destroy=function(){this._trans&&(this._trans.removeAllListeners(),this._trans.destroy(),this._trans=void 0),this._eQueue=[],clearTimeout(this._timeout)},o.use=function(){var e=this;this._eQueue.forEach((function(t){e._trans&&e._trans.emit(t.type,t.data)})),this._trans=void 0},o._bind=function(e){var t=this;this._events.forEach((function(i){e.on(i,t._onEvents(i))})),e.on(P.default.PRELOAD_COMPLETE,(function(){t._data.config.fragBeforeWorker=t._backupConf.fragBeforeWorker,t._data.config.retryWithBackup=t._backupConf.retryWithBackup,e.removeAllListeners(),clearTimeout(t._timeout),t.emit("end",!0)})),e.on(P.default.REPORT,(function(e){e.type===V.REPORT_TYPES.DOWNLOAD?t.emit(P.default.REPORT,e):t._onEvents(P.default.REPORT)(e)})),e.on(P.default.ERROR,this._onError)},n=r,(a=[{key:"trans",get:function(){return this._trans}}])&&Pt(n.prototype,a),s&&Pt(n,s),r}(a.EventEmitter),It=function(){function e(e){this.tag="preloadM",this._waiting=[],this._running=void 0,this._cache=[],this._active=!1,this._monitor=void 0,this._updateTimer=void 0,this._monitor=e}var t=e.prototype;return t.check=function(e,t){if(t)for(var i=ct(e),r=0;r<this._cache.length;r++)if(this._cache[r].data.id===i){if(!(performance.now()-this._cache[r].ts<72e5))return void this._cache.splice(r,1);var n=this._cache.splice(r,1)[0];if(n.data.auto&&t.abrNow||!n.data.auto&&!t.abrNow&&n.data.level===t.level)return n}},t.add=function(e,t){if(f.Log.i(this.tag,"add preload task"),e=Object(n.ObjectAssign)({},e),y.setSrc(e,t),t){var i={data:{id:"",config:e},ts:performance.now()};this._waiting.push(i),this._delayUpdate()}},t.active=function(e){void 0===e&&(e=!1),this._active!==e&&(e?(this._active=e,this._delayUpdate()):(this._active=e,clearTimeout(this._updateTimer)))},t.clean=function(){this._waiting=[],this._running&&(this._running.app&&this._running.app.destroy(),this._running=void 0),this._active=!1},t.destroy=function(){this.clean(),this._cache.forEach((function(e){e.app&&e.app.destroy()})),this._cache=[],clearTimeout(this._updateTimer)},t.hasCache=function(){return this._cache.length>0},t._delayUpdate=function(){var e=this;clearTimeout(this._updateTimer),this._updateTimer=setTimeout((function(){e._update()}),1e3)},t._update=function(){var e=this;if(!this._running&&this._waiting.length&&this._active){var t=this._running=this._waiting.shift();if(t){var i=t.data;if(t.data.id=ct(i.config.src||i.config.manifest),!t.data.id)return this._running=void 0,void this._update();for(var r=0;r<this._cache.length;r++)if(this._cache[r].data.id===t.data.id)return this._cache.push(this._cache.splice(r,1)[0]),this._running=void 0,this._update(),void f.Log.i(this.tag,"preload exist");var n=new Dt(t.data);t.app=n,n.on("end",(function(i){i&&(f.Log.i(e.tag,"preload task done",e._waiting.length),e._cache.push(t),e._cache.length>50&&e._cache.shift(),e._monitor.onPreload()),e._running=void 0,e._delayUpdate()})),n.on(P.default.REPORT,(function(t){e._monitor.onReport(t)}));var a=this._monitor.data;n.start(a.abrNow,a.level),f.Log.i(this.tag,"preload task start")}}},e}();function Ct(e,t){if(void 0===t)return e;var i=new F.a(e,!0);return i.query.kabr_spts=""+t,i.toString()}var Nt=function(e){this.url=void 0,this.maxBitrate=0,this.avgBitrate=void 0,this.qualityType="",this.qualityLabel="",this.id=0,this.codec="",this.hidden=!1,this.enableAdaptive=!0,this.defaultSelect=!1,this.width=void 0,this.height=void 0,this.url=e};function Mt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ut=function(){function e(t){var i=this;if(this._levels=[],this._abrLevels=[],this._default=void 0,e.verify(t)){var r=t;r.adaptationSet.representation.sort((function(e,t){return e.bitrate-t.bitrate})),r.adaptationSet.representation.forEach((function(e,t){var r=new Nt(e.url);r.id=e.id||t,r.maxBitrate=e.bitrate||0,r.qualityType=e.qualityType||"",r.qualityLabel=e.name||"",r.codec=e.codec||"",r.hidden=e.hidden||!1,r.enableAdaptive=void 0===e.enableAdaptive||!!e.enableAdaptive,r.defaultSelect=e.defaultSelect||!1,i._levels.push(r),r.enableAdaptive&&i._abrLevels.push(t),r.defaultSelect&&void 0===i._default&&(i._default=t)}))}else st.verify(t)&&this.parse(t)}var t,i,r;return e.verify=function(e){return!!(e&&e.hasOwnProperty("version")&&e.hasOwnProperty("adaptationSet")&&e.adaptationSet.hasOwnProperty("representation")&&Array.isArray(e.adaptationSet.representation)&&e.adaptationSet.representation.length>0)&&(e.adaptationSet.representation.forEach((function(e){if(!e.url||!e.bitrate||!e.qualityType)return!1})),!0)},e.prototype.parse=function(e){var t=this;if(st.verify(e)){var i=e;i.adaptationSet[0]&&(i.adaptationSet[0].representation.sort((function(e,t){return e.maxBitrate-t.maxBitrate})),i.adaptationSet[0].representation.forEach((function(e,i){var r=new Nt(e.url);r.id=e.id||i,r.maxBitrate=e.maxBitrate||0,r.avgBitrate=e.avgBitrate||0,r.qualityType=e.qualityType||"",r.qualityLabel=e.qualityLabel||"",r.codec=e.codecs||"",r.hidden=e.hidden||!1,r.enableAdaptive=void 0===e.disableAdaptive||!e.disableAdaptive,r.defaultSelect=e.defaultSelect||!1,t._levels.push(r),r.enableAdaptive&&t._abrLevels.push(i),r.defaultSelect&&void 0===t._default&&(t._default=i)})))}},t=e,(i=[{key:"levels",get:function(){return this._levels}},{key:"abrLevels",get:function(){return this._abrLevels}},{key:"default",get:function(){return this._default||0}}])&&Mt(t.prototype,i),r&&Mt(t,r),e}(),Bt=i("./node_modules/@ks/adaptive-multi-rate/lib/adaptive-flv.js"),Ft=i.n(Bt);function Vt(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function jt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ht(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Gt=function(e){var t,i;function r(t,i){var r;return(r=e.call(this)||this)._config=void 0,r._media=void 0,r._smooth=void 0,r._downloadSize=0,r._downloadStartTime=0,r._qosStatInterval=0,r._qosStatIntervalCount=0,r._keyCount=0,r._index=0,r._algorithm=void 0,r._adaptiveQosStat=void 0,r._autoLevelEnabled=!1,r._manifest=void 0,r._getBufferedLengthMillis=function(){return 1e3*r._media.bufferedSec()},r._config=t,r._media=i,r._adaptiveQosStat={playStartTime:0,tickStart:0},r._manifest=new Ut(t.manifest),r._algorithm=new Ft.a(t.manifest,r._config.liveAdaptiveConfig,{index:r._index}),r._algorithm.on(P.default.ADAPTIVE_ALGORITHM,(function(e){return r.trigger(P.default.ADAPTIVE_ALGORITHM,e)})),r._autoLevelEnabled=!!t.adaptive,Ft.a.setLogLevel(r._config.kwaiKernelLog),r}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,a,s,o=r.prototype;return o.init=function(){this._downloadSize=0,this._downloadStartTime=performance.now(),this._qosStatInterval=2,this._qosStatIntervalCount=0,this._keyCount=0,this._manifest.levels&&(this._autoLevelEnabled&&(this._index=this._algorithm.nextIndex),this.trigger(P.default.MANIFEST_PARSED,{}))},o.destory=function(){this._algorithm&&this._algorithm.removeAllListeners()},o.onLoaderChunk=function(e){this._downloadSize+=e},o.onLevelLoad=function(e){this._manifest.levels.length&&e>=0&&e<this._manifest.levels.length&&(this._keyCount=0,this._adaptiveQosStat.playStartTime=Date.now(),this._index=e,this._algorithm&&this._algorithm.onLevelLoad(e))},o.onKeyFrame=function(e){var t=this._manifest.levels;if(this._keyCount++,(this._algorithm||"number"==typeof this._smooth)&&this._keyCount>1&&t){var i=this._index,r=!1;if("number"==typeof this._smooth)i=this._smooth,this._smooth=void 0;else{if(!this._autoLevelEnabled||!this._algorithm)return;this._algorithm.onGOP(this._getAdaptionInfo()),i=this._algorithm.nextIndex,r=!0}if(i!==this._index)return{url:this.getRequestUrl(i,e),level:i,auto:r}}},o.heartbeat=function(){if(this._algorithm&&this._autoLevelEnabled){var e=this._getAdaptionInfo();e.type=V.REPORT_TYPES.HEARTBEAT,this._algorithm.onHeartbeat(e),this._qosStatIntervalCount%this._qosStatInterval==0&&this._sendAdaptiveQosStat(),this._qosStatIntervalCount=(this._qosStatIntervalCount+1)%this._qosStatInterval}},o.getRequestUrl=function(e,t){var i=this._config.src,r=this._manifest.levels[e];return r&&(i=r.url),Ct(i,t||this._config.defaultSpts)},o._sendAdaptiveQosStat=function(){if(this._algorithm){var e=this._algorithm.qos,t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Vt(i,!0).forEach((function(t){jt(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Vt(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({type:V.REPORT_TYPES.LIVE_ADAPTIVE_QOS_STAT,play_start_time:this._adaptiveQosStat.playStartTime,tick_start:this._adaptiveQosStat.tickStart,current_gop_duration:0,buffer_time:Math.floor(this._getBufferedLengthMillis())},e);this._adaptiveQosStat.tickStart=Date.now(),this.trigger(P.default.REPORT,t)}},o._getAdaptionInfo=function(){var e={currentTime:Math.round(1e3*(this._media.currentTime||0)),buffered:this._getBufferedLengthMillis(),pendingBuffers:Math.round(1e3*this._media.pendingSecByType("video")),download:{size:this._downloadSize,duration:Math.round(performance.now()-this._downloadStartTime)}};return this._downloadStartTime=performance.now(),this._downloadSize=0,e},n=r,(a=[{key:"autoLevelEnabled",get:function(){return this._autoLevelEnabled}},{key:"levels",get:function(){return this._manifest.levels}},{key:"nextLevel",get:function(){return"number"==typeof this._smooth?this._smooth:this._index},set:function(e){e>=0?(e=Math.min(this._manifest.levels.length-1,e),this._autoLevelEnabled=!1,this._smooth=e):-1===e&&(this._autoLevelEnabled=this._config.adaptive)}},{key:"currentLevel",get:function(){return this._index},set:function(e){e>=0?(e=Math.min(this._manifest.levels.length-1,e),this._autoLevelEnabled=!1,this._index=e):-1===e&&(this._autoLevelEnabled=this._config.adaptive)}}])&&Ht(n.prototype,a),s&&Ht(n,s),r}(Te.default),Kt=i("./src/demux/flv/flv-demuxer-inline.ts"),qt=i("./src/demux/flv/flv.ts"),Wt=function(){function e(e,t){this._observer=void 0,this._cache=void 0,this._tag=void 0,this._result=void 0,this._parseLen=0,this._parseFunc=void 0,this._onAbr=void 0,this._observer=e,this._onAbr=t,this._cache=new gt,this._parseLen=qt.FlvSize.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._result={list:[]}}var t=e.prototype;return t.reset=function(){this._parseLen=qt.FlvSize.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0,this._result.list=[],this._result.abr=void 0},t.append=function(e){for(this._cache.put(new Uint8Array(e));this._cache.unreadLen>this._parseLen;)this._parseFunc();var t={list:this._result.list.splice(0),abr:this._result.abr};return this._result.abr=void 0,t},t._parseFlvHead=function(){var e=this._cache.read(qt.FlvSize.FLV_HEAD_LEN);e&&(70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||this._observer.trigger(P.default.ERROR,{type:O.ErrorTypes.MUX_ERROR,details:O.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"Flv: wrong head"}),this._observer.trigger(P.default.FLV_HEAD,{hasAudio:(4&e[4])>>>2,hasVideo:1&e[4]}),this._cache.skip(qt.FlvSize.FLV_HEAD_LEN),this._parseLen=qt.FlvSize.FLV_TAG_HEAD_LEN,this._parseFunc=this._parseFlvTagHead)},t._parseFlvTagHead=function(){this._tag=new qt.FlvTag;var e=this._cache.read(qt.FlvSize.FLV_TAG_HEAD_LEN);e&&(this._tag.tagType=e[0],this._tag.dataSize=((255&e[1])<<16)+((255&e[2])<<8)+(255&e[3]),this._tag.timestamp=((255&e[7])<<24)+((255&e[4])<<16)+((255&e[5])<<8)+(255&e[6]),this._cache.skip(qt.FlvSize.FLV_TAG_HEAD_LEN),this._tag.tagType===qt.FlvTagType.VIDEO?(this._parseFunc=this._detectKeyFrame,this._parseLen=qt.FlvSize.AVC_KEY_FRAME_CHECK_LEN):(this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+qt.FlvSize.FLV_TAG_SIZE_LEN))},t._detectKeyFrame=function(){var e=this._cache.read(2);if(e&&this._tag){var t=(240&e[0])>>>4,i=e[1];this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+qt.FlvSize.FLV_TAG_SIZE_LEN,1===t&&1===i&&this._onAbr&&(this._result.abr=this._onAbr(this._tag.timestamp),this._result.abr&&(this._parseLen=qt.FlvSize.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0))}},t._parseFlvTag=function(){var e=this._tag;e&&(e.tagType!==qt.FlvTagType.SCRIPT&&e.tagType!==qt.FlvTagType.AUDIO&&e.tagType!==qt.FlvTagType.VIDEO||(e.body=this._cache.get(e.dataSize),this._cache.skip(4),e&&this._result.list.push(e),this._tag=void 0),this._parseFunc=this._parseFlvTagHead,this._parseLen=qt.FlvSize.FLV_TAG_HEAD_LEN)},e}(),zt=function(){function e(e,t){this.tag="MultiPartLoader",this._observer=void 0,this._config=void 0,this._manifest=void 0,this._segment=void 0,this._callbacks=null,this._loaderCallbacks=null,this._loader=void 0,this._fragLoadConfig=void 0,this._segmentIndex=void 0,this._autoNext=void 0,this._removeFlvHead=void 0,this._periodId=void 0,this._seeking=!1,this._observer=e,this._config=t,this._loader=null,this._segmentIndex=0,this._autoNext=!0,this._removeFlvHead=!1,this._periodId=NaN}var t=e.prototype;return t.load=function(e,t,i){var r=0;this._callbacks=t,this._fragLoadConfig=i,this._manifest=e;var n=0,a=[];if(this._manifest.segments.forEach((function(e){e.time=n,a.push(n/1e3),n+=e.duration})),e.duration=n,this._initLoaderCallback(),this._config.startFromSec>0)r=this.seek(this._config.startFromSec,this._config.startFromKeyframe);else{this._autoNext=!0;var s=this._nextSegment();s&&this._loadSegment(s)}return this._observer.trigger(P.default.LEVEL_UPDATED,{duration:e.duration/1e3,times:a}),r},t.setDownloadEnabled=function(e){!this._autoNext&&e?this.resume():this._autoNext=e},t.pause=function(){f.Log.v(this.tag,"pause"),this._autoNext=!1},t.resume=function(){if(this._autoNext=!0,!this._loader){var e=this._nextSegment();e&&this._loadSegment(e)}},t.destroy=function(){this._callbacks=null,this._disposeLoader(this._loader),this._loader=null},t.seek=function(e,t){void 0===t&&(t=!1),this._loader&&(this._disposeLoader(this._loader),this._loader=null),this._seeking=!0,this._autoNext=!0,this._removeFlvHead=!1;var i=this._seekByTime(1e3*e||0);return t&&this._observer.trigger(P.default.SEEK_KEYFRAME,{keyFrameSec:i.time/1e3}),this._nextSegment(),this._loadSegment(i),i.time/1e3},t.getCurrentUrl=function(e){var t=St.search(this._manifest.segments,(function(t){return e<t.time?-1:e>t.time+t.duration?1:0}));return t?t.url:this._manifest.segments[0].url},t._initLoaderCallback=function(){var e=this;this._loaderCallbacks={onProgress:this._onLoaderChunkArrival.bind(this),onEnd:function(t,i,r){if(e._loader=null,!e._config.streamingMux&&i instanceof ArrayBuffer&&e._callbacks&&(e._removeFlvHead&&(i=i.slice(qt.FlvSize.FLV_HEAD_LEN,i.byteLength),e._removeFlvHead=!1),e._callbacks&&e._callbacks.onProgress&&e._callbacks.onProgress(t,i,r)),e._observer.trigger(P.default.REPORT,xe(ye.SUCCESS,t,r)),e._removeFlvHead=!0,e._hasNextSegment()){if(e._autoNext){var n=e._nextSegment();n&&e._loadSegment(n)}}else e._callbacks&&e._callbacks.onEnd(t,i,r)},onError:function(t,i){e._observer.trigger(P.default.REPORT,xe(ye.FAIL,t,i)),e._callbacks&&e._callbacks.onError(t,i)},onAbort:function(){}}},t._onLoaderChunkArrival=function(e,t,i){t instanceof ArrayBuffer&&this._callbacks&&this._callbacks.onProgress&&(this._removeFlvHead&&(t=t.slice(qt.FlvSize.FLV_HEAD_LEN,t.byteLength),this._removeFlvHead=!1),this._callbacks.onProgress(e,t,i))},t._loadSegment=function(e){this._disposeLoader(this._loader),this._loader=null,e&&(this._segment=e,this._config.baseURL&&(this._segment.url=Object(je.buildAbsoluteURL)(this._config.baseURL,this._segment.url,{alwaysNormalize:!0})),this._loader=new ne,isNaN(this._periodId)||this._periodId===e.periodId||this._seeking||(this._removeFlvHead=!1,f.Log.v(this.tag,"DISCONTINUITY"),this._observer.trigger(P.default.DISCONTINUITY,e.time/1e3)),this._periodId=e.periodId,this._seeking&&(this._seeking=!1),this._loaderCallbacks&&this._loader.load({url:e.url,responseType:"arraybuffer",progress:this._config.streamingMux,frag:e,credentials:this._manifest.withCredentials,type:"flv"},this._loaderCallbacks,this._fragLoadConfig))},t._disposeLoader=function(e){e&&e.destroy()},t._seekByTime=function(e){return this._segmentIndex=St.searchIndex(this._manifest.segments,(function(t){return e<t.time?-1:e>t.time+t.duration?1:0})),this._segmentIndex<0&&(this._segmentIndex=0),this._manifest.segments[this._segmentIndex]},t._hasNextSegment=function(){return this._manifest.segments&&this._manifest.segments.length>this._segmentIndex},t._nextSegment=function(){var e=null;return this._manifest.segments&&this._manifest.segments.length>this._segmentIndex&&(e=this._manifest.segments[this._segmentIndex],this._segmentIndex++),e},e}();function Yt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Qt=function(e){var t,i;function r(t,i){var r;(r=e.call(this)||this)._config=void 0,r._media=void 0,r._w=void 0,r._flv=void 0,r._observer=void 0,r._protocol=o.FLV,r._loader=null,r._loaderConf=void 0,r._loaderCallbacks=void 0,r._multirate=void 0,r._contiguous=void 0,r._remuxId=void 0,r._lastDTS=0,r._discontinuity=!1,r._accurateTimeOffset=!1,r._baseTimeSec=0,r._progressTime=0,r._tagDump=void 0,r._currentUrl=void 0,r._ready=!1,r._onKeyframe=function(e){if(r._multirate){var t=r._multirate.onKeyFrame(e);if(t){r._tagDump&&r._tagDump.reset();var i=Object(n.ObjectAssign)({},t);return r._baseTimeSec=r._lastDTS,i.startSec=r._baseTimeSec,i.smooth=!0,r.emit(P.default.LEVEL_SWITCHING,i),i}}r.emit(P.default.REPORT,{type:V.REPORT_TYPES.KEY_FRAME})},r._onMessage=function(e,t){switch(e){case P.default.FLV_HEAD:r._protocol===o.KWAI_FLV&&(t.hasAudio=r._config.manifest.hasAudio,t.hasVideo=r._config.manifest.hasVideo),r._w?r._w.postMessage({cmd:"flvHead",hasAudio:t.hasAudio,hasVideo:t.hasVideo}):r._flv&&r._flv.flvHead(t.hasAudio,t.hasVideo);break;case P.default.PARSING_INIT_SEGMENT:r.emit(P.default.PARSING_INIT_SEGMENT,t);break;case P.default.PARSING_DATA:if(t.extra&&t.extra.remuxId!==r._remuxId)break;r._lastDTS=t.endDTS,r.emit(P.default.PARSING_DATA,{data:t.payload,type:t.type,startDTS:t.startDTS||0,endDTS:t.endDTS||0,startPTS:t.startPTS||0,endPTS:t.endPTS||0,streamDTS:t.streamDTS||0,duration:t.endDTS-t.startDTS,framesInfo:t.framesInfo});break;case P.default.REPORT:t.type===V.REPORT_TYPES.HLS_VOD_ADAPTIVE_QOS_STAT&&(t.play_url=r._currentUrl),r.emit(e,t);break;case P.default.DISCONTINUITY:r._w?r._w.postMessage({cmd:"flush"}):r._flv&&r._flv.flush(),r._tagDump.reset(),r._discontinuity=!0,r._accurateTimeOffset=!1,r._contiguous=!1,r._baseTimeSec=t,r._observer&&r._observer.trigger(P.default.REPORT,{type:V.REPORT_TYPES.DISCONTINUITY,time:t});break;default:r.emit(e,t)}},r._config=t,r._media=i,t.manifest&&(Ut.verify(t.manifest)||st.verify(t.manifest)?r._protocol=o.ABR_FLV:r._protocol=o.KWAI_FLV),r._loaderConf={connectionTimeout:r._config.connectionTimeout,transmissionTimeout:r._config.transmissionTimeout,maxRetry:r._config.isLive?0:r._config.maxRetry,retryDelay:r._config.isLive?0:r._config.retryDelay,useFetch:r._config.isLive},r._loaderCallbacks={onProgress:r._onProgress.bind(Xt(r)),onError:r._onLoaderError.bind(Xt(r)),onEnd:r._onLoaderEnd.bind(Xt(r)),onAbort:r._onAbort.bind(Xt(r))},r._contiguous=!1,r._remuxId=1;var a=r._observer=new Te.default,s=r._onMessage;return a.on(P.default.METADATA,s),a.on(P.default.PARSING_INIT_SEGMENT,s),a.on(P.default.PARSING_DATA,s),a.on(P.default.ERROR,s),a.on(P.default.SCRIPT_PARSED,s),a.on(P.default.REPORT,s),a.on(P.default.PRIV_NAL,s),a.on(P.default.LOAD_END,s),a.on(P.default.DISCONTINUITY,s),a.on(P.default.LEVEL_UPDATED,s),a.on(P.default.SEEK_KEYFRAME,s),a.on(P.default.FLV_HEAD,s),r._tagDump=new Wt(a,r._onKeyframe),r._config.webWorker&&(f.Log.i("TransFLV","webWorker"),r._onWorkMessage=r._onWorkMessage.bind(Xt(r)),r._w=pt()(/*! ../demux/flv/flv-demuxer-worker */"./src/demux/flv/flv-demuxer-worker.ts"),r._w)?(ce.workerTimeOffset=performance.now(),r._w.addEventListener("message",r._onWorkMessage),r._w.postMessage({cmd:"init",config:r._config,data:{remuxId:r._remuxId},vendor:navigator.vendor}),Xt(r)):(r._flv=new Kt.default(a,r._config,{remuxId:r._remuxId},navigator.vendor),r._flv.init(),r)}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a,s,u,d=r.prototype;return d.init=function(){this._protocol!==o.ABR_FLV||this._multirate||(this._multirate=new Gt(this._config,this._media),this._multirate.on(P.default.REPORT,this._onMessage),this._multirate.on(P.default.MANIFEST_PARSED,this._onMessage),this._multirate.on(P.default.ADAPTIVE_ALGORITHM,this._onMessage),this._multirate.init()),this._ready=!0},d._onWorkMessage=function(e){var t=e.data;e.data.event===P.default.PARSING_DATA&&(t.data.payload=t.payload),this._onMessage(e.data.event,t.data)},d.loadSource=function(){var e=this._multirate;if(e){var t=e.levels[e.currentLevel];t?this._load(Ct(t.url,this._config.defaultSpts),e.currentLevel):this.emit(P.default.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.PARSING_ERROR,fatal:!0,reason:"manifest parse error"})}else this._load(this._config.src)},d.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._loader instanceof zt&&this._loader.setDownloadEnabled(e)},d.isSeekable=function(){return this._protocol===o.KWAI_FLV},d.seek=function(e,t){this.isSeekable()?(this._loader instanceof zt&&(this._refreshRemuxId(),this._baseTimeSec=this._loader.seek(e,t),this._accurateTimeOffset=!1,this._discontinuity=!0,this._contiguous=!1),this._tagDump&&this._tagDump.reset()):this.emit(P.default.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.CANNOT_SEEK,fatal:!0,reason:"can not seek"})},d.heartbeat=function(){this._multirate&&this._multirate.heartbeat()},d.destroy=function(){this._loader&&(this._loader.destroy(),this._loader=null),this._w&&(this._w.postMessage({cmd:"destroy"}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate()),this._flv&&(this._flv.destroy(),this._flv=void 0),this._multirate&&(this._multirate.removeAllListeners(),this._multirate.destory());var e=this._observer;e&&e.removeAllListeners()},d.getCurrentUrl=function(){var e=this._config.src;return this._protocol===o.ABR_FLV?e=this._currentUrl:this._protocol===o.KWAI_FLV&&(e=this._loader.getCurrentUrl(0)),e},d.setAvailableAbrLevels=function(e){},d.streamingMux=function(e){},d._load=function(e,t){void 0===t&&(t=0),this._loader&&(this._loader.destroy(),this._loader=null),this._multirate&&this._multirate.onLevelLoad(t),this._currentUrl=e;var i=this.levels[t];if(this._observer.trigger(P.default.REPORT,{type:V.REPORT_TYPES.NEW_SOURCE,url:e,sync:this._baseTimeSec,index:t,bitrate:i?i.bitrate:0,maxBitrate:i?i.bitrate:0,avgBitrate:i?i.avgBitrate:0,qualityType:i?i.qualityType:void 0,qualityLabel:i?i.qualityLabel:void 0}),this._protocol===o.KWAI_FLV)this._loader||(this._loader=new zt(this._observer,this._config)),this._baseTimeSec=this._loader.load(this._config.manifest,this._loaderCallbacks,this._loaderConf)||0;else{this._loader||(this._loader=new ne);var r={url:e,progress:!0,responseType:"arraybuffer",credentials:this._config.credentials};this._loader instanceof ne&&this._loader.load(r,this._loaderCallbacks,this._loaderConf)}},d._append=function(e,t,i,r,n){this._w?this._w.postMessage({cmd:"append",tags:e,timeOffset:t||0,discontinuity:i,contiguous:r,accurateTimeOffset:n}):this._flv&&this._flv.append(e,t||0,i,r,n)},d._onProgress=function(e,t,i){if(t instanceof ArrayBuffer){this._multirate&&this._multirate.onLoaderChunk(t.byteLength),this._observer&&this._observer.trigger(P.default.REPORT,{type:V.REPORT_TYPES.LOADER_CHUNK_ARRIVAL,byteLength:t.byteLength,timeCost:performance.now()-this._progressTime||i.trequest,header:e.responseHeader}),this._progressTime=performance.now();var r=this._tagDump.append(t);r.list.length&&(this._append(r.list,this._baseTimeSec,this._discontinuity,this._contiguous,this._accurateTimeOffset),this._accurateTimeOffset=!0,this._contiguous=!0,this._discontinuity=!1),r.abr&&this._load(r.abr.url,r.abr.level)}},d._onAbort=function(){},d._onLoaderError=function(e,t){if(t.fatal){var i={type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url};this.emit(P.default.ERROR,i)}},d._onLoaderEnd=function(){this._w?this._w.postMessage({cmd:"end"}):this._flv&&this._flv.end()},d._refreshRemuxId=function(){this._remuxId++;var e={remuxId:this._remuxId};this._w?this._w.postMessage({cmd:"setExtra",data:e}):this._flv&&this._flv.setExtra(e)},a=r,(s=[{key:"protocol",get:function(){return this._protocol}},{key:"isNetworkInUse",get:function(){return!0}},{key:"autoLevelEnabled",get:function(){return!!this._multirate&&this._multirate.autoLevelEnabled}},{key:"levels",get:function(){var e=[];return this._multirate&&this._multirate.levels.forEach((function(t){e.push({width:t.width,height:t.height,bitrate:t.maxBitrate,maxBitrate:t.maxBitrate,avgBitrate:t.avgBitrate,qualityType:t.qualityType,qualityLabel:t.qualityLabel})})),e}},{key:"nextLevel",get:function(){return this._multirate?this._multirate.nextLevel:0},set:function(e){this._ready||(this.currentLevel=e);var t=this._multirate;t&&(-1===e&&this.emit(P.default.LEVEL_SWITCHING,{level:-1,startSec:this._media.currentTime,smooth:!0,auto:!0}),t.nextLevel=e)}},{key:"currentLevel",get:function(){return this._multirate?this._multirate.currentLevel:0},set:function(e){var t=this._multirate;if(t){var i=e>=0||e!==t.currentLevel;t.currentLevel=e;var r=t.levels[t.currentLevel];i&&r&&this._ready&&(this._currentUrl=Ct(r.url,this._config.defaultSpts),this._refreshRemuxId(),this._contiguous=!1,this._discontinuity=!0,this._accurateTimeOffset=!1,this._tagDump&&this._tagDump.reset(),this._baseTimeSec=this._media.currentTime,this.emit(P.default.LEVEL_SWITCHING,{level:t.currentLevel,startSec:this._baseTimeSec,smooth:!1,auto:!1}),this._load(this._currentUrl,t.currentLevel))}}}])&&Yt(a.prototype,s),u&&Yt(a,u),r}(Te.default),Jt={hls:Ot,flv:Qt};function Zt(e,t){return e.reduce((function(i,r,n){return(e[i].bitrate+r.bitrate)/2>=t?i:n}),0)}var $t,ei=function(){function e(e,t){this.tag="PlaybackRateManager",this._media=void 0,this._config=void 0,this._interval=0,this._timer=void 0,this._media=e,this._config=t}var t=e.prototype;return t.start=function(){this._interval=this._interval||this._config.startDelay||this._config.interval||5,this._tick(),this._interval=this._config.interval||1},t.stop=function(){this._timer&&(clearTimeout(this._timer),this._timer=0)},t.dispose=function(){this._timer&&(clearTimeout(this._timer),this._timer=0)},t._tick=function(){var e=this;this._timer||(this._timer=setTimeout((function(){e._media.video&&e._nextPlayBackRate(e._media.bufferedSec(),e._media.video),e._timer=0,e._tick()}),1e3*this._interval))},t._nextPlayBackRate=function(e,t){var i=1,r=this._config.rule,n=0;for(n=0;n<r.length&&!(t.playbackRate>=r[n].rate);n++);var a=n<r.length-1?r[n+1]:null,s=n>0?r[n-1]:null;i=r[n].rate,s&&e>s.lower&&(i=s.rate),a&&e<a.upper&&(i=a.rate),t.playbackRate!==i&&(f.Log.v(this.tag,"Change playback rate from "+t.playbackRate+" to "+i),t.playbackRate=i)},e}();function ti(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ii(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ri(e,t,i){return t&&ii(e.prototype,t),i&&ii(e,i),e}i.d(t,"default",(function(){return ni})),function(e){e[e.NONE=0]="NONE",e[e.WAITING=1]="WAITING",e[e.SEEK=2]="SEEK",e[e.SELECT_BITRATE=3]="SELECT_BITRATE",e[e.INIT=4]="INIT"}($t||($t={}));var ni=function(e){var t,i;function r(t,i){var n,a;return(n=e.call(this)||this).tag="kernel",n._config=void 0,n._video=void 0,n._mse=void 0,n._monitor=void 0,n._transmuxer=void 0,n._playbackRateManager=null,n._stat=$t.INIT,n._seekOnCanplay=!1,n._skipSeekEvent=!1,n._internalSeekFlag=!1,n._isFlushVideoBufferOnEnd=!1,n._audioCodecSwap=!1,n._error=void 0,n._audioCodec="",n._recoverMediaErrorTime=0,n._mainTimer=void 0,n._hbTimer=void 0,n._media=void 0,n._nextLevel=[],n._mediaInfo=void 0,n._streamingMuxThreshold=11,n._loadStopped=!1,n._preloader=void 0,n._streamTimeOffset=0,n._playingLevel=void 0,n._preloadProcessing=!1,n._startLevel=void 0,n._flvLiveRetry=0,n._flvLiveRetryTimer=void 0,n._levelSwitchId=0,n._liveEnd=!1,n._onVideoPlay=function(){f.Log.i(n.tag,"play"),n._error||(n._transmuxer||n.load(),n._monitor.onPlay())},n._onVideoEnded=function(){n._monitor.onEnd(),n._stopHeartbeat(),n._isFlushVideoBufferOnEnd&&n._mse&&(n._mse.flush(),n._checkStreamingMux())},n._resetMSE=function(){f.Log.i(n.tag,"rebuild mse"),URL.revokeObjectURL(n._video.src),n._video.src="",n._video.removeAttribute("src"),n._destroyMSE(),n._initMSE()},n._seeked=function(){n._monitor.onSeeked()},n._seek=function(){if(f.Log.i(n.tag,"seek to "+n._video.currentTime+" internal:"+n._internalSeekFlag),n._video&&n._video.currentTime>=n._video.duration&&n._mse&&n._mse.ended())return n._video.currentTime;n._checkStreamingMux();var e=n._internalSeekFlag;if(n._internalSeekFlag=!1,n._skipSeekEvent)return n._skipSeekEvent=!1,n._video.currentTime;n._monitor.onSeek(e);var t=n._video.currentTime;return n._media.isTimeinBuffered(t)?e||(h.default.msedge||h.default.msie?(n._seekOnCanplay=!0,n._seekWithLoad()):n._transmuxer&&"hls"===n._config.box&&n._transmuxer.seek(t,!1,!0)):0===t&&n._video.buffered.length>0&&n._video.buffered.start(0)<1?e||n._internalSeek(n._video.buffered.start(0)):n._seekWithLoad(),t},n._seekWithLoad=function(){if(!n._config.isLive&&n._transmuxer&&n._mse){n._preloader&&n._preloader.active(!1);var e=n._video.currentTime;n._monitor.onSeekWithLoad(e),n._stat=$t.SEEK,n._nextLevel.length&&(n._nextLevel=n._nextLevel.slice(n._nextLevel.length-1),n._nextLevel[0].startSec=e),n._mse.flush(),n._transmuxer.seek(e,n._config.alwaysSeekKeyframe,!1)}},n._mainLoop=function(){var e=n._video;if((n._stat===$t.WAITING&&!e.seeking||n._stat===$t.INIT||n._stat===$t.SEEK||n._stat===$t.SELECT_BITRATE)&&n._mse&&!n._mse.hasCleanUpTask()&&!e.ended){var t=e.currentTime,i=n._media.currentBuffer(t),r=void 0;if(!i||i.end-t<1){var a=n._media.nextBuffer(t);a&&(f.Log.i(n.tag,"try fix block-A"),r=a.start)}else n._video.buffered.length>1&&i.end-t>1&&(f.Log.i(n.tag,"try fix block-B"),r=i.start);r&&(r+=h.default.safari?.3:.001,n._internalSeek(r),f.Log.i(n.tag,"jump to "+r))}n._nextLevel.length&&n._checkLevelChange()},n._onVideoLoadeddata=function(){f.Log.i(n.tag,"loadeddata"),n._monitor.onLoadeddata()},n._onVideoCanplay=function(){f.Log.i(n.tag,"canplay "+!!n._stat),n._monitor.onCanplay(),n._stat!==$t.NONE&&(n._stat=$t.NONE,n._transmuxer&&n._transmuxer.emit("mainNotify",{type:"canplay"}),n._detectSeekOnCanplay(),n._checkLevelChange(),n._video.paused||n._onVideoPlaying()),K||(K=new Y("kwai","pre"))},n._onVideoWaiting=function(){if(n._liveEnd&&n._config.box===u.flv&&n._config.isLive)n.stopLoad();else{n._stat=n._stat||$t.WAITING;var e=n._media.bufferedSec(),t=!n._video.seeking&&n._stat===$t.WAITING;t&&n._transmuxer&&n._transmuxer.emit("mainNotify",{type:"waiting"}),n._monitor.onWaiting(t,e)}},n._onVideoPlaying=function(){f.Log.i(n.tag,"playing"),n._error||(n._stat=$t.NONE,n._startHeartbeat(),n._monitor.onPlaying())},n._onVideoPause=function(){f.Log.i(n.tag,"pause"),n._video.ended||n._monitor.onPause()},n._onVideoError=function(e){if(f.Log.e(n.tag,"video error",e),!n._error){var t=performance.now();if(!n._recoverMediaErrorTime||t-n._recoverMediaErrorTime>3e3)return n._recoverMediaErrorTime=t,n._config.box===u.flv&&n._config.isLive?n._config.gopRemux=!0:n._config.streamingMux=!1,void n._recoverMedia();if(!n._audioCodecSwap&&n._audioCodec)return n._audioCodecSwap=!0,n._recoverSwapAudioCodec(),void n._recoverMedia();var i="video error";n._video&&n._video.error&&(i+=" code:"+n._video.error.code+" message:"+n._video.error.message),n._onError({type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.VIDEO_ERROR,fatal:!0,reason:i})}},n._onVideoRatechange=function(){n._transmuxer&&n._transmuxer.emit("mainNotify",{type:"ratechange",playbackRate:n._video.playbackRate}),n._monitor.onRateChange(n._video.playbackRate),f.Log.v(n.tag,"ratechange "+n._video.playbackRate)},n._onVideoDurationchange=function(){n._monitor.onDurationChange(n._video.duration)},n._heartbeat=function(){n._monitor.heartbeat(),n._updateBufferControl(),n._transmuxer&&(n._transmuxer.heartbeat(),n._preloader&&n._preloader.active(!n._transmuxer.isNetworkInUse&&"closed"!==n._media.mseReadyState))},n._video=t,n.off||(n.off=n.removeListener),n._config=y.processConfig(i),n._media=new I,n._media.attachVideo(n._video),n._config?r.isSupport(n._config)?(n._mainTimer=null,n._isFlushVideoBufferOnEnd=!1,n._parseUrlConfig(),n._bindEvents(),n._initMSE(),n._initLogger(),n._startMainTimer(),It&&(n._preloader=new It(n._monitor)),n._config.autoPlaybackRateConf&&(n._playbackRateManager=new ei(n._media,n._config.autoPlaybackRateConf)),!n._config.isLive&&(n._config.startFromSec>0||n._config.startFrom&&n._config.startFrom>0)&&(n._config.startFromSec=n._config.startFromSec||(n._config.startFrom||0)/1e3,n._internalSeek(n._config.startFromSec),n._skipSeekEvent=!0),n._config.box===u.hls&&n._config.resourceBuffer&&(a=n._config.resourceBufferSize,performance&&("function"==typeof performance.setResourceTimingBufferSize?performance.setResourceTimingBufferSize(a):"function"==typeof performance.webkitSetResourceTimingBufferSize&&performance.webkitSetResourceTimingBufferSize(a)),performance.onresourcetimingbufferfull=Re),f.Log.i("kernel",r.version,n._config),n):(setTimeout((function(){n._onError({type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"unsupported"})}),0),ti(n)):(setTimeout((function(){n._onError({type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.CONFIG_ERROR,fatal:!0,reason:"config data error"})}),0),ti(n))}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r.isSupport=function(e){var t,i,r,n,a=(t=N(),i=window.SourceBuffer||window.WebKitSourceBuffer,r=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!i||i.prototype&&"function"==typeof i.prototype.appendBuffer&&"function"==typeof i.prototype.remove,r&&n),s=!0;e&&(s=e.isLive&&e.box===u.flv);var o=y.isStreamingSupport(e);return a&&!(s&&!o)},ri(r,null,[{key:"version",get:function(){return"2.1.3"}},{key:"MediaBox",get:function(){return u}},{key:"Events",get:function(){return l}},{key:"Reports",get:function(){return c}}]);var a=r.prototype;return a._initLogger=function(){var e=this;this._monitor=new be(r.version,this._media,this._config),this._monitor.on("report",(function(t){e.emit(l.REPORT,t)}))},a._bindEvents=function(){this._video&&(this._video.addEventListener("loadeddata",this._onVideoLoadeddata),this._video.addEventListener("canplay",this._onVideoCanplay),this._video.addEventListener("waiting",this._onVideoWaiting),this._video.addEventListener("playing",this._onVideoPlaying),this._video.addEventListener("pause",this._onVideoPause),this._video.addEventListener("play",this._onVideoPlay),this._video.addEventListener("error",this._onVideoError),this._video.addEventListener("ended",this._onVideoEnded),this._video.addEventListener("ratechange",this._onVideoRatechange),this._video.addEventListener("durationchange",this._onVideoDurationchange))},a._unbindMediaSourceEvent=function(e){e.removeAllListeners()},a._initMSE=function(){var e=this;this._mse=new U(this._config),this._mse.attach(this._video),this._media.attachMSE(this._mse),this._mse.on(P.default.ERROR,(function(t){e._onError(t)})),this._mse.on("bufferFull",(function(){e._config.lazyLoad&&e._transmuxer&&e._transmuxer.setDownloadEnabled(!1),e._monitor.onMSEBufferFull()})),this._mse.on("updateend",(function(){e._monitor.mseUpdate(),e._stat!==$t.NONE&&e._media.isTimeinBuffered(e._video.currentTime)&&4===e._video.readyState?(e._onVideoCanplay(),f.Log.v(e.tag,"canplay polyfill")):e._seekOnCanplay&&e._detectSeekOnCanplay()})),this._mse.on("remove",(function(){e._monitor.mseRemove()}))},a.load=function(e,t){void 0===e&&(e=void 0),f.Log.i(this.tag,"load");var i=!!this._transmuxer,r=this._monitor.data;this._monitor.reset(i),this._playingLevel=void 0,this._flvLiveRetry=0,e&&y.setSrc(this._config,e),this._config.src||this._config.manifest?(this._preloader&&this._preloader.active(!1),t?("number"==typeof t.bitrateStart&&(this._config.bitrateStart=t.bitrateStart),"number"==typeof t.startFromSec&&(this._config.startFromSec=t.startFromSec)):i&&(this._config.startFromSec=0),this._checkPreload(r)||(f.Log.i(this.tag,"preload miss"),this._load()),this._preloader&&this._preloader.clean()):this._onError({type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.CONFIG_ERROR,fatal:!0,reason:"url empty"})},a._load=function(e){void 0===e&&(e=!1),f.Log.i(this.tag,"_load"),this._loadStopped=!1,this._error=!1,this._internalSeekFlag=!1,this._stat=$t.INIT,this._nextLevel=[],this._liveEnd=!1,this._monitor.onLoad(this._config.src,e),this._transmuxer&&this._destroyTrans(),(this._mse.hasSourceBuffer()||this._video.error)&&this._resetMSE(),this._startHeartbeat(),this._initTrans(),this._transmuxer&&(this._transmuxer.loadSource(),this._config.autoPlaybackRate&&this._playbackRateManager&&this._playbackRateManager.start())},a.getTimeNow=function(){return ue.serverNowMs},a._verifyLevel=function(e){return!(!(this._transmuxer&&this._transmuxer.levels.length>0&&e<this._transmuxer.levels.length&&this._mse&&this._video)||this._video.ended)},a.selectBitrate=function(e,t){if(void 0===t&&(t=!1),this._transmuxer){var i=-1;if(e>=0&&(i=Zt(this._transmuxer.levels,e)),!this._verifyLevel(i))return;t?this.nextLevel=i:this.currentLevel=i}},a.getBitrates=function(){var e=[];return this._transmuxer&&this._transmuxer.levels.forEach((function(t){e.push(t.bitrate)})),e},a.getLevels=function(){return this._transmuxer?this._transmuxer.levels:[]},a.getCurrentLevelIndex=function(){return this._transmuxer?this._transmuxer.currentLevel:0},a.getCurrentLevel=function(){if(this._transmuxer){var e=this._transmuxer.levels;if(e.length>0)return e[this._transmuxer.currentLevel]}return null},a.setAvailableAbrBitrates=function(e){var t=this;if(this._transmuxer&&e&&e.length){var i=[];e.forEach((function(e){t._transmuxer&&i.push(Zt(t._transmuxer.levels,e))})),this.setAvailableAbrLevels(i)}},a.setAvailableAbrLevels=function(e){this._transmuxer&&e&&e.length&&this._transmuxer.setAvailableAbrLevels(e)},a.preload=function(e){this._config.box===u.hls&&!this._config.isLive&&this._preloader&&this._preloader.add(this._config,e)},a._checkPreload=function(e){if(!this._preloader||!this._preloader.hasCache()||!this._transmuxer||this._config.startFromSec)return!1;var t=this._preloader.check(this._config.manifest,e);return!!(t&&t.app&&t.app.trans)&&(this._config=t.data.config,this._stat=$t.INIT,this._audioCodecSwap=!1,this._destroyTrans(),this._mse.hasSourceBuffer()&&this._resetMSE(),this._transmuxer=t.app.trans,this._monitor.onPreloadHit(this._transmuxer.getCurrentUrl()),this._transmuxerEvent(this._transmuxer),this._preloadProcessing=!0,t.app.use(),this._preloadProcessing=!1,this._transmuxer.usePreload(),this._startHeartbeat(),f.Log.i(this.tag,"preload hit"),this.emit(l.PRELOAD_HIT),!0)},a._transmuxerEvent=function(e){var t=this,i=this._mse;e.on(P.default.PARSING_DATA,(function(e){i&&(i.mediaSegment(e),t._updateBufferControl()),"audio"===e.type&&e.streamDTS>0&&e.startDTS>0&&(t._streamTimeOffset=e.streamDTS-e.startDTS),t._monitor&&t._monitor.onSegment({type:e.type,byteLength:e.data.byteLength,dts:Math.floor(1e3*e.startDTS),duration:Math.floor(1e3*e.duration),framesInfo:e.framesInfo})})),e.on(P.default.PARSING_INIT_SEGMENT,(function(e){if(t._nextLevel.length){var r=t._nextLevel[t._nextLevel.length-1];r.init=!0,t.emit(l.LEVEL_SWITCHED,{bitrate:r.bitrate,level:r.level,smooth:r.smooth,auto:r.auto,id:r.id})}var a=e.tracks.video,s=e.tracks.audio,o={segments:[],hasVideo:!!a,hasAudio:!!s};for(var u in e.tracks){var d=e.tracks[u];Object(n.ObjectAssign)(o,d.metadata),d.initSegment&&o.segments.push({type:u,data:new Uint8Array(d.initSegment)})}o.videoCodec=a?a.codec:null,o.audioCodec=s?s.codec:null,t._audioCodec=e.manifestAudioCodec||o.audioCodec;var h=Object(n.ObjectAssign)({},o);delete h.segments,t._monitor.onSegmentInit(h),t.emit(l.REPORT,{type:c.MEDIA_INFO,value:h}),t._mediaInfo||(t._video.addEventListener("seeking",t._seek),t._video.addEventListener("seeked",t._seeked)),t._mediaInfo=h,i&&i.trackInfo(o),t._startMainTimer()})),e.on(P.default.ERROR,(function(e){t._onError(e)})),e.on(P.default.LOAD_END,(function(){!t._liveEnd&&t._config.isLive&&t._config.box===u.flv?t._onError({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.LIVE_DISCONNECTED_ERROR,fatal:!0,reason:"live disconnected"}):(i&&i.endOfData(),t.emit(l.LOAD_END))})),e.on(P.default.REPORT,(function(e){t._monitor&&t._monitor.onReport(e)})),e.on(P.default.ADAPTIVE_ALGORITHM,(function(e){return t.emit("adaptiveAlgorithm",e)})),e.on(P.default.LEVEL_SWITCH_FAILED,(function(e){e&&e.smooth?t.currentLevel=e.level:t.emit(l.LEVEL_SWITCH_FAILED)})),e.on(P.default.LEVEL_SWITCHING,(function(i){i.id=t._levelSwitchId,t._levelSwitchId++,i.auto=e.autoLevelEnabled,t._monitor.levelSwitching(e.getCurrentUrl(),i.auto),!i.smooth&&t._mse&&(t._mse.flush(),t._checkStreamingMux()),i.bitrate=i.level<0?-1:e.levels[i.level].bitrate,t.emit(l.LEVEL_SWITCHING,{bitrate:i.bitrate,level:i.level,smooth:i.smooth,auto:i.auto,id:i.id}),-1===i.level?t.emit(l.LEVEL_SWITCHED,{bitrate:i.bitrate,level:i.level,smooth:i.smooth,auto:i.auto,id:i.id}):(t._nextLevel=t._nextLevel.sort((function(e,t){return e.startSec-t.startSec})).filter((function(e){return e.startSec<i.startSec-.5})),t._nextLevel.push(i))})),e.on(P.default.BUFFER_FLUSHING,(function(e){t._mse&&t._mse.flush(e.startSec,t._video.duration)})),e.on(P.default.SCRIPT_PARSED,(function(e){e.hasOwnProperty("onMetaData")&&t.emit(l.REPORT,{type:c.METADATA,value:e.onMetaData})})),e.on(P.default.MANIFEST_PARSED,(function(i){if(f.Log.i(t.tag,"manifest parsed"),"number"!=typeof t._playingLevel){var r,a=void 0,s=t._config.bitrateStart;if("number"==typeof s&&s>=0)r=Zt(e.levels,s),a=s>=0?r:-1;"number"==typeof t._startLevel&&(a=t._startLevel),"number"==typeof a&&(-1===a&&e.autoLevelEnabled||(e.currentLevel=a));var o=t.getBitrates(),u=o[e.currentLevel];(i=Object(n.ObjectAssign)({bitrates:o,bitrate:u,levels:t.getLevels().slice(0),currentLevel:t.currentLevel},i)).levels=t.getLevels(),t._playingLevel=e.currentLevel,f.Log.i(t.tag,P.default.MANIFEST_PARSED,i),t.emit(l.MANIFEST_PARSED,i),t._monitor.onManifest(e.getCurrentUrl(),e.protocol,u,e.autoLevelEnabled)}else e.currentLevel=t._playingLevel})),e.on(P.default.LEVEL_UPDATED,(function(e){e.targetduration&&(t._streamingMuxThreshold=Math.max(e.targetduration+1,11)),!t._config.isLive&&e.duration&&t._mse&&t._mse.updateDuration(e.duration),t._monitor.onLevel(),f.Log.i(t.tag,P.default.LEVEL_UPDATED,e),t.emit(l.LEVEL_UPDATED,e)})),e.on(P.default.SEEK_KEYFRAME,(function(e){t._skipSeekEvent=!0;try{t._internalSeek(e.keyFrameSec)}catch(e){}})),e.on(P.default.PRIV_NAL,(function(e){t._monitor.onPrivNal(e)}))},a.isTimeinBuffered=function(e){return this._media.isTimeinBuffered(e)},a._internalSeek=function(e){this._internalSeekFlag=!0;try{this._video.currentTime=e}catch(e){}},a._updateBufferControl=function(){if(this._transmuxer&&this._mse){var e=this._media.bufferedSec(),t=this._mse.getBufferQueueSec(),i=!0;if(this._checkStreamingMux(e),(e<this._config.lazyLoadRecoverDuration||!this._config.lazyLoad&&!this._mse.getAppendEnabled())&&this._mse.setAppendEnabled(!0),e+t>=("closed"===this._media.mseReadyState?1:this._config.lazyLoadMaxDuration))i=!1;else{if(!(e+t<this._config.lazyLoadRecoverDuration))return;i=!0}this._config.lazyLoad&&this._transmuxer&&(f.Log.v(this.tag,"download: "+i+" buffered:"+e+" mse:"+t),this._transmuxer.setDownloadEnabled(i)),this._media.pendingNum()&&this._mse.refresh()}},a._detectSeekOnCanplay=function(){this._seekOnCanplay&&this._mse&&!this._mse.hasCleanUpTask()&&this._media.isTimeinBuffered(this._video.currentTime+.001)&&(f.Log.i(this.tag,"seek on canplay "+this._video.currentTime+" + 0.001"),this._seekOnCanplay=!1,this._internalSeek(this._video.currentTime+.001))},a.resume=function(){f.Log.i(this.tag,"call resume"),this._loadStopped&&!this._liveEnd&&(this._loadStopped=!1,this._load(!0)),this._video.paused&&this._video.play()},a.destroy=function(){this._stopFlvLiveRetryTimer(),this._stopMainTimer(),this._stopHeartbeat(),this._monitor&&(this._monitor.destroy(),this._monitor.removeAllListeners()),this._video.removeEventListener("loadeddata",this._onVideoLoadeddata),this._video.removeEventListener("canplay",this._onVideoCanplay),this._video.removeEventListener("seeking",this._seek),this._video.removeEventListener("seeked",this._seeked),this._video.removeEventListener("waiting",this._onVideoWaiting),this._video.removeEventListener("playing",this._onVideoPlaying),this._video.removeEventListener("pause",this._onVideoPause),this._video.removeEventListener("play",this._onVideoPlay),this._video.removeEventListener("error",this._onVideoError),this._video.removeEventListener("ended",this._onVideoEnded),this._video.removeEventListener("ratechange",this._onVideoRatechange),this._video.removeEventListener("durationchange",this._onVideoDurationchange),this._stopVideo(),this._playbackRateManager&&this._playbackRateManager.dispose(),performance.onresourcetimingbufferfull=null,this._preloader&&this._preloader.destroy()},a.seek=function(e){f.Log.i(this.tag,"call kernel seek"),this._config.isLive||(this._internalSeekFlag=!1,this._video.currentTime=e)},a.play=function(){return f.Log.i(this.tag,"call kernel play"),this._video.play()},a.pause=function(){return f.Log.i(this.tag,"call kernel pause"),this._video.pause()},a.refresh=function(e){void 0===e&&(e=!1),f.Log.i(this.tag,"call kernel refresh"),this._liveEnd||(this._reload(e),this._flvLiveRetry=0)},a.stopLoad=function(){f.Log.i(this.tag,"call kernel stopLoad"),this._transmuxer&&(this._destroyTrans(),this._stopHeartbeat(),this._loadStopped=!0,this._playbackRateManager&&this._playbackRateManager.stop(),this._monitor.onStopLoad())},a.getStreamTime=function(e){return this._streamTimeOffset?e+1e3*this._streamTimeOffset:NaN},a.getCurrentBitrate=function(){if(this._transmuxer){var e=this._transmuxer.levels[this._transmuxer.currentLevel];if(e)return e.bitrate}return 0},a.getAudienceStat=function(){return this._monitor.audienceStat},a.getMediaInfo=function(){return Object(n.ObjectAssign)({},this._mediaInfo)},a.experiment=function(e){e&&null!=typeof e.startBitrateLimit&&(this._config.hlsAdaptiveConfig?this._config.hlsAdaptiveConfig.startBitrateLimit=e.startBitrateLimit:this._config.hlsAdaptiveConfig={startBitrateLimit:e.startBitrateLimit})},a.liveEnd=function(){f.Log.i(this.tag,"liveEnd",this._config.isLive),this._config.isLive&&(this._liveEnd=!0)},a._reload=function(e){void 0===e&&(e=!1),this._transmuxer&&this._mse?(this._config.startFromSec=this._video.currentTime,this._startLevel=this._transmuxer.currentLevel,this._nextLevel=[],e?(this._mse.flush(),this._internalSeek(0),this._destroyTrans(),this._seekOnCanplay=!0):(this._internalSeekFlag=!1,this._stopVideo(),this._initMSE(),this._initTrans()),this._initTrans(),this._transmuxer&&this._transmuxer.loadSource(),this._startHeartbeat()):f.Log.v(this.tag,"transmuxer & mediaSource not ready")},a._parseUrlConfig=function(){if(location.href){var e=location.href.match(/kwaiKernelLog=([a-z]{1})/);e&&(this._config.kwaiKernelLog=e[1])}f.Log.level(this._config.kwaiKernelLog)},a._onError=function(e){f.Log.i(this.tag,"on error "+JSON.stringify(e));var t={errno:b,errmsg:e.reason||"unknow"};switch(e.type){case O.ErrorTypes.NETWORK_ERROR:if(this._config.isLive&&this._config.box===u.flv&&this._flvLiveRetry<this._config.maxRetry)return void this._startFlvLiveRetryTimer(e.details!==O.ErrorDetails.LIVE_DISCONNECTED_ERROR);t.errno=E,t.statusCode=e.statusCode,t.url=e.url;break;case O.ErrorTypes.MSE_ERROR:switch(e.details){case O.ErrorDetails.APPENDBUFFER_ERROR:t.errno=x;break;case O.ErrorDetails.ENDOFSTREAM_ERROR:t.errno=w;break;case O.ErrorDetails.MEDIASOURCE_ERROR:t.errno=L;break;default:t.errno=R}break;case O.ErrorTypes.MEDIA_ERROR:t.errno=k,e.details===O.ErrorDetails.CANNOT_SEEK?t.errno=T:t.errno=S;break;case O.ErrorTypes.MUX_ERROR:t.errno=k;break;case O.ErrorTypes.OTHER_ERROR:e.details===O.ErrorDetails.CONFIG_ERROR?t.errno=A:t.errno=k}if(e.fatal){var i=Le(e.details,e.reason,e.statusCode||0);this._monitor.onError(i,e.reason),this.stopLoad(),this._stopMainTimer(),(e.details===O.ErrorDetails.VIDEO_ERROR||this._video.error)&&this._destroyMSE(),t.code=i,t.type=e.type,t.reason=e.reason}e.fatal&&!this._error&&(this._error=t,this.emit(l.ERROR,t))},a._startMainTimer=function(){null===this._mainTimer&&(this._mainTimer=setInterval(this._mainLoop,200))},a._stopMainTimer=function(){this._mainTimer&&(clearInterval(this._mainTimer),this._mainTimer=null)},a._startHeartbeat=function(){this._hbTimer||(this._hbTimer=setInterval(this._heartbeat,1e3))},a._stopHeartbeat=function(){this._hbTimer&&(clearInterval(this._hbTimer),this._hbTimer=null)},a._checkLevelChange=function(){var e=this._nextLevel[0];e&&this._video.currentTime>=e.startSec&&this._media.isTimeinBuffered(this._video.currentTime)&&(e.init||this.emit(l.LEVEL_SWITCHED,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),this.emit(l.LEVEL_SWITCH_PLAYING,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),this._playingLevel=e.level,this._nextLevel.shift())},a._stopVideo=function(){this._video&&(URL.revokeObjectURL(this._video.src),this._video.src="",this._video.removeAttribute("src"),this._destroyTrans(),this._destroyMSE())},a._destroyTrans=function(){this._transmuxer&&(this._transmuxer.removeAllListeners(),this._transmuxer.destroy(),this._transmuxer=void 0)},a._destroyMSE=function(){this._mse&&(this._unbindMediaSourceEvent(this._mse),this._mse.destroy())},a._initTrans=function(){this._stopFlvLiveRetryTimer();var e=Jt[this._config.box];e?(this._transmuxer=new e(this._config,this._media),this._transmuxer&&(this._transmuxerEvent(this._transmuxer),this._transmuxer.init())):this._onError({type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.UNSUPPORTED,fatal:!0,reason:"unsupported box"})},a._recoverSwapAudioCodec=function(){var e=this._audioCodec;e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5",this._config.audioCodec=e,this._config.audioCodecSwap=!0},a._recoverMedia=function(){this._monitor.recoverMedia(),this.refresh()},a._checkStreamingMux=function(e){void 0===e&&(e=0),this._config.streamingMux&&this._transmuxer&&(e>this._streamingMuxThreshold?this._transmuxer.streamingMux(!1):this._transmuxer.streamingMux(!0))},a._startFlvLiveRetryTimer=function(e){var t=this;void 0===e&&(e=!0),this._flvLiveRetryTimer=setTimeout((function(){f.Log.i(t.tag,"live retry:"+t._flvLiveRetry),t._flvLiveRetry++,t._monitor.flvLiveRetry(),t._reload(!0)}),e?this._config.retryDelay:0)},a._stopFlvLiveRetryTimer=function(){this._flvLiveRetryTimer&&(clearTimeout(this._flvLiveRetryTimer),this._flvLiveRetryTimer=void 0)},ri(r,[{key:"currentLevel",get:function(){return this._transmuxer?this._transmuxer.currentLevel:0},set:function(e){var t=this;f.Log.i(this.tag,"set currentLevel",e),this._preloadProcessing?setTimeout((function(){t.currentLevel=e}),0):this._verifyLevel(e)&&(e!==this.currentLevel||this.autoLevelEnabled)?e<0?this.nextLevel=-1:(this._preloader&&this._preloader.active(!1),this._stat!==$t.INIT&&(this._monitor.selectBitrate(),this._stat=$t.SELECT_BITRATE,this._seekOnCanplay=!0),this._mse&&(this._mse.flush(),this._checkStreamingMux()),this._transmuxer&&(this._transmuxer.currentLevel=e)):this.emit(l.LEVEL_SWITCH_FAILED)}},{key:"nextLevel",get:function(){return this._transmuxer?this._transmuxer.nextLevel:0},set:function(e){f.Log.i(this.tag,"set nextLevel",e),this._verifyLevel(e)?this._media.bufferedSec()<3&&e>=0?this.currentLevel=e:this._transmuxer&&(this._transmuxer.nextLevel=e):this.emit(l.LEVEL_SWITCH_FAILED)}},{key:"startLevel",get:function(){return void 0===this._startLevel?this._config.adaptive?-1:0:this._startLevel},set:function(e){this._startLevel=e}},{key:"autoLevelEnabled",get:function(){return this._transmuxer?this._transmuxer.autoLevelEnabled:this._config.adaptive}},{key:"monitorData",get:function(){return this._monitor?this._monitor.snapshot:null}}]),r}(a.EventEmitter)},"./src/polyfills/number-isFinite.js":
/*!******************************************!*\
  !*** ./src/polyfills/number-isFinite.js ***!
  \******************************************/
/*! exports provided: isFiniteNumber */function(e,t,i){"use strict";i.r(t),i.d(t,"isFiniteNumber",(function(){return r}));var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},"./src/polyfills/object-assign.js":
/*!****************************************!*\
  !*** ./src/polyfills/object-assign.js ***!
  \****************************************/
/*! exports provided: ObjectAssign */function(e,t,i){"use strict";i.r(t),i.d(t,"ObjectAssign",(function(){return r}));var r=Object.assign||function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])}return i}},"./src/remux/aac-helper.ts":
/*!*********************************!*\
  !*** ./src/remux/aac-helper.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var r=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.default=r},"./src/remux/mp4-remuxer.ts":
/*!**********************************************!*\
  !*** ./src/remux/mp4-remuxer.ts + 1 modules ***!
  \**********************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/kernel-errors.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/core/kernel-events.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number-isFinite.js because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/object-assign.js because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/remux/aac-helper.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/types/remux.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/browser.ts because of ./src/index.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/log.ts because of ./src/index.ts */function(e,t,i){"use strict";i.r(t);var r=i("./src/polyfills/number-isFinite.js"),n=i("./src/polyfills/object-assign.js"),a=i("./src/remux/aac-helper.ts"),s=i("./src/types/remux.ts"),o=Math.pow(2,32)-1,u=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],hev1:[],hvcC:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([104,101,118,49]),d=new Uint8Array([0,0,0,1]);e.FTYP_AVC=e.box(e.types.ftyp,s,d,s,o),e.FTYP_HEVC=e.box(e.types.ftyp,s,d,s,u),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(var n,a=8,s=i.length,o=s;s--;)a+=i[s].byteLength;for((n=new Uint8Array(a))[0]=a>>24&255,n[1]=a>>16&255,n[2]=a>>8&255,n[3]=255&a,n.set(e,4),s=0,a=8;s<o;s++)n.set(i[s],a),a+=i[s].byteLength;return n},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var r=Math.floor(i/(o+1)),n=Math.floor(i%(o+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,i))},e.moov=function(t){for(var i=t.length,r=[];i--;)r[i]=e.trak(t[i]);return e.box.apply(e,[e.types.moov].concat([e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t))))},e.mvex=function(t){for(var i=t.length,r=[];i--;)r[i]=e.trex(t[i]);return e.box.apply(e,[e.types.mvex].concat(r))},e.mvhd=function(t,i){i*=t;var r=Math.floor(i/(o+1)),n=Math.floor(i%(o+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var i,r,n=t.samples||[],a=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,a[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,r,n,a=[],s=[];for(i=0;i<t.sps.length;i++)n=(r=t.sps[i]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));for(i=0;i<t.pps.length;i++)n=(r=t.pps[i]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),u=t.width,d=t.height,l=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,c>>24,c>>16&255,c>>8&255,255&c])))},e.hev1=function(t){var i=t.hvcc,r=t.codecWidth,n=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.hev1,a,e.box(e.types.hvcC,i))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return t.type===s.TrackType.audio?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):0===t.codec.indexOf("hev1")?e.box(e.types.stsd,e.STSD,e.hev1(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,r=t.duration*t.timescale,n=Math.floor(r/(o+1)),a=Math.floor(r%(o+1)),s=0,u=0;return t.hasOwnProperty("width")&&(s=t.width),t.hasOwnProperty("height")&&(u=t.height),e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,u>>8&255,255&u,0,0]))},e.traf=function(t,i){var r=e.sdtp(t),n=t.id,a=Math.floor(i/(o+1)),s=Math.floor(i%(o+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var r,n,a,s,o,u,d=t.samples||[],l=d.length,c=12+16*l,h=new Uint8Array(c);for(i+=8+c,h.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),r=0;r<l;r++)a=(n=d[r]).duration,s=n.size,o=n.flags,u=n.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();for(var i=e.FTYP_AVC,r=t.length;r--;)"video"===t[r].type&&0===t[r].codec.indexOf("hev1")&&(i=e.FTYP_HEVC);var n=e.moov(t),a=new Uint8Array(i.byteLength+n.byteLength);return a.set(i),a.set(n,i.byteLength),a},e}();u.types=void 0,u.HDLR_TYPES=void 0,u.STTS=void 0,u.STSC=void 0,u.STCO=void 0,u.STSZ=void 0,u.VMHD=void 0,u.SMHD=void 0,u.STSD=void 0,u.FTYP_AVC=void 0,u.FTYP_HEVC=void 0,u.DINF=void 0;var d=u,l=i("./src/core/kernel-events.ts"),c=i("./src/core/kernel-errors.ts"),h=i("./src/utils/log.ts"),f=i("./src/utils/browser.ts");function _(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(e,t,i,r){void 0===r&&(r=""),this._observer=void 0,this._config=void 0,this._typeSupported=void 0,this._isSafari=void 0,this._forceFirstIDR=void 0,this._stash=void 0,this._stashInfo=void 0,this._stashLastVideoSample=void 0,this._ISGenerated=!1,this._videoTime=void 0,this._extra=void 0,this._nextAudioPts=void 0,this._nextAvcDts=void 0,this._initPTS=void 0,this._initDTS=void 0,this._initSegment={},this._observer=e,this._config=t,this._typeSupported=i;var n=navigator.userAgent;this._isSafari=!(!(r&&r.indexOf("Apple")>-1&&n)||n.match("CriOS")),this._ISGenerated=!1,this._stash=t.streamingMux&&!t.gopRemux,this._resetVideoTime(),this._stashInfo={},d.types||d.init(),this._forceFirstIDR=!(!f.default.chrome||!(f.default.version.major<50||50===f.default.version.major&&f.default.version.build<2661))}var t,i,s,o=e.prototype;return o.setStat=function(e){e&&(this._ISGenerated=e.ISGenerated,this._nextAudioPts=e.nextAudioPts,this._nextAvcDts=e.nextAvcDts,this._initPTS=e.initPTS,this._initDTS=e.initDTS,this._videoTime.nbSamples=e.videoTime.nbSamples,this._videoTime.firstDTS=e.videoTime.firstDTS,this._videoTime.sampleDuration=e.videoTime.sampleDuration,this._videoTime.vLastPTS=e.videoTime.vLastPTS,this._videoTime.aLastPTS=e.videoTime.aLastPTS,this._videoTime.endDts=e.videoTime.endDts)},o.getStat=function(){return{ISGenerated:this._ISGenerated,nextAudioPts:this._nextAudioPts,nextAvcDts:this._nextAvcDts,initPTS:this._initPTS,initDTS:this._initDTS,videoTime:{nbSamples:this._videoTime.nbSamples,firstDTS:this._videoTime.firstDTS,sampleDuration:this._videoTime.sampleDuration,vLastPTS:this._videoTime.vLastPTS,aLastPTS:this._videoTime.aLastPTS,endDts:this._videoTime.endDts}}},o.destroy=function(){},o.setExtra=function(e){this._extra=e},o.resetTimeStamp=function(e){this._initPTS=this._initDTS=e,this._resetVideoTime()},o.resetInitSegment=function(){this._ISGenerated=!1,this._initSegment={},this.resetStash()},o.getLastPTS=function(){return{video:this._videoTime.vLastPTS,audio:this._videoTime.aLastPTS}},o.flush=function(e){void 0===e&&(e=0);var t=null;if(this._stash&&this._stashLastVideoSample){var i=this._stashInfo;i.track.samples=[this._stashLastVideoSample],this._stashLastVideoSample=null,i.sequenceNumber+=1,t=this.remuxVideo(i.track,i.timeOffset,!0,e,i.accurateTimeOffset)}return this.resetStash(),t},o.resetStash=function(){this._stashLastVideoSample=null,this._stashInfo={}},o.remux=function(e,t,i,a,s,o){if(void 0===o&&(o=!1),this._ISGenerated||this.generateIS(e,t,i),!a&&t.samples.length&&(t.samples[0].pts=t.samples[0].dts),this._ISGenerated){var u=o&&this._stashLastVideoSample?1:0,d=e.samples.length,c=t.samples.length,f=i,_=i;if(d&&c)if(!a&&s){if(e.samples[0].pts-t.samples[0].pts<0){var p=Object(n.ObjectAssign)({},t.samples[0]);p.dts=p.pts=e.samples[0].pts,t.samples.unshift(p)}}else{var v=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;f+=Math.max(0,v),_+=Math.max(0,-v)}if(d){e.timescale||(h.Log.w("regenerate InitSegment as audio detected"),this.generateIS(e,t,i));var m,g=this.remuxAudio(e,f,a,s);g&&(m=g.endPTS-g.startPTS),c?(t.timescale||(h.Log.w("regenerate InitSegment as video detected"),this.generateIS(e,t,i)),this.remuxVideo(t,_,a,m,s,o)):this.flush(m)}else{var y=null;c?y=this.remuxVideo(t,_,a,0,s,o):u&&(y=this.flush()),y&&e.codec&&Object(r.isFiniteNumber)(y.startDTS)&&Object(r.isFiniteNumber)(y.endDTS)&&this.remuxEmptyAudio(e,f,a,y)}}this._observer.trigger(l.default.HLS_FRAG_PARSED)},o.generateIS=function(e,t,i){var r,n,a=this._observer,s=e.samples,o=t.samples,u=this._typeSupported,f={},_={tracks:f},p=void 0===this._initPTS,v="audio/mp4";if(p&&(r=n=1/0),e.config&&s.length&&(e.timescale=e.samplerate,h.Log.v("audio sampling rate : "+e.samplerate),e.isAAC||(u.mpeg?(v="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3")),this._initSegment.audio=!e.isAAC&&u.mpeg?new Uint8Array:d.initSegment([e]),f.audio={container:v,codec:e.codec,metadata:{channelCount:e.channelCount,audioSampleRate:e.samplerate}},p&&(r=n=s[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&o.length){var m=t.inputTimeScale;t.timescale=m,this._initSegment.video=d.initSegment([t]),f.video={container:"video/mp4",codec:t.codec,metadata:{width:t.width,height:t.height,fps:t.fps,profile:t.profile,level:t.level,chromaFormat:t.chromaFormat}},p&&(r=Math.min(r||1/0,o[0].pts-m*i),n=Math.min(n||1/0,o[0].dts-m*i),this._observer.trigger(l.default.INIT_PTS_FOUND,{initPTS:r}))}Object.keys(f).length?(a.trigger(l.default.PARSING_INIT_SEGMENT,_),this._ISGenerated=!0,p&&(this._initPTS=r,this._initDTS=n)):a.trigger(l.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,details:c.ErrorDetails.PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},o.remuxVideo=function(e,t,i,r,n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var s,o,u,f,_=e.timescale,p=e.samples,v=[],m=this._PTSNormalize,g=this._initPTS,y=p[0].dts/_,b=p[0].key,E=this._videoTime,S=[],T=8,w=0,L=0,R=0,x=p.length;if(void 0!==g){var k=this._nextAvcDts,A=this._isSafari;if(0===x||0===e.timescale)return null;if(A&&(i=i||!!(p.length&&k&&(n&&Math.abs(t-k/_)<.1||Math.abs(p[0].pts-k-g)<_/5))),i||(k=t*_,this._resetVideoTime()),void 0!==k){p.forEach((function(e){e.pts=m(e.pts-g,k),e.dts=m(e.dts-g,k)})),p.sort((function(e,t){var i=e.dts-t.dts,r=e.pts-t.pts;return i||r||e.id-t.id}));var O=p.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)}),0);if(O<0){h.Log.w("PTS < DTS detected in video samples, shifting DTS by "+Math.round(O/90)+" ms to overcome this issue");for(var P=0;P<p.length;P++)p[P].dts+=O}this._stash&&(this._stashInfo.timeOffset=t,this._stashInfo.accurateTimeOffset=n,this._stashInfo.track=e,this._stashLastVideoSample&&(x++,p.unshift(this._stashLastVideoSample),this._stashLastVideoSample=null),p.length>1&&!a&&(this._stashLastVideoSample=p.pop(),x--));var D=p[0];R=Math.max(D.dts,0),L=Math.max(D.pts,0);var I=Math.round((R-k)/90);i&&I&&(I>1?h.Log.v("AVC:"+I+" ms hole between fragments detected,filling it"):I<-1&&h.Log.v("AVC:"+-I+" ms overlapping between fragments detected"),L=Math.max(L-(R-k),k),R=k,p[0].dts=R,p[0].pts=L,h.Log.v("Video/PTS/DTS adjusted: "+Math.round(L/90)+"/"+Math.round(R/90)+",delta:"+I+" ms")),D=p[p.length-1],f=Math.max(D.dts,0),u=Math.max(D.pts,0,f),A&&(w=Math.round((f-R)/(p.length-1)));for(var C=0,N=0,M=0;M<x;M++){for(var U=p[M],B=U.units,F=B.length,V=0,j=0;j<F;j++)V+=B[j].data.length;N+=V,C+=F,U.length=V,U.dts=A?R+M*w:Math.max(U.dts,R),U.pts=Math.max(U.pts,U.dts)}var H=N+4*C+8;try{s=new Uint8Array(H)}catch(e){return this._observer.trigger(l.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,details:c.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating video mdat "+H}),null}var G=new DataView(s.buffer);G.setUint32(0,H),s.set(d.types.mdat,4);for(var K=0;K<x;K++){for(var q=p[K],W=q.units,z=0,Y=void 0,X=0,Q=W.length;X<Q;X++){var J=W[X],Z=J.data,$=J.data.byteLength;G.setUint32(T,$),T+=4,s.set(Z,T),T+=$,z+=4+$}if(A)Y=Math.max(0,w*Math.round((q.pts-q.dts)/w));else{if(K<x-1)w=p[K+1].dts-q.dts;else{var ee=this._config,te=0;if(te=this._stashLastVideoSample?this._stashLastVideoSample.dts-q.dts:e.refSampleDuration||E.sampleDuration||q.dts-p[K>0?K-1:K].dts,te=90*Math.floor(te/90),ee.stretchShortVideoTrack&&this._nextAudioPts){var ie=ee.maxBufferHole,re=Math.floor(ie*_),ne=(r?L+r*_:this._nextAudioPts)-q.pts;ne>re?((w=ne-te)<0&&(w=te),h.Log.v("It is approximately "+ne/90+" ms to the next segment; using duration "+w/90+" ms for the last video frame.")):w=te}else w=te}Y=Math.round(q.pts-q.dts)}if(w<0||isNaN(w)){var ae=0;i&&p.length<2&&(ae=90*I),w=Math.max((e.refSampleDuration||E.sampleDuration)-ae,90)}v.push({size:z,duration:w,cts:Y,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:q.key?2:1,isNonSync:q.key?0:1}}),q.extraInfo&&(q.extraInfo.ptsMs=D.pts/_*1e3,S.push(q.extraInfo))}this._nextAvcDts=f+w;var se=e.dropped;if(e.dropped=0,v.length&&this._forceFirstIDR){var oe=v[0].flags;oe.dependsOn=2,oe.isNonSync=0}e.samples=v,o=d.moof(e.sequenceNumber++,R,e),e.samples=[];var ue={payload:this._mergeBoxes("video",o,s),startPTS:L/_,endPTS:(u+w)/_,startDTS:R/_,endDTS:this._nextAvcDts/_,type:"video",hasAudio:!1,hasVideo:!0,nb:v.length,dropped:se,streamDTS:y,key:b,extra:this._extra,framesInfo:S};return this._videoTime.vLastPTS=ue.endPTS,ue.endStreamDts=ue.endDTS-ue.startDTS+ue.streamDTS,this._observer.trigger(l.default.PARSING_DATA,ue),0===E.nbSamples&&(E.firstDTS=R),E.nbSamples+=x,E.sampleDuration=Math.round((this._nextAvcDts-E.firstDTS)/E.nbSamples),E.endDts=this._nextAvcDts,ue}}},o.remuxAudio=function(e,t,i,r){if(void 0===r&&(r=!1),!e.samples.length)return null;var n,s,o,u,f,_,p=e.inputTimeScale,v=e.timescale,m=p/v,g=e.isAAC?1024:1152,y=g*m,b=this._PTSNormalize,E=this._initPTS,S=!e.isAAC&&this._typeSupported.mpeg,T=[],w=[],L=e.samples[0].dts/p,R=S?0:8,x=e.samples,k=this._nextAudioPts,A=!1;if(void 0!==E){if(i=i||!!(x.length&&k&&(r&&Math.abs(t-k/p)<.1||Math.abs(x[0].pts-k-E)<20*y)),x.forEach((function(e){e.pts=e.dts=b(e.pts-E,t*p)})),0===(x=x.filter((function(e){return e.pts>=0}))).length)return null;if(i&&void 0!==k||(k=r?t*p:x[0].pts,A=!0),void 0!==k){if(e.isAAC)for(var O=this._config.maxAudioFramesDrift,P=0,D=k;P<x.length;){var I=x[P],C=I.pts-D,N=Math.abs(1e3*C/p);if(C<=-O*y)h.Log.w("Dropping 1 audio frame @ "+(D/p).toFixed(3)+"s due to "+Math.round(N)+" ms overlap."),x.splice(P,1);else if(C>=O*y&&N<1e5&&D){var M=Math.round(C/y);h.Log.w("Injecting "+M+" audio frame @ "+(D/p).toFixed(3)+"s due to "+Math.round(1e3*C/p)+" ms gap.");for(var U=0;U<M;U++){var B=Math.max(D,0);(s=a.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(h.Log.v("Unable to get silent frame for given audio codec; duplicating last frame instead."),s=I.unit.subarray()),x.splice(P,0,{unit:s,pts:B,dts:B}),D+=y,P++}I.pts=I.dts=D,D+=y,P++}else Math.abs(C),I.pts=I.dts=D,D+=y,P++}for(var F=x.length,V=0;F--;)V+=x[F].unit.byteLength;for(var j=0,H=x.length;j<H;j++){var G=x[j],K=G.unit,q=G.pts;if(void 0!==_&&n)n.duration=Math.round((q-_)/m);else{var W=Math.round(1e3*(q-k)/p),z=0;if(i&&e.isAAC&&W){if(W>0&&W<1e5)z=Math.round((q-k)/y),h.Log.v(W+" ms hole between AAC samples detected,filling it"),z>0&&((s=a.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s=K.subarray()),V+=z*s.length);else if(W<-12){h.Log.v("drop overlapping AAC sample, expected/parsed/delta:"+(k/p).toFixed(3)+"s/"+(q/p).toFixed(3)+"s/"+-W+"ms"),V-=K.byteLength;continue}q=k}if(f=q,!(V>0))return e.samples=[],null;V+=R;try{o=new Uint8Array(V)}catch(e){return this._observer.trigger(l.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,details:c.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V}),null}S||(new DataView(o.buffer).setUint32(0,V),o.set(d.types.mdat,4));for(var Y=0;Y<z;Y++)(s=a.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(h.Log.v("Unable to get silent frame for given audio codec; duplicating this frame instead."),s=K.subarray()),o.set(s,R),R+=s.byteLength,n={size:s.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(n)}if(!o)return;o.set(K,R);var X=K.byteLength;R+=X,n={size:X,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(n),G.extraInfo&&(G.extraInfo.ptsMs=q/p*1e3,w.push(G.extraInfo)),_=q}var Q=0;if(F=T.length,n){if(F>=2&&(Q=T[F-2].duration,n.duration=Q),F&&"number"==typeof _&&o){n&&0===n.duration&&(n.duration=e.isAAC?1024:1152),this._nextAudioPts=k=_+m*(Q||g),e.samples=T,u=S?new Uint8Array:d.moof(e.sequenceNumber++,f/m,e),e.samples=[];var J=f/p,Z=k/p,$={payload:this._mergeBoxes("audio",u,o),startPTS:J,endPTS:Z,startDTS:J,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:F,streamDTS:L,endStreamDts:Z-J+L,extra:this._extra,framesInfo:w};return this._videoTime.aLastPTS=$.endPTS,this._observer.trigger(l.default.PARSING_DATA,$),$}return A&&delete this._nextAudioPts,e.samples=[],null}}}},o.remuxEmptyAudio=function(e,t,i,r){if(void 0!==this._initDTS){var n=e.inputTimeScale,s=n/(e.samplerate?e.samplerate:n),o=this._nextAudioPts,u=(void 0!==o?o:r.startDTS*n)+this._initDTS,d=r.endDTS*n+this._initDTS,l=1024*s,c=Math.ceil((d-u)/l),f=a.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(h.Log.w("remux empty Audio"),f){for(var _=[],p=0;p<c;p++){var v=u+p*l;_.push({unit:f,pts:v,dts:v})}e.samples=_,this.remuxAudio(e,t,i)}else h.Log.d("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},o._PTSNormalize=function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e},o._resetVideoTime=function(){this._videoTime={nbSamples:0,firstDTS:0,sampleDuration:3e3,vLastPTS:0,aLastPTS:0}},o._mergeBoxes=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this._initSegment[e]&&(i.unshift(this._initSegment[e]),delete this._initSegment[e]);var n=i.reduce((function(e,t){return t?e+t.byteLength:e}),0),a=new Uint8Array(n),s=0;return i.forEach((function(e){e&&(a.set(e,s),s+=e.byteLength)})),a},t=e,(i=[{key:"ISGenerated",get:function(){return this._ISGenerated}}])&&_(t.prototype,i),s&&_(t,s),e}();t.default=p},"./src/types/remux.ts":
/*!****************************!*\
  !*** ./src/types/remux.ts ***!
  \****************************/
/*! exports provided: TrackType, RemuxerTrackIdConfig */function(e,t,i){"use strict";var r,n;i.r(t),i.d(t,"TrackType",(function(){return r})),i.d(t,"RemuxerTrackIdConfig",(function(){return n})),function(e){e.video="video",e.audio="audio"}(r||(r={})),function(e){e[e.video=1]="video",e[e.audio=2]="audio"}(n||(n={}))},"./src/utils/browser.ts":
/*!******************************!*\
  !*** ./src/utils/browser.ts ***!
  \******************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var r={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},a={};if(n.browser){a[n.browser]=!0;var s=n.majorVersion.split(".");a.version={major:parseInt(n.majorVersion,10),string:n.version},s.length>1&&(a.version.minor=parseInt(s[1],10)),s.length>2&&(a.version.build=parseInt(s[2],10))}for(var o in n.platform&&(a[n.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,n.browser="msie",a.msie=!0),a.edge&&(delete a.edge,n.browser="msedge",a.msedge=!0),a.opr&&(n.browser="opera",a.opera=!0),a.safari&&a.android&&(n.browser="android",a.android=!0),a.name=n.browser,a.platform=n.platform,r)r.hasOwnProperty(o)&&delete r[o];r=a}(),t.default=r},"./src/utils/log.ts":
/*!**************************!*\
  !*** ./src/utils/log.ts ***!
  \**************************/
/*! exports provided: Log, LOG_LEVEL */function(e,t,i){"use strict";var r;function n(e,t){return t&&0!==t.length||(t=[e],e=""),e="kwai-k"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}i.r(t),i.d(t,"Log",(function(){return a})),i.d(t,"LOG_LEVEL",(function(){return r})),function(e){e.LEVEL_ERROR="e",e.LEVEL_WARN="w",e.LEVEL_INFO="i",e.LEVEL_DEBUG="d",e.LEVEL_VERBOSE="v"}(r||(r={}));var a=function(){function e(){}return e.level=function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case r.LEVEL_ERROR:e.ENABLE_ERROR=!0;break;case r.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case r.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case r.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case r.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0}},e.e=function(t){if(e.ENABLE_ERROR){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];var s=n(t,r);(console.error||console.warn||console.log).apply(console,s)}},e.w=function(t){if(e.ENABLE_WARN){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];var s=n(t,r);(console.warn||console.log).apply(console,s)}},e.i=function(t){if(e.ENABLE_INFO){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];var s=n(t,r);(console.info||console.log).apply(console,s)}},e.d=function(t){if(e.ENABLE_DEBUG){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];var s=n(t,r);(console.debug||console.log).apply(console,s)}},e.v=function(t){if(e.ENABLE_VERBOSE){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];var s=n(t,r);console.log.apply(console,s)}},e}();a.ENABLE_ERROR=!0,a.ENABLE_WARN=!1,a.ENABLE_INFO=!1,a.ENABLE_DEBUG=!1,a.ENABLE_VERBOSE=!1}}).default},e.exports=i())}).call(this,i(2))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";var r,n="object"==typeof Reflect?Reflect:null,a=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,i,r){var n,a,s,o;if(d(i),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"==typeof s?s=a[t]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),(n=l(e))>0&&s.length>n&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,o=u,console&&console.warn&&console.warn(o)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=h.bind(r);return n.listener=i,r.wrapFn=n,n}function _(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):v(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function v(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var d=u.length,l=v(u,d);for(i=0;i<d;++i)a(l[i],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return d(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,f(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,n,a,s;if(d(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,n=a;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,a=Object.keys(i);for(r=0;r<a.length;++r)"removeListener"!==(n=a[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return _(this,e,!0)},o.prototype.rawListeners=function(e){return _(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return ft}));var r,n,a,s=i(0),o=i.n(s);Object.defineProperty||(Object.defineProperty=function(e,t,i){e[t]="[object Object]"===Object.prototype.toString.call(i)&&i.hasOwnProperty("value")?i.value:i}),Object.assign||Object.defineProperty(Object,"assign",{value:function(e){if(null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!==r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},writable:!0,configurable:!0}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),i=this,r=function(){},n=function(){var n=this instanceof r?this:e;return i.apply(n,t.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),n.prototype=new r,n}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i;if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),n=r.length>>>0;if(0===n)return-1;var a=+t||0;if(Math.abs(a)===1/0&&(a=0),a>=n)return-1;for(i=Math.max(a>=0?a:n-Math.abs(a),0);i<n;){if(i in r&&r[i]===e)return i;i++}return-1}),Object.keys||(Object.keys=(r=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable("toString"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var t=[];for(var i in e)r.call(e,i)&&t.push(i);if(n)for(var s=0,o=a;s<o.length;s++){var u=o[s];r.call(e,u)&&t.push(u)}return t})),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],n=0;n<i;){var a=t[n];if(e.call(r,a,n,t))return n;n++}return-1}}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,r;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),a=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(i=t),r=0;r<a;){var s=void 0;r in n&&(s=n[r],e.call(i,s,r,n)),r++}})
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */;var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function d(e,t){function i(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var l=function(){return(l=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function c(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&(i[r[n]]=e[r[n]])}return i}var h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function f(e,t){return e(t={exports:{}},t.exports),t.exports}var _=f((function(e){!function(t){function i(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function r(e,t,r,n,a,s){return i((o=i(i(t,e),i(n,s)))<<(u=a)|o>>>32-u,r);var o,u}function n(e,t,i,n,a,s,o){return r(t&i|~t&n,e,t,a,s,o)}function a(e,t,i,n,a,s,o){return r(t&n|i&~n,e,t,a,s,o)}function s(e,t,i,n,a,s,o){return r(t^i^n,e,t,a,s,o)}function o(e,t,i,n,a,s,o){return r(i^(t|~n),e,t,a,s,o)}function u(e,t){var r,u,d,l,c;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,f=-271733879,_=-1732584194,p=271733878;for(r=0;r<e.length;r+=16)u=h,d=f,l=_,c=p,h=n(h,f,_,p,e[r],7,-680876936),p=n(p,h,f,_,e[r+1],12,-389564586),_=n(_,p,h,f,e[r+2],17,606105819),f=n(f,_,p,h,e[r+3],22,-1044525330),h=n(h,f,_,p,e[r+4],7,-176418897),p=n(p,h,f,_,e[r+5],12,1200080426),_=n(_,p,h,f,e[r+6],17,-1473231341),f=n(f,_,p,h,e[r+7],22,-45705983),h=n(h,f,_,p,e[r+8],7,1770035416),p=n(p,h,f,_,e[r+9],12,-1958414417),_=n(_,p,h,f,e[r+10],17,-42063),f=n(f,_,p,h,e[r+11],22,-1990404162),h=n(h,f,_,p,e[r+12],7,1804603682),p=n(p,h,f,_,e[r+13],12,-40341101),_=n(_,p,h,f,e[r+14],17,-1502002290),h=a(h,f=n(f,_,p,h,e[r+15],22,1236535329),_,p,e[r+1],5,-165796510),p=a(p,h,f,_,e[r+6],9,-1069501632),_=a(_,p,h,f,e[r+11],14,643717713),f=a(f,_,p,h,e[r],20,-373897302),h=a(h,f,_,p,e[r+5],5,-701558691),p=a(p,h,f,_,e[r+10],9,38016083),_=a(_,p,h,f,e[r+15],14,-660478335),f=a(f,_,p,h,e[r+4],20,-405537848),h=a(h,f,_,p,e[r+9],5,568446438),p=a(p,h,f,_,e[r+14],9,-1019803690),_=a(_,p,h,f,e[r+3],14,-187363961),f=a(f,_,p,h,e[r+8],20,1163531501),h=a(h,f,_,p,e[r+13],5,-1444681467),p=a(p,h,f,_,e[r+2],9,-51403784),_=a(_,p,h,f,e[r+7],14,1735328473),h=s(h,f=a(f,_,p,h,e[r+12],20,-1926607734),_,p,e[r+5],4,-378558),p=s(p,h,f,_,e[r+8],11,-2022574463),_=s(_,p,h,f,e[r+11],16,1839030562),f=s(f,_,p,h,e[r+14],23,-35309556),h=s(h,f,_,p,e[r+1],4,-1530992060),p=s(p,h,f,_,e[r+4],11,1272893353),_=s(_,p,h,f,e[r+7],16,-155497632),f=s(f,_,p,h,e[r+10],23,-1094730640),h=s(h,f,_,p,e[r+13],4,681279174),p=s(p,h,f,_,e[r],11,-358537222),_=s(_,p,h,f,e[r+3],16,-722521979),f=s(f,_,p,h,e[r+6],23,76029189),h=s(h,f,_,p,e[r+9],4,-640364487),p=s(p,h,f,_,e[r+12],11,-421815835),_=s(_,p,h,f,e[r+15],16,530742520),h=o(h,f=s(f,_,p,h,e[r+2],23,-995338651),_,p,e[r],6,-198630844),p=o(p,h,f,_,e[r+7],10,1126891415),_=o(_,p,h,f,e[r+14],15,-1416354905),f=o(f,_,p,h,e[r+5],21,-57434055),h=o(h,f,_,p,e[r+12],6,1700485571),p=o(p,h,f,_,e[r+3],10,-1894986606),_=o(_,p,h,f,e[r+10],15,-1051523),f=o(f,_,p,h,e[r+1],21,-2054922799),h=o(h,f,_,p,e[r+8],6,1873313359),p=o(p,h,f,_,e[r+15],10,-30611744),_=o(_,p,h,f,e[r+6],15,-1560198380),f=o(f,_,p,h,e[r+13],21,1309151649),h=o(h,f,_,p,e[r+4],6,-145523070),p=o(p,h,f,_,e[r+11],10,-1120210379),_=o(_,p,h,f,e[r+2],15,718787259),f=o(f,_,p,h,e[r+9],21,-343485551),h=i(h,u),f=i(f,d),_=i(_,l),p=i(p,c);return[h,f,_,p]}function d(e){var t,i="",r=32*e.length;for(t=0;t<r;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function l(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function c(e){var t,i,r="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),r+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return r}function h(e){return unescape(encodeURIComponent(e))}function f(e){return function(e){return d(u(l(e),8*e.length))}(h(e))}function _(e,t){return function(e,t){var i,r,n=l(e),a=[],s=[];for(a[15]=s[15]=void 0,n.length>16&&(n=u(n,8*e.length)),i=0;i<16;i+=1)a[i]=909522486^n[i],s[i]=1549556828^n[i];return r=u(a.concat(l(t)),512+8*t.length),d(u(s.concat(r),640))}(h(e),h(t))}function p(e,t,i){return t?i?_(t,e):c(_(t,e)):i?f(e):c(f(e))}e.exports?e.exports=p:t.md5=p}(h)})),p=["UVideo","Vstatus","Kwaigo","MvMaster"],v=["Kwai","Kwai_Lite","Kwai_Pro","livemate","ksthanos","ksNebula","ksnebula","kwaiying","pearl","kinder","m2u","LOLita","XFunCore","ACVideoCore"].concat(p),m=null,g="",y=function(){return m||(m=(new o.a).getResult()),m};function b(e){if(void 0===e&&(e=location.hostname),!e)return"";var t=e.split("."),i=t.length;return i<=2?"":"."+t[i-2]+"."+t[i-1]}function E(e,t){if(void 0===t&&(t={}),!document.cookie)return null;var i=function(e,t,i){void 0===i&&(i={});var r={};if(e.length>0)for(var n=t?decodeURIComponent:function(e){return e},a=e.split(/;\s/g),s=null,o=null,u=null,d=0,l=a.length;d<l;d++){if(null!==(u=a[d].match(/([^=]+)=/i)))try{s=decodeURIComponent(u[1]),o=n(a[d].substring(u[1].length+1))}catch(e){}else s=decodeURIComponent(a[d]),o="";null!==s&&(r[s]=o)}return r}(document.cookie,!t.raw,t)[e];return void 0===i?null:i}function S(e,t,i){void 0===i&&(i={}),document.cookie=function(e,t,i,r){void 0===r&&(r={});var n=encodeURIComponent(e)+"="+(i?encodeURIComponent(t):t),a=r.expires,s=r.path||"/",o=r.domain||"";return a instanceof Date&&(n+="; expires="+a.toUTCString()),"number"==typeof a&&(n+="; max-age=="+a),""!==s&&(n+="; path="+s),""!==o&&(n+="; domain="+o),!0===r.secure&&(n+="; secure"),n}(e,t,!i.raw,i)}function T(){for(var e=1e9*Math.random()>>>0,t=[],i=0;i<7;i++)t.push("0123456789ABCDEF".charAt(16*Math.random()));return e+t.join("")}function w(){var e=E("did")?"did":"_did",t=E(e),i=new Date;i.setFullYear(i.getFullYear()+1);var r=t||"web_"+T();return S(e,r,{expires:i,domain:b(),path:"/"}),r}function L(){return T()}function R(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function x(e,t,i,r){return"attachEvent"in e?e.attachEvent("on"+t,i):e.addEventListener(t,i,r)}function k(e,t,i,r){return"attachEvent"in e?e.detachEvent("on"+t,i):e.removeEventListener(t,i,r)}function A(e,t,i){if(void 0===i&&(i=" "),(t-=e.length)<=0)return e;for(var r="";t;)1&t&&(r+=i),t>>=1,i+=i;return r+e}var O,P=(O=null,function(){if(null===O)for(var e=0;e<v.length;e++)if(p.indexOf(v[e])>-1){if(navigator.userAgent.toLowerCase().indexOf(v[e].toLowerCase())>-1){O=!0;break}}else if(navigator.userAgent.indexOf(v[e])>-1){O=!0;break}return O}),D=function(){var e=null;return function(){return null===e&&(e=navigator.userAgent.indexOf("Kwai")>-1),e}}();function I(e){return setTimeout(e,62.5)}var C=clearTimeout;function N(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function M(e){for(var t={},i=0,r=e.split("&");i<r.length;i++){var n=r[i].split("="),a=n[0],s=n[1];a in t?t[a]instanceof Array?t[a].push(s):t[a]=[t[a],s]:t[a]=s}return t}function U(e){var t=JSON.parse(e),i=[];return Object.keys(t).forEach((function(e){if(t[e]instanceof Array)for(var r=0,n=t[e];r<n.length;r++){var a=n[r];i.push(e+"="+a)}else"object"==typeof t[e]&&null!==t[e]?i.push(e+"="+JSON.stringify(t[e])):i.push(e+"="+t[e])})),i.join("&")}var B=function(){var e=w();if(!g){var t="http://logger-v2.corp.kuaishou.com/#/home?sessionId="+e;console.log("%cLogSDK logger: %c"+t,"color:#1abf89;font-size:1.4em;line-height:2.4em;","font-size:1.2em;"),g="http://logger-v2-backend.corp.kuaishou.com/"+e+"/rest/wd/common/log/collect/misc2"}return g};function F(e){return e?e.map((function(e){var t=e.tagName,i=void 0===t?"":t,r=e.id,n=e.className,a=i.toLowerCase();return r&&(a+="#"+r),n&&(a+=n.split(" ").map((function(e){return"."+e})).join("")),a})).filter((function(e){return e})).join(","):""}var V=function(){for(var e=navigator.userAgent,t=[[/ wxwork\//,"workWechat"],[/ MicroMessenger\//,"wechat"],[/ Kwai\//,"KUAISHOU"],[/ ksthanos\//,"THANOS"],[/ ksNebula\//i,"NEBULA"],[/ QQ\//,"qq"],[/__weibo__([^_]+)/,"weibo"],[/ livemate\//,"livemate"],[/ baiduboxapp\//,"baidu"],[/ MQQBrowser\//,"qqBrowser"],[/\(MSIE ([^;]+);/,"ie"]],i=0;i<t.length;i++){var r=t[i],n=r[0],a=r[1];if(n.exec(e))return a}return""};var j=function(e){this.env="production",this.retries=0,this.maxErrLog=100,this.timeout=3e4,this.useBeacon=!1,this.wait=1e3,this.maxBatchLength=100,this.lazy=!1,this.showValidateMsg=!1,this.sampleRate=1,this.sampleRateFn=null,this.logger=!1,Object.assign(this,e)},H=["display: none;","position: absolute;","top: -9999px","left: -9999px"].join("");function G(e,t){var i=e.url,r=e.data,n="iframe_"+T(),a=function(e){var t=document.createElement("iframe");return document.body.appendChild(t),t.contentWindow.name=e,t.style.cssText=H,t}(n),s=function(e,t){var i=document.createElement("form");return document.body.appendChild(i),i.target=e,i.enctype="multipart/form-data",i.method="POST",i.action=t,i.style.cssText=H,i}(n,i);!function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var r=document.createElement("input");r.name=i,r.value=JSON.stringify(t[i]),e.appendChild(r)}}(s,r);try{s.submit()}catch(e){t(e)}a.onload=function(){document.body.removeChild(a),document.body.removeChild(s),a=null,s=null}}function K(e){var t=new FormData;for(var i in e)e.hasOwnProperty(i)&&t.append(i,JSON.stringify(e[i]));return t}function q(e,t){var i=e.url,r=e.data,n=e.async,a=void 0===n||n,s=e.timeout,o=new XMLHttpRequest;o.open("POST",i,a),a&&s&&(o.timeout=s),o.onload=function(){o.status<200&&o.status>=300&&304!==o.status&&t(o.response)},o.ontimeout=o.onerror=function(e){t(e)},o.send(K(r))}function W(e,t){var i=e.url,r=e.data;navigator.sendBeacon(i,K(r))||t()}var z=y(),Y="Chrome"===z.browser.name&&+(z.browser.major||0)>77;function X(e,t){var i=e.url,r=e.data,n=e.async,a=e.useBeacon,s=void 0!==a&&a,o=e.timeout;if((s||Y)&&function(e){var t="";if("string"==typeof e)t=e;else try{t=JSON.stringify(e)}catch(i){t=String(e)}for(var i=0,r=0;r<t.length;r++){var n=t.charCodeAt(r);i+=n<128?1:n<2048?2:n<65536?3:n<1<<21?4:n<1<<26?5:n<1<<31?6:Number.NaN}return i}(r)<51200)return W({url:i,data:r},t);if(function(){var e=y();return"IE"===e.browser.name&&(e.browser.major&&+e.browser.major<=9)}())return G({url:i,data:r},t);if(n)return q({url:i,data:r,async:n,timeout:o},t);try{q({url:i,data:r,async:n,timeout:o},t)}catch(e){W({url:i,data:r},t)}}var Q,J,Z,$,ee,te=function(){function e(){var e=this;this.logQueue=[],this.errorQueue=[],this.batchWaitTimer=0,this.errorWaitTimer=0,this.flush=function(t){e.sendData(e.logQueue,t),e.logQueue=[]}}return e.prototype.updateBase=function(e){this.commonPackage=e},Object.defineProperty(e.prototype,"url",{get:function(){if(this.config.logger)return B();var e=this.config.env;return!e||0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&0!==e.indexOf("//")?"production"===e?"//log-sdk.ksapisrv.com/rest/wd/common/log/collect/misc2":"https://webapi.test.gifshow.com/rest/wd/common/log/collect/misc2":e},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t){this.config=new j(l(l({},this.config),e)),this.updateBase(t)},e.prototype.sendData=function(e,t,i){var r=this,n=e instanceof Array?{retry:0,logs:e}:e;X({url:this.url,data:{common:this.commonPackage,logs:{event:n.logs}},useBeacon:i||this.config.useBeacon,async:void 0!==t?t:0!==this.config.wait,timeout:this.config.timeout},(function(){r.errHandler(n)}))},e.prototype.flushErrorQueue=function(){var e=this;this.errorQueue.forEach((function(t){t.retry>e.config.retries?R(e.errorQueue,t):(t.retry++,e.sendData(t))}))},e.prototype.send=function(e,t,i,r){var n=this;void 0===t&&(t=!1),t?this.sendData([e],i,r):this.config.lazy?this.logQueue.push(e):(clearTimeout(this.batchWaitTimer),this.logQueue.length>=this.config.maxBatchLength?this.flush(i):(this.logQueue.push(e),this.batchWaitTimer=window.setTimeout((function(){n.flush(i)}),this.config.wait)))},Object.defineProperty(e.prototype,"errorLogCount",{get:function(){return this.errorQueue.reduce((function(e,t){return e+t.logs.length}),0)},enumerable:!0,configurable:!0}),e.prototype.errHandler=function(e){var t=this;this.config.retries&&(this.errorQueue.push(e),clearTimeout(this.errorWaitTimer),this.errorLogCount>=this.config.maxErrLog?this.flushErrorQueue():this.errorWaitTimer=window.setTimeout((function(){t.flushErrorQueue()}),this.config.wait))},e}();!function(e){e[e.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",e[e.ENTER=1]="ENTER",e[e.LEAVE=2]="LEAVE",e[e.RESUME=3]="RESUME"}(Q||(Q={})),function(e){e[e.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",e[e.PAGE_ENTER=1]="PAGE_ENTER",e[e.PAGE_LEAVE=2]="PAGE_LEAVE",e[e.PAGE_RESUME=3]="PAGE_RESUME",e[e.PAGE_PAUSE=4]="PAGE_PAUSE"}(J||(J={})),function(e){e[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.PAGE_AUTO=10]="PAGE_AUTO",e[e.PAGE_CUSTOM=11]="PAGE_CUSTOM",e[e.ELEMENT=12]="ELEMENT"}(Z||(Z={})),function(e){e[e.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",e[e.SUCCESS=1]="SUCCESS",e[e.FAIL=2]="FAIL"}($||($={})),function(e){e[e.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",e[e.CLICK=1]="CLICK",e[e.LEFT_PULL=2]="LEFT_PULL",e[e.RIGHT_PULL=3]="RIGHT_PULL",e[e.UP_PULL=4]="UP_PULL",e[e.DOWN_PULL=5]="DOWN_PULL"}(ee||(ee={}));var ie,re,ne,ae,se=!0,oe=function(e){this.first_load=se,this.action=Q.ENTER,this.time_cost=0,this.sub_action=J.PAGE_ENTER,this.type=Z.ELEMENT,this.status=$.SUCCESS,this.action_type=ee.CLICK,this.sub_page=!1,se=!1;var t=e.type,i=e.currentUrlPackage,r=e.referUrlPackage,n=e.name,a=void 0===n?"":n,s=e.action,o=e.beginTime,u=e.params,d=void 0===u?{}:u,l=e.contentPackage,c=e.status;if(this.url_package=i,this.refer_url_package=r,this.content_package=l,c&&(this.status=void 0===$[c]?$.UNKNOWN_STATUS:$[c]),"PV"===t)switch(this.type=Z.PAGE_AUTO,s){case"leave":this.action=Q.LEAVE,this.sub_action=J.PAGE_LEAVE,o&&(this.stay_length=(new Date).valueOf()-o);break;case"enter":this.action=Q.ENTER,this.sub_action=J.PAGE_ENTER;break;case"visible":this.action=Q.RESUME,this.sub_action=J.PAGE_RESUME;break;case"hidden":this.action=Q.LEAVE,this.sub_action=J.PAGE_PAUSE}"SHOW"===t&&a&&d&&(this.element_package={action:a,params:JSON.stringify(d)})};!function(e){e[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.USER_OPERATION=1]="USER_OPERATION",e[e.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",e[e.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(ie||(ie={})),function(e){e[e.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",e[e.CLICK=1]="CLICK",e[e.DOUBLE_CLICK=2]="DOUBLE_CLICK",e[e.TRIPLE_CLICK=3]="TRIPLE_CLICK",e[e.LONG_PRESS=4]="LONG_PRESS",e[e.PULL=5]="PULL",e[e.DRAG=6]="DRAG",e[e.SCALE=7]="SCALE",e[e.PULL_DOWN=8]="PULL_DOWN",e[e.PULL_UP=9]="PULL_UP"}(re||(re={})),function(e){e[e.UNKNOWN_OPERATION_DIRECTION=0]="UNKNOWN_OPERATION_DIRECTION",e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT"}(ne||(ne={})),function(e){e[e.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",e[e.START=1]="START",e[e.RETRY=2]="RETRY",e[e.PAUSE=3]="PAUSE",e[e.RESUME=4]="RESUME",e[e.PENDING=5]="PENDING",e[e.PROCESSING=6]="PROCESSING",e[e.SUCCESS=7]="SUCCESS",e[e.FAIL=8]="FAIL",e[e.CANCEL=9]="CANCEL",e[e.FINISH=10]="FINISH"}(ae||(ae={}));var ue,de,le,ce,he,fe,_e=function(e){this.type=ie.USER_OPERATION,this.operation_type=re.CLICK,this.status=ae.UNKNOWN_STATUS;var t=e.sessionId,i=e.currentUrlPackage,r=e.referUrlPackage,n=e.name,a=e.params,s=e.type,o=e.contentPackage,u=e.status,d=e.taskType;u&&(this.status=void 0===ae[u]?ae.UNKNOWN_STATUS:ae[u]),d&&(this.type=void 0===ie[d]?ie.USER_OPERATION:ie[d]),this.operation_type=re[s],this.session_id=t,this.url_package=i,this.refer_url_package=r,this.content_package=o,this.element_package={action:n,params:JSON.stringify(a)}},pe=function(e){var t=e.name,i=e.params,r=e.currentUrlPackage,n=e.referUrlPackage;this.key=t,this.value=JSON.stringify(l({url_package:r,refer_url_package:n},i))},ve=[["a7","640x1136",["iPhone 5","iPhone 5s"]],["a7","1536x2048",["iPad Air","iPad Mini 2","iPad Mini 3"]],["a8","640x1136",["iPod touch (6th gen)"]],["a8","750x1334",["iPhone 6"]],["a8","1242x2208",["iPhone 6 Plus"]],["a8","1536x2048",["iPad Air 2","iPad Mini 4"]],["a9","640x1136",["iPhone SE"]],["a9","750x1334",["iPhone 6s"]],["a9","1242x2208",["iPhone 6s Plus"]],["a9x","1536x2048",["iPad Pro (1st gen 9.7-inch)"]],["a9x","2048x2732",["iPad Pro (1st gen 12.9-inch)"]],["a10","750x1334",["iPhone 7"]],["a10","1242x2208",["iPhone 7 Plus"]],["a10x","1668x2224",["iPad Pro (2th gen 10.5-inch)"]],["a10x","2048x2732",["iPad Pro (2th gen 12.9-inch)"]],["a11","750x1334",["iPhone 8"]],["a11","1242x2208",["iPhone 8 Plus"]],["a11","1125x2436",["iPhone X"]],["a12","828x1792",["iPhone Xr"]],["a12","1125x2436",["iPhone Xs"]],["a12","1242x2688",["iPhone Xs Max"]],["a12x","1668x2388",["iPad Pro (3rd gen 11-inch)"]],["a12x","2048x2732",["iPad Pro (3rd gen 12.9-inch)"]]],me=(ue="",function(){if(ue)return ue;var e=window.devicePixelRatio||1,t=Math.floor(Math.min(screen.width,screen.height)*e),i=Math.floor(Math.max(screen.width,screen.height)*e);return ue=t+"x"+i}),ge=(de="",function(){if(de)return de;var e=document.createElement("canvas").getContext("webgl");if(e){var t=e.getExtension("WEBGL_debug_renderer_info");de=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):"unknown"}else de="unknown";return de}),ye=(le="",function(){if(le)return le;var e=y(),t=P();if("iOS"!==e.os.name||t)return e.device.model||"unknown";var i=ge(),r=me(),n=i.match(/^apple\s+([_a-z0-9-]+)\s+gpu$/i);if(!n)return le="unknown";for(var a=0,s=ve;a<s.length;a++){var o=s[a];if(n[1].toLocaleLowerCase()===o[0]&&r===o[1]){le=o[2].join(" or ");break}}return le=le||e.device.model||"unknown"});function be(e){console&&console.warn&&console.warn(e)}function Ee(e){console&&console.error&&console.error(e)}!function(e){e[e.UNKNOWN_NETWORK=0]="UNKNOWN_NETWORK",e[e.NOT_CONNECTED=1]="NOT_CONNECTED",e[e.WIFI=2]="WIFI",e[e.MOBILE_4G=3]="MOBILE_4G",e[e.MOBILE_3G=4]="MOBILE_3G",e[e.MOBILE_2G=5]="MOBILE_2G",e[e.MOBILE_UNKNOWN=6]="MOBILE_UNKNOWN"}(ce||(ce={})),function(e){e[e.UNKNOWN_PLATFORM=0]="UNKNOWN_PLATFORM",e[e.ANDROID_PHONE=1]="ANDROID_PHONE",e[e.ANDROID_PAD=2]="ANDROID_PAD",e[e.IPHONE=3]="IPHONE",e[e.IPAD=4]="IPAD",e[e.WINDOWS_PC=5]="WINDOWS_PC",e[e.ANDROID_PHONE_H5=6]="ANDROID_PHONE_H5",e[e.IPHONE_H5=7]="IPHONE_H5",e[e.OUTSIDE_ANDROID_H5=8]="OUTSIDE_ANDROID_H5",e[e.OUTSIDE_IOS_H5=9]="OUTSIDE_IOS_H5",e[e.PC_WEB=10]="PC_WEB"}(he||(he={})),function(e){e.NATIVE="NATIVE",e.H5="H5",e.MP_WECHAT="MP_WECHAT",e.MP_ALIPAY="MP_ALIPAY",e.MP_BAIDU="MP_BAIDU",e.WEB="WEB"}(fe||(fe={}));var Se={unknown:ce.UNKNOWN_NETWORK,none:ce.NOT_CONNECTED,wifi:ce.WIFI,"4g":ce.MOBILE_4G,"3g":ce.MOBILE_3G,"2g":ce.MOBILE_2G,"slow-2g":ce.MOBILE_2G};function Te(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!e)return Se.unknown;var t=e.type,i=e.effectiveType;return Se[t]||Se[i]||Se.unknown}function we(){var e=y();if(!e.os.name)return he.UNKNOWN_PLATFORM;var t=P();return"Android"===e.os.name?t?he.ANDROID_PHONE_H5:he.OUTSIDE_ANDROID_H5:"iOS"===e.os.name?t?he.IPHONE_H5:he.OUTSIDE_IOS_H5:he.PC_WEB}var Le=[["identity_package","device_id"],["identity_package","global_id"],["identity_package","user_id"],["app_package","product"],["app_package","version_name"],["app_package","package_name"],["app_package","product_name"],["app_package","channel"],["network_package","type"]];var Re,xe=function(e,t){if(this.identity_package={device_id:w()},this.app_package={language:navigator.language,platform:we(),container:fe.H5},this.device_package={os_version:y().os.version||"unknown",model:ye(),ua:navigator.userAgent},this.network_package={type:Te()},this.need_encrypt=!1,this.h5_extra_attr={},function e(t,i){i&&Object.keys(i).forEach((function(r){var n=i[r];"object"==typeof n&&"h5_extra_attr"!==r?e(t[r],n):n&&(t[r]=n)}))}(this,e),P()||function(e,t){for(var i=0,r=Le;i<r.length;i++){for(var n=r[i],a=void 0,s=0,o=n;s<o.length;s++){var u=o[s];a=a?a[u]:e[u]}a||t&&be('Base Option "'+n[n.length-1]+'" should be set when in Kwai App')}}(this,t.showValidateMsg),this.app_package.version_name){var i=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(i+1)||0}this.network_package.type=this.network_package.type||Te();var r,n,a=this.h5_extra_attr||{},s={host_product:(r=E("kpn"),n=V(),r||n||""),app_version_name:E("appver")||"",resolution:me()},o=JSON.stringify(l(l({},s),a));this.h5_extra_attr=o},ke=(Re=(new Date).getTimezoneOffset()/60)<=0?"GMT+"+A(-Re+"",2,"0")+":00":"GMT-"+A(Re+"",2,"0")+":00",Ae=0,Oe=function(e){this.client_timestamp=(new Date).valueOf(),this.client_increment_id=++Ae,this.session_id=sessionStorage.getItem("sessionId")||L(),this.time_zone=ke,Object.assign(this,e)};function Pe(e,t){switch(e){case"PV":case"SHOW":return new Oe({event_package:{show_event:new oe({type:e,status:t.status,currentUrlPackage:t.currentUrlPackage,referUrlPackage:t.referUrlPackage,action:t.type,beginTime:t.beginTime,name:t.name,params:t.params,contentPackage:t.contentPackage})}});case"CUSTOM":return new Oe({stat_package:{custom_stat_event:new pe({currentUrlPackage:t.currentUrlPackage,name:t.name,params:t.params})}});case"RADAR":return new Oe({stat_package:{custom_stat_event:new pe({currentUrlPackage:t.currentUrlPackage,referUrlPackage:t.referUrlPackage,name:t.name,params:t.params})}});default:return new Oe({event_package:{task_event:new _e({type:e,status:t.status,taskType:t.taskType,sessionId:sessionStorage.getItem("sessionId")||L(),currentUrlPackage:t.currentUrlPackage,referUrlPackage:t.referUrlPackage,name:t.name,params:t.params,contentPackage:t.contentPackage})}})}}var De,Ie=[{keys:["identity_package","device_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["identity_package","user_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["identity_package","union_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["identity_package","global_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["app_package","product"],type:"number",validator:function(e){return"number"==typeof e}},{keys:["app_package","channel"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["app_package","version_name"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["app_package","package_name"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["app_package","product_name"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["experiment"],type:"Array",validator:function(e){return e instanceof Array}},{keys:["service_name"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["sub_biz"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["need_encrypt"],type:"boolean",validator:function(e){return"boolean"==typeof e}},{keys:["safety_id"],type:"string",validator:function(e){return"string"==typeof e}},{keys:["h5_extra_attr"],type:"Object",validator:function(e){return e instanceof Object}}];function Ce(e,t){for(var i={identity_package:{},network_package:{},app_package:{},experiment:[],service_name:"",safety_id:""},r=0,n=Ie;r<n.length;r++){var a=n[r],s=a.keys,o=a.validator,u=a.type,d=s[0],l=s[1],c=e[l||d];if(l?i[d][l]=e[l]:i[d]=e[d],void 0!==c&&!o(c))throw new Error(["There is an error init value on '"+(l||d)+"', ","the type should be '"+u+"', ","but your type is '"+typeof c+"'"].join(""))}return e.network_type&&(i.network_package=i.network_package||{},i.network_package.type=Se[e.network_type]),new xe(i,t)}!function(e){e[e.UNKNOWN_PAGE_TYPE=0]="UNKNOWN_PAGE_TYPE",e[e.NATIVE=1]="NATIVE",e[e.H5=2]="H5",e[e.MINA=3]="MINA"}(De||(De={}));var Ne=function(e,t){void 0===t&&(t="web");var i=function(e){void 0===e&&(e=location.href);var t=e.lastIndexOf("?");return-1===t?{page:e,params:void 0}:{page:e.slice(0,t),params:M(e.slice(t+1))}}(e),r=i.page,n=i.params;switch(t){case"web":this.page_type=De.H5;break;case"native":this.page_type=De.NATIVE;break;case"mina":this.page_type=De.MINA;break;default:this.page_type=De.UNKNOWN_PAGE_TYPE}this.params=JSON.stringify(n),this.page=r,this.identity=function(e){var t=e+(new Date).getTime()+w()+T();return _(t)}(r)},Me={device_id:"",global_id:"",union_id:"",user_id:"",product:0,channel:"",version_name:"",package_name:"",product_name:"",network_type:"unknown",appType:De.H5,service_name:"",sub_biz:"",need_encrypt:!1,safety_id:"",experiment:[],h5_extra_attr:{}},Ue=function(){function e(){this.events={}}return e.prototype.on=function(e,t){t&&"function"==typeof t&&(this.events[e]=this.events[e]||[],this.events[e].push(t))},e.prototype.off=function(e,t){this.events[e]&&(t&&"function"==typeof t&&R(this.events[e],t),t||(this.events[e]=[]))},e.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.events[e]&&this.events[e].forEach((function(e){e.apply(void 0,t)}))},e}(),Be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t}(Ue),Fe={updateInterval:2e4,crashThreshold:1e4},Ve=function(e){function t(t,i){var r=e.call(this)||this;r.eventName="onpagehide"in window?"pagehide":"beforeunload",r.options=l({},Fe),r.monitorId="@ks.monitor.crash",r.historyMoniorInfo=null,r.stop=function(){clearInterval(r.updateIntervalId);try{localStorage.removeItem(r.monitorId)}catch(e){}};try{var n=localStorage.getItem(r.monitorId);r.historyMoniorInfo=JSON.parse(n)||{}}catch(e){}return Object.assign(r.options,i),x(window,r.eventName,r.stop),r.on("crash",(function(e){t.sendImmediately("CUSTOM","crash",e)})),r.start(),r}return d(t,e),t.prototype.destroy=function(){this.stop(),this.off("crash"),k(window,this.eventName,this.stop)},t.prototype.checkHistoryCrash=function(){var e=(new Date).valueOf();this.historyMoniorInfo&&e-this.historyMoniorInfo.time>this.options.crashThreshold&&this.emit("crash",this.historyMoniorInfo)},t.prototype.start=function(){var e=this;this.checkHistoryCrash(),this.updateIntervalId=window.setInterval((function(){e.update()}),this.options.updateInterval),this.update()},t.prototype.update=function(){if(window.performance&&window.performance.memory){var e={time:(new Date).valueOf(),memory:{limit:window.performance.memory.jsHeapSizeLimit/1024,total:window.performance.memory.totalJSHeapSize/1024,used:window.performance.memory.usedJSHeapSize/1024}};try{localStorage.setItem(this.monitorId,JSON.stringify(e))}catch(e){}}},t.key="crachMonitor",t}(Be),je={interval:1e4,decimals:2},He=function(e){function t(t,i){var r=e.call(this)||this;return r.options=l({},je),r.count=0,Object.assign(r.options,i),r.on("performance",(function(e){t.collect("CUSTOM","fps",{fps:e})})),r.start(),r}return d(t,e),t.prototype.destroy=function(){this.off("performance"),this.stop()},t.prototype.start=function(){this.loop(),this.fpsTick()},t.prototype.fpsTick=function(){var e=this;this.fpsTickId=function(e){return(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||I).call(this,e)}((function(){e.count++,e.fpsTick()}))},t.prototype.loop=function(){var e=this;this.loopBeginTime=(new Date).valueOf(),this.loopId=window.setTimeout((function(){e.loopEndTime=(new Date).valueOf();var t=e.calculate();e.emit("performance",t),e.count=0,e.loop()}),this.options.interval)},t.prototype.stop=function(){!function(e){(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||C).call(this,e)}(this.fpsTickId),window.clearTimeout(this.loopId)},t.prototype.calculate=function(){return+(1e3/((this.loopEndTime-this.loopBeginTime)/this.count)).toFixed(this.options.decimals)},t.key="fpsMonitor",t}(Be),Ge="undefined"!=typeof window?window.performance:null,Ke=Ge&&Ge.timing||null,qe=(Ge&&Ge.getEntriesByType&&Ge.getEntriesByType("navigation")[0],{dnsLookup:{end:"domainLookupEnd",start:"domainLookupStart"},tcpConnection:{end:"connectEnd",start:"connectStart"},resourceLoad:{end:"responseEnd",start:"requestStart"},jsCost:{custom:function(){if("function"!=typeof performance.getEntries)return 0;var e=performance.getEntries(),t=e[0],i=e.filter((function(e){return"script"===e.initiatorType}))[0];return i?t.domComplete-i.fetchStart:0}},documentContentLoaded:{end:"domComplete",start:"fetchStart"},load:{end:"loadEventEnd",start:"fetchStart"},timeToFirstByte:{end:"loadEventEnd",start:"fetchStart"},firstScreen:{custom:function(e,t){var i=(t||{}).endPoint,r=void 0!==i?i:(new Date).valueOf();return Ke&&r-Ke.fetchStart||0}},whiteScreen:{custom:function(e,t){var i=(t||{}).endPoint,r=void 0!==i?i:(new Date).valueOf();return Ke&&r-Ke.fetchStart||0}}}),We=function(e){function t(t){var i=e.call(this)||this;return i.load=function(){setTimeout((function(){var e=i.collect();e&&["load","documentContentLoaded","dnsLookup","tcpConnection","jsCost","timeToFirstByte"].forEach((function(t){var r;"jsCost"===t&&0===e[t]||i.weblog.collect("CUSTOM",ze[t],((r={})[ze[t]]=e[t],r))}))}))},i.weblog=t,Ke?(x(window,"load",i.load),i.on("perf",(function(e){var t,r=e.key,n=e.data;i.weblog.collect("CUSTOM",ze[r],((t={})[ze[r]]=n[r],t))})),i):(Ee("The Timing Monitor need performance APIs to Support!"),i)}return d(t,e),t.prototype.destroy=function(){k(window,"load",this.load),this.off("perf")},t.prototype.calculate=function(e,t){var i=qe[e];if(!i)throw new Error("The perf key is not correct!");return"function"==typeof i.custom?i.custom(e,t):Ke[qe[e].end]-Ke[qe[e].start]},t.prototype.mark=function(e,t){var i=this.collect(e,t);this.emit("perf",{key:e,data:i})},t.prototype.collect=function(e,t){var i,r=this;if(Ke){if(e)return(i={})[e]=this.calculate(e,t),i;return Object.keys(qe).reduce((function(e,i){return e[i]=r.calculate(i,t),e}),{})}},t.key="timingMonitor",t}(Be),ze={load:"total_download_cost",documentContentLoaded:"operational_cost",dnsLookup:"dns_query_cost",tcpConnection:"tcp_cost",jsCost:"js_cost",whiteScreen:"white_screen_cost",firstScreen:"first_screen_cost",timeToFirstByte:"ttfb_cost"},Ye=function(){var e="undefined"!=typeof window?window.performance:null;if(e&&e.timing){if("function"==typeof e.timing.toJSON){var t=e.timing.toJSON();return t&&!t.redirectStart&&(t.redirectStart=t.navigationStart),t}return e.timing}return null};var Xe,Qe;!function(e){e.LOAD="load_statistics",e.RES="resource_statistics",e.API="api_statistics",e.ERROR="error",e.SDK_ERROR="sdk_error",e.CUSTOM="custom_statistics"}(Xe||(Xe={})),function(e){e.SCRIPT="script",e.RES="res",e.API="api",e.VIDEO="video"}(Qe||(Qe={}));var Je={redirect:{end:"fetchStart",start:"navigationStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(e,t){return t.redirectCount}},ssl:{custom:function(e,t){return 0===t.secureConnectionStart?null:t.connectEnd-t.secureConnectionStart}},ssl_start:{custom:function(e,t){return 0===t.secureConnectionStart?null:t.secureConnectionStart-t.redirectStart}},ttfb:{end:"responseStart",start:"requestStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domContentLoadedEventEnd"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var e=performance.getEntries().filter((function(e){return"first-paint"===e.name}))[0];return e?Math.ceil(e.startTime+e.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var e=Ye(),t=performance.getEntries(),i=performance.getEntries().filter((function(e){return"navigation"===e.initiatorType}))[0],r=t.filter((function(e){return"script"===e.initiatorType}))[0],n=i?i.domComplete:e.domComplete-e.navigationStart;return r&&n?n-r.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(e,t){return t.nextHopProtocol}}},Ze={fetch_start:{custom:function(e,t){return Math.round(t.fetchStart)}},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0},ssl:{cachedSkip:!0,custom:function(e,t){return 0===t.secureConnectionStart?null:t.requestStart-t.secureConnectionStart}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0},total:{end:"responseEnd",start:"fetchStart"},size:{cachedSkip:!0,custom:function(e,t){return t.encodedBodySize},noThrottle:!0},protocol:{custom:function(e,t){return t.nextHopProtocol}},file:{custom:function(e,t){return t.name},noThrottle:!0},res_type:{custom:function(e,t){return t.initiatorType}},cached:{custom:function(e,t){return 0===t.transferSize||null==t.transferSize&&0===t.domainLookupStart},noThrottle:!0}},$e=["//wlog.kuaishou.com/rest/n/log/web/collect","//log-sdk.ksapisrv.com/rest/wd/common/log/collect/misc2"],et=function(e){function t(t,i){var r=e.call(this)||this;return r.plugins=[],r.observeResource=function(e){e.getEntriesByType("resource").forEach((function(e){return r.reportPerformance(e)}))},r.asyncReportTiming=function(){setTimeout((function(){r.reportPerformance(Ye())}))},r.weblog=t,r.options=i,r}return d(t,e),t.prototype.use=function(e,t){this.plugins.push(new e(t,this.options))},t.prototype.created=function(){this.register(),this.plugins.forEach((function(e){e.created()}))},t.prototype.destroy=function(){k(window,"load",this.asyncReportTiming),this.plugins.forEach((function(e){e.destroy()}))},t.prototype.register=function(){if(Ye()){x(window,"load",this.asyncReportTiming);try{this.observeResource(performance),new PerformanceObserver(this.observeResource).observe({entryTypes:["resource"]})}catch(e){be("[Radar] ç±äºä¸æ¯æ Performance API Level 2ï¼åªè¿è¡è¯·æ±çæ§åå¼å¸¸çæ§")}}else be("[Radar] ç±äºä¸æ¯æ Performance APIï¼åªè¿è¡è¯·æ±çæ§åå¼å¸¸çæ§")},t.prototype.throttle=function(e,t,i,r){if(void 0===r&&(r={}),t.noThrottle||"number"!=typeof e)return e;var n=r.startPoint,a=r.endPoint;if(e>6e4||e<0){var s="["+i+" å¼å¸¸]: "+e+"ï¼åå§æ°æ®ä¸ºï¼"+t.end+": "+a+" - "+t.start+": "+n;return this.logCollect({key:Xe.SDK_ERROR,value:{msg:s}}),null}return Math.round(e)},t.prototype.reportPerformance=function(e){this.plugins.forEach((function(t){t.when(e)&&t.onPerfReport(e)}))},t.prototype.calculate=function(e,t,i){var r=t[e];if(r){if(r.cachedSkip)if(this.calculate("cached",t,i))return;if("function"==typeof r.custom){var n=r.custom(e,i);return this.throttle(n,r,e)}var a=r.end,s=r.start,o=+i[a],u=+i[s],d=o-u;return this.throttle(d,r,e,{startPoint:u,endPoint:o})}Ee("perf key "+e+" is unexpected!")},t.prototype.generateLog=function(e,t){var i=this,r={};return Object.keys(e).forEach((function(n){var a=n,s=i.calculate(a,e,t);null!=s&&(r[a]=s)})),r},t.prototype.logCollect=function(e){this.options&&this.weblog.collect("RADAR","fe_radar",l({project_id:this.options.projectId,app_version_name:E("appver")||""},e))},t.prototype.logSendImmediately=function(e,t){this.options&&this.weblog.sendImmediately({type:"RADAR",async:!0,forceUseBeacon:t},"fe_radar",l({project_id:this.options.projectId,app_version_name:E("appver")||""},e))},t}(Be),tt=/^(https?:)?\/\//;function it(e,t){if(!e)return!1;var i=e.replace(tt,"");return t.some((function(e){return i.indexOf(e)>0}))}var rt=function(e){this.radar=e},nt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="navigation",t.eventName="onpagehide"in window?"pagehide":"beforeunload",t.logData={},t.logSended=!1,t.isInKwai=D(),t.record={fmp:!1,base:!1},t.reportOnUnload=function(){t.logSended||(t.logSended=!0,t.radar.logCollect(t.data),t.radar.weblog.flush())},t}return d(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this.sepDimension({key:Xe.LOAD,value:this.logData})},enumerable:!0,configurable:!0}),t.prototype.created=function(){var e=this;this.isInKwai&&(this.delay=setTimeout((function(){return e.radar.logCollect(e.data)}),1e4)),x(window,this.eventName,this.reportOnUnload)},t.prototype.when=function(e){if(e.custom){var t=(e.entry||{}).key;return["fmp","play_clicked","play_idr"].indexOf(t)>-1}return!e.entryType||"navigation"===e.entryType},t.prototype.onPerfReport=function(e){var t;if(e.custom){var i=e.entry;if(i){var r=i.key,n=i.value;Object.assign(this.logData,((t={})[r]=n,t)),"fmp"===r&&(this.record.fmp=!0)}}else{var a=this.radar.generateLog(Je,e);Object.assign(this.logData,a),this.record.base=!0}this.isInKwai&&this.record.fmp&&this.record.base&&this.reportOnUnload()},t.prototype.destroy=function(){clearTimeout(this.delay),k(window,this.eventName,this.reportOnUnload)},t.prototype.sepDimension=function(e){var t=e.key,i=e.value,r=i.protocol;return{key:t,value:c(i,["protocol"]),dimension:{protocol:r}}},t}(rt),at=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="resource",t}return d(t,e),t.prototype.created=function(){},t.prototype.when=function(e){return!it(e.name,this.radar.ignoreList)&&"resource"===e.entryType},t.prototype.onPerfReport=function(e){var t=this.radar.generateLog(Ze,e);this.radar.logCollect(this.sepDimension({key:Xe.RES,value:t}))},t.prototype.destroy=function(){},t.prototype.sepDimension=function(e){var t=e.key,i=e.value,r=i.protocol,n=i.file,a=i.cached,s=i.res_path,o=i.failed,u=i.res_type;return{key:t,value:c(i,["protocol","file","cached","res_path","failed","res_type"]),dimension:{protocol:r,file:n,cached:a,failed:o,res_path:s,res_type:u}}},t}(rt),st=f((function(e){(function(t){var i,r,n,a,s,o,u,d,l,c,f,_,p,v,m,g,y,b,E,S,T,w,L,R,x,k,A=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};c=null,c="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:void 0!==h?h:window,y=c.document,d="addEventListener",u="removeEventListener",n="dispatchEvent",v="XMLHttpRequest",l=["load","loadend","loadstart"],i=["progress","abort","error","timeout"],R="undefined"!=typeof navigator&&navigator.useragent?navigator.userAgent:"",S=parseInt((/msie (\d+)/.exec(R.toLowerCase())||[])[1]),isNaN(S)&&(S=parseInt((/trident\/.*; rv:(\d+)/.exec(R.toLowerCase())||[])[1])),(k=Array.prototype).indexOf||(k.indexOf=function(e){var t,i,r;for(t=i=0,r=this.length;i<r;t=++i)if(this[t]===e)return t;return-1}),L=function(e,t){return Array.prototype.slice.call(e,t)},g=function(e){return"returnValue"===e||"totalSize"===e||"position"===e},E=function(e,t){var i;for(i in e)if(e[i],!g(i))try{t[i]=e[i]}catch(e){}return t},T=function(e){return void 0===e?null:e},w=function(e,t,i){var r,a,s,o;for(a=function(e){return function(r){var a,s,o;for(s in a={},r)g(s)||(o=r[s],a[s]=o===t?i:o);return i[n](e,a)}},s=0,o=e.length;s<o;s++)r=e[s],i._has(r)&&(t["on"+r]=a(r))},b=function(e){var t;if(y&&null!=y.createEventObject)return(t=y.createEventObject()).type=e,t;try{return new Event(e)}catch(t){return{type:e}}},(x=(r=function(e){var i,r,a;return r={},a=function(e){return r[e]||[]},(i={})[d]=function(e,i,n){r[e]=a(e),r[e].indexOf(i)>=0||(n=n===t?r[e].length:n,r[e].splice(n,0,i))},i[u]=function(e,i){var n;e!==t?(i===t&&(r[e]=[]),-1!==(n=a(e).indexOf(i))&&a(e).splice(n,1)):r={}},i[n]=function(){var t,r,n,s,o,u,d;for(r=(t=L(arguments)).shift(),e||(t[0]=E(t[0],b(r))),(s=i["on"+r])&&s.apply(i,t),n=o=0,u=(d=a(r).concat(a("*"))).length;o<u;n=++o)d[n].apply(i,t)},i._has=function(e){return!(!r[e]&&!i["on"+e])},e&&(i.listeners=function(e){return L(a(e))},i.on=i[d],i.off=i[u],i.fire=i[n],i.once=function(e,t){var r;return r=function(){return i.off(e,r),t.apply(null,arguments)},i.on(e,r)},i.destroy=function(){return r={}}),i})(!0)).EventEmitter=r,x.before=function(e,t){if(e.length<1||e.length>2)throw"invalid hook";return x[d]("before",e,t)},x.after=function(e,t){if(e.length<2||e.length>3)throw"invalid hook";return x[d]("after",e,t)},x.enable=function(){c[v]=p,"function"==typeof f&&(c.fetch=f),s&&(c.FormData=_)},x.disable=function(){c[v]=x[v],c.fetch=x.fetch,s&&(c.FormData=s)},m=x.headers=function(e,t){var i,r,n,a,s,o,u,d,l;switch(null==t&&(t={}),typeof e){case"object":for(n in r=[],e)s=e[n],a=n.toLowerCase(),r.push(a+":\t"+s);return r.join("\n")+"\n";case"string":for(u=0,d=(r=e.split("\n")).length;u<d;u++)i=r[u],/([^:]+):\s*(.+)/.test(i)&&(a=null!=(l=RegExp.$1)?l.toLowerCase():void 0,o=RegExp.$2,null==t[a]&&(t[a]=o));return t}},s=c.FormData,_=function(e){var t,i;this.fd=e?new s(e):new s,this.form=e,t=[],Object.defineProperty(this,"entries",{get:function(){return(e?L(e.querySelectorAll("input,select")).filter((function(e){var t;return"checkbox"!==(t=e.type)&&"radio"!==t||e.checked})).map((function(e){return[e.name,"file"===e.type?e.files:e.value]})):[]).concat(t)}}),this.append=(i=this,function(){var e;return e=L(arguments),t.push(e),i.fd.append.apply(i.fd,e)})},s&&(x.FormData=s,c.FormData=_),o=c[v],x[v]=o,p=c[v]=function(){var e,t,a,s,o,u,c,h,f,p,g,y,b,L,R,k,O,P,D,I;O=new x[v],b=null,u=void 0,L=void 0,g=void 0,f=function(){var e,t,i,r;if(g.status=b||O.status,-1===b&&S<10||(g.statusText=O.statusText),-1!==b)for(e in r=m(O.getAllResponseHeaders()))i=r[e],g.headers[e]||(t=e.toLowerCase(),g.headers[t]=i)},h=function(){if(O.responseType&&"text"!==O.responseType)"document"===O.responseType?(g.xml=O.responseXML,g.data=O.responseXML):g.data=O.response;else{g.text=O.responseText,g.data=O.responseText;try{g.xml=O.responseXML}catch(e){}}"responseURL"in O&&(g.finalUrl=O.responseURL)},k=function(){o.status=g.status,o.statusText=g.statusText},R=function(){"text"in g&&(o.responseText=g.text),"xml"in g&&(o.responseXML=g.xml),"data"in g&&(o.response=g.data),"finalUrl"in g&&(o.responseURL=g.finalUrl)},a=function(i){for(;i>e&&e<4;)o.readyState=++e,1===e&&o[n]("loadstart",{}),2===e&&k(),4===e&&(k(),R()),o[n]("readystatechange",{}),4===e&&(!1===p.async?t():setTimeout(t,0))},t=function(){u||o[n]("load",{}),o[n]("loadend",{}),u&&(o.readyState=0)},e=0,y=function(e){var t,i;4===e?(t=x.listeners("after"),(i=function(){var e;return t.length?2===(e=t.shift()).length?(e(p,g),i()):3===e.length&&p.async?e(p,g,i):i():a(4)})()):a(e)},o=(p={}).xhr=r(),O.onreadystatechange=function(e){try{2===O.readyState&&f()}catch(e){}4===O.readyState&&(L=!1,f(),h()),y(O.readyState)},c=function(){u=!0},o[d]("error",c),o[d]("timeout",c),o[d]("abort",c),o[d]("progress",(function(){e<3?y(3):o[n]("readystatechange",{})})),("withCredentials"in O||x.addWithCredentials)&&(o.withCredentials=!1),o.status=0;for(P=0,D=(I=i.concat(l)).length;P<D;P++)s=I[P],o["on"+s]=null;return o.open=function(t,i,r,n,a){e=0,u=!1,L=!1,p.headers={},p.headerNames={},p.status=0,(g={}).headers={},p.method=t,p.url=i,p.async=!1!==r,p.user=n,p.pass=a,y(1)},o.send=function(e){var t,r,n,a,s,u,d,c;for(u=0,d=(c=["type","timeout","withCredentials"]).length;u<d;u++)(n="type"===(r=c[u])?"responseType":r)in o&&(p[r]=o[n]);p.body=e,s=function(){var e,t,a,s,u,d;for(w(i,O,o),o.upload&&w(i.concat(l),O.upload,o.upload),L=!0,O.open(p.method,p.url,p.async,p.user,p.pass),a=0,s=(u=["type","timeout","withCredentials"]).length;a<s;a++)n="type"===(r=u[a])?"responseType":r,r in p&&(O[n]=p[r]);for(e in d=p.headers)t=d[e],e&&O.setRequestHeader(e,t);p.body instanceof _&&(p.body=p.body.fd),O.send(p.body)},t=x.listeners("before"),(a=function(){var e,i;return t.length?((e=function(e){if("object"==typeof e&&("number"==typeof e.status||"number"==typeof g.status))return E(e,g),A.call(e,"data")<0&&(e.data=e.response||e.text),void y(4);a()}).head=function(e){return E(e,g),y(2)},e.progress=function(e){return E(e,g),y(3)},1===(i=t.shift()).length?e(i(p)):2===i.length&&p.async?i(p,e):e()):s()})()},o.abort=function(){b=-1,L?O.abort():o[n]("abort",{})},o.setRequestHeader=function(e,t){var i,r;i=null!=e?e.toLowerCase():void 0,r=p.headerNames[i]=p.headerNames[i]||e,p.headers[r]&&(t=p.headers[r]+", "+t),p.headers[r]=t},o.getResponseHeader=function(e){var t;return t=null!=e?e.toLowerCase():void 0,T(g.headers[t])},o.getAllResponseHeaders=function(){return T(m(g.headers))},O.overrideMimeType&&(o.overrideMimeType=function(){return O.overrideMimeType.apply(O,arguments)}),O.upload&&(o.upload=p.upload=r()),o.UNSENT=0,o.OPENED=1,o.HEADERS_RECEIVED=2,o.LOADING=3,o.DONE=4,o.response="",o.responseText="",o.responseXML=null,o.readyState=0,o.statusText="",o},"function"==typeof c.fetch&&(a=c.fetch,x.fetch=a,f=c.fetch=function(e,t){var i,r,n;return null==t&&(t={headers:{}}),t.url=e,n=null,r=x.listeners("before"),i=x.listeners("after"),new Promise((function(e,s){var o,u,d,l,c;u=function(){return t.body instanceof _&&(t.body=t.body.fd),t.headers&&(t.headers=new Headers(t.headers)),n||(n=new Request(t.url,t)),E(t,n)},d=function(t){var r;return i.length?2===(r=i.shift()).length?(r(u(),t),d(t)):3===r.length?r(u(),t,d):d(t):e(t)},o=function(t){var i;if(void 0!==t)return i=new Response(t.body||t.text,t),e(i),void d(i);l()},l=function(){var e;if(r.length)return 1===(e=r.shift()).length?o(e(t)):2===e.length?e(u(),o):void 0;c()},c=function(){return a(u()).then((function(e){return d(e)})).catch((function(e){return d(e),s(e)}))},l()}))}),p.UNSENT=0,p.OPENED=1,p.HEADERS_RECEIVED=2,p.LOADING=3,p.DONE=4,"function"==typeof t&&t.amd?t("xhook",[],(function(){return x})):e.exports?e.exports={xhook:x}:c&&(c.xhook=x)}).call(h)})).xhook;st.disable();var ot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.queue=[],t.xhrLog=[],t.key="api",t.logList=[],t.perfList=[],t.beforeHook=function(e){if(!it(e.url,t.radar.ignoreList)){var i={api:t.requestURLCompletion(e.url),method:e.method,request:e,startTime:Date.now()};t.queue.push(i)}},t.afterHook=function(e,i){var r=t.queue.filter((function(t){return t.request===e}))[0];if(r){delete r.request;var n=r.startTime,a=c(r,["startTime"]),s=ut(i.headers),o=l({duration:Date.now()-n,total:Date.now()-n,status:i.status,size:+s},a);t.isResponseError(i)?t.radar.logCollect(t.sepDimension({key:Xe.API,value:o})):(t.logList.push(o),t.mergeAPIPerf(null,o)),t.queue=t.queue.filter((function(t){return t.request!==e}))}},t}return d(t,e),t.prototype.when=function(e){return!it(e.name,this.radar.ignoreList)&&("resource"===e.entryType&&"xmlhttprequest"===e.initiatorType)},t.prototype.onPerfReport=function(e){var t=this.radar.generateLog(Ze,e);this.perfList.push(t),this.mergeAPIPerf(l(l({},t),{api:t.file}))},t.prototype.mergeAPIPerf=function(e,t){var i=e||t,r=e?this.logList:this.perfList;if(i){var n=r.findIndex((function(e){return(i.api||"").replace(/\?.+$/,"")===(e.api||"").replace(/\?.+$/,"")&&(Object.assign(i,e),delete i.file,!0)}));-1!==n&&(r.splice(n,1),this.radar.logCollect(this.sepDimension({key:Xe.API,value:i})))}},t.prototype.sepDimension=function(e){var t=e.key,i=e.value,r=i.protocol,n=i.cached,a=i.status,s=i.api,o=i.method;return{key:t,value:c(i,["protocol","cached","status","api","method"]),dimension:{protocol:r,api:s,status:a,cached:n,method:o}}},t.prototype.requestURLCompletion=function(e){var t=document.location,i=t.protocol,r=t.host;return 0===e.indexOf("//")?i+e:0===e.indexOf("/")?i+"//"+r+e:e},t.prototype.isResponseError=function(e){return 0===e.status},t.prototype.created=function(){st.disable();var e=window.FormData;st.before(this.beforeHook),st.after(this.afterHook),st.enable(),window.FormData=e},t.prototype.destroy=function(){st.disable()},t}(rt);function ut(e){return"function"==typeof e.get?+e.get("Content-Length")||0:+e["content-length"]||0}var dt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="error",t.onResError=function(e){var i=t.isScriptError(e),r=e.error;if(i){var n={error_type:Qe.SCRIPT,error_cons_type:e.type,msg:e.message||e.reason,stack:r?r.stack:null,file:e.filename,line:e.lineno,col:e.colno};t.collect(n)}else t.radar.logCollect(t.sepDimension({key:Xe.RES,value:{failed:!0,file:e.target.src,cached:!1,res_path:F(e.path||e.composedPath())}}))},t.onPromiseError=function(e){var i={error_type:Qe.SCRIPT,error_cons_type:e.type,msg:e.reason.message};t.collect(i)},t}return d(t,e),t.prototype.when=function(e){if(e.custom){var t=(e.entry||{}).key;if(["play_block","play_error"].indexOf(t)>-1)return!0}return!1},t.prototype.onPerfReport=function(e){if(e.custom){var t=e.entry||{},i=t.key,r=t.value;this.collect({error_type:Qe.VIDEO,error_cons_type:i,msg:r})}},t.prototype.sepDimension=function(e){var t=e.key;if("error"===t){var i=e.value,r=i.file,n=i.error_cons_type,a=i.error_type,s=i.msg,o=i.col,u=i.line;return{key:t,value:c(i,["file","error_cons_type","error_type","msg","col","line"]),dimension:{error_cons_type:n,file:r,error_type:a,msg:s,col:o,line:u}}}var d=e.value,l=d.protocol,h=d.file,f=d.cached,_=d.res_path,p=d.failed,v=d.res_type;return{key:t,value:c(d,["protocol","file","cached","res_path","failed","res_type"]),dimension:{protocol:l,file:h,cached:f,failed:p,res_path:_,res_type:v}}},t.prototype.collect=function(e){this.radar.logCollect(this.sepDimension({key:Xe.ERROR,value:e}))},t.prototype.isScriptError=function(e){return e.message||null!=e.lineno},t.prototype.created=function(){x(window,"error",this.onResError,!0),x(window,"unhandledrejection",this.onPromiseError)},t.prototype.destroy=function(){k(window,"error",this.onResError,!0),k(window,"unhandledrejection",this.onPromiseError)},t}(rt),lt=function(e){function t(t,i){var r,n=e.call(this,t,i)||this;return n.customReported=[],n.ignoreList=(r=n.options&&n.options.ignoreList,void 0===r&&(r=[]),r.concat($e).map((function(e){return e.replace(tt,"")}))).concat(t.logger.url),n.validOption()?(n.use(nt,n),n.use(at,n),n.use(ot,n),n.use(dt,n),e.prototype.created.call(n),n):n}return d(t,e),t.samplingControl=function(e){if(!e)return!1;var t=e.sampling;return Math.random()<t},t.prototype.collect=function(e,t){0===e.indexOf("c_")?this.logCollect({key:Xe.CUSTOM,value:{metric_value:t},dimension:{metric_name:e}}):Ee("[Radar] ä¼ å¥çèªå®ä¹ææ  "+e+" å¿é¡»ä¸º c_ å¼å¤´")},t.prototype.reportTimePoint=function(e,t){if(this.customReported.indexOf(e)>-1)return null;this.customReported.push(e);var i=t;if("string"!=typeof t){var r=function(e){var t="undefined"!=typeof window?window.performance:null;if(!t)return{value:null};if(null!=e)return{value:e-t.timing.navigationStart,detail:{start:"navigationStart",startPoint:t.timing.navigationStart,end:"customTime",endPoint:e}};if("function"==typeof t.now)return{value:t.now(),detail:{start:"navigationStart",startPoint:t.timing.navigationStart,end:"perfNowAPI",endPoint:t.now()}};var i=Date.now();return{value:i-t.timing.navigationStart,detail:{start:"navigationStart",startPoint:t.timing.navigationStart,end:"dateNow",endPoint:i}}}(t);if(null==r.value)return;i=this.throttle(r.value,r.detail,"fmp",r.detail)}return null!=i?(this.reportPerformance({custom:!0,entry:{key:e,value:i}}),i):void 0},t.prototype.fmp=function(e){var t=this.reportTimePoint("fmp",e);t&&this.logCollect({key:Xe.CUSTOM,value:{fmp:t}})},t.prototype.playClicked=function(e){this.reportTimePoint("play_clicked",e)},t.prototype.playIDR=function(e){this.reportTimePoint("play_idr",e)},t.prototype.playBlock=function(e){this.reportTimePoint("play_block",e)},t.prototype.playError=function(e){this.reportTimePoint("play_error",e)},t.prototype.validOption=function(){if(!this.options)return!1;var e=this.options,t=e.sampling;return"string"!=typeof e.projectId?(Ee("[Radar] å¿é¡»éç½® projectId å±æ§"),!1):!(t>1||t<0)||(Ee("[Radar] éæ ·ç sampling å¿é¡»å¨ 0~1 ä¹é´"),!1)},t.key="radar",t}(et),ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.fmp=function(){},t.prototype.playClicked=function(){},t.prototype.playIDR=function(){},t.prototype.playBlock=function(){},t.prototype.playError=function(){},t.prototype.destroy=function(){},t.key="radar",t}(Be),ht=function(e){function t(t,i){var r=e.call(this)||this;return r.oldPushState=history.pushState,r.oldReplaceState=history.replaceState,r.beginTime=Ke&&Ke.fetchStart||(new Date).valueOf(),r.visibilityChange=function(){"hidden"===document.visibilityState&&r.weblog.collect("PV",{type:"hidden",beginTime:r.beginTime}),"visible"===document.visibilityState&&r.weblog.collect("PV",{type:"visible",beginTime:r.beginTime})},r.proxyPushState=function(e,t,i){return r.urlChange(),r.oldPushState.call(history,e,t,i)},r.proxyReplaceState=function(e,t,i){return r.urlChange(),r.oldReplaceState.call(history,e,t,i)},r.urlChange=function(){setTimeout((function(){if(!r.autoPVFilter(location.href,r.weblog.currentUrl))return!1;r.weblog.collect("PV",{type:"leave",beginTime:r.beginTime}),r.weblog.updateCurrentUrlPackage(location.href),r.weblog.collect("PV",{type:"enter",beginTime:r.beginTime}),r.beginTime=(new Date).valueOf()}))},r.autoPVFilter=i||function(){return!0},r.weblog=t,r.autoPVFilter(location.href,null)&&r.weblog.collect("PV",{type:"enter",beginTime:r.beginTime}),history.pushState=r.proxyPushState,history.replaceState=r.proxyReplaceState,x(window,N?"popstate":"hashchange",r.urlChange),x(document,"visibilitychange",r.visibilityChange),r}return d(t,e),t.prototype.destroy=function(){this.weblog.sendImmediately("PV",{type:"leave"}),k(window,N?"popstate":"hashchange",this.urlChange),k(document,"visibilitychange",this.visibilityChange),history.pushState=this.oldPushState,history.replaceState=this.oldReplaceState},t.key="autoPV",t}(Be),ft=function(e){function t(t,i){void 0===t&&(t={});var r=e.call(this)||this;r.eventName="onpagehide"in window?"pagehide":"beforeunload",r.currentUrlPackage=new Ne(location.href),r.logConfig={},r.isSampled=!0,r.logger=new te,r.plugins={},r.flush=function(){r.logger.flush(!1)},Ke||be("Your browser don't support performance API, the auto pv duration may not correct"),r.baseOption=l(l({},Me),i),r.logConfig=t,r.commomPackage=Ce(r.baseOption,r.logConfig);var n=t.autoPV,a=t.fps,s=t.timing,o=t.radar,u=t.crash,d=t.autoPVFilter,h=t.referer,f=c(t,["autoPV","fps","timing","radar","crash","autoPVFilter","referer"]),_="",p="web";return h?(_=h.value,p=h.type&&h.type||p):document.referrer&&(_=document.referrer),_&&(r.referUrlPackage=new Ne(_,p)),r.logger.init(f,r.commomPackage),r.isSampled=r.getIfSampled(),x(window,r.eventName,r.flush),r.initBuildInPlugins({radar:o,autoPV:n,fps:a,timing:s,crash:u,autoPVFilter:d}),r}return d(t,e),t.prototype.getIfSampled=function(){var e=this.logConfig.sampleRate||this.logger.config.sampleRate,t=this.logConfig.sampleRateFn||this.logger.config.sampleRateFn;if(t)try{return t()}catch(e){return console.log(e,"æ½æ ·å½æ°æ¥é"),!1}return!(!e||e<0)&&Math.random()<e},Object.defineProperty(t.prototype,"currentUrl",{get:function(){var e=this.currentUrlPackage,t=e.page,i=e.params;return i&&"object"==typeof i?t+"?"+U(i):t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"referUrl",{get:function(){if(!this.referUrlPackage)return"";var e=this.referUrlPackage,t=e.page,i=e.params;return i&&"object"==typeof i?t+"?"+U(i):t},enumerable:!0,configurable:!0}),t.prototype.initBuildInPlugins=function(e){var t=e.autoPV,i=e.radar,r=e.fps,n=e.timing,a=e.crash,s=e.autoPVFilter;t=void 0===t||t,n=void 0===n||n,a=void 0===a||a,(r=void 0===r||r)&&this.plug(He),n&&this.plug(We),a&&this.plug(Ve),t&&this.plug(ht,s),i&&(i.sampling&&lt.samplingControl(i)?this.plug(lt,i):this.plug(ct,i))},t.prototype.updateCurrentUrlPackage=function(e){void 0===e&&(e=location.href),this.referUrlPackage=this.currentUrlPackage,this.currentUrlPackage=new Ne(e)},t.prototype.updateBase=function(e){this.logger.updateBase(Ce(l(l({},this.baseOption),e),this.logConfig))},t.prototype.plug=function(e,t){if(this.plugins[e.key])throw new Error("There is a duplex plugin called "+e.key);return this.plugins[e.key]=new e(this,t),this},t.prototype.unplug=function(e){var t=this.plugins[e];t&&(t.destroy(),delete this.plugins[e])},t.prototype.unplugAll=function(){for(var e in this.plugins)this.plugins[e]&&this.unplug(e)},t.prototype.generateLog=function(e,t,i,r){if(void 0===e&&(e="CLICK"),"PV"===e){var n=t,a=n.type,s=n.beginTime,o=n.page,u=n.params,d=n.contentPackage;return o&&(this.currentUrlPackage.page=o),u&&(this.currentUrlPackage.params="string"==typeof u?u:JSON.stringify(u)),Pe("PV",{type:a,beginTime:s,name:"PV",params:{},currentUrlPackage:this.currentUrlPackage,referUrlPackage:this.referUrlPackage,contentPackage:d,status:status})}if("object"==typeof t){var l=t,c=l.action,h=l.params,f=l.contentPackage,_=l.status,p=l.type;return Pe(e,{name:c,params:h,contentPackage:f,currentUrlPackage:this.currentUrlPackage,referUrlPackage:this.referUrlPackage,status:_,taskType:p})}return Pe(e,{name:t,params:i,contentPackage:r,currentUrlPackage:this.currentUrlPackage,referUrlPackage:this.referUrlPackage})},t.prototype.send=function(e,t,i,r,n,a,s){if(void 0===e&&(e="CLICK"),this.isSampled){var o=this.generateLog(e,t,i,r);this.logger.send(o,!!n,a,s)}},t.prototype.collect=function(e,t,i,r){if(void 0===e&&(e="CLICK"),"string"==typeof e)this.send(e,t,i,r,!1);else{var n=e;this.send(n.type,t,i,r,!1,n.async)}},t.prototype.sendImmediately=function(e,t,i,r){if(void 0===e&&(e="CLICK"),"string"==typeof e)this.send(e,t,i,r,!0);else{var n=e;this.send(n.type,t,i,r,!0,n.async,n.forceUseBeacon)}},t.prototype.destroy=function(){this.unplugAll(),k(window,this.eventName,this.flush)},t}(Ue)}).call(this,i(2))},function(e,t,i){"use strict";i.r(t);var r=i(1),n=i.n(r),a=i(3),s=Object.assign||function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])}return i},o={debug:!1,box:"flv",isLive:!0,maxRetry:3,retryDelay:2e3,connectionTimeout:1e4,startPlayBufferSec:3,logEnv:"production",logBaseConfig:{product_name:"ks693554345971931249"}},u={retryDelay:100,startPlayBufferSec:0};var d,l=i(4),c=i(0);!function(e){e.video="video",e.audio="audio",e.unknown="unknown"}(d||(d={}));var h=function(){function e(e,t,i){this._weblog=void 0,this._biz=void 0,this._version=void 0,this._mediaType=d.unknown,this._uaResult=void 0,this._weblog=new l.a(e,t),this._version=i,this._uaResult=(new c.UAParser).getResult()}var t=e.prototype;return t.setBiz=function(e){this._biz=s({},e)},t.setMediaType=function(e){this._mediaType=e},t.sendSummary=function(e){this._preBeacon(e),this._weblog.sendImmediately({type:"CLICK",async:!1},"summary",e)},t.sendRealtime=function(e){this._preBeacon(e),this._weblog.sendImmediately("CLICK","realtime",e)},t.sendDownload=function(e){this._preBeacon(e),this._weblog.sendImmediately("CLICK","download",e)},t._preBeacon=function(e){if(e){this._biz&&(e.biz=this._biz),e.media_type=this._mediaType,e.version=this._version,e.player_type="kwaiPlayerKernel";var t=this._uaResult.browser,i=t.name,r=t.version;e.browser=i,e.browser_version=r}},e}();function f(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(e){var t,i;i=e,(t=_).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r,a,l,c;r=_;function _(t){var i;return(i=e.call(this)||this)._kernel=void 0,i._reportingChannel=void 0,i._media=void 0,i._config=void 0,i._onReport=function(e){if(i._reportingChannel)switch(e.type){case"realtimeBeacon":i._reportingChannel.sendRealtime(e.value);break;case"download":i._reportingChannel.sendDownload(e.value)}},i._onError=function(e){i.emit("error",e)},i.off||(i.off=i.removeListener),i._config=function(e){var t=e&&"hls"===e.box?s({},o,u):s({},o);if(s(t,e),!t.logBaseConfig.product_name||!t.logBaseConfig.product_name.trim())throw new Error("config.logBaseConfig.product_name must be set");"production"===t.logEnv&&(t.logEnv="https://open-log-sdk.gifshow.com/rest/wd/common/log/collect/misc2");var i=t.logBaseConfig,r={product_name:i.product_name,service_name:"media_web_player_external"};return["user_id","network_type","sub_biz","need_encrypt","experiment","union_id"].forEach((function(e){t.logBaseConfig.hasOwnProperty(e)&&(r[e]=i[e])})),i&&(t.logBaseConfig=r),t}(t),i._config.logBaseConfig&&(i._reportingChannel=new h({env:i._config.logEnv,autoPV:!1,timing:!1,crash:!1,fps:!1,useBeacon:!0},i._config.logBaseConfig,_.version)),i}_.isSupport=function(e){return e||(e={box:"flv",isLive:!0}),n.a.isSupport({box:e.box,isLive:e.isLive})},a=_,c=[{key:"version",get:function(){return"1.0.4"}}],(l=null)&&f(a.prototype,l),c&&f(a,c);var p=_.prototype;return p.setBiz=function(e){this._reportingChannel&&this._reportingChannel.setBiz(e)},p.attachMedia=function(e){this._media=e,this._reportingChannel&&this._reportingChannel.setMediaType(e instanceof HTMLVideoElement?d.video:d.audio),this._kernel||this._initKernel()},p.load=function(e){this._kernel||this._initKernel(),this._kernel&&this._kernel.load(e)},p.sendSummary=function(){this._reportingChannel&&this._kernel&&this._reportingChannel.sendSummary(this._kernel.getAudienceStat())},p.refresh=function(){this._kernel&&this._kernel.refresh()},p.destroy=function(){this._destroyKernel()},p.liveEnd=function(){this._kernel&&this._kernel.liveEnd()},p._initKernel=function(){if(this._media){var e={box:this._config.box,isLive:this._config.isLive,kwaiKernelLog:"e",startPlayBufferSec:this._config.startPlayBufferSec||0};this._config.debug&&(e.kwaiKernelLog="v"),this._kernel=new n.a(this._media,e),this._kernel.on("error",this._onError),this._kernel.on("report",this._onReport)}},p._destroyKernel=function(){this._kernel&&(this._kernel.destroy(),this._kernel.removeAllListeners())},_}(a.EventEmitter);t.default=_}]).default}));
//# sourceMappingURL=kwai-player-kernel-external.js.map